(this["webpackJsonpketcher-react-app"]=this["webpackJsonpketcher-react-app"]||[]).push([[0],{335:function(t,e,n){"use strict";(function(t){var r=n(1),a=n.n(r),o=n(336),i=(n(548),n(337));n(804);t.Miew=o.a;e.a=function(){return a.a.createElement("div",null,a.a.createElement(i.a,{staticResourcesUrl:".",apiPath:"https://lifescience.opensource.epam.com/v2"}))}}).call(this,n(29))},337:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return Df}));n(272),n(549);var r=n(1),a=n.n(r),o=(n(550),n(551),n(105)),i=n.n(o),s=n(203),c=n.n(s),l=n(25),u=n.n(l),p=n(18),d=n.n(p),h=n(19),f=n.n(h),m=n(338),g=n.n(m),b=n(20),v=n.n(b),y=n(21),w=n.n(y),E=n(6),O=n.n(E),x=n(204),S=n.n(x),A=n(46),P=n.n(A),T=n(14),C=n.n(T),R=n(85),j=n.n(R),N=n(12),M=n(8),k=n(68),B=n.n(k),L=n(69),I=n(4),D=n.n(I),z=n(141),_=n.n(z),H=n(7),V=n.n(H),F=n(33),G=n.n(F),U=n(106),W=n.n(U),Y=n(78),q=n(341),$=n.n(q),K=n(86),X=n(342),Z=(n(699),n(38)),Q=n.n(Z),J=n(107),tt=n.n(J),et=n(207),nt=n(208),rt=n(343),at=n.n(rt),ot=n(344),it=n.n(ot),st=n(345),ct=n.n(st);function lt(t,e,n,r){return new Promise((function(a,o){setTimeout((function r(){t().then((function(t){try{e(t)?a(t):setTimeout(r,n)}catch(i){o(i)}}),(function(t){return o(t)}))}),r||0)}))}var ut=[null,{label:"H",period:1,group:1,title:"Hydrogen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:1.00794},{label:"He",period:1,group:8,title:"Helium",state:"gas",origin:"primordial",type:"noble",atomic_mass:4.0026022},{label:"Li",period:2,group:1,title:"Lithium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:6.94},{label:"Be",period:2,group:2,title:"Beryllium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:9.01218315},{label:"B",period:2,group:3,title:"Boron",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:10.81},{label:"C",period:2,group:4,title:"Carbon",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:12.011},{label:"N",period:2,group:5,title:"Nitrogen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:14.007},{label:"O",period:2,group:6,leftH:!0,title:"Oxygen",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:15.999},{label:"F",period:2,group:7,leftH:!0,title:"Fluorine",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:18.9984031636},{label:"Ne",period:2,group:8,title:"Neon",state:"gas",origin:"primordial",type:"noble",atomic_mass:20.17976},{label:"Na",period:3,group:1,title:"Sodium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:22.989769282},{label:"Mg",period:3,group:2,title:"Magnesium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:24.305},{label:"Al",period:3,group:3,title:"Aluminium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:26.98153857},{label:"Si",period:3,group:4,title:"Silicon",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:28.085},{label:"P",period:3,group:5,title:"Phosphorus",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:30.9737619985},{label:"S",period:3,group:6,leftH:!0,title:"Sulfur",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:32.06},{label:"Cl",period:3,group:7,leftH:!0,title:"Chlorine",state:"gas",origin:"primordial",type:"diatomic",atomic_mass:35.45},{label:"Ar",period:3,group:8,title:"Argon",state:"gas",origin:"primordial",type:"noble",atomic_mass:39.9481},{label:"K",period:4,group:1,title:"Potassium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:39.09831},{label:"Ca",period:4,group:2,title:"Calcium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:40.0784},{label:"Sc",period:4,group:3,title:"Scandium",state:"solid",origin:"primordial",type:"transition",atomic_mass:44.9559085},{label:"Ti",period:4,group:4,title:"Titanium",state:"solid",origin:"primordial",type:"transition",atomic_mass:47.8671},{label:"V",period:4,group:5,title:"Vanadium",state:"solid",origin:"primordial",type:"transition",atomic_mass:50.94151},{label:"Cr",period:4,group:6,title:"Chromium",state:"solid",origin:"primordial",type:"transition",atomic_mass:51.99616},{label:"Mn",period:4,group:7,title:"Manganese",state:"solid",origin:"primordial",type:"transition",atomic_mass:54.9380443},{label:"Fe",period:4,group:8,title:"Iron",state:"solid",origin:"primordial",type:"transition",atomic_mass:55.8452},{label:"Co",period:4,group:8,title:"Cobalt",state:"solid",origin:"primordial",type:"transition",atomic_mass:58.9331944},{label:"Ni",period:4,group:8,title:"Nickel",state:"solid",origin:"primordial",type:"transition",atomic_mass:58.69344},{label:"Cu",period:4,group:1,title:"Copper",state:"solid",origin:"primordial",type:"transition",atomic_mass:63.5463},{label:"Zn",period:4,group:2,title:"Zinc",state:"solid",origin:"primordial",type:"transition",atomic_mass:65.382},{label:"Ga",period:4,group:3,title:"Gallium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:69.7231},{label:"Ge",period:4,group:4,title:"Germanium",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:72.6308},{label:"As",period:4,group:5,title:"Arsenic",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:74.9215956},{label:"Se",period:4,group:6,leftH:!0,title:"Selenium",state:"solid",origin:"primordial",type:"polyatomic",atomic_mass:78.9718},{label:"Br",period:4,group:7,leftH:!0,title:"Bromine",state:"liquid",origin:"primordial",type:"diatomic",atomic_mass:79.904},{label:"Kr",period:4,group:8,title:"Krypton",state:"gas",origin:"primordial",type:"noble",atomic_mass:83.7982},{label:"Rb",period:5,group:1,title:"Rubidium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:85.46783},{label:"Sr",period:5,group:2,title:"Strontium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:87.621},{label:"Y",period:5,group:3,title:"Yttrium",state:"solid",origin:"primordial",type:"transition",atomic_mass:88.905842},{label:"Zr",period:5,group:4,title:"Zirconium",state:"solid",origin:"primordial",type:"transition",atomic_mass:91.2242},{label:"Nb",period:5,group:5,title:"Niobium",state:"solid",origin:"primordial",type:"transition",atomic_mass:92.906372},{label:"Mo",period:5,group:6,title:"Molybdenum",state:"solid",origin:"primordial",type:"transition",atomic_mass:95.951},{label:"Tc",period:5,group:7,title:"Technetium",state:"solid",origin:"decay",type:"transition",atomic_mass:98},{label:"Ru",period:5,group:8,title:"Ruthenium",state:"solid",origin:"primordial",type:"transition",atomic_mass:101.072},{label:"Rh",period:5,group:8,title:"Rhodium",state:"solid",origin:"primordial",type:"transition",atomic_mass:102.905502},{label:"Pd",period:5,group:8,title:"Palladium",state:"solid",origin:"primordial",type:"transition",atomic_mass:106.421},{label:"Ag",period:5,group:1,title:"Silver",state:"solid",origin:"primordial",type:"transition",atomic_mass:107.86822},{label:"Cd",period:5,group:2,title:"Cadmium",state:"solid",origin:"primordial",type:"transition",atomic_mass:112.4144},{label:"In",period:5,group:3,title:"Indium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:114.8181},{label:"Sn",period:5,group:4,title:"Tin",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:118.7107},{label:"Sb",period:5,group:5,title:"Antimony",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:121.7601},{label:"Te",period:5,group:6,title:"Tellurium",state:"solid",origin:"primordial",type:"metalloid",atomic_mass:127.603},{label:"I",period:5,group:7,leftH:!0,title:"Iodine",state:"solid",origin:"primordial",type:"diatomic",atomic_mass:126.904473},{label:"Xe",period:5,group:8,title:"Xenon",state:"gas",origin:"primordial",type:"noble",atomic_mass:131.2936},{label:"Cs",period:6,group:1,title:"Caesium",state:"solid",origin:"primordial",type:"alkali",atomic_mass:132.905451966},{label:"Ba",period:6,group:2,title:"Barium",state:"solid",origin:"primordial",type:"alkaline-earth",atomic_mass:137.3277},{label:"La",period:6,group:3,title:"Lanthanum",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:138.905477},{label:"Ce",period:6,group:3,title:"Cerium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:140.1161},{label:"Pr",period:6,group:3,title:"Praseodymium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:140.907662},{label:"Nd",period:6,group:3,title:"Neodymium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:144.2423},{label:"Pm",period:6,group:3,title:"Promethium",state:"solid",origin:"decay",type:"lanthanide",atomic_mass:145},{label:"Sm",period:6,group:3,title:"Samarium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:150.362},{label:"Eu",period:6,group:3,title:"Europium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:151.9641},{label:"Gd",period:6,group:3,title:"Gadolinium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:157.253},{label:"Tb",period:6,group:3,title:"Terbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:158.925352},{label:"Dy",period:6,group:3,title:"Dysprosium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:162.5001},{label:"Ho",period:6,group:3,title:"Holmium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:164.930332},{label:"Er",period:6,group:3,title:"Erbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:167.2593},{label:"Tm",period:6,group:3,title:"Thulium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:168.934222},{label:"Yb",period:6,group:3,title:"Ytterbium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:173.0451},{label:"Lu",period:6,group:3,title:"Lutetium",state:"solid",origin:"primordial",type:"lanthanide",atomic_mass:174.96681},{label:"Hf",period:6,group:4,title:"Hafnium",state:"solid",origin:"primordial",type:"transition",atomic_mass:178.492},{label:"Ta",period:6,group:5,title:"Tantalum",state:"solid",origin:"primordial",type:"transition",atomic_mass:180.947882},{label:"W",period:6,group:6,title:"Tungsten",state:"solid",origin:"primordial",type:"transition",atomic_mass:183.841},{label:"Re",period:6,group:7,title:"Rhenium",state:"solid",origin:"primordial",type:"transition",atomic_mass:186.2071},{label:"Os",period:6,group:8,title:"Osmium",state:"solid",origin:"primordial",type:"transition",atomic_mass:190.233},{label:"Ir",period:6,group:8,title:"Iridium",state:"solid",origin:"primordial",type:"transition",atomic_mass:192.2173},{label:"Pt",period:6,group:8,title:"Platinum",state:"solid",origin:"primordial",type:"transition",atomic_mass:195.0849},{label:"Au",period:6,group:1,title:"Gold",state:"solid",origin:"primordial",type:"transition",atomic_mass:196.9665695},{label:"Hg",period:6,group:2,title:"Mercury",state:"liquid",origin:"primordial",type:"transition",atomic_mass:200.5923},{label:"Tl",period:6,group:3,title:"Thallium",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:204.38},{label:"Pb",period:6,group:4,title:"Lead",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:207.21},{label:"Bi",period:6,group:5,title:"Bismuth",state:"solid",origin:"primordial",type:"post-transition",atomic_mass:208.980401},{label:"Po",period:6,group:6,title:"Polonium",state:"solid",origin:"decay",type:"post-transition",atomic_mass:209},{label:"At",period:6,group:7,title:"Astatine",state:"solid",origin:"decay",type:"metalloid",atomic_mass:210},{label:"Rn",period:6,group:8,title:"Radon",state:"gas",origin:"decay",type:"noble",atomic_mass:222},{label:"Fr",period:7,group:1,title:"Francium",state:"solid",origin:"decay",type:"alkali",atomic_mass:223},{label:"Ra",period:7,group:2,title:"Radium",state:"solid",origin:"decay",type:"alkaline-earth",atomic_mass:226},{label:"Ac",period:7,group:3,title:"Actinium",state:"solid",origin:"decay",type:"actinide",atomic_mass:227},{label:"Th",period:7,group:3,title:"Thorium",state:"solid",origin:"primordial",type:"actinide",atomic_mass:232.03774},{label:"Pa",period:7,group:3,title:"Protactinium",state:"solid",origin:"decay",type:"actinide",atomic_mass:231.035882},{label:"U",period:7,group:3,title:"Uranium",state:"solid",origin:"primordial",type:"actinide",atomic_mass:238.028913},{label:"Np",period:7,group:3,title:"Neptunium",state:"solid",origin:"decay",type:"actinide",atomic_mass:237},{label:"Pu",period:7,group:3,title:"Plutonium",state:"solid",origin:"decay",type:"actinide",atomic_mass:244},{label:"Am",period:7,group:3,title:"Americium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:243},{label:"Cm",period:7,group:3,title:"Curium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:247},{label:"Bk",period:7,group:3,title:"Berkelium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:247},{label:"Cf",period:7,group:3,title:"Californium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:251},{label:"Es",period:7,group:3,title:"Einsteinium",state:"solid",origin:"synthetic",type:"actinide",atomic_mass:252},{label:"Fm",period:7,group:3,title:"Fermium",origin:"synthetic",type:"actinide",atomic_mass:257},{label:"Md",period:7,group:3,title:"Mendelevium",origin:"synthetic",type:"actinide",atomic_mass:258},{label:"No",period:7,group:3,title:"Nobelium",origin:"synthetic",type:"actinide",atomic_mass:259},{label:"Lr",period:7,group:3,title:"Lawrencium",origin:"synthetic",type:"actinide",atomic_mass:266},{label:"Rf",period:7,group:4,title:"Rutherfordium",origin:"synthetic",type:"transition",atomic_mass:267},{label:"Db",period:7,group:5,title:"Dubnium",origin:"synthetic",type:"transition",atomic_mass:268},{label:"Sg",period:7,group:6,title:"Seaborgium",origin:"synthetic",type:"transition",atomic_mass:269},{label:"Bh",period:7,group:7,title:"Bohrium",origin:"synthetic",type:"transition",atomic_mass:270},{label:"Hs",period:7,group:8,title:"Hassium",origin:"synthetic",type:"transition",atomic_mass:269},{label:"Mt",period:7,group:8,title:"Meitnerium",origin:"synthetic",atomic_mass:278},{label:"Ds",period:7,group:8,title:"Darmstadtium",origin:"synthetic",atomic_mass:281},{label:"Rg",period:7,group:1,title:"Roentgenium",origin:"synthetic",atomic_mass:282},{label:"Cn",period:7,group:2,title:"Copernicium",origin:"synthetic",type:"transition",atomic_mass:285},{label:"Nh",period:7,group:3,title:"Nihonium",origin:"synthetic",atomic_mass:286},{label:"Fl",period:7,group:4,title:"Flerovium",origin:"synthetic",type:"post-transition",atomic_mass:289},{label:"Mc",period:7,group:5,title:"Moscovium",origin:"synthetic",atomic_mass:289},{label:"Lv",period:7,group:6,title:"Livermorium",origin:"synthetic",atomic_mass:293},{label:"Ts",period:7,group:7,title:"Tennessine",origin:"synthetic",atomic_mass:294},{label:"Og",period:7,group:8,title:"Oganesson",origin:"synthetic",atomic_mass:294}];function pt(t,e,n){if(0===arguments.length)this.x=0,this.y=0,this.z=0;else if(1===arguments.length)this.x=parseFloat(t.x||0),this.y=parseFloat(t.y||0),this.z=parseFloat(t.z||0);else if(2===arguments.length)this.x=parseFloat(t||0),this.y=parseFloat(e||0),this.z=0;else{if(3!==arguments.length)throw new Error("Vec2(): invalid arguments");this.x=parseFloat(t),this.y=parseFloat(e),this.z=parseFloat(n)}}function dt(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return ht(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ht(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function ht(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ft(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}ut.map=ut.reduce((function(t,e,n){return e&&(t[e.label]=n),t}),{}),pt.ZERO=new pt(0,0),pt.UNIT=new pt(1,1),pt.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},pt.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},pt.prototype.add=function(t){return new pt(this.x+t.x,this.y+t.y,this.z+t.z)},pt.prototype.add_=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},pt.prototype.get_xy0=function(){return new pt(this.x,this.y)},pt.prototype.sub=function(t){return new pt(this.x-t.x,this.y-t.y,this.z-t.z)},pt.prototype.scaled=function(t){return new pt(this.x*t,this.y*t,this.z*t)},pt.prototype.negated=function(){return new pt(-this.x,-this.y,-this.z)},pt.prototype.yComplement=function(t){return t=t||0,new pt(this.x,t-this.y,this.z)},pt.prototype.addScaled=function(t,e){return new pt(this.x+t.x*e,this.y+t.y*e,this.z+t.z*e)},pt.prototype.normalized=function(){return this.scaled(1/this.length())},pt.prototype.normalize=function(){var t=this.length();return!(t<1e-6)&&(this.x/=t,this.y/=t,!0)},pt.prototype.turnLeft=function(){return new pt(-this.y,this.x,this.z)},pt.prototype.coordStr=function(){return this.x.toString()+" , "+this.y.toString()},pt.prototype.toString=function(){return"("+this.x.toFixed(2)+","+this.y.toFixed(2)+")"},pt.prototype.max=function(t){return new pt.max(this,t)},pt.prototype.min=function(t){return new pt.min(this,t)},pt.prototype.ceil=function(){return new pt(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))},pt.prototype.floor=function(){return new pt(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))},pt.prototype.rotate=function(t){var e=Math.sin(t),n=Math.cos(t);return this.rotateSC(e,n)},pt.prototype.rotateSC=function(t,e){return new pt(this.x*e-this.y*t,this.x*t+this.y*e,this.z)},pt.prototype.oxAngle=function(){return Math.atan2(this.y,this.x)},pt.dist=function(t,e){return pt.diff(t,e).length()},pt.max=function(t,e){return new pt(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},pt.min=function(t,e){return new pt(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},pt.sum=function(t,e){return new pt(t.x+e.x,t.y+e.y,t.z+e.z)},pt.dot=function(t,e){return t.x*e.x+t.y*e.y},pt.cross=function(t,e){return t.x*e.y-t.y*e.x},pt.angle=function(t,e){return Math.atan2(pt.cross(t,e),pt.dot(t,e))},pt.diff=function(t,e){return new pt(t.x-e.x,t.y-e.y,t.z-e.z)},pt.lc=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=new pt,a=0;a<arguments.length/2;++a)r=r.addScaled(e[2*a],e[2*a+1]);return r},pt.lc2=function(t,e,n,r){return new pt(t.x*e+n.x*r,t.y*e+n.y*r,t.z*e+n.z*r)},pt.centre=function(t,e){return new pt.lc2(t,.5,e,.5)};var mt=function(t){v()(n,t);var e=ft(n);function n(t){var r;return d()(this,n),(r=e.call(this,t))._nextId=0,r}return f()(n,[{key:"add",value:function(t){var e=this._nextId++;return g()(O()(n.prototype),"set",this).call(this,e,t),e}},{key:"newId",value:function(){return this._nextId++}},{key:"keyOf",value:function(t){var e,n=dt(this.entries());try{for(n.s();!(e=n.n()).done;){var r=u()(e.value,2),a=r[0];if(r[1]===t)return a}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"find",value:function(t){var e,n=dt(this.entries());try{for(n.s();!(e=n.n()).done;){var r=u()(e.value,2),a=r[0];if(t(a,r[1]))return a}}catch(o){n.e(o)}finally{n.f()}return null}},{key:"filter",value:function(t){return new n(Array.from(this).filter((function(e){var n=u()(e,2),r=n[0],a=n[1];return t(r,a)})))}}]),n}(S()(Map));function gt(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return bt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function bt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function vt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var yt=function(t){v()(n,t);var e=vt(n);function n(){return d()(this,n),e.apply(this,arguments)}return f()(n,[{key:"find",value:function(t){var e,n=gt(this);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(t(r))return r}}catch(a){n.e(a)}finally{n.f()}return null}},{key:"equals",value:function(t){return this.isSuperset(t)&&t.isSuperset(this)}},{key:"isSuperset",value:function(t){var e,n=gt(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(!this.has(r))return!1}}catch(a){n.e(a)}finally{n.f()}return!0}},{key:"filter",value:function(t){return new n(Array.from(this).filter(t))}},{key:"union",value:function(t){var e,r=new n(this),a=gt(t);try{for(a.s();!(e=a.n()).done;){var o=e.value;r.add(o)}}catch(i){a.e(i)}finally{a.f()}return r}}]),n}(S()(Set));function wt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(1===e.length&&"min"in e[0]&&"max"in e[0]&&(this.p0=e[0].min,this.p1=e[0].max),2===e.length)this.p0=e[0],this.p1=e[1];else if(4===e.length)this.p0=new pt(e[0],e[1]),this.p1=new pt(e[2],e[3]);else{if(0!==e.length)return new Error("Box2Abs constructor only accepts 4 numbers or 2 vectors or no args!");this.p0=new pt,this.p1=new pt}}function Et(t){this.notList=t.notList,this.ids=t.ids}function Ot(t){var e,n=Ot.attrGetDefault;this.label=t.label,this.fragment="fragment"in t?t.fragment:-1,this.pseudo=t.pseudo||(e=t.label,ut.map[e]||"L"===e||"L#"===e||"R#"===e?null:e),St(this,t,"alias",n("alias")),St(this,t,"isotope",n("isotope")),St(this,t,"radical",n("radical")),St(this,t,"charge",n("charge")),St(this,t,"rglabel",n("rglabel")),St(this,t,"attpnt",n("attpnt")),St(this,t,"explicitValence",n("explicitValence")),this.valence=0,this.implicitH=0,this.pp=t.pp?new pt(t.pp):new pt,this.sgs=new yt,St(this,t,"ringBondCount",n("ringBondCount")),St(this,t,"substitutionCount",n("substitutionCount")),St(this,t,"unsaturatedAtom",n("unsaturatedAtom")),St(this,t,"hCount",n("hCount")),St(this,t,"aam",n("aam")),St(this,t,"invRet",n("invRet")),St(this,t,"exactChangeFlag",n("exactChangeFlag")),St(this,t,"rxnFragmentType",-1),St(this,t,"stereoLabel",n("stereoLabel")),St(this,t,"stereoParity",n("stereoParity")),this.atomList=t.atomList?new Et(t.atomList):null,this.neighbors=[],this.badConn=!1}function xt(t){return(t-=0)===Ot.PATTERN.RADICAL.NONE?0:t===Ot.PATTERN.RADICAL.DOUPLET?1:t===Ot.PATTERN.RADICAL.SINGLET||t===Ot.PATTERN.RADICAL.TRIPLET?2:void 0}function St(t,e,n,r){t[n]="undefined"!==typeof e[n]?e[n]:r}function At(t){this.begin=t.begin,this.end=t.end,this.type=t.type,this.xxx=t.xxx||"",this.stereo=At.PATTERN.STEREO.NONE,this.topology=At.PATTERN.TOPOLOGY.EITHER,this.reactingCenterStatus=0,this.hb1=null,this.hb2=null,this.len=0,this.sb=0,this.sa=0,this.angle=0,t.stereo&&(this.stereo=t.stereo),t.topology&&(this.topology=t.topology),t.reactingCenterStatus&&(this.reactingCenterStatus=t.reactingCenterStatus),this.center=new pt}function Pt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.stereoAtoms=[],this.enhancedStereoFlag=t}function Tt(t,e){if(!e||0===e.length)return null;var n=t.atoms.get(e[0]).stereoLabel;return e.map((function(e){return t.atoms.get(e)})).some((function(t){return t.stereoLabel!==n}))?"Mixed":null===n||void 0===n?void 0:n.split("-")[0]}function Ct(t){this.type=t,this.id=-1,this.label=-1,this.bracketBox=null,this.bracketDir=new pt(1,0),this.areas=[],this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null,this.atoms=[],this.patoms=[],this.bonds=[],this.xBonds=[],this.neiAtoms=[],this.pp=null,this.data={mul:1,connectivity:"ht",name:"",subscript:"n",attached:!1,absolute:!0,showUnits:!1,nCharsToDisplay:-1,tagChar:"",daspPos:1,fieldType:"F",fieldName:"",fieldValue:"",units:"",query:"",queryOp:""}}function Rt(t){t=t||{},this.frags=new yt,this.resth=t.resth||!1,this.range=t.range||"",this.ifthen=t.ifthen||0}function jt(){this.parent=new Map,this.children=new Map,this.children.set(-1,[]),this.atomSets=new Map}function Nt(){this.atoms=new mt,this.bonds=new mt,this.sgroups=new mt,this.halfBonds=new mt,this.loops=new mt,this.isReaction=!1,this.rxnArrows=new mt,this.rxnPluses=new mt,this.frags=new mt,this.rgroups=new mt,this.name="",this.sGroupForest=new jt,this.simpleObjects=new mt}function Mt(t,e,n){this.begin=t,this.end=e,this.bid=n,this.dir=new pt,this.norm=new pt,this.ang=0,this.p=new pt,this.loop=-1,this.contra=-1,this.next=-1,this.leftSin=0,this.leftCos=0,this.leftNeighbor=0,this.rightSin=0,this.rightCos=0,this.rightNeighbor=0}function kt(t,e,n){var r=this;this.hbs=t,this.dblBonds=0,this.aromatic=!0,this.convex=n||!1,t.forEach((function(t){var n=e.bonds.get(e.halfBonds.get(t).bid);n.type!==At.PATTERN.TYPE.AROMATIC&&(r.aromatic=!1),n.type===At.PATTERN.TYPE.DOUBLE&&r.dblBonds++}))}function Bt(t){t=t||{},this.pp=t.pp?new pt(t.pp):new pt}function Lt(t){if(t=t||{},this.pos=[],t.pos)for(var e=0;e<t.pos.length;e++)this.pos[e]=t.pos[e]?new pt(t.pos[e]):new pt;this.mode=t.mode}function It(t){t=t||{},this.pp=t.pp?new pt(t.pp):new pt}function Dt(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return!1;return t.push(e),!0}wt.prototype.toString=function(){return this.p0.toString()+" "+this.p1.toString()},wt.prototype.clone=function(){return new wt(this.p0,this.p1)},wt.prototype.extend=function(t,e){return e=e||t,new wt(this.p0.sub(t),this.p1.add(e))},wt.prototype.include=function(t){return new wt(this.p0.min(t),this.p1.max(t))},wt.prototype.contains=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.x>=this.p0.x-e&&t.x<=this.p1.x+e&&t.y>=this.p0.y-e&&t.y<=this.p1.y+e},wt.prototype.translate=function(t){return new wt(this.p0.add(t),this.p1.add(t))},wt.prototype.transform=function(t,e){return new wt(t(this.p0,e),t(this.p1,e))},wt.prototype.sz=function(){return this.p1.sub(this.p0)},wt.prototype.centre=function(){return pt.centre(this.p0,this.p1)},wt.prototype.pos=function(){return this.p0},wt.fromRelBox=function(t){return new wt(t.x,t.y,t.x+t.width,t.y+t.height)},wt.union=function(t,e){return new wt(pt.min(t.p0,e.p0),pt.max(t.p1,e.p1))},wt.segmentIntersection=function(t,e,n,r){var a=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x),o=(t.x-r.x)*(e.y-r.y)-(t.y-r.y)*(e.x-r.x),i=(n.x-t.x)*(r.y-t.y)-(n.y-t.y)*(r.x-t.x),s=(n.x-e.x)*(r.y-e.y)-(n.y-e.y)*(r.x-e.x);return a*o<=0&&i*s<=0},Et.prototype.labelList=function(){for(var t=[],e=0;e<this.ids.length;++e)t.push(ut[this.ids[e]].label);return t},Et.prototype.label=function(){var t="["+this.labelList().join(",")+"]";return this.notList&&(t="!"+t),t},Et.prototype.equals=function(t){return this.notList==t.notList&&(this.ids||[]).sort().toString()===(t.ids||[]).sort().toString()},Ot.getAttrHash=function(t){var e={};for(var n in Ot.attrlist)"undefined"!==typeof t[n]&&(e[n]=t[n]);return e},Ot.attrGetDefault=function(t){if(t in Ot.attrlist)return Ot.attrlist[t]},Ot.PATTERN={RADICAL:{NONE:0,SINGLET:1,DOUPLET:2,TRIPLET:3},STEREO_PARITY:{NONE:0,ODD:1,EVEN:2,EITHER:3}},Ot.attrlist={alias:null,label:"C",pseudo:null,isotope:0,radical:0,charge:0,explicitValence:-1,ringBondCount:0,substitutionCount:0,unsaturatedAtom:0,hCount:0,atomList:null,invRet:0,exactChangeFlag:0,rglabel:null,attpnt:null,aam:0,stereoLabel:null,stereoParity:0},Ot.prototype.clone=function(t){var e=new Ot(this);return t&&t.has(this.fragment)&&(e.fragment=t.get(this.fragment)),e},Ot.prototype.isQuery=function(){return null!==this.atomList||"A"===this.label||this.attpnt||this.hCount},Ot.prototype.pureHydrogen=function(){return"H"===this.label&&0===this.isotope},Ot.prototype.isPlainCarbon=function(){return"C"===this.label&&0===this.isotope&&0===this.radical&&0===this.charge&&this.explicitValence<0&&0===this.ringBondCount&&0===this.substitutionCount&&0===this.unsaturatedAtom&&0===this.hCount&&!this.atomList},Ot.prototype.isPseudo=function(){return!this.atomList&&!this.rglabel&&!ut.map[this.label]},Ot.prototype.hasRxnProps=function(){return!!(this.invRet||this.exactChangeFlag||null!==this.attpnt||this.aam)},Ot.prototype.calcValence=function(t){var e=this.charge,n=this.label;if(this.isQuery())return this.implicitH=0,!0;var r=ut.map[n];if(void 0===r)return this.implicitH=0,!0;var a=ut[r].group,o=xt(this.radical),i=t,s=0,c=Math.abs(e);return 1===a?"H"!==n&&"Li"!==n&&"Na"!==n&&"K"!==n&&"Rb"!==n&&"Cs"!==n&&"Fr"!==n||(i=1,s=1-o-t-c):2===a?t+o+c===2||t+o+c===0?i=2:s=-1:3===a?"B"===n||"Al"===n||"Ga"===n||"In"===n?-1===e?(i=4,s=4-o-t):(i=3,s=3-o-t-c):"Tl"===n&&(-1===e?o+t<=2?(i=2,s=2-o-t):(i=4,s=4-o-t):-2===e?o+t<=3?(i=3,s=3-o-t):(i=5,s=5-o-t):o+t+c<=1?(i=1,s=1-o-t-c):(i=3,s=3-o-t-c)):4===a?"C"===n||"Si"===n||"Ge"===n?(i=4,s=4-o-t-c):"Sn"!==n&&"Pb"!==n||(t+o+c<=2?(i=2,s=2-o-t-c):(i=4,s=4-o-t-c)):5===a?"N"===n||"P"===n?1===e?(i=4,s=4-o-t):2===e?(i=3,s=3-o-t):"N"===n||o+t+c<=3?(i=3,s=3-o-t-c):(i=5,s=5-o-t-c):"Bi"!==n&&"Sb"!==n&&"As"!==n||(1===e?o+t<=2&&"As"!==n?(i=2,s=2-o-t):(i=4,s=4-o-t):2===e?(i=3,s=3-o-t):o+t<=3?(i=3,s=3-o-t-c):(i=5,s=5-o-t-c)):6===a?"O"===n?e>=1?(i=3,s=3-o-t):(i=2,s=2-o-t-c):"S"===n||"Se"===n||"Po"===n?1===e?t<=3?(i=3,s=3-o-t):(i=5,s=5-o-t):t+o+c<=2?(i=2,s=2-o-t-c):t+o+c<=4?(i=4,s=4-o-t-c):(i=6,s=6-o-t-c):"Te"===n&&(-1===e?t<=2&&(i=2,s=2-o-t-c):0!==e&&2!==e||(t<=2?(i=2,s=2-o-t-c):t<=4?(i=4,s=4-o-t-c):0===e&&t<=6?(i=6,s=6-o-t-c):s=-1)):7===a?"F"===n?(i=1,s=1-o-t-c):"Cl"!==n&&"Br"!==n&&"I"!==n&&"At"!==n||(1===e?t<=2?(i=2,s=2-o-t):(3===t||5===t||t>=7)&&(s=-1):0===e&&(t<=1?(i=1,s=1-o-t):2===t||4===t||6===t?1===o?(i=t,s=0):s=-1:t>7&&(s=-1))):8===a&&(t+o+c===0?i=1:s=-1),this.valence=i,this.implicitH=s,!(this.implicitH<0)||(this.valence=t,this.implicitH=0,this.badConn=!0,!1)},Ot.prototype.calcValenceMinusHyd=function(t){var e=this.charge,n=this.label,r=ut.map[n];if(r<0)return this.implicitH=0,null;var a=ut[r].group,o=xt(this.radical);if(3===a){if(("B"===n||"Al"===n||"Ga"===n||"In"===n)&&-1===e&&o+t<=4)return o+t}else if(5===a){if("N"===n||"P"===n){if(1===e)return o+t;if(2===e)return o+t}else if("Sb"===n||"Bi"===n||"As"===n){if(1===e)return o+t;if(2===e)return o+t}}else if(6===a){if("O"===n){if(e>=1)return o+t}else if(("S"===n||"Se"===n||"Po"===n)&&1===e)return o+t}else if(7===a&&("Cl"===n||"Br"===n||"I"===n||"At"===n)&&1===e)return o+t;return o+t+Math.abs(e)},At.PATTERN={TYPE:{SINGLE:1,DOUBLE:2,TRIPLE:3,AROMATIC:4,SINGLE_OR_DOUBLE:5,SINGLE_OR_AROMATIC:6,DOUBLE_OR_AROMATIC:7,ANY:8},STEREO:{NONE:0,UP:1,EITHER:4,DOWN:6,CIS_TRANS:3},TOPOLOGY:{EITHER:0,RING:1,CHAIN:2},REACTING_CENTER:{NOT_CENTER:-1,UNMARKED:0,CENTER:1,UNCHANGED:2,MADE_OR_BROKEN:4,ORDER_CHANGED:8,MADE_OR_BROKEN_AND_CHANGED:12}},At.attrlist={type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.NONE,topology:At.PATTERN.TOPOLOGY.EITHER,reactingCenterStatus:At.PATTERN.REACTING_CENTER.UNMARKED},At.getAttrHash=function(t){var e={};for(var n in At.attrlist)"undefined"!==typeof t[n]&&(e[n]=t[n]);return e},At.attrGetDefault=function(t){if(t in At.attrlist)return At.attrlist[t]},At.prototype.hasRxnProps=function(){return!!this.reactingCenterStatus},At.prototype.getCenter=function(t){var e=t.atoms.get(this.begin).pp,n=t.atoms.get(this.end).pp;return pt.lc2(e,.5,n,.5)},At.prototype.getDir=function(t){var e=t.atoms.get(this.begin).pp;return t.atoms.get(this.end).pp.sub(e).normalized()},At.prototype.clone=function(t){var e=new At(this);return t&&(e.begin=t.get(e.begin),e.end=t.get(e.end)),e},Pt.prototype=Object.create(null),Pt.prototype.clone=function(t){var e=new Pt(this.enhancedStereoFlag);return e.stereoAtoms=this.stereoAtoms.map((function(e){return t.get(e)})),e},Pt.STEREO_FLAG={Mixed:"Mixed",abs:"ABS (Chiral)",and:"AND Enantiomer",or:"OR Enantiomer",null:null},Pt.prototype.updateStereoFlag=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.enhancedStereoFlag=!1!==e?e:Tt(t,this.stereoAtoms),this.enhancedStereoFlag},Pt.prototype.updateStereoAtom=function(t,e,n){n&&!this.stereoAtoms.includes(e)&&this.stereoAtoms.push(e),n||(this.stereoAtoms=this.stereoAtoms.filter((function(t){return t!==e}))),this.enhancedStereoFlag=Tt(t,this.stereoAtoms)},Ct.TYPES={MUL:1,SRU:2,SUP:3,DAT:4,GEN:5},Ct.prototype.getAttr=function(t){return this.data[t]},Ct.prototype.getAttrs=function(){var t=this,e={};return Object.keys(this.data).forEach((function(n){e[n]=t.data[n]})),e},Ct.prototype.setAttr=function(t,e){var n=this.data[t];return this.data[t]=e,n},Ct.prototype.checkAttr=function(t,e){return this.data[t]==e},Ct.filterAtoms=function(t,e){for(var n=[],r=0;r<t.length;++r){var a=t[r];"number"!==typeof e[a]?n.push(a):e[a]>=0?n.push(e[a]):n.push(-1)}return n},Ct.removeNegative=function(t){for(var e=[],n=0;n<t.length;++n)t[n]>=0&&e.push(t[n]);return e},Ct.filter=function(t,e,n){e.atoms=Ct.removeNegative(Ct.filterAtoms(e.atoms,n))},Ct.clone=function(t,e){var n=new Ct(t.type);return Object.keys(t.data).forEach((function(e){n.data[e]=t.data[e]})),n.atoms=t.atoms.map((function(t){return e.get(t)})),n.pp=t.pp,n.bracketBox=t.bracketBox,n.patoms=null,n.bonds=null,n.allAtoms=t.allAtoms,n},Ct.addAtom=function(t,e){t.atoms.push(e)},Ct.removeAtom=function(t,e){for(var n=0;n<t.atoms.length;++n)if(t.atoms[n]===e)return void t.atoms.splice(n,1)},Ct.getCrossBonds=function(t,e,n,r){n.bonds.forEach((function(n,a){r.has(n.begin)&&r.has(n.end)?null!==t&&t.push(a):(r.has(n.begin)||r.has(n.end))&&null!==e&&e.push(a)}))},Ct.bracketPos=function(t,e,n){var r=t.atoms;if(n&&2===n.length){var a=e.bonds.get(n[0]).getCenter(e),o=e.bonds.get(n[1]).getCenter(e);t.bracketDir=pt.diff(o,a).normalized()}else t.bracketDir=new pt(1,0);var i=t.bracketDir,s=null,c=[];r.forEach((function(t){var n=new pt(e.atoms.get(t).pp),r=new pt(.05*3,.05*3),a=new wt(n,n).extend(r,r);c.push(a)})),c.forEach((function(t){var e=null;[t.p0.x,t.p1.x].forEach((function(n){[t.p0.y,t.p1.y].forEach((function(t){var r=new pt(n,t),a=new pt(pt.dot(r,i),pt.dot(r,i.rotateSC(1,0)));e=null===e?new wt(a,a):e.include(a)}))})),s=null===s?e:wt.union(s,e)}));var l=new pt(.2,.4);null!==s&&(s=s.extend(l,l)),t.bracketBox=s},Ct.getBracketParameters=function(t,e,n,r,a,o){function i(t,e,n,r){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=r}var s=[];return e.length<2?function(){a=a||new pt(1,0),o=o||a.rotateSC(1,0);var t=Math.min(.25,.3*r.sz().x),e=pt.lc2(a,r.p0.x,o,.5*(r.p0.y+r.p1.y)),n=pt.lc2(a,r.p1.x,o,.5*(r.p0.y+r.p1.y)),c=r.sz().y;s.push(new i(e,a.negated(),t,c),new i(n,a,t,c))}():2===e.length?function(){var n=t.bonds.get(e[0]),r=t.bonds.get(e[1]),a=n.getCenter(t),o=r.getCenter(t),c=pt.diff(o,a).normalized(),l=c.negated();s.push(new i(a.addScaled(l,0),l,.25,1.5),new i(o.addScaled(c,0),c,.25,1.5))}():function(){for(var r=0;r<e.length;++r){var a=t.bonds.get(e[r]),o=a.getCenter(t),c=n.has(a.begin)?a.getDir(t):a.getDir(t).negated();s.push(new i(o,c,.2,1))}}(),s},Ct.getObjBBox=function(t,e){for(var n=e.atoms.get(t[0]).pp,r=new wt(n,n),a=1;a<t.length;++a){var o=t[a],i=e.atoms.get(o).pp;r=r.include(i)}return r},Ct.getAtoms=function(t,e){if(!e.allAtoms)return e.atoms;var n=[];return t.atoms.forEach((function(t,e){n.push(e)})),n},Ct.getBonds=function(t,e){var n=Ct.getAtoms(t,e),r=[];return t.bonds.forEach((function(t,e){n.indexOf(t.begin)>=0&&n.indexOf(t.end)>=0&&r.push(e)})),r},Ct.prepareMulForSaving=function(t,e){t.atoms.sort((function(t,e){return t-e})),t.atomSet=new yt(t.atoms),t.parentAtomSet=new yt(t.atomSet);var n=[],r=[];if(e.bonds.forEach((function(e,a){t.parentAtomSet.has(e.begin)&&t.parentAtomSet.has(e.end)?n.push(a):(t.parentAtomSet.has(e.begin)||t.parentAtomSet.has(e.end))&&r.push(a)})),0!==r.length&&2!==r.length)throw Error("Unsupported cross-bonds number");var a=-1,o=-1,i=null;if(2===r.length){var s=e.bonds.get(r[0]);a=t.parentAtomSet.has(s.begin)?s.begin:s.end;var c=e.bonds.get(r[1]);o=t.parentAtomSet.has(c.begin)?c.begin:c.end,i=c}for(var l=null,u=o,p=[],d=0;d<t.data.mul-1;d++)if(l={},t.atoms.forEach((function(n){var r=e.atoms.get(n),a=e.atoms.add(new Ot(r));p.push(a),t.atomSet.add(a),l[n]=a})),n.forEach((function(t){var n=new At(e.bonds.get(t));n.begin=l[n.begin],n.end=l[n.end],e.bonds.add(n)})),null!==i){var h=new At(i);h.begin=u,h.end=l[a],e.bonds.add(h),u=l[o]}if(u>=0){var f=e.bonds.get(r[1]);f.begin===o?f.begin=u:f.end=u}t.bonds=r,p.forEach((function(n){e.sGroupForest.getPathToRoot(t.id).reverse().forEach((function(t){e.atomAddToSGroup(t,n)}))}))},Ct.getMassCentre=function(t,e){for(var n=new pt,r=0;r<e.length;++r)n=n.addScaled(t.atoms.get(e[r]).pp,1/e.length);return n},Rt.prototype.getAttrs=function(){return{resth:this.resth,range:this.range,ifthen:this.ifthen}},Rt.findRGroupByFragment=function(t,e){return t.find((function(t,n){return n.frags.has(e)}))},Rt.prototype.clone=function(t){var e=new Rt(this);return this.frags.forEach((function(n){e.frags.add(t?t.get(n):n)})),e},jt.prototype.getSGroupsBFS=function(){for(var t=[],e=-1,n=Array.from(this.children.get(-1));n.length>0;)e=n.shift(),n=n.concat(this.children.get(e)),t.push(e);return t},jt.prototype.getAtomSetRelations=function(t,e){var n=this,r=new Map,a=new Map;this.atomSets.delete(t),this.atomSets.forEach((function(t,n){a.set(n,t.isSuperset(e)),r.set(n,e.isSuperset(t)&&!t.equals(e))}));var o=Array.from(this.atomSets.keys()).filter((function(t){return!!a.get(t)&&n.children.get(t).findIndex((function(t){return a.get(t)}))<0}));return{children:Array.from(this.atomSets.keys()).filter((function(t){return r.get(t)&&!r.get(n.parent.get(t))})),parent:0===o.length?-1:o[0]}},jt.prototype.getPathToRoot=function(t){for(var e=[],n=t;n>=0;n=this.parent.get(n))e.push(n);return e},jt.prototype.insert=function(t,e,n){var r=this,a=t.id,o=t.atoms;if(!e||!n){var i=this.getAtomSetRelations(a,new yt(o));e=i.parent,n=i.children}return n.forEach((function(t){var e=r.children.get(r.parent.get(t)),n=e.indexOf(t);e.splice(n,1),r.parent.set(t,a)})),this.children.set(a,n),this.parent.set(a,e),this.children.get(e).push(a),this.atomSets.set(a,new yt(o)),{parent:e,children:n}},jt.prototype.remove=function(t){var e=this,n=this.parent.get(t);this.children.get(t).forEach((function(t){e.parent.set(t,n),e.children.get(n).push(t)}));var r=this.children.get(n),a=r.indexOf(t);r.splice(a,1),this.children.delete(t),this.parent.delete(t),this.atomSets.delete(t)},Nt.prototype.hasRxnProps=function(){return this.atoms.find((function(t,e){return e.hasRxnProps()}))||this.bonds.find((function(t,e){return e.hasRxnProps()}))},Nt.prototype.hasRxnArrow=function(){return this.rxnArrows.size>0},Nt.prototype.isBlank=function(){return 0===this.atoms.size&&0===this.rxnArrows.size&&0===this.rxnPluses.size&&0===this.simpleObjects.size},Nt.prototype.clone=function(t,e,n,r,a){return this.mergeInto(new Nt,t,e,n,!1,r,a)},Nt.prototype.getScaffold=function(){var t=this,e=new yt;return this.atoms.forEach((function(t,n){e.add(n)})),this.rgroups.forEach((function(n){n.frags.forEach((function(n,r){t.atoms.forEach((function(t,n){t.fragment===r&&e.delete(n)}))}))})),this.clone(e)},Nt.prototype.getFragmentIds=function(t){var e=new yt;return this.atoms.forEach((function(n,r){n.fragment===t&&e.add(r)})),e},Nt.prototype.getFragment=function(t){return this.clone(this.getFragmentIds(t))},Nt.prototype.mergeInto=function(t,e,n,r,a,o,i){var s=this;e=e||new yt(this.atoms.keys()),n=n||new yt(this.bonds.keys()),i=i||new yt(this.simpleObjects.keys()),o=o||new Map,n=n.filter((function(t){var n=s.bonds.get(t);return e.has(n.begin)&&e.has(n.end)}));var c=new yt;this.atoms.forEach((function(t,n){e.has(n)&&c.add(t.fragment)}));var l=new Map;this.frags.forEach((function(e,n){c.has(n)&&l.set(n,t.frags.add(null))}));var u=[];this.rgroups.forEach((function(e,n){var r=a;if(r||(e.frags.forEach((function(t,e){u.push(e),c.has(e)&&(r=!0)})),r)){var o=t.rgroups.get(n);o?e.frags.forEach((function(t,e){u.push(e),c.has(e)&&o.frags.add(l.get(e))})):t.rgroups.set(n,e.clone(l))}})),this.atoms.forEach((function(n,r){e.has(r)&&-1===u.indexOf(n.fragment)&&o.set(r,t.atoms.add(n.clone(l)))})),this.atoms.forEach((function(n,r){e.has(r)&&-1!==u.indexOf(n.fragment)&&o.set(r,t.atoms.add(n.clone(l)))})),l.forEach((function(e,n){var r=JSON.parse(JSON.stringify(s.frags.get(n)));r&&0!==Object.keys(r).length&&t.frags.set(e,s.frags.get(n).clone(o))}));var p=new Map;return this.bonds.forEach((function(e,r){n.has(r)&&p.set(r,t.bonds.add(e.clone(o)))})),this.sgroups.forEach((function(n){if(!n.atoms.some((function(t){return!e.has(t)}))){n=Ct.clone(n,o);var r=t.sgroups.add(n);n.id=r,n.atoms.forEach((function(e){t.atoms.get(e).sgs.add(r)})),"DAT"===n.type?t.sGroupForest.insert(n,-1,[]):t.sGroupForest.insert(n)}})),i.forEach((function(e){t.simpleObjects.add(s.simpleObjects.get(e).clone())})),r||(t.isReaction=this.isReaction,this.rxnArrows.forEach((function(e){t.rxnArrows.add(e.clone())})),this.rxnPluses.forEach((function(e){t.rxnPluses.add(e.clone())}))),t},Nt.prototype.findBondId=function(t,e){return this.bonds.find((function(n,r){return r.begin===t&&r.end===e||r.begin===e&&r.end===t}))},Nt.prototype.initNeighbors=function(){var t=this;this.atoms.forEach((function(t){t.neighbors=[]})),this.bonds.forEach((function(e){var n=t.atoms.get(e.begin),r=t.atoms.get(e.end);n.neighbors.push(e.hb1),r.neighbors.push(e.hb2)}))},Nt.prototype.bondInitHalfBonds=function(t,e){(e=e||this.bonds.get(t)).hb1=2*t,e.hb2=2*t+1,this.halfBonds.set(e.hb1,new Mt(e.begin,e.end,t)),this.halfBonds.set(e.hb2,new Mt(e.end,e.begin,t));var n=this.halfBonds.get(e.hb1),r=this.halfBonds.get(e.hb2);n.contra=e.hb2,r.contra=e.hb1},Nt.prototype.halfBondUpdate=function(t){var e=this.halfBonds.get(t),n=this.atoms.get(e.begin).pp,r=this.atoms.get(e.end).pp,a=pt.diff(r,n).normalized();e.dir=pt.dist(r,n)>1e-4?a:new pt(1,0),e.norm=e.dir.turnLeft(),e.ang=e.dir.oxAngle(),e.loop<0&&(e.loop=-1)},Nt.prototype.initHalfBonds=function(){var t=this;this.halfBonds.clear(),this.bonds.forEach((function(e,n){t.bondInitHalfBonds(n,e)}))},Nt.prototype.setHbNext=function(t,e){this.halfBonds.get(this.halfBonds.get(t).contra).next=e},Nt.prototype.halfBondSetAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);r.rightCos=pt.dot(r.dir,n.dir),n.leftCos=pt.dot(r.dir,n.dir),r.rightSin=pt.cross(r.dir,n.dir),n.leftSin=pt.cross(r.dir,n.dir),n.leftNeighbor=e,r.rightNeighbor=t},Nt.prototype.atomAddNeighbor=function(t){for(var e=this.halfBonds.get(t),n=this.atoms.get(e.begin),r=0;r<n.neighbors.length&&!(this.halfBonds.get(n.neighbors[r]).ang>e.ang);++r);n.neighbors.splice(r,0,t);var a=n.neighbors[(r+1)%n.neighbors.length],o=n.neighbors[(r+n.neighbors.length-1)%n.neighbors.length];this.setHbNext(o,t),this.setHbNext(t,a),this.halfBondSetAngle(t,o),this.halfBondSetAngle(a,t)},Nt.prototype.atomSortNeighbors=function(t){var e=this,n=this.atoms.get(t),r=this.halfBonds;n.neighbors.sort((function(t,e){return r.get(t).ang-r.get(e).ang})).forEach((function(t,r){var a=n.neighbors[(r+1)%n.neighbors.length];e.halfBonds.get(e.halfBonds.get(t).contra).next=a,e.halfBondSetAngle(a,t)}))},Nt.prototype.sortNeighbors=function(t){var e=this;t?t.forEach((function(t){e.atomSortNeighbors(t)})):this.atoms.forEach((function(t,n){e.atomSortNeighbors(n)}))},Nt.prototype.atomUpdateHalfBonds=function(t){var e=this;this.atoms.get(t).neighbors.forEach((function(t){e.halfBondUpdate(t),e.halfBondUpdate(e.halfBonds.get(t).contra)}))},Nt.prototype.updateHalfBonds=function(t){var e=this;t?t.forEach((function(t){e.atomUpdateHalfBonds(t)})):this.atoms.forEach((function(t,n){e.atomUpdateHalfBonds(n)}))},Nt.prototype.sGroupsRecalcCrossBonds=function(){var t=this;this.sgroups.forEach((function(t){t.xBonds=[],t.neiAtoms=[]})),this.bonds.forEach((function(e,n){var r=t.atoms.get(e.begin),a=t.atoms.get(e.end);r.sgs.forEach((function(r){if(!a.sgs.has(r)){var o=t.sgroups.get(r);o.xBonds.push(n),Dt(o.neiAtoms,e.end)}})),a.sgs.forEach((function(a){if(!r.sgs.has(a)){var o=t.sgroups.get(a);o.xBonds.push(n),Dt(o.neiAtoms,e.begin)}}))}))},Nt.prototype.sGroupDelete=function(t){var e=this;this.sgroups.get(t).atoms.forEach((function(n){e.atoms.get(n).sgs.delete(t)})),this.sGroupForest.remove(t),this.sgroups.delete(t)},Nt.prototype.atomSetPos=function(t,e){this.atoms.get(t).pp=e},Nt.prototype.rxnPlusSetPos=function(t,e){this.rxnPluses.get(t).pp=e},Nt.prototype.rxnArrowSetPos=function(t,e){this.rxnArrows.get(t).pp=e},Nt.prototype.simpleObjectSetPos=function(t,e){this.simpleObjects.get(t).pos=e},Nt.prototype.getCoordBoundingBox=function(t){var e=null;function n(t){e?(e.min=pt.min(e.min,t),e.max=pt.max(e.max,t)):e={min:t,max:t}}var r=!t||0===t.size;return this.atoms.forEach((function(e,a){(r||t.has(a))&&n(e.pp)})),r&&(this.rxnPluses.forEach((function(t){n(t.pp)})),this.rxnArrows.forEach((function(t){n(t.pp)}))),!e&&r&&(e={min:new pt(0,0),max:new pt(1,1)}),e},Nt.prototype.getCoordBoundingBoxObj=function(){var t=null;return this.atoms.forEach((function(e){var n;n=e.pp,t?(t.min=pt.min(t.min,n),t.max=pt.max(t.max,n)):t={min:new pt(n),max:new pt(n)}})),t},Nt.prototype.getBondLengthData=function(){var t=this,e=0,n=0;return this.bonds.forEach((function(r){e+=pt.dist(t.atoms.get(r.begin).pp,t.atoms.get(r.end).pp),n++})),{cnt:n,totalLength:e}},Nt.prototype.getAvgBondLength=function(){var t=this.getBondLengthData();return t.cnt>0?t.totalLength/t.cnt:-1},Nt.prototype.getAvgClosestAtomDistance=function(){var t,e,n,r=0,a=0,o=this.atoms.keys();for(e=0;e<o.length;++e){for(t=-1,n=0;n<o.length;++n)n!=e&&(a=pt.dist(this.atoms.get(o[n]).pp,this.atoms.get(o[e]).pp),(t<0||t>a)&&(t=a));r+=t}return o.length>0?r/o.length:-1},Nt.prototype.checkBondExists=function(t,e){return void 0!==this.bonds.find((function(n,r){return r.begin===t&&r.end===e||r.end===t&&r.begin===e}))},Nt.prototype.findConnectedComponent=function(t){for(var e=this,n=[t],r=new yt;n.length>0;){var a=n.pop();r.add(a),this.atoms.get(a).neighbors.forEach((function(t){var a=e.halfBonds.get(t).end;r.has(a)||n.push(a)}))}return r},Nt.prototype.findConnectedComponents=function(t){var e=this;this.halfBonds.size||(this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(Array.from(this.atoms.keys())),this.sortNeighbors(Array.from(this.atoms.keys())));var n=new yt,r=[];return this.atoms.forEach((function(a,o){if((t||a.fragment<0)&&!n.has(o)){var i=e.findConnectedComponent(o);r.push(i),n=n.union(i)}})),r},Nt.prototype.markFragment=function(t){var e=this,n=new Pt,r=this.frags.add(n);t.forEach((function(t){var a=e.atoms.get(t);a.stereoLabel&&n.updateStereoAtom(e,t,!0),a.fragment=r}))},Nt.prototype.markFragments=function(){var t=this;this.findConnectedComponents().forEach((function(e){t.markFragment(e)}))},Nt.prototype.scale=function(t){1!==t&&(this.atoms.forEach((function(e){e.pp=e.pp.scaled(t)})),this.rxnPluses.forEach((function(e){e.pp=e.pp.scaled(t)})),this.rxnArrows.forEach((function(e){e.pp=e.pp.scaled(t)})),this.sgroups.forEach((function(e){e.pp=e.pp?e.pp.scaled(t):null})))},Nt.prototype.rescale=function(){var t=this.getAvgBondLength();t<0&&!this.isReaction&&(t=this.getAvgClosestAtomDistance()),t<.001&&(t=1);var e=1/t;this.scale(e)},Nt.prototype.loopHasSelfIntersections=function(t){for(var e=0;e<t.length;++e)for(var n=this.halfBonds.get(t[e]),r=this.atoms.get(n.begin).pp,a=this.atoms.get(n.end).pp,o=new yt([n.begin,n.end]),i=e+2;i<t.length;++i){var s=this.halfBonds.get(t[i]);if(!o.has(s.begin)&&!o.has(s.end)){var c=this.atoms.get(s.begin).pp,l=this.atoms.get(s.end).pp;if(wt.segmentIntersection(r,a,c,l))return!0}}return!1},Nt.prototype.partitionLoop=function(t){for(var e=[],n=!0;n;){var r={};n=!1;for(var a=0;a<t.length;++a){var o=t[a],i=this.halfBonds.get(o).begin,s=this.halfBonds.get(o).end;if(s in r){var c=r[s],l=t.slice(c,a+1);e.push(l),a<t.length&&t.splice(c,a-c+1),n=!0;break}r[i]=a}n||e.push(t)}return e},Nt.prototype.halfBondAngle=function(t,e){var n=this.halfBonds.get(t),r=this.halfBonds.get(e);return Math.atan2(pt.cross(n.dir,r.dir),pt.dot(n.dir,r.dir))},Nt.prototype.loopIsConvex=function(t){var e=this;return t.every((function(t,n,r){return e.halfBondAngle(t,r[(n+1)%r.length])<=0}))},Nt.prototype.loopIsInner=function(t){var e=this,n=2*Math.PI;return t.forEach((function(t,r,a){var o=a[(r+1)%a.length],i=e.halfBonds.get(o),s=e.halfBondAngle(t,o);n+=i.contra===t?Math.PI:s})),Math.abs(n)<Math.PI},Nt.prototype.findLoops=function(){var t,e,n,r,a=this,o=[],i=new yt;return this.halfBonds.forEach((function(s,c){if(-1===s.loop)for(t=c,e=0,n=[];e<=a.halfBonds.size;t=a.halfBonds.get(t).next,++e){if(e>0&&t===c){a.partitionLoop(n).forEach((function(t){a.loopIsInner(t)&&!a.loopHasSelfIntersections(t)?(r=Math.min.apply(Math,P()(t)),a.loops.set(r,new kt(t,a,a.loopIsConvex(t)))):r=-2,t.forEach((function(t){a.halfBonds.get(t).loop=r,i.add(a.halfBonds.get(t).bid)})),r>=0&&o.push(r)}));break}n.push(t)}})),{newLoops:o,bondsToMark:Array.from(i)}},Nt.prototype.prepareLoopStructure=function(){this.initHalfBonds(),this.initNeighbors(),this.updateHalfBonds(Array.from(this.atoms.keys())),this.sortNeighbors(Array.from(this.atoms.keys())),this.findLoops()},Nt.prototype.atomAddToSGroup=function(t,e){Ct.addAtom(this.sgroups.get(t),e),this.atoms.get(e).sgs.add(t)},Nt.prototype.calcConn=function(t){for(var e=0,n=0;n<t.neighbors.length;++n){var r=this.halfBonds.get(t.neighbors[n]);switch(this.bonds.get(r.bid).type){case At.PATTERN.TYPE.SINGLE:e+=1;break;case At.PATTERN.TYPE.DOUBLE:e+=2;break;case At.PATTERN.TYPE.TRIPLE:e+=3;break;case At.PATTERN.TYPE.AROMATIC:return 1===t.neighbors.length?[-1,!0]:[t.neighbors.length,!0];default:return[-1,!1]}}return[e,!1]},Nt.prototype.calcImplicitHydrogen=function(t){var e=this.atoms.get(t),n=this.calcConn(e),r=u()(n,2),a=r[0],o=r[1],i=a;if(e.badConn=!1,o)if("C"===e.label&&0===e.charge){if(3===a)return void(e.implicitH=-xt(e.radical));if(2===a)return void(e.implicitH=1-xt(e.radical))}else{if("O"===e.label&&0===e.charge||"N"===e.label&&0===e.charge&&3===a||"N"===e.label&&1===e.charge&&3===a||"S"===e.label&&0===e.charge&&3===a)return void(e.implicitH=0);e.hasImplicitH||i++}if(i<0||e.isQuery())e.implicitH=0;else if(e.explicitValence>=0){var s=ut.map[e.label];e.implicitH=null!==s?e.explicitValence-e.calcValenceMinusHyd(i):0,e.implicitH<0&&(e.implicitH=0,e.badConn=!0)}else e.calcValence(i)},Nt.prototype.setImplicitHydrogen=function(t){var e=this;this.sgroups.forEach((function(t){"MRV_IMPLICIT_H"===t.data.fieldName&&(e.atoms.get(t.atoms[0]).hasImplicitH=!0)})),t?t.forEach((function(t){e.calcImplicitHydrogen(t)})):this.atoms.forEach((function(t,n){e.calcImplicitHydrogen(n)}))},Nt.prototype.getComponents=function(){var t=this,e=this.findConnectedComponents(!0),n=[],r=null;this.rxnArrows.forEach((function(t){r=t.pp.x})),this.rxnPluses.forEach((function(t){n.push(t.pp.x)})),null!==r&&n.push(r),n.sort((function(t,e){return t-e}));var a=[];e.forEach((function(e){for(var r=t.getCoordBoundingBox(e),o=pt.lc2(r.min,.5,r.max,.5),i=0;o.x>n[i];)++i;a[i]=a[i]||new yt,a[i]=a[i].union(e)}));var o=[],i=[];return a.forEach((function(e){e&&(1===t.defineRxnFragmentTypeForAtomset(e,r)?o.push(e):i.push(e))})),{reactants:o,products:i}},Nt.prototype.defineRxnFragmentTypeForAtomset=function(t,e){var n=this.getCoordBoundingBox(t);return pt.lc2(n.min,.5,n.max,.5).x<e?1:2},Nt.prototype.getBondFragment=function(t){var e=this.bonds.get(t).begin;return this.atoms.get(e).fragment},Bt.prototype.clone=function(){return new Bt(this)},Lt.prototype.clone=function(){return new Lt(this)},Lt.prototype.center=function(){switch(this.mode){case"rectangle":return pt.centre(this.pos[0],this.pos[1]);default:return this.pos[0]}},It.prototype.clone=function(){return new It(this)};var zt={bondTypeMap:{1:At.PATTERN.TYPE.SINGLE,2:At.PATTERN.TYPE.DOUBLE,3:At.PATTERN.TYPE.TRIPLE,4:At.PATTERN.TYPE.AROMATIC,5:At.PATTERN.TYPE.SINGLE_OR_DOUBLE,6:At.PATTERN.TYPE.SINGLE_OR_AROMATIC,7:At.PATTERN.TYPE.DOUBLE_OR_AROMATIC,8:At.PATTERN.TYPE.ANY},bondStereoMap:{0:At.PATTERN.STEREO.NONE,1:At.PATTERN.STEREO.UP,4:At.PATTERN.STEREO.EITHER,6:At.PATTERN.STEREO.DOWN,3:At.PATTERN.STEREO.CIS_TRANS},v30bondStereoMap:{0:At.PATTERN.STEREO.NONE,1:At.PATTERN.STEREO.UP,2:At.PATTERN.STEREO.EITHER,3:At.PATTERN.STEREO.DOWN},bondTopologyMap:{0:At.PATTERN.TOPOLOGY.EITHER,1:At.PATTERN.TOPOLOGY.RING,2:At.PATTERN.TOPOLOGY.CHAIN},countsLinePartition:[3,3,3,3,3,3,3,3,3,3,3,6],atomLinePartition:[10,10,10,1,3,2,3,3,3,3,3,3,3,3,3,3,3],bondLinePartition:[3,3,3,3,3,3,3],atomListHeaderPartition:[3,1,1,4,1,1],atomListHeaderLength:11,atomListHeaderItemLength:4,chargeMap:[0,3,2,1,0,-1,-2,-3],valenceMap:[void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,0],implicitHydrogenMap:[void 0,0,1,2,3,4],v30atomPropMap:{CHG:"charge",RAD:"radical",MASS:"isotope",VAL:"explicitValence",HCOUNT:"hCount",INVRET:"invRet",SUBST:"substitutionCount",UNSAT:"unsaturatedAtom",RBCNT:"ringBondCount"},rxnItemsPartition:[3,3,3]},_t=1,Ht=2,Vt=3;var Ft={fmtInfo:zt,paddedNum:function(t,e,n){var r=(t=parseFloat(t)).toFixed(n||0).replace(",",".");if(r.length>e)throw new Error("number does not fit");return r.padStart(e)},parseDecimalInt:function(t){var e=parseInt(t,10);return isNaN(e)?0:e},partitionLine:function(t,e,n){for(var r=[],a=0,o=0;a<e.length;++a)r.push(t.slice(o,o+e[a])),n&&o++,o+=e[a];return r},partitionLineFixed:function(t,e,n){for(var r=[],a=0;a<t.length;a+=e)r.push(t.slice(a,a+e)),n&&a++;return r},rxnMerge:function(t,e,n,r,a){var o,i=new Nt,s=[],c=[],l=[],u=[],p=[],d=[],h={cnt:0,totalLength:0};for(o=0;o<t.length;++o){var f=t[o],m=f.getBondLengthData();h.cnt+=m.cnt,h.totalLength+=m.totalLength}var g,b,v,y,w=1/(0==h.cnt?1:h.totalLength/h.cnt);for(o=0;o<t.length;++o)(f=t[o]).scale(w);for(o=0;o<t.length;++o){var E=(f=t[o]).getCoordBoundingBoxObj();if(E){var O=o<e?_t:o<e+n?Ht:Vt;O==_t?(s.push(E),u.push(f)):O==Vt?(c.push(E),p.push(f)):O==Ht&&(l.push(E),d.push(f)),f.atoms.forEach((function(t){t.rxnFragmentType=O}))}}function x(t,e,n,r,a){var o=new pt(r-n.min.x,a?1-n.min.y:-(n.min.y+n.max.y)/2);return e.atoms.forEach((function(t){t.pp.add_(o)})),e.sgroups.forEach((function(t){t.pp&&t.pp.add_(o)})),n.min.add_(o),n.max.add_(o),e.mergeInto(t),n.max.x-n.min.x}if(a){var S=0;for(o=0;o<u.length;++o)S+=x(i,u[o],s[o],S,!1)+2;for(S+=2,o=0;o<p.length;++o)S+=x(i,p[o],c[o],S,!0)+2;for(S+=2,o=0;o<d.length;++o)S+=x(i,d[o],l[o],S,!1)+2}else{for(o=0;o<u.length;++o)u[o].mergeInto(i);for(o=0;o<p.length;++o)p[o].mergeInto(i);for(o=0;o<d.length;++o)d[o].mergeInto(i)}var A=null,P=null;for(o=0;o<s.length-1;++o)g=s[o],b=s[o+1],v=(g.max.x+b.min.x)/2,y=(g.max.y+g.min.y+b.max.y+b.min.y)/4,i.rxnPluses.add(new Bt({pp:new pt(v,y)}));for(o=0;o<s.length;++o)0==o?((A={}).max=new pt(s[o].max),A.min=new pt(s[o].min)):(A.max=pt.max(A.max,s[o].max),A.min=pt.min(A.min,s[o].min));for(o=0;o<l.length-1;++o)g=l[o],b=l[o+1],v=(g.max.x+b.min.x)/2,y=(g.max.y+g.min.y+b.max.y+b.min.y)/4,i.rxnPluses.add(new Bt({pp:new pt(v,y)}));for(o=0;o<l.length;++o)0==o?((P={}).max=new pt(l[o].max),P.min=new pt(l[o].min)):(P.max=pt.max(P.max,l[o].max),P.min=pt.min(P.min,l[o].min));if(b=P,(g=A)||b){var T=g?new pt(g.max.x,(g.max.y+g.min.y)/2):null,C=b?new pt(b.min.x,(b.max.y+b.min.y)/2):null;T||(T=new pt(C.x-3,C.y)),C||(C=new pt(T.x+3,T.y)),i.rxnArrows.add(new It({pp:pt.lc2(T,.5,C,.5)}))}else i.rxnArrows.add(new It({pp:new pt(0,0)}));return i.isReaction=!0,i}};function Gt(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return Ut(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function Ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Wt(t,e){for(var n=new mt,r=Ft.partitionLineFixed(t,3,!0),a=Ft.parseDecimalInt(r[0]),o=0;o<a;++o){var i=Ft.parseDecimalInt(r[2*o+1])-1,s=e?r[2*o+2].trim():Ft.parseDecimalInt(r[2*o+2]);n.set(i,s)}return n}function Yt(t,e,n){t.data.mul=t.data.subscript-0;var r={};t.atoms=Ct.filterAtoms(t.atoms,n),t.patoms=Ct.filterAtoms(t.patoms,n);for(var a=1;a<t.data.mul;++a)for(var o=0;o<t.patoms.length;++o){var i=t.atoms[a*t.patoms.length+o];if(!(i<0)){if(t.patoms[o]<0)throw new Error("parent atom missing");r[i]=t.patoms[o]}}t.patoms=Ct.removeNegative(t.patoms);var s=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=t[n];return e}(t.patoms),c=[];e.bonds.forEach((function(t,e){var n=t.begin in r,a=t.end in r;n&&a||n&&t.end in s||a&&t.begin in s?c.push(e):n?t.begin=r[t.begin]:a&&(t.end=r[t.end])}),t);for(var l=0;l<c.length;++l)e.bonds.delete(c[l]);for(var u in r)e.atoms.delete(+u),n[u]=-1;t.atoms=t.patoms,t.patoms=null}function qt(t){t.data.connectivity=(t.data.connectivity||"EU").trim().toLowerCase()}function $t(t){t.data.name=(t.data.subscript||"").trim(),t.data.subscript=""}function Kt(t,e,n){}function Xt(t,e){t.data.absolute||(t.pp=t.pp.add(Ct.getMassCentre(e,t.atoms)))}function Zt(t,e){var n=Ft.partitionLine(e,[10,10,4,1,1,1,3,3,3,3,2,3,2],!1),r=parseFloat(n[0]),a=parseFloat(n[1]),o="A"==n[3].trim(),i="A"==n[4].trim(),s="U"==n[5].trim(),c=n[7].trim();c="ALL"==c?-1:Ft.parseDecimalInt(c);var l=n[10].trim(),u=Ft.parseDecimalInt(n[11].trim());t.pp=new pt(r,-a),t.data.attached=o,t.data.absolute=i,t.data.showUnits=s,t.data.nCharsToDisplay=c,t.data.tagChar=l,t.data.daspPos=u}function Qt(t,e,n){t.data.fieldValue=(t.data.fieldValue||"")+e,n&&(t.data.fieldValue=t.data.fieldValue.replace(/\s+$/,""),t.data.fieldValue.startsWith('"')&&t.data.fieldValue.endsWith('"')&&(t.data.fieldValue=t.data.fieldValue.substr(1,t.data.fieldValue.length-2)))}var Jt={readKeyValuePairs:Wt,readKeyMultiValuePairs:function(t,e){for(var n=[],r=Ft.partitionLineFixed(t,3,!0),a=Ft.parseDecimalInt(r[0]),o=0;o<a;++o)n.push([Ft.parseDecimalInt(r[2*o+1])-1,e?r[2*o+2].trim():Ft.parseDecimalInt(r[2*o+2])]);return n},loadSGroup:function(t,e,n){var r={MUL:Yt,SRU:qt,SUP:$t,DAT:Xt,GEN:Kt};e.id=t.sgroups.add(e),r[e.type](e,t,n);for(var a=0;a<e.atoms.length;++a)t.atoms.has(e.atoms[a])&&t.atoms.get(e.atoms[a]).sgs.add(e.id);return"DAT"===e.type?t.sGroupForest.insert(e,-1,[]):t.sGroupForest.insert(e),e.id},initSGroup:function(t,e){var n,r=Gt(Wt(e,!0));try{for(r.s();!(n=r.n()).done;){var a=u()(n.value,2),o=a[0],i=a[1];if(!(i in Ct.TYPES))throw new Error("Unsupported S-group type");var s=new Ct(i);s.number=o,t[o]=s}}catch(c){r.e(c)}finally{r.f()}},applySGroupProp:function(t,e,n,r,a){var o,i=Wt(n,!r),s=Gt(i.keys());try{for(s.s();!(o=s.n()).done;){var c=o.value;(a?t[c]:t[c].data)[e]=i.get(c)}}catch(l){s.e(l)}finally{s.f()}},applySGroupArrayProp:function(t,e,n,r){var a=Ft.parseDecimalInt(n.slice(1,4))-1,o=Ft.parseDecimalInt(n.slice(4,8)),i=function(t){for(var e=[],n=0;n<t.length;++n)e[n]=Ft.parseDecimalInt(t[n]);return e}(Ft.partitionLineFixed(n.slice(8),3,!0));if(i.length!==o)throw new Error("File format invalid");r&&(i=i.map((function(t){return t+r}))),t[a][e]=t[a][e].concat(i)},applyDataSGroupName:function(t,e){t.data.fieldName=e},applyDataSGroupQuery:function(t,e){t.data.query=e},applyDataSGroupQueryOp:function(t,e){t.data.queryOp=e},applyDataSGroupDesc:function(t,e){var n=Ft.partitionLine(e,[4,31,2,20,2,3],!1),r=Ft.parseDecimalInt(n[0])-1,a=n[1].trim(),o=n[2].trim(),i=n[3].trim(),s=n[4].trim(),c=n[5].trim(),l=t[r];l.data.fieldType=o,l.data.fieldName=a,l.data.units=i,l.data.query=s,l.data.queryOp=c},applyDataSGroupInfo:Zt,applyDataSGroupData:Qt,applyDataSGroupInfoLine:function(t,e){Zt(t[Ft.parseDecimalInt(e.substr(0,4))-1],e.substr(5))},applyDataSGroupDataLine:function(t,e,n){var r=Ft.parseDecimalInt(e.substr(0,5))-1,a=e.substr(5);Qt(t[r],a,n)}};function te(t){var e=Ft.partitionLine(t,Ft.fmtInfo.atomLinePartition);return new Ot({pp:new pt(parseFloat(e[0]),-parseFloat(e[1]),parseFloat(e[2])),label:e[4].trim(),explicitValence:Ft.fmtInfo.valenceMap[Ft.parseDecimalInt(e[10])],massDifference:Ft.parseDecimalInt(e[5]),charge:Ft.fmtInfo.chargeMap[Ft.parseDecimalInt(e[6])],hCount:Ft.parseDecimalInt(Ft.parseDecimalInt(e[8])),stereoCare:0!=Ft.parseDecimalInt(e[9]),aam:Ft.parseDecimalInt(e[14]),invRet:Ft.parseDecimalInt(e[15]),exactChangeFlag:0!=Ft.parseDecimalInt(e[16])})}function ee(t){var e=Ft.partitionLine(t,Ft.fmtInfo.bondLinePartition);return new At({begin:Ft.parseDecimalInt(e[0])-1,end:Ft.parseDecimalInt(e[1])-1,type:Ft.fmtInfo.bondTypeMap[Ft.parseDecimalInt(e[2])],stereo:Ft.fmtInfo.bondStereoMap[Ft.parseDecimalInt(e[3])],xxx:e[4],topology:Ft.fmtInfo.bondTopologyMap[Ft.parseDecimalInt(e[5])],reactingCenterStatus:Ft.parseDecimalInt(e[6])})}function ne(t){for(var e=Ft.partitionLine(t,Ft.fmtInfo.atomListHeaderPartition),n=Ft.parseDecimalInt(e[0])-1,r="T"==e[2].trim(),a=Ft.parseDecimalInt(e[4].trim()),o=t.slice(Ft.fmtInfo.atomListHeaderLength),i=[],s=Ft.fmtInfo.atomListHeaderItemLength,c=0;c<a;++c)i[c]=Ft.parseDecimalInt(o.slice(c*s,(c+1)*s-1));return{aid:n,atomList:new Et({notList:r,ids:i})}}function re(t,e){var n,r=new Nt,a=Ft.parseDecimalInt(e[0]),o=Ft.parseDecimalInt(e[1]),i=Ft.parseDecimalInt(e[2]),s=1===Ft.parseDecimalInt(e[4]),c=Ft.parseDecimalInt(e[5]),l=Ft.parseDecimalInt(e[10]),u=0,p=t.slice(u,u+a);u+=a;var d=t.slice(u,u+o);u+=o;var h=t.slice(u,u+i);u+=i+c,p.map(te).forEach((function(t){return r.atoms.add(t)})),d.map(ee).forEach((function(t){t.stereo&&s&&(r.atoms.get(t.begin).stereoLabel="abs"),r.bonds.add(t)})),h.map(ne).forEach((function(t){r.atoms.get(t.aid).atomList=t.atomList,r.atoms.get(t.aid).label="L#"}));var f={},m={};(function(t,e,n,r,a,o){for(var i=new mt;n<r;){var s=e[n];if("A"==s.charAt(0)){var c=e[++n],l=/'.+'/.test(c);l&&!i.get("pseudo")&&i.set("pseudo",new mt),l||i.get("alias")||i.set("alias",new mt),l&&(c=c.replace(/'/g,"")),i.get(l?"pseudo":"alias").set(Ft.parseDecimalInt(s.slice(3,6))-1,c)}else if("M"==s.charAt(0)){var u=s.slice(3,6),p=s.slice(6);if("END"==u)break;if("CHG"==u)i.get("charge")||i.set("charge",Jt.readKeyValuePairs(p));else if("RAD"==u)i.get("radical")||i.set("radical",Jt.readKeyValuePairs(p));else if("ISO"==u)i.get("isotope")||i.set("isotope",Jt.readKeyValuePairs(p));else if("RBC"==u)i.get("ringBondCount")||i.set("ringBondCount",Jt.readKeyValuePairs(p));else if("SUB"==u)i.get("substitutionCount")||i.set("substitutionCount",Jt.readKeyValuePairs(p));else if("UNS"==u)i.get("unsaturatedAtom")||i.set("unsaturatedAtom",Jt.readKeyValuePairs(p));else if("RGP"==u){i.get("rglabel")||i.set("rglabel",new mt);for(var d=i.get("rglabel"),h=Jt.readKeyMultiValuePairs(p),f=0;f<h.length;f++){var m=h[f];d.set(m[0],(d.get(m[0])||0)|1<<m[1]-1)}}else if("LOG"==u){p=p.slice(4);var g=Ft.parseDecimalInt(p.slice(0,3).trim()),b=Ft.parseDecimalInt(p.slice(4,7).trim()),v=Ft.parseDecimalInt(p.slice(8,11).trim()),y=p.slice(12).trim(),w={};b>0&&(w.ifthen=b),w.resth=1==v,w.range=y,o[g]=w}else if("APO"==u)i.get("attpnt")||i.set("attpnt",Jt.readKeyValuePairs(p));else if("ALS"==u){var E=ie(Ft.partitionLine(p,[1,3,3,1,1,1]),Ft.partitionLineFixed(p.slice(10),4,!1));i.get("atomList")||i.set("atomList",new mt),i.get("label")||i.set("label",new mt),E.forEach((function(t,e){i.get("label").set(e,"L#"),i.get("atomList").set(e,t)}))}else if("STY"==u)Jt.initSGroup(a,p);else if("SST"==u)Jt.applySGroupProp(a,"subtype",p);else if("SLB"==u)Jt.applySGroupProp(a,"label",p,!0);else if("SPL"==u)Jt.applySGroupProp(a,"parent",p,!0,!0);else if("SCN"==u)Jt.applySGroupProp(a,"connectivity",p);else if("SAL"==u)Jt.applySGroupArrayProp(a,"atoms",p,-1);else if("SBL"==u)Jt.applySGroupArrayProp(a,"bonds",p,-1);else if("SPA"==u)Jt.applySGroupArrayProp(a,"patoms",p,-1);else if("SMT"==u){a[Ft.parseDecimalInt(p.slice(0,4))-1].data.subscript=p.slice(4).trim()}else"SDT"==u?Jt.applyDataSGroupDesc(a,p):"SDD"==u?Jt.applyDataSGroupInfoLine(a,p):"SCD"==u?Jt.applyDataSGroupDataLine(a,p,!1):"SED"==u&&Jt.applyDataSGroupDataLine(a,p,!0)}++n}return i})(0,t,u,Math.min(t.length,u+l),f,m).forEach((function(t,e){!function(t,e,n){e.forEach((function(e,r){t.get(r)[n]=e}))}(r.atoms,t,e)}));var g,b={};for(g in f){var v=f[g];if("DAT"===v.type&&0===v.atoms.length){var y=f[g].parent;if(y>=0){var w=f[y-1];"GEN"===w.type&&(v.atoms=[].slice.call(w.atoms))}}}for(g in f)Jt.loadSGroup(r,f[g],b);var E=[];for(g in f)Ct.filter(r,f[g],b),0!==f[g].atoms.length||f[g].allAtoms||E.push(+g);for(n=0;n<E.length;++n)r.sGroupForest.remove(E[n]),r.sgroups.delete(E[n]);for(var O in m){var x=parseInt(O,10);r.rgroups.set(x,new Rt(m[x]))}return r}function ae(t){if("$CTAB"!==(t=t.slice(7))[0].trim())throw new Error("RGFile format invalid");for(var e=1;"$"!==t[e].charAt(0);)e++;if("$END CTAB"!==t[e].trim())throw new Error("RGFile format invalid");var n=t.slice(1,e);t=t.slice(e+1);for(var r={};;){if(0===t.length)throw new Error("Unexpected end of file");var a=t[0].trim();if("$END MOL"===a){t=t.slice(1);break}if("$RGP"!==a)throw new Error("RGFile format invalid");var o=parseInt(t[1].trim(),10);for(r[o]=[],t=t.slice(2);;){if(0===t.length)throw new Error("Unexpected end of file");if("$END RGP"===(a=t[0].trim())){t=t.slice(1);break}if("$CTAB"!==a)throw new Error("RGFile format invalid");for(e=1;"$"!==t[e].charAt(0);)e++;if("$END CTAB"!==t[e].trim())throw new Error("RGFile format invalid");r[o].push(t.slice(1,e)),t=t.slice(e+1)}}var i=oe(n),s={};for(var c in r){var l=parseInt(c,10);s[l]=[];for(var u=0;u<r[l].length;++u)s[l].push(oe(r[l][u]))}return function(t,e){var n=new Nt;return t.mergeInto(n,null,null,!1,!0),Object.keys(e).forEach((function(t){for(var r=parseInt(t,10),a=function(t){var a=e[r][t];a.rgroups.set(r,new Rt);var o=a.frags.add({});a.rgroups.get(r).frags.add(o),a.atoms.forEach((function(t){t.fragment=o})),a.mergeInto(n)},o=0;o<e[r].length;++o)a(o)})),n}(i,s)}function oe(t){var e=Ft.partitionLine(t[0],Ft.fmtInfo.countsLinePartition);return re(t=t.slice(1),e)}function ie(t,e){var n=Ft.parseDecimalInt(t[1])-1,r=Ft.parseDecimalInt(t[2]),a="T"==t[4].trim(),o=function(t){for(var e=[],n=0;n<t.length;++n)e.push(ut.map[t[n].trim()]);return e}(e.slice(0,r)),i=new mt;return i.set(n,new Et({notList:a,ids:o})),i}var se={parseCTabV2000:re,parseRg2000:ae,parseRxn2000:function(t,e){t=t.slice(4);var n=Ft.partitionLine(t[0],Ft.fmtInfo.rxnItemsPartition),r=n[0]-0,a=n[1]-0,o=n[2]-0;t=t.slice(1);for(var i=[];t.length>0&&"$MOL"==t[0].substr(0,4);){t=t.slice(1);for(var s=0;s<t.length&&"$MOL"!=t[s].substr(0,4);)s++;var c,l=t.slice(0,s);0==l[0].search("\\$MDL")?c=ae(l):(c=oe(l.slice(3))).name=l[0].trim(),i.push(c),t=t.slice(s)}return Ft.rxnMerge(i,r,a,o,e)}};function ce(t){var e,n,r,a,o;e=fe(t);var i={pp:new pt(parseFloat(e[2]),-parseFloat(e[3]),parseFloat(e[4])),aam:e[5].trim()},s=e[1].trim();if('"'==s.charAt(0)&&'"'==s.charAt(s.length-1)&&(s=s.substr(1,s.length-2)),"]"==s.charAt(s.length-1)){var c={notList:!1};if("NOT ["==(s=s.substr(0,s.length-1)).substr(0,5))c.notList=!0,s=s.substr(5);else{if("["!=s.charAt(0))throw new Error("Error: atom list expected, found '"+s+"'");s=s.substr(1)}c.ids=function(t){for(var e=[],n=0;n<t.length;++n)e.push(ut.map[t[n].trim()]);return e}(s.split(",")),i.atomList=new Et(c),i.label="L#"}else i.label=s;for(e.splice(0,6),o=0;o<e.length;++o)if(r=(n=ge(e[o],"="))[0],a=n[1],r in Ft.fmtInfo.v30atomPropMap){var l=Ft.parseDecimalInt(a);if("VAL"==r){if(0==l)continue;-1==l&&(l=0)}i[Ft.fmtInfo.v30atomPropMap[r]]=l}else if("RGROUPS"==r){var u=(a=a.trim().substr(1,a.length-2)).split(" ").slice(1);i.rglabel=0;for(var p=0;p<u.length;++p)i.rglabel|=1<<u[p]-1}else"ATTCHPT"==r&&(i.attpnt=a.trim()-0);return new Ot(i)}function le(t){var e,n,r,a,o;e=fe(t);var i={begin:Ft.parseDecimalInt(e[2])-1,end:Ft.parseDecimalInt(e[3])-1,type:Ft.fmtInfo.bondTypeMap[Ft.parseDecimalInt(e[1])]};for(e.splice(0,4),o=0;o<e.length;++o)r=(n=ge(e[o],"="))[0],a=n[1],"CFG"==r?(i.stereo=Ft.fmtInfo.v30bondStereoMap[Ft.parseDecimalInt(a)],i.type==At.PATTERN.TYPE.DOUBLE&&i.stereo==At.PATTERN.STEREO.EITHER&&(i.stereo=At.PATTERN.STEREO.CIS_TRANS)):"TOPO"==r?i.topology=Ft.fmtInfo.bondTopologyMap[Ft.parseDecimalInt(a)]:"RXCTR"==r?i.reactingCenterStatus=Ft.parseDecimalInt(a):"STBOX"==r&&(i.stereoCare=Ft.parseDecimalInt(a));return new At(i)}function ue(t,e,n){for(n++;"M  V30 END COLLECTION"!=e[n].trim();)n++;return++n}function pe(t,e,n,r,a){var o="";for(a++;a<e.length;){if("END SGROUP"==(o=ye(e[a++]).trim()).trim())return a;for(;"-"==o.charAt(o.length-1);)o=(o.substr(0,o.length-1)+ye(e[a++])).trim();var i=be(o),s=i[1],c=new Ct(s);c.number=i[0]-0,c.type=s,c.label=i[2]-0,n[c.number]=c;for(var l={},u=3;u<i.length;++u){var p=ge(i[u],"=");if(2!=p.length)throw new Error("A record of form AAA=BBB or AAA=(...) expected, got '"+i[u]+"'");var d=p[0];d in l||(l[d]=[]),l[d].push(p[1])}c.atoms=ve(l.ATOMS[0],-1),l.PATOMS&&(c.patoms=ve(l.PATOMS[0],-1)),c.bonds=l.BONDS?ve(l.BONDS[0],-1):[];var h=l.BRKXYZ;if(c.brkxyz=[],h)for(var f=0;f<h.length;++f)c.brkxyz.push(ve(h[f]));l.MULT&&(c.data.subscript=l.MULT[0]-0),l.LABEL&&(c.data.subscript=l.LABEL[0].trim()),l.CONNECT&&(c.data.connectivity=l.CONNECT[0].toLowerCase()),l.FIELDDISP&&Jt.applyDataSGroupInfo(c,me(l.FIELDDISP[0])),l.FIELDDATA&&Jt.applyDataSGroupData(c,l.FIELDDATA[0],!0),l.FIELDNAME&&Jt.applyDataSGroupName(c,l.FIELDNAME[0]),l.QUERYTYPE&&Jt.applyDataSGroupQuery(c,l.QUERYTYPE[0]),l.QUERYOP&&Jt.applyDataSGroupQueryOp(c,l.QUERYOP[0]),Jt.loadSGroup(t,c,r)}throw new Error("S-group declaration incomplete.")}function de(t,e){var n=new Nt,r=0;if("M  V30 BEGIN CTAB"!=t[r++].trim())throw Error("CTAB V3000 invalid");if("M  V30 COUNTS"!=t[r].slice(0,13))throw Error("CTAB V3000 invalid");var a=t[r].slice(14).split(" "),o=1===Ft.parseDecimalInt(a[4]);if("M  V30 BEGIN ATOM"==t[++r].trim()){var i;for(r++;r<t.length&&"END ATOM"!=(i=ye(t[r++]).trim());){for(;"-"==i.charAt(i.length-1);)i=(i.substring(0,i.length-1)+ye(t[r++])).trim();n.atoms.add(ce(i))}if("M  V30 BEGIN BOND"==t[r].trim())for(r++;r<t.length&&"END BOND"!=(i=ye(t[r++]).trim());){for(;"-"==i.charAt(i.length-1);)i=(i.substring(0,i.length-1)+ye(t[r++])).trim();var s=le(i);s.stereo&&o&&(n.atoms.get(s.begin).stereoLabel="abs"),n.bonds.add(s)}for(var c={},l={};"M  V30 END CTAB"!=t[r].trim();)if("M  V30 BEGIN COLLECTION"==t[r].trim())r=ue(0,t,r);else{if("M  V30 BEGIN SGROUP"!=t[r].trim())throw Error("CTAB V3000 invalid");r=pe(n,t,c,l,r)}}if("M  V30 END CTAB"!=t[r++].trim())throw Error("CTAB V3000 invalid");return e||he(n,t.slice(r)),n}function he(t,e){for(var n={},r={},a=0;a<e.length&&0==e[a].search("M  V30 BEGIN RGROUP");){var o=e[a++].split(" ").pop();for(n[o]=[],r[o]={};;){var i=e[a].trim();if(0!=i.search("M  V30 RLOGIC")){if("M  V30 BEGIN CTAB"!=i)throw Error("CTAB V3000 invalid");for(var s=0;s<e.length&&"M  V30 END CTAB"!=e[a+s].trim();++s);var c=de(e.slice(a,a+s+1),!0);if(n[o].push(c),"M  V30 END RGROUP"==e[a=a+s+1].trim()){a++;break}}else{var l=(i=i.slice(13)).trim().split(/\s+/g),u=Ft.parseDecimalInt(l[0]),p=Ft.parseDecimalInt(l[1]),d=l.slice(2).join(" "),h={};u>0&&(h.ifthen=u),h.resth=1==p,h.range=d,r[o]=h,a++}}}Object.keys(n).forEach((function(e){n[e].forEach((function(n){n.rgroups.set(e,new Rt(r[e]));var a=n.frags.add({});n.rgroups.get(e).frags.add(a),n.atoms.forEach((function(t){t.fragment=a})),n.mergeInto(t)}))}))}function fe(t){var e,n,r=[],a=0,o=-1,i=!1;for(n=0;n<t.length;++n)"("==(e=t[n])?a++:")"==e&&a--,'"'==e&&(i=!i),i||" "!=t[n]||0!=a||(n>o+1&&r.push(t.slice(o+1,n)),o=n);return n>o+1&&r.push(t.slice(o+1,n)),r}function me(t){return'"'===t[0]&&'"'===t[t.length-1]?t.substr(1,t.length-2):t}function ge(t,e){var n=t.indexOf(e);return[t.slice(0,n),t.slice(n+1)]}function be(t){for(var e=[],n=0,r=!1,a=0;a<t.length;++a){var o=t.charAt(a);'"'==o?r=!r:r||("("==o?n++:")"==o?n--:" "==o&&0==n&&(e.push(t.slice(0,a)),t=t.slice(a+1).trim(),a=0))}if(0!=n)throw new Error("Brace balance broken. S-group properies invalid!");return t.length>0&&e.push(t.trim()),e}function ve(t,e){if(!t)return null;var n=[],r=(t=(t=t.trim()).substr(1,t.length-2)).split(" ");e=e||0;for(var a=1;a<r.length;++a){var o=parseInt(r[a]);isNaN(o)||n.push(o+e)}return n}function ye(t){if("M  V30 "!=t.slice(0,7))throw new Error("Prefix invalid");return t.slice(7)}var we={parseCTabV3000:de,readRGroups3000:he,parseRxn3000:function(t,e){var n=(t=t.slice(4))[0].split(/\s+/g).slice(3),r=n[0]-0,a=n[1]-0,o=n.length>2?n[2]-0:0;function i(e){for(var n=e;n<t.length;++n)if("M  V30 END CTAB"==t[n].trim())return n}function s(e){for(var n=e;n<t.length;++n)if("M  V30 END RGROUP"==t[n].trim())return n}for(var c=[],l=[],u=null,p=[],d=0;d<t.length;++d){var h,f=t[d].trim();if(f.startsWith("M  V30 COUNTS"));else{if("M  END"==f)break;if("M  V30 BEGIN PRODUCT"==f)u=l;else if("M  V30 END PRODUCT"==f)u=null;else if("M  V30 BEGIN REACTANT"==f)u=c;else if("M  V30 END REACTANT"==f)u=null;else if(f.startsWith("M  V30 BEGIN RGROUP"))h=s(d),p.push(t.slice(d,h+1)),d=h;else{if("M  V30 BEGIN CTAB"!=f)throw new Error("line unrecognized: "+f);h=i(d),u.push(t.slice(d,h+1)),d=h}}}var m=[],g=c.concat(l);for(h=0;h<g.length;++h){var b=de(g[h],n);m.push(b)}var v=Ft.rxnMerge(m,r,a,o,e);return he(v,function(t){for(var e=[],n=0;n<t.length;++n)e=e.concat(t[n]);return e}(p)),v}};function Ee(t){var e=function(t,e,n){for(var r=[],a=0,o=0;a<e.length;++a)r.push(t.slice(o,o+e[a])),n&&o++,o+=e[a];return r}(t[0],Ft.fmtInfo.countsLinePartition),n=e[11].trim();if(t=t.slice(1),"V2000"===n)return se.parseCTabV2000(t,e);if("V3000"===n)return we.parseCTabV3000(t,!1);throw new Error("Molfile version unknown: "+n)}var Oe={MUL:Ct.prepareMulForSaving,SRU:function(t,e){var n=[];if(e.bonds.forEach((function(r,a){var o=e.atoms.get(r.begin),i=e.atoms.get(r.end);(o.sgs.has(t.id)&&!i.sgs.has(t.id)||i.sgs.has(t.id)&&!o.sgs.has(t.id))&&n.push(a)}),t),0!==n.length&&2!==n.length)throw{id:t.id,"error-type":"cross-bond-number",message:"Unsupported cross-bonds number"};t.bonds=n},SUP:function(t,e){var n=[];e.bonds.forEach((function(r,a){var o=e.atoms.get(r.begin),i=e.atoms.get(r.end);(o.sgs.has(t.id)&&!i.sgs.has(t.id)||i.sgs.has(t.id)&&!o.sgs.has(t.id))&&n.push(a)}),t),t.bonds=n},DAT:function(t,e){t.atoms=Ct.getAtoms(e,t)},GEN:function(t,e){}};var xe={MUL:function(t,e,n,r,a){var o=(n[t.id]+"").padStart(3),i=[];i=(i=(i=i.concat(Se("SAL",o,Array.from(t.atomSet.values()),r))).concat(Se("SPA",o,Array.from(t.parentAtomSet.values()),r))).concat(Se("SBL",o,t.bonds,a));var s="M  SMT "+o+" "+t.data.mul;return i.push(s),(i=i.concat(Ae(e,t,o))).join("\n")},SRU:function(t,e,n,r,a){var o=(n[t.id]+"").padStart(3),i=[];return(i=(i=(i=i.concat(Se("SAL",o,t.atoms,r))).concat(Se("SBL",o,t.bonds,a))).concat(Ae(e,t,o))).join("\n")},SUP:function(t,e,n,r,a){var o=(n[t.id]+"").padStart(3),i=[];i=(i=i.concat(Se("SAL",o,t.atoms,r))).concat(Se("SBL",o,t.bonds,a)),t.data.name&&""!==t.data.name&&i.push("M  SMT "+o+" "+t.data.name);return i.join("\n")},DAT:function(t,e,n,r){var a=(n[t.id]+"").padStart(3),o=t.data,i=t.pp;o.absolute||(i=i.sub(Ct.getMassCentre(e,t.atoms)));var s=[];s=s.concat(Se("SAL",a,t.atoms,r));var c="M  SDT "+a+" "+(o.fieldName||"").padEnd(30)+(o.fieldType||"").padStart(2)+(o.units||"").padEnd(20)+(o.query||"").padStart(2);o.queryOp&&(c+=o.queryOp.padEnd(15));s.push(c);var l="M  SDD "+a+" "+Ft.paddedNum(i.x,10,4)+Ft.paddedNum(-i.y,10,4)+"    "+(o.attached?"A":"D")+(o.absolute?"A":"R")+(o.showUnits?"U":" ")+"   "+(o.nCharnCharsToDisplay>=0?Ft.paddedNum(o.nCharnCharsToDisplay,3):"ALL")+"  1   "+(o.tagChar||" ")+"  "+Ft.paddedNum(o.daspPos,1)+"  ";s.push(l);var u=(p=o.fieldValue,p.replace(Pe,"\n")).replace(/\n*$/,"");var p;return u.split("\n").forEach((function(t){for(;t.length>69;)s.push("M  SCD "+a+" "+t.slice(0,69)),t=t.slice(69);s.push("M  SED "+a+" "+t)})),s.join("\n")},GEN:function(t,e,n,r,a){var o=(n[t.id]+"").padStart(3),i=[];return(i=(i=(i=i.concat(Se("SAL",o,t.atoms,r))).concat(Se("SBL",o,t.bonds,a))).concat(Ae(e,t,o))).join("\n")}};function Se(t,e,n,r){if(!n)return[];for(var a=[],o=0;o<Math.floor((n.length+14)/15);++o){for(var i=Math.min(n.length-15*o,15),s="M  "+t+" "+e+" "+Ft.paddedNum(i,2),c=0;c<i;++c)s+=" "+Ft.paddedNum(r[n[15*o+c]],3);a.push(s)}return a}function Ae(t,e,n){var r=[],a=new yt(e.atoms);Ct.getCrossBonds([],r,t,a),Ct.bracketPos(e,t,r);for(var o=e.bracketBox,i=e.bracketDir,s=i.rotateSC(1,0),c=Ct.getBracketParameters(t,r,a,o,i,s),l=[],u=0;u<c.length;++u){for(var p=c[u],d=p.c.addScaled(p.n,-.5*p.h).yComplement(),h=p.c.addScaled(p.n,.5*p.h).yComplement(),f="M  SDI "+n+Ft.paddedNum(4,3),m=[d.x,d.y,h.x,h.y],g=0;g<m.length;++g)f+=Ft.paddedNum(m[g],10,4);l.push(f)}return l}var Pe=/\r\n|[\n\r]/g;var Te={parseCTab:Ee,parseMol:function(t){if(0===t[0].search("\\$MDL")){var e=se.parseRg2000(t);return e.name=t[3].trim(),e}var n=Ee(t.slice(3));return n.name=t[0].trim(),n},parseRxn:function(t,e){var n=t[0].trim().split(" ");if(n.length>1&&"V3000"===n[1])return we.parseRxn3000(t,e);var r=se.parseRxn2000(t,e);return r.name=t[1].trim(),r},prepareForSaving:Oe,saveToMolfile:xe};function Ce(t){this.molecule=null,this.molfile=null,this.v3000=t||!1}Ce.prototype.parseCTFile=function(t,e){var n=null;return(n=0===t[0].search("\\$RXN")?Te.parseRxn(t,e):Te.parseMol(t)).initHalfBonds(),n.initNeighbors(),n.markFragments(),n},Ce.prototype.prepareSGroups=function(t,e){var n=this.molecule,r=[],a=0;if(this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach((function(o){var i=n.sgroups.get(o),s=!1;try{Te.prepareForSaving[i.type](i,n)}catch(c){if(!t||"number"!=typeof c.id)throw new Error("Error: ".concat(c.message));s=!0}(s||!e&&/^INDIGO_.+_DESC$/i.test(i.data.fieldName))&&(a+=s,r.push(i.id))}),this),a)throw new Error("Warning: "+a+" invalid S-groups were detected. They will be omitted.");for(var o=0;o<r.length;++o)n.sGroupDelete(r[o]);return n},Ce.prototype.getCTab=function(t,e){return this.molecule=t.clone(),this.prepareSGroups(!1,!1),this.molfile="",this.writeCTab2000(e),this.molfile},Ce.prototype.saveMolecule=function(t,e,n,r){var a=this;if(this.reaction=t.rxnArrows.size>0,t.rxnArrows.size>1)throw new Error("Reaction may not contain more than one arrow");if(this.molfile=""+t.name,this.reaction){if(t.rgroups.size>0)throw new Error("Reactions with r-groups are not supported at the moment");var o=t.getComponents(),i=o.reactants,s=o.products,c=i.concat(s);this.molfile="$RXN\n"+t.name+"\n\n\n"+Ft.paddedNum(i.length,3)+Ft.paddedNum(s.length,3)+Ft.paddedNum(0,3)+"\n";for(var l=0;l<c.length;++l){var u=new Ce(!1),p=t.clone(c[l],null,!0),d=u.saveMolecule(p,!1,!0);this.molfile+="$MOL\n"+d}return this.molfile}if(t.rgroups.size>0){if(!n){var h=new Ce(!1).getCTab(t.getScaffold(),t.rgroups);return this.molfile="$MDL  REV  1\n$MOL\n$HDR\n"+t.name+"\n\n\n$END HDR\n",this.molfile+="$CTAB\n"+h+"$END CTAB\n",t.rgroups.forEach((function(e,n){a.molfile+="$RGP\n",a.writePaddedNumber(n,3),a.molfile+="\n",e.frags.forEach((function(e){var n=new Ce(!1).getCTab(t.getFragment(e));a.molfile+="$CTAB\n"+n+"$END CTAB\n"})),a.molfile+="$END RGP\n"})),this.molfile+="$END MOL\n",this.molfile}t=t.getScaffold()}return this.molecule=t.clone(),this.prepareSGroups(e,r),this.writeHeader(),this.writeCTab2000(),this.molfile},Ce.prototype.writeHeader=function(){var t=new Date;this.writeCR(),this.writeWhiteSpace(2),this.write("Ketcher"),this.writeWhiteSpace(),this.writeCR((t.getMonth()+1+"").padStart(2)+(t.getDate()+"").padStart(2)+(t.getFullYear()%100+"").padStart(2)+(t.getHours()+"").padStart(2)+(t.getMinutes()+"").padStart(2)+"2D 1   1.00000     0.00000     0"),this.writeCR()},Ce.prototype.write=function(t){this.molfile+=t},Ce.prototype.writeCR=function(t){0==arguments.length&&(t=""),this.molfile+=t+"\n"},Ce.prototype.writeWhiteSpace=function(t){0==arguments.length&&(t=1),this.write(" ".repeat(Math.max(t,0)))},Ce.prototype.writePadded=function(t,e){this.write(t),this.writeWhiteSpace(e-t.length)},Ce.prototype.writePaddedNumber=function(t,e){var n=(t-0).toString();this.writeWhiteSpace(e-n.length),this.write(n)},Ce.prototype.writePaddedFloat=function(t,e,n){this.write(Ft.paddedNum(t,e,n))},Ce.prototype.writeCTab2000Header=function(){this.writePaddedNumber(this.molecule.atoms.size,3),this.writePaddedNumber(this.molecule.bonds.size,3),this.writePaddedNumber(0,3),this.writeWhiteSpace(3);var t=Array.from(this.molecule.frags.values()).some((function(t){return!!t&&"abs"===t.enhancedStereoFlag}));this.writePaddedNumber(t?1:0,3),this.writePaddedNumber(0,3),this.writeWhiteSpace(12),this.writePaddedNumber(999,3),this.writeCR(" V2000")},Ce.prototype.writeCTab2000=function(t){var e=this;this.writeCTab2000Header(),this.mapping={};var n=1,r=[],a=[];for(this.molecule.atoms.forEach((function(t,o){e.writePaddedFloat(t.pp.x,10,4),e.writePaddedFloat(-t.pp.y,10,4),e.writePaddedFloat(t.pp.z,10,4),e.writeWhiteSpace();var i=t.label;null!=t.atomList?(i="L",r.push(o)):t.pseudo?t.pseudo.length>3&&(i="A",a.push({id:o,value:"'"+t.pseudo+"'"})):t.alias?a.push({id:o,value:t.alias}):ut.map[i]||-1!=["A","Q","X","*","R#"].indexOf(i)||(i="C",a.push({id:o,value:t.label})),e.writePadded(i,3),e.writePaddedNumber(0,2),e.writePaddedNumber(0,3),e.writePaddedNumber(0,3),"undefined"===typeof t.hCount&&(t.hCount=0),e.writePaddedNumber(t.hCount,3),"undefined"===typeof t.stereoCare&&(t.stereoCare=0),e.writePaddedNumber(t.stereoCare,3),e.writePaddedNumber(t.explicitValence<0?0:0==t.explicitValence?15:t.explicitValence,3),e.writePaddedNumber(0,3),e.writePaddedNumber(0,3),e.writePaddedNumber(0,3),"undefined"===typeof t.aam&&(t.aam=0),e.writePaddedNumber(t.aam,3),"undefined"===typeof t.invRet&&(t.invRet=0),e.writePaddedNumber(t.invRet,3),"undefined"===typeof t.exactChangeFlag&&(t.exactChangeFlag=0),e.writePaddedNumber(t.exactChangeFlag,3),e.writeCR(),e.mapping[o]=n,n++}),this),this.bondMapping={},n=1,this.molecule.bonds.forEach((function(t,r){e.bondMapping[r]=n++,e.writePaddedNumber(e.mapping[t.begin],3),e.writePaddedNumber(e.mapping[t.end],3),e.writePaddedNumber(t.type,3),"undefined"===typeof t.stereo&&(t.stereo=0),e.writePaddedNumber(t.stereo,3),e.writePadded(t.xxx,3),"undefined"===typeof t.topology&&(t.topology=0),e.writePaddedNumber(t.topology,3),"undefined"===typeof t.reactingCenterStatus&&(t.reactingCenterStatus=0),e.writePaddedNumber(t.reactingCenterStatus,3),e.writeCR()}));a.length>0;)this.write("A  "),this.writePaddedNumber(a[0].id+1,3),this.writeCR(),this.writeCR(a[0].value),a.splice(0,1);var o=[],i=[],s=[],c=[],l=[],u=[],p=[],d=[],h=[];function f(t,e){for(var n=this;e.length>0;){for(var r=[];e.length>0&&r.length<8;)r.push(e[0]),e.splice(0,1);this.write(t),this.writePaddedNumber(r.length,3),r.forEach((function(t){n.writeWhiteSpace(),n.writePaddedNumber(n.mapping[t[0]],3),n.writeWhiteSpace(),n.writePaddedNumber(t[1],3)})),this.writeCR()}}this.molecule.atoms.forEach((function(t,e){if(0!=t.charge&&o.push([e,t.charge]),0!=t.isotope&&i.push([e,t.isotope]),0!=t.radical&&s.push([e,t.radical]),null!=t.rglabel&&"R#"==t.label)for(var n=0;n<32;n++)t.rglabel&1<<n&&c.push([e,n+1]);null!=t.attpnt&&u.push([e,t.attpnt]),0!=t.ringBondCount&&p.push([e,t.ringBondCount]),0!=t.substitutionCount&&h.push([e,t.substitutionCount]),0!=t.unsaturatedAtom&&d.push([e,t.unsaturatedAtom])})),t&&t.forEach((function(t,e){if(t.resth||t.ifthen>0||t.range.length>0){var n="  1 "+Ft.paddedNum(e,3)+" "+Ft.paddedNum(t.ifthen,3)+" "+Ft.paddedNum(t.resth?1:0,3)+"   "+t.range;l.push(n)}})),f.call(this,"M  CHG",o),f.call(this,"M  ISO",i),f.call(this,"M  RAD",s),f.call(this,"M  RGP",c);for(var m=0;m<l.length;++m)this.write("M  LOG"+l[m]+"\n");if(f.call(this,"M  APO",u),f.call(this,"M  RBC",p),f.call(this,"M  SUB",h),f.call(this,"M  UNS",d),r.length>0)for(m=0;m<r.length;++m){var g=r[m],b=this.molecule.atoms.get(g).atomList;this.write("M  ALS"),this.writePaddedNumber(g+1,4),this.writePaddedNumber(b.ids.length,3),this.writeWhiteSpace(),this.write(b.notList?"T":"F");for(var v=b.labelList(),y=0;y<v.length;++y)this.writeWhiteSpace(),this.writePadded(v[y],3);this.writeCR()}var w={},E=1,O={};this.molecule.sGroupForest.getSGroupsBFS().forEach((function(t){O[E]=t,w[t]=E++}));for(var x=1;x<E;++x){var S=O[x],A=this.molecule.sgroups.get(S);this.write("M  STY"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(x,3),this.writeWhiteSpace(1),this.writePadded(A.type,3),this.writeCR(),this.write("M  SLB"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(x,3),this.writeWhiteSpace(1),this.writePaddedNumber(x,3),this.writeCR();var P=this.molecule.sGroupForest.parent.get(S);if(P>=0&&(this.write("M  SPL"),this.writePaddedNumber(1,3),this.writeWhiteSpace(1),this.writePaddedNumber(x,3),this.writeWhiteSpace(1),this.writePaddedNumber(w[P],3),this.writeCR()),"SRU"==A.type&&A.data.connectivity){var T="";T+=" ",T+=x.toString().padStart(3),T+=" ",T+=(A.data.connectivity||"").padEnd(3),this.write("M  SCN"),this.writePaddedNumber(1,3),this.write(T.toUpperCase()),this.writeCR()}"SRU"==A.type&&(this.write("M  SMT "),this.writePaddedNumber(x,3),this.writeWhiteSpace(),this.write(A.data.subscript||"n"),this.writeCR()),this.writeCR(Te.saveToMolfile[A.type](A,this.molecule,w,this.mapping,this.bondMapping))}this.writeCR("M  END")};var Re=function(t,e){var n=e||{};return new Ce(n.v3000).saveMolecule(t,n.ignoreErrors,n.noRgroups,n.preserveIndigoDesc)},je=function(t,e){return function(t,e){var n=new Ce,r=t.split(/\r\n|[\n\r]/g);try{return n.parseCTFile(r,e.reactionRelayout)}catch(a){if(e.badHeaderRecover){try{return n.parseCTFile(r.slice(1),e.reactionRelayout)}catch(o){}try{return n.parseCTFile([""].concat(r),e.reactionRelayout)}catch(i){}}throw a}}(t,e||{})},Ne=function(t){var e=/v(?:2000|3000)/im.exec(t);return e?e[0].toUpperCase():"V2000"};function Me(t,e,n){this.molecule=t,this.bonds=new mt,this.getNeighbors=e,this.context=n}function ke(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function Be(t,e,n,r){var a=this;this.molecule=t,this.atom_data=e,this.components=n,this.nComponentsInReactants=-1,this.nReactants=r,this.vertices=new Array(this.molecule.atoms.size),this.molecule.atoms.forEach((function(t,e){a.vertices[e]=new Be.VertexDesc}),this),this.edges=new Array(this.molecule.bonds.size),this.molecule.bonds.forEach((function(t,e){a.edges[e]=new Be.EdgeDesc}),this),this.v_seq=[]}function Le(t,e,n){this.molecule=t,this.atoms=new mt,this.getNeighbors=e,this.context=n}function Ie(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function De(){this.smiles="",this.writtenAtoms=[],this.writtenComponents=0,this.ignore_errors=!1}Me.PARITY={NONE:0,CIS:1,TRANS:2},Me.prototype.each=function(t){this.bonds.forEach(t)},Me.prototype.getParity=function(t){return this.bonds.get(t).parity},Me.prototype.getSubstituents=function(t){return this.bonds.get(t).substituents},Me.prototype.sameside=function(t,e,n,r){var a=pt.diff(t,e),o=new pt(-a.y,a.x);if(!o.normalize())return 0;var i=pt.diff(n,t),s=pt.diff(r,e);if(!i.normalize())return 0;if(!s.normalize())return 0;var c=pt.dot(i,o),l=pt.dot(s,o);return Math.abs(c)<.001||Math.abs(l)<.001?0:c*l>0?1:-1},Me.prototype.samesides=function(t,e,n,r){return this.sameside(this.molecule.atoms.get(t).pp,this.molecule.atoms.get(e).pp,this.molecule.atoms.get(n).pp,this.molecule.atoms.get(r).pp)},Me.prototype.sortSubstituents=function(t){var e=this.molecule.atoms.get(t[0]).pureHydrogen(),n=t[1]<0||this.molecule.atoms.get(t[1]).pureHydrogen(),r=this.molecule.atoms.get(t[2]).pureHydrogen(),a=t[3]<0||this.molecule.atoms.get(t[3]).pureHydrogen();return(!e||!n)&&((!r||!a)&&(n?t[1]=-1:e?(t[0]=t[1],t[1]=-1):t[0]>t[1]&&ke(t,0,1),a?t[3]=-1:r?(t[2]=t[3],t[3]=-1):t[2]>t[3]&&ke(t,2,3),!0))},Me.prototype.isGeomStereoBond=function(t,e){var n=this.molecule.bonds.get(t);if(n.type!=At.PATTERN.TYPE.DOUBLE)return!1;var r=this.molecule.atoms.get(n.begin).label,a=this.molecule.atoms.get(n.end).label;if("C"!=r&&"N"!=r&&"Si"!=r&&"Ge"!=r)return!1;if("C"!=a&&"N"!=a&&"Si"!=a&&"Ge"!=a)return!1;var o,i,s=this.getNeighbors.call(this.context,n.begin),c=this.getNeighbors.call(this.context,n.end);if(s.length<2||s.length>3||c.length<2||c.length>3)return!1;for(e[0]=-1,e[1]=-1,e[2]=-1,e[3]=-1,o=0;o<s.length;o++)if((i=s[o]).bid!=t){if(this.molecule.bonds.get(i.bid).type!=At.PATTERN.TYPE.SINGLE)return!1;-1==e[0]?e[0]=i.aid:e[1]=i.aid}for(o=0;o<c.length;o++)if((i=c[o]).bid!=t){if(this.molecule.bonds.get(i.bid).type!=At.PATTERN.TYPE.SINGLE)return!1;-1==e[2]?e[2]=i.aid:e[3]=i.aid}return(-1==e[1]||-1==this.samesides(n.begin,n.end,e[0],e[1]))&&(-1==e[3]||-1==this.samesides(n.begin,n.end,e[2],e[3]))},Me.prototype.build=function(t){var e=this;this.molecule.bonds.forEach((function(n,r){var a={parity:0,substituents:[]};if(e.bonds.set(r,a),(!Array.isArray(t)||!t[r])&&e.isGeomStereoBond(r,a.substituents)&&e.sortSubstituents(a.substituents)){var o=e.samesides(n.begin,n.end,a.substituents[0],a.substituents[2]);1===o?a.parity=Me.PARITY.CIS:-1===o&&(a.parity=Me.PARITY.TRANS)}}))},Be.VertexDesc=function(){this.dfs_state=0,this.parent_vertex=0,this.parent_edge=0,this.branches=0},Be.EdgeDesc=function(){this.opening_cycles=0,this.closing_cycle=0},Be.SeqElem=function(t,e,n){this.idx=t,this.parent_vertex=e,this.parent_edge=n},Be.prototype.walk=function(){for(var t,e,n=this,r=[],a=0,o=0;;){if(r.length<1){for(var i=-1;a<this.components.length&&-1==i;)null===(i=this.components[a].find((function(t){return 0===n.vertices[t].dfs_state&&(i=t,!0)})))&&(i=-1,a++),a==this.nReactants&&(this.nComponentsInReactants=o);if(i<-1&&this.molecule.atoms.find((function(t){return 0===n.vertices[t].dfs_state&&(i=t,!0)})),-1==i)break;this.vertices[i].parent_vertex=-1,this.vertices[i].parent_edge=-1,r.push(i),o++}var s=r.pop(),c=this.vertices[s].parent_vertex,l=new Be.SeqElem(s,c,this.vertices[s].parent_edge);this.v_seq.push(l),this.vertices[s].dfs_state=2;var u=this.atom_data[s];for(t=0;t<u.neighbours.length;t++){var p=u.neighbours[t].aid,d=u.neighbours[t].bid;if(p!=c)if(2==this.vertices[p].dfs_state){for(this.edges[d].closing_cycle=1,e=s;-1!=e&&this.vertices[e].parent_vertex!=p;)e=this.vertices[e].parent_vertex;if(-1==e)throw new Error("cycle unwind error");this.edges[this.vertices[e].parent_edge].opening_cycles++,this.vertices[s].branches++,l=new Be.SeqElem(p,s,d),this.v_seq.push(l)}else{if(1==this.vertices[p].dfs_state){if(-1==(e=r.indexOf(p)))throw new Error("internal: removing vertex from stack");r.splice(e,1);var h=this.vertices[p].parent_vertex;h>=0&&this.vertices[h].branches--}this.vertices[s].branches++,this.vertices[p].parent_vertex=s,this.vertices[p].parent_edge=d,this.vertices[p].dfs_state=1,r.push(p)}}}},Be.prototype.edgeClosingCycle=function(t){return 0!==this.edges[t].closing_cycle},Be.prototype.numBranches=function(t){return this.vertices[t].branches},Be.prototype.numOpeningCycles=function(t){return this.edges[t].opening_cycles},Be.prototype.toString=function(){var t="";return this.v_seq.forEach((function(e){t+=e.idx+" -> "})),t+="*"},Le.prototype.each=function(t,e){this.atoms.forEach(t,e)},Le.prototype.buildFromBonds=function(t){var e=this,n=this.molecule.atoms,r=this.molecule.bonds,a=new yt;n.forEach((function(t,o){var i=e.getNeighbors.call(e.context,o);if(2!==i.length)return!1;var s=i[0],c=i[1];if([o,s.aid,c.aid].findIndex((function(t){return["C","Si"].indexOf(n.get(t).label)<0}),e)>=0)return!1;if([s.bid,c.bid].findIndex((function(t){return r.get(t).type!==At.PATTERN.TYPE.DOUBLE}),e)>=0)return!1;var l=e.getNeighbors.call(e.context,s.aid).filter((function(t){return t.aid!=o})),u=e.getNeighbors.call(e.context,c.aid).filter((function(t){return t.aid!=o}));return!(l.length<1||l.length>2||u.length<1||u.length>2)&&(!(l.concat(u).findIndex((function(t){return r.get(t.bid).type!=At.PATTERN.TYPE.SINGLE}),e)>=0)&&(!(l.concat(u).findIndex((function(t){return r.get(t.bid).stereo==At.PATTERN.STEREO.EITHER}),e)>=0)&&(a.add(s.aid).add(c.aid),!0)))})),a.size>0&&n.forEach((function(t,n){if(!a.has(n)){var r=e.getNeighbors.call(e.context,n),o=!1;r.find((function(t){var e=this.molecule.bonds.get(t.bid);return e.type===At.PATTERN.TYPE.SINGLE&&e.begin==n&&(e.stereo===At.PATTERN.STEREO.UP||e.stereo==At.PATTERN.STEREO.DOWN)&&(o=!0,!0)}),e),o&&e.buildOneCenter(n)}}))},Le.allowed_stereocenters=[{elem:"C",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"C",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"Si",charge:0,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:3,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"N",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:4,n_double_bonds:2,implicit_degree:4},{elem:"S",charge:1,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"S",charge:0,degree:3,n_double_bonds:1,implicit_degree:3},{elem:"P",charge:0,degree:3,n_double_bonds:0,implicit_degree:3},{elem:"P",charge:1,degree:4,n_double_bonds:0,implicit_degree:4},{elem:"P",charge:0,degree:4,n_double_bonds:1,implicit_degree:4}],Le.prototype.buildOneCenter=function(t){var e=this,n=this.molecule.atoms.get(t),r=this.getNeighbors.call(this.context,t),a=r.length,o=-1,i={group:0,type:0,pyramid:[]},s=[],c=0,l=0;i.pyramid[0]=-1,i.pyramid[1]=-1,i.pyramid[2]=-1,i.pyramid[3]=-1;var u=0;if(a>4)throw new Error("stereocenter with %d bonds are not supported"+a);if(r.forEach((function(t,r){var a=e.molecule.atoms.get(t.aid),o=e.molecule.bonds.get(t.bid);if(s[r]={edge_idx:t.bid,nei_idx:t.aid,rank:t.aid,vec:pt.diff(a.pp,n.pp).yComplement()},a.pureHydrogen()?(u++,s[r].rank=1e4):"H"===a.label&&(s[r].rank=5e3),!s[r].vec.normalize())throw new Error("zero bond length");if(o.type===At.PATTERN.TYPE.TRIPLE)throw new Error("non-single bonds not allowed near stereocenter");if(o.type===At.PATTERN.TYPE.AROMATIC)throw new Error("aromatic bonds not allowed near stereocenter");o.type===At.PATTERN.TYPE.DOUBLE&&l++})),Le.allowed_stereocenters.find((function(t){return t.elem===n.label&&t.charge===n.charge&&t.degree===a&&t.n_double_bonds===l&&(o=t.implicit_degree,!0)})),-1===o)throw new Error("unknown stereocenter configuration: "+n.label+", charge "+n.charge+", "+a+" bonds ("+l+" double)");if(4===a&&u>1)throw new Error(u+" hydrogens near stereocenter");if(3===a&&4===o&&u>0)throw new Error("have hydrogen(s) besides implicit hydrogen near stereocenter");if(4===a){s[0].rank>s[1].rank&&Ie(s,0,1),s[1].rank>s[2].rank&&Ie(s,1,2),s[2].rank>s[3].rank&&Ie(s,2,3),s[1].rank>s[2].rank&&Ie(s,1,2),s[0].rank>s[1].rank&&Ie(s,0,1),s[1].rank>s[2].rank&&Ie(s,1,2);for(var p,d,h=-1,f=-1,m=-1,g=-1,b=0,v=0;v<4;v++){var y=this.getBondStereo(t,s[v].edge_idx);if(y===At.PATTERN.STEREO.UP||y==At.PATTERN.STEREO.DOWN){h=v,b=y;break}}if(-1===h)throw new Error("none of 4 bonds going from stereocenter is stereobond");if(-1===f&&((p=Le.xyzzy(s[h].vec,s[(h+1)%4].vec,s[(h+2)%4].vec))+(d=Le.xyzzy(s[h].vec,s[(h+1)%4].vec,s[(h+3)%4].vec))!=3&&p+d!=12||(f=(h+1)%4,m=(h+2)%4,g=(h+3)%4)),-1==f&&((p=Le.xyzzy(s[h].vec,s[(h+2)%4].vec,s[(h+1)%4].vec))+(d=Le.xyzzy(s[h].vec,s[(h+2)%4].vec,s[(h+3)%4].vec))!=3&&p+d!=12||(f=(h+2)%4,m=(h+1)%4,g=(h+3)%4)),-1==f&&((p=Le.xyzzy(s[h].vec,s[(h+3)%4].vec,s[(h+1)%4].vec))+(d=Le.xyzzy(s[h].vec,s[(h+3)%4].vec,s[(h+2)%4].vec))!=3&&p+d!=12||(f=(h+3)%4,m=(h+2)%4,g=(h+1)%4)),-1==f)throw new Error("internal error: can not find opposite bond");if(b==At.PATTERN.STEREO.UP&&this.getBondStereo(t,s[f].edge_idx)==At.PATTERN.STEREO.DOWN)throw new Error("stereo types of the opposite bonds mismatch");if(b==At.PATTERN.STEREO.DOWN&&this.getBondStereo(t,s[f].edge_idx)==At.PATTERN.STEREO.UP)throw new Error("stereo types of the opposite bonds mismatch");if(b==this.getBondStereo(t,s[m].edge_idx))throw new Error("stereo types of non-opposite bonds match");if(b==this.getBondStereo(t,s[g].edge_idx))throw new Error("stereo types of non-opposite bonds match");c=3==h||3==f?b:b==At.PATTERN.STEREO.UP?At.PATTERN.STEREO.DOWN:At.PATTERN.STEREO.UP,P=Le.sign(s[0].vec,s[1].vec,s[2].vec),c==At.PATTERN.STEREO.UP&&P>0||c==At.PATTERN.STEREO.DOWN&&P<0?(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[1].nei_idx,i.pyramid[2]=s[2].nei_idx):(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[2].nei_idx,i.pyramid[2]=s[1].nei_idx),i.pyramid[3]=s[3].nei_idx}else if(3===a){s[0].rank>s[1].rank&&Ie(s,0,1),s[1].rank>s[2].rank&&Ie(s,1,2),s[0].rank>s[1].rank&&Ie(s,0,1);var w=this.getBondStereo(t,s[0].edge_idx),E=this.getBondStereo(t,s[1].edge_idx),O=this.getBondStereo(t,s[2].edge_idx),x=0,S=0;if(x+=w===At.PATTERN.STEREO.UP?1:0,x+=E===At.PATTERN.STEREO.UP?1:0,x+=O===At.PATTERN.STEREO.UP?1:0,S+=w===At.PATTERN.STEREO.DOWN?1:0,S+=E===At.PATTERN.STEREO.DOWN?1:0,S+=O===At.PATTERN.STEREO.DOWN?1:0,4==o){if(3==x)throw new Error("all 3 bonds up near stereoatom");if(3==S)throw new Error("all 3 bonds down near stereoatom");if(0==x&&0==S)throw new Error("no up/down bonds near stereoatom -- indefinite case");if(1==x&&1==S)throw new Error("one bond up, one bond down -- indefinite case");if(b=0,2==x)c=At.PATTERN.STEREO.DOWN;else if(2==S)c=At.PATTERN.STEREO.UP;else{for(h=-1,m=-1,g=-1,v=0;v<3;v++)if((T=this.getBondStereo(t,s[v].edge_idx))==At.PATTERN.STEREO.UP||T==At.PATTERN.STEREO.DOWN){h=v,b=T,m=(v+1)%3,g=(v+2)%3;break}if(-1==h)throw new Error("internal error: can not find up or down bond");var A=Le.xyzzy(s[m].vec,s[g].vec,s[h].vec);if(3==A||4==A)throw new Error("degenerate case for 3 bonds near stereoatom");c=1==A?b:b==At.PATTERN.STEREO.UP?At.PATTERN.STEREO.DOWN:At.PATTERN.STEREO.UP}var P=Le.sign(s[0].vec,s[1].vec,s[2].vec);c==At.PATTERN.STEREO.UP&&P>0||c==At.PATTERN.STEREO.DOWN&&P<0?(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[1].nei_idx,i.pyramid[2]=s[2].nei_idx):(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[2].nei_idx,i.pyramid[2]=s[1].nei_idx),i.pyramid[3]=-1}else{var T;if(S>0&&x>0)throw new Error("one bond up, one bond down -- indefinite case");if(0==S&&0==x)throw new Error("no up-down bonds attached to stereocenter");T=x>0?1:-1,1!==Le.xyzzy(s[0].vec,s[1].vec,s[2].vec)&&1!==Le.xyzzy(s[0].vec,s[2].vec,s[1].vec)&&1!==Le.xyzzy(s[2].vec,s[1].vec,s[0].vec)||(T=-T),(P=Le.sign(s[0].vec,s[1].vec,s[2].vec))==T?(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[2].nei_idx,i.pyramid[2]=s[1].nei_idx):(i.pyramid[0]=s[0].nei_idx,i.pyramid[1]=s[1].nei_idx,i.pyramid[2]=s[2].nei_idx),i.pyramid[3]=-1}}this.atoms.set(t,i)},Le.prototype.getBondStereo=function(t,e){var n=this.molecule.bonds.get(e);return t!=n.begin?0:n.stereo},Le.xyzzy=function(t,e,n){var r=pt.cross(t,e),a=pt.dot(t,e),o=pt.cross(t,n),i=pt.dot(t,n);if(Math.abs(r)<.001){if(Math.abs(o)<.001)throw new Error("degenerate case -- bonds overlap");return o>0?4:8}return r*o<-1e-6||i<a?2:1},Le.sign=function(t,e,n){var r=(t.x-n.x)*(e.y-n.y)-(t.y-n.y)*(e.x-n.x);if(r>.001)return 1;if(r<-.001)return-1;throw new Error("degenerate triangle")},Le.isPyramidMappingRigid=function(t){var e=t.slice(),n=!0;return e[0]>e[1]&&(Ie(e,0,1),n=!n),e[1]>e[2]&&(Ie(e,1,2),n=!n),e[2]>e[3]&&(Ie(e,2,3),n=!n),e[1]>e[2]&&(Ie(e,1,2),n=!n),e[0]>e[1]&&(Ie(e,0,1),n=!n),e[1]>e[2]&&(Ie(e,1,2),n=!n),n},De._Atom=function(t){this.neighbours=[],this.aromatic=!1,this.lowercase=!1,this.chirality=0,this.branch_cnt=0,this.paren_written=!1,this.h_count=t,this.parent=-1},De.prototype.isBondInRing=function(t){return this.inLoop[t]},De.prototype.saveMolecule=function(t,e){var n,r,a,o=this;e||(this.ignore_errors=e),(t=t.clone()).initHalfBonds(),t.initNeighbors(),t.sortNeighbors(),t.setImplicitHydrogen(),t.sgroups.forEach((function(e){if("MUL"===e.type)try{Ct.prepareMulForSaving(e,t)}catch(n){throw Error("Bad s-group ("+n.message+")")}})),this.atoms=new Array(t.atoms.size),t.atoms.forEach((function(t,e){o.atoms[e]=new De._Atom(t.implicitH)}));var i=["B","C","N","O","P","S","Se","As"];t.bonds.forEach((function(e,n){e.type===At.PATTERN.TYPE.AROMATIC&&(o.atoms[e.begin].aromatic=!0,-1!==i.indexOf(t.atoms.get(e.begin).label)&&(o.atoms[e.begin].lowercase=!0),o.atoms[e.end].aromatic=!0,-1!==i.indexOf(t.atoms.get(e.end).label)&&(o.atoms[e.end].lowercase=!0)),o.atoms[e.begin].neighbours.push({aid:e.end,bid:n}),o.atoms[e.end].neighbours.push({aid:e.begin,bid:n})})),this.inLoop=function(){t.prepareLoopStructure();var e=new yt;t.loops.forEach((function(n){if(n.hbs.length<=6){var r=n.hbs.map((function(e){return t.halfBonds.get(e).bid}));e=e.union(new yt(r))}}));var n={};return e.forEach((function(t){n[t]=1})),n}(),this.touchedCistransbonds=0,this.markCisTrans(t);var s=t.getComponents(),c=s.reactants.concat(s.products),l=new Be(t,this.atoms,c,s.reactants.length);for(l.walk(),this.atoms.forEach((function(t){t.neighbours=[]})),n=0;n<l.v_seq.length;n++){var u=l.v_seq[n],p=u.idx,d=u.parent_edge,h=u.parent_vertex;if(d>=0){var f=this.atoms[p],m=l.numOpeningCycles(d);for(r=0;r<m;r++)this.atoms[h].neighbours.push({aid:-1,bid:-1});if(l.edgeClosingCycle(d)){for(a=0;a<f.neighbours.length;a++)if(-1===f.neighbours[a].aid){f.neighbours[a].aid=h,f.neighbours[a].bid=d;break}if(a===f.neighbours.length)throw new Error("internal: can not put closing bond to its place")}else f.neighbours.push({aid:h,bid:d}),f.parent=h;this.atoms[h].neighbours.push({aid:p,bid:d})}}try{var g=new Le(t,(function(t){return this.atoms[t].neighbours}),this);g.buildFromBonds(this.ignore_errors),g.each((function(t,e){var n=-1;-1==t.pyramid[3]&&(n=3);var i=[],s=0,c=o.atoms[e];if(-1!=c.parent)for(a=0;a<4;a++)if(t.pyramid[a]==c.parent){i[s++]=a;break}for(-1!=n&&(i[s++]=n),r=0;r!=c.neighbours.length;r++)if(c.neighbours[r].aid!=c.parent)for(a=0;a<4;a++)if(c.neighbours[r].aid==t.pyramid[a]){if(s>=4)throw new Error("internal: pyramid overflow");i[s++]=a;break}if(4==s)s=i[0],i[0]=i[1],i[1]=i[2],i[2]=i[3],i[3]=s;else if(3!=s)throw new Error("cannot calculate chirality");Le.isPyramidMappingRigid(i)?o.atoms[e].chirality=1:o.atoms[e].chirality=2}))}catch(x){}var b=[];b.push(0);var v=!0;for(n=0;n<l.v_seq.length;n++){p=(u=l.v_seq[n]).idx,d=u.parent_edge;var y=!0;if((h=u.parent_vertex)>=0){for(l.numBranches(h)>1&&this.atoms[h].branch_cnt>0&&this.atoms[h].paren_written&&(this.smiles+=")"),m=l.numOpeningCycles(d),r=0;r<m;r++){for(a=1;a<b.length&&-1!=b[a];a++);a==b.length?b.push(h):b[a]=h,this.writeCycleNumber(a)}if(h>=0){var w=l.numBranches(h);if(w>1&&this.atoms[h].branch_cnt<w-1&&(l.edgeClosingCycle(d)?this.atoms[h].paren_written=!1:(this.smiles+="(",this.atoms[h].paren_written=!0)),this.atoms[h].branch_cnt++,this.atoms[h].branch_cnt>w)throw new Error("unexpected branch")}var E=t.bonds.get(d),O=0;if(E.type==At.PATTERN.TYPE.SINGLE&&(O=this.calcBondDirection(t,d,h)),1==O&&p==E.end||2==O&&p==E.begin?this.smiles+="/":2==O&&p==E.end||1==O&&p==E.begin?this.smiles+="\\":E.type==At.PATTERN.TYPE.ANY?this.smiles+="~":E.type==At.PATTERN.TYPE.DOUBLE?this.smiles+="=":E.type==At.PATTERN.TYPE.TRIPLE?this.smiles+="#":E.type==At.PATTERN.TYPE.SINGLE_OR_AROMATIC?this.smiles+="-,:":E.type==At.PATTERN.TYPE.DOUBLE_OR_AROMATIC?this.smiles+="=,:":E.type==At.PATTERN.TYPE.SINGLE_OR_DOUBLE?this.smiles+="-,=":E.type!=At.PATTERN.TYPE.AROMATIC||this.atoms[E.begin].lowercase&&this.atoms[E.end].lowercase&&this.isBondInRing(d)?E.type==At.PATTERN.TYPE.SINGLE&&this.atoms[E.begin].aromatic&&this.atoms[E.end].aromatic&&(this.smiles+="-"):this.smiles+=":",l.edgeClosingCycle(d)){for(r=1;r<b.length&&b[r]!=p;r++);if(r==b.length)throw new Error("cycle number not found");this.writeCycleNumber(r),b[r]=-1,y=!1}}else v||(this.smiles+=this.writtenComponents===l.nComponentsInReactants&&0!==l.nReactants?">>":"."),v=!1,this.writtenComponents++;y&&(this.writeAtom(t,p,this.atoms[p].aromatic,this.atoms[p].lowercase,this.atoms[p].chirality),this.writtenAtoms.push(u.idx))}return this.comma=!1,this.writeRadicals(t),this.comma&&(this.smiles+="|"),this.smiles},De.prototype.writeCycleNumber=function(t){if(t>0&&t<10)this.smiles+=t;else if(t>=10&&t<100)this.smiles+="%"+t;else{if(!(t>=100&&t<1e3))throw new Error("bad cycle number: "+t);this.smiles+="%%"+t}},De.prototype.writeAtom=function(t,e,n,r,a){var o,i=t.atoms.get(e),s=!1,c=-1;if("A"!=i.label)if("R"!=i.label&&"R#"!=i.label){o=i.aam,"C"!=i.label&&"P"!=i.label&&"N"!=i.label&&"S"!=i.label&&"O"!=i.label&&"Cl"!=i.label&&"F"!=i.label&&"Br"!=i.label&&"B"!=i.label&&"I"!=i.label&&(s=!0),(i.explicitValence>=0||0!=i.radical||a>0||n&&"C"!=i.label&&"O"!=i.label||n&&"C"==i.label&&this.atoms[e].neighbours.length<3&&0==this.atoms[e].h_count)&&(c=this.atoms[e].h_count);var l=i.label;if(i.atomList&&!i.atomList.notList?(l=i.atomList.label(),s=!1):i.isPseudo()||i.atomList&&i.atomList.notList?(l="*",s=!0):(a||0!=i.charge||i.isotope>0||c>=0||o>0)&&(s=!0),s&&(-1==c&&(c=this.atoms[e].h_count),this.smiles+="["),i.isotope>0&&(this.smiles+=i.isotope),this.smiles+=r?l.toLowerCase():l,a>0&&(this.smiles+=1==a?"@":"@@",i.implicitH>1))throw new Error(i.implicitH+" implicit H near stereocenter");"H"!=i.label&&(c>1||0==c&&!s?this.smiles+="H"+c:1==c&&(this.smiles+="H")),i.charge>1?this.smiles+="+"+i.charge:i.charge<-1?this.smiles+=i.charge:1==i.charge?this.smiles+="+":-1==i.charge&&(this.smiles+="-"),o>0&&(this.smiles+=":"+o),s&&(this.smiles+="]")}else this.smiles+="[*]";else this.smiles+="*"},De.prototype.markCisTrans=function(t){var e=this;this.cis_trans=new Me(t,(function(t){return this.atoms[t].neighbours}),this),this.cis_trans.build(),this.dbonds=new Array(t.bonds.size),t.bonds.forEach((function(t,n){e.dbonds[n]={ctbond_beg:-1,ctbond_end:-1,saved:0}})),this.cis_trans.each((function(n,r){var a=t.bonds.get(r);if(0!==n.parity&&!e.isBondInRing(r)){var o=e.atoms[a.begin].neighbours,i=e.atoms[a.end].neighbours,s=!0,c=!0;if(o.forEach((function(e){e.bid!==r&&t.bonds.get(e.bid).type===At.PATTERN.TYPE.SINGLE&&(s=!1)})),i.forEach((function(e){e.bid!==r&&t.bonds.get(e.bid).type===At.PATTERN.TYPE.SINGLE&&(c=!1)})),s||c)return;o.forEach((function(n){n.bid!==r&&(t.bonds.get(n.bid).begin===a.begin?e.dbonds[n.bid].ctbond_beg=r:e.dbonds[n.bid].ctbond_end=r)})),i.forEach((function(n){n.bid!==r&&(t.bonds.get(n.bid).begin===a.end?e.dbonds[n.bid].ctbond_beg=r:e.dbonds[n.bid].ctbond_end=r)}))}}))},De.prototype.updateSideBonds=function(t,e){var n=t.bonds.get(e),r=this.cis_trans.getSubstituents(e),a=this.cis_trans.getParity(e),o=[-1,-1,-1,-1];o[0]=t.findBondId(r[0],n.begin),-1!=r[1]&&(o[1]=t.findBondId(r[1],n.begin)),o[2]=t.findBondId(r[2],n.end),-1!=r[3]&&(o[3]=t.findBondId(r[3],n.end));var i=0,s=0,c=0,l=0;if(0!=this.dbonds[o[0]].saved&&(1==this.dbonds[o[0]].saved&&t.bonds.get(o[0]).begin==n.begin||2==this.dbonds[o[0]].saved&&t.bonds.get(o[0]).end==n.begin?i++:s++),-1!=o[1]&&0!=this.dbonds[o[1]].saved&&(2==this.dbonds[o[1]].saved&&t.bonds.get(o[1]).begin==n.begin||1==this.dbonds[o[1]].saved&&t.bonds.get(o[1]).end==n.begin?i++:s++),0!=this.dbonds[o[2]].saved&&(1==this.dbonds[o[2]].saved&&t.bonds.get(o[2]).begin==n.end||2==this.dbonds[o[2]].saved&&t.bonds.get(o[2]).end==n.end?c++:l++),-1!=o[3]&&0!=this.dbonds[o[3]].saved&&(2==this.dbonds[o[3]].saved&&t.bonds.get(o[3]).begin==n.end||1==this.dbonds[o[3]].saved&&t.bonds.get(o[3]).end==n.end?c++:l++),a==Me.PARITY.CIS?(i+=c,s+=l):(i+=l,s+=c),i>0&&s>0)throw new Error("incompatible cis-trans configuration");return(0!=i||0!=s)&&(i>0&&(this.dbonds[o[0]].saved=t.bonds.get(o[0]).begin==n.begin?1:2,-1!=o[1]&&(this.dbonds[o[1]].saved=t.bonds.get(o[1]).begin==n.begin?2:1),this.dbonds[o[2]].saved=t.bonds.get(o[2]).begin==n.end==(a==Me.PARITY.CIS)?1:2,-1!=o[3]&&(this.dbonds[o[3]].saved=t.bonds.get(o[3]).begin==n.end==(a==Me.PARITY.CIS)?2:1)),s>0&&(this.dbonds[o[0]].saved=t.bonds.get(o[0]).begin==n.begin?2:1,-1!=o[1]&&(this.dbonds[o[1]].saved=t.bonds.get(o[1]).begin==n.begin?1:2),this.dbonds[o[2]].saved=t.bonds.get(o[2]).begin==n.end==(a==Me.PARITY.CIS)?2:1,-1!=o[3]&&(this.dbonds[o[3]].saved=t.bonds.get(o[3]).begin==n.end==(a==Me.PARITY.CIS)?1:2)),!0)},De.prototype.calcBondDirection=function(t,e,n){var r,a=this;if(-1==this.dbonds[e].ctbond_beg&&-1==this.dbonds[e].ctbond_end)return 0;if(t.bonds.get(e).type!=At.PATTERN.TYPE.SINGLE)throw new Error("internal: directed bond type "+t.bonds.get(e).type);for(;r=0,this.cis_trans.each((function(e,n){0===e.parity||a.isBondInRing(n)||a.updateSideBonds(t,n)&&r++})),r!==this.touchedCistransbonds;)this.touchedCistransbonds=r;return 0===this.dbonds[e].saved&&(n===t.bonds.get(e).begin?this.dbonds[e].saved=1:this.dbonds[e].saved=2),this.dbonds[e].saved},De.prototype.writeRadicals=function(t){var e,n,r=new Array(this.writtenAtoms.length);for(e=0;e<this.writtenAtoms.length;e++)if(!r[e]){var a=t.atoms.get(this.writtenAtoms[e]).radical;if(0!=a)for(this.comma?this.smiles+=",":(this.smiles+=" |",this.comma=!0),a==Ot.PATTERN.RADICAL.SINGLET?this.smiles+="^3:":a==Ot.PATTERN.RADICAL.DOUPLET?this.smiles+="^1:":this.smiles+="^4:",this.smiles+=e,n=e+1;n<this.writtenAtoms.length;n++)t.atoms.get(this.writtenAtoms[n]).radical==a&&(r[n]=!0,this.smiles+=","+n)}};var ze=function(t,e){var n=e||{};return(new De).saveMolecule(t,n.ignoreErrors)},_e={id:"/Graph",type:"object",required:["root"],properties:{header:{$ref:"#/header"},root:{$ref:"#/root"}},patternProperties:{"^mol":{$ref:"/Molecule"},"^rg":{$ref:"/RGroup"}},root:{id:"/Root",required:["nodes"],properties:{nodes:{type:"array",items:{oneOf:[{$ref:"/RxnPlus"},{$ref:"/RxnArrow"},{type:"object",required:["$ref"],properties:{$ref:{type:"string"}}}]}},edges:{type:"array",items:{oneOf:[{properties:{$refs:{type:"array",maxItems:2,items:{type:"string"}}}}]}}}},header:{title:"Header",type:"object",properties:{moleculeName:{title:"Molecule name",type:"string",default:""},creatorProgram:{title:"Creator program",type:"string"},comment:{title:"Comment",type:"string"}}}};function He(t,e,n,r){void 0===n||null===n||n===r||Array.isArray(n)&&0===n.length||(t[e]=n)}var Ve={id:"/Molecule",type:"object",properties:{stereoFlag:{title:"Stereo Flag",type:["string",null],enum:[null,"ABS","AND","OR","Mixed"],default:null},atoms:{title:"Atoms",type:"array",items:{oneOf:[{$ref:"#/atom"},{$ref:"#/rgatom"},{$ref:"#/atomlist"}]}},bonds:{title:"Bonds",type:"array",items:{$ref:"#/bond"}},sgroups:{title:"SGroups",type:"array",items:{$ref:"#/sgroup"}}},atom:{title:"Atom",type:"object",required:["label","location"],properties:{label:{title:"Label",type:"string",maxLength:3},alias:{title:"Alias",type:"string"},location:{title:"Location",type:"array",items:{type:"float",precision:1}},rgroups:{title:"Rgroups",type:"array",items:{type:"integer"}},charge:{title:"Charge",type:"integer",minimum:-1e3,maximum:1e3,default:0},explicitValence:{title:"Valence",enum:[-1,0,1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["Not specified","0","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"],default:-1},isotope:{title:"Isotope",type:"integer",minimum:0,default:0},radical:{title:"Radical",enum:[0,2,1,3],enumNames:["Not specified","Monoradical","Diradical (singlet)","Diradical (triplet)"],default:0},attachmentPoints:{title:"Rgroup attachment points",enum:[0,1,2,3],enumNames:["No","First site only","Second site only","First and second site"],default:0},stereoLabel:{title:"Stereo label",type:["string","null"],pattern:/(^abs)|(^and)|(^or)/,default:null},stereoParity:{title:"Stereo parity configuration",enum:[0,1,2,3],enumNames:["none","odd parity","even parity","either parity"],default:0},weight:{title:"Atomic weight",type:"integer",default:0},ringBondCount:{title:"Ring bond count",enum:[0,-2,-1,2,3,4],enumNames:["","As drawn","0","2","3","4"],default:0},substitutionCount:{title:"Substitution count",enum:[0,-2,-1,1,2,3,4,5,6],enumNames:["Not specified","As drawn","0","1","2","3","4","5","6"],default:0},unsaturatedAtom:{title:"Unsaturated",type:"boolean",default:!1},hCount:{title:"H count",enum:[-1,0,1,2,3,4,5],enumNames:["Zero","Not specified","H0","H1","H2","H3","H4"],default:0},mapping:{title:"Atom-atom mapping",type:"integer",default:0},invRet:{title:"Inversion",enum:[0,1,2],enumNames:["","Inverts","Retains"],default:0},exactChangeFlag:{title:"Exact change",type:"boolean",default:!1}}},atomlist:{title:"RGroup-atom",type:"object",required:["type","location"],properties:{type:{enum:["atom-list"]},notList:{type:"boolean",default:!1},location:{title:"Location",type:"array",items:{type:"float",precision:1}},elements:{type:"array",minItems:2,items:{type:"string",maxLength:3}},attachmentPoints:{title:"Rgroup attachment points",enum:[0,1,2,3],enumNames:["No","First site only","Second site only","First and second site"],default:0}}},rgatom:{title:"RGroup-atom",type:"object",required:["type","location"],properties:{type:{enum:["rg-label"]},location:{title:"Location",type:"array",items:{type:"float",precision:1}},$refs:{type:"array",items:{type:"string",pattern:"^rg-",maxLength:5}},rgroups:{type:"array",items:{$ref:"/RGroup"}},attachmentPoints:{title:"Rgroup attachment points",enum:[0,1,2,3],enumNames:["No","First site only","Second site only","First and second site"],default:0}}},bond:{title:"Bond",type:"object",required:["atoms"],properties:{type:{title:"Type",enum:[1,2,3,4,5,6,7,8,9,10,11,12],enumNames:["Single","Single Up","Single Down","Single Up/Down","Double","Double Cis/Trans","Triple","Aromatic","Any","Single/Double","Single/Aromatic","Double/Aromatic"],default:1},atoms:{title:"Atoms",type:"array",minItems:2,maxItems:2,items:{type:"integer"}},stereo:{title:"Bond stereo configuration",enum:[0,1,2,3],enumNames:["None","Up","Either","Down"],default:0},topology:{title:"Topology",enum:[0,1,2],enumNames:["Either","Ring","Chain"],default:0},center:{title:"Reacting Center",enum:[0,-1,1,2,4,8,12],enumNames:["Unmarked","Not center","Center","No change","Made/broken","Order changes","Made/broken and changes"],default:0},stereobox:{title:"Stereo box",enum:[0,1],default:0}}},sgroup:{title:"SGroup",allOf:[{required:["atoms"],properties:{atoms:{type:"array"}}},{oneOf:[{key:"GEN",title:"Generic",properties:{type:{enum:["GEN"]}}},{key:"MUL",title:"Multiple group",type:"object",properties:{type:{enum:["MUL"]},mul:{title:"Repeat count",type:"integer",default:1,minimum:1,maximum:1e3}},required:["mul"]},{key:"SRU",title:"SRU polymer",properties:{type:{enum:["SRU"]},subscript:{title:"Polymer label",type:"string",default:"n",pattern:"^[a-zA-Z]$",invalidMessage:"SRU subscript should consist of a single letter"},connectivity:{title:"Repeat Pattern",enum:["HT","HH","EU"],enumNames:["Head-to-tail","Head-to-head","Either unknown"],default:"ht"}},required:["subscript","connectivity"]},{key:"SUP",title:"Superatom",properties:{type:{enum:["SUP"]},name:{title:"Name",type:"string",default:"",minLength:1,invalidMessage:"Please, provide a name for the superatom"}}},{key:"DAT",title:"Data-group",properties:{type:{enum:["DAT"]},context:{title:"Context",enum:["Fragment","Multifragment","Bond","Atom","Group"],default:"Fragment"},fieldName:{title:"Field name",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field value"},display:{title:"Display",type:"boolean",default:!1},placement:{title:"Placement",type:"boolean",default:!0}},required:["context","fieldName","fieldValue"]}]}]}};function Fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ge(t){var e={atoms:Array.from(t.atoms.values()).map((function(t){return"R#"===t.label?function(t){var e=Ve.rgatom.properties,n={type:"rg-label"};He(n,"location",[t.pp.x,t.pp.y,t.pp.z]),He(n,"attachmentPoints",t.attpnt,e.attachmentPoints.default);var r=function(t){var e,n,r=[];for(e=0;e<32;e++)t&1<<e&&(n=e+1,r.push(n));return r}(t.rglabel).map((function(t){return"rg-".concat(t)}));return He(n,"$refs",r),n}(t):"L#"===t.label?function(t){var e=Ve.atomlist.properties,n={type:"atom-list"};return He(n,"location",[t.pp.x,t.pp.y,t.pp.z]),He(n,"attachmentPoints",t.attpnt,e.attachmentPoints.default),He(n,"elements",t.atomList.labelList()),He(n,"notList",t.atomList.notList,e.notList.default),n}(t):function(t){var e=Ve.atom.properties,n={};return He(n,"label",t.label),He(n,"alias",t.alias),He(n,"location",[t.pp.x,t.pp.y,t.pp.z]),He(n,"charge",t.charge,e.charge.default),He(n,"explicitValence",t.explicitValence,e.explicitValence.default),He(n,"isotope",t.isotope,e.isotope.default),He(n,"radical",t.radical,e.radical.default),He(n,"attachmentPoints",t.attpnt,e.attachmentPoints.default),He(n,"stereoLabel",t.stereoLabel,e.stereoLabel.default),He(n,"stereoParity",t.stereoCare,e.stereoParity.default),He(n,"weight",t.weight,e.weight.default),He(n,"ringBondCount",t.ringBondCount,e.ringBondCount.default),He(n,"substitutionCount",t.substitutionCount,e.substitutionCount.default),He(n,"unsaturatedAtom",!!t.unsaturatedAtom,e.unsaturatedAtom.default),He(n,"hCount",t.hCount,e.hCount.default),He(n,"mapping",parseInt(t.aam),e.mapping.default),He(n,"invRet",t.invRet,e.invRet.default),He(n,"exactChangeFlag",!!t.exactChangeFlag,e.exactChangeFlag.default),n}(t)}))};0!==t.bonds.size&&(e.bonds=Array.from(t.bonds.values()).map(Ue)),0!==t.sgroups.size&&(e.sgroups=Array.from(t.sgroups.values()).map(We));var n=t.frags.get(0);return n&&He(e,"stereoFlag",n.enhancedStereoFlag,Ve.properties.stereoFlag.default),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({type:"molecule"},e)}function Ue(t){var e=Ve.bond.properties,n={};return He(n,"type",t.type),He(n,"atoms",[t.begin,t.end]),He(n,"stereo",t.stereo,e.stereo.default),He(n,"topology",t.topology,e.topology.default),He(n,"center",t.reactingCenterStatus,e.center.default),n}function We(t){var e,n={};switch(He(n,"type",t.type),He(n,"atoms",t.atoms),t.type){case"GEN":break;case"MUL":e=Ve.sgroup.allOf[1].oneOf[1].properties,He(n,"mul",t.data.mul||e.mul.default);break;case"SRU":e=Ve.sgroup.allOf[1].oneOf[2].properties,He(n,"subscript",t.data.subscript||e.subscript.default),He(n,"connectivity",t.data.connectivity.toUpperCase()||e.connectivity.default);break;case"SUP":e=Ve.sgroup.allOf[1].oneOf[3].properties,He(n,"name",t.data.name||e.name.default);break;case"DAT":e=Ve.sgroup.allOf[1].oneOf[4].properties;var r=t.data;He(n,"placement",r.absolute,e.placement.default),He(n,"display",r.attached,e.display.default),He(n,"context",r.context),He(n,"fieldName",r.fieldName),He(n,"fieldData",r.fieldValue)}return n}var Ye={id:"/RGroup",type:"object",allOf:[{required:["type"],properties:{type:{enum:["rgroup"]},rlogic:{$ref:"#/logic"}}},{$ref:"/Molecule"}],logic:{title:"RGroupLogic",type:"object",required:["number"],properties:{number:{type:"number"},range:{title:"Occurrence",type:"string",maxLength:50,default:""},resth:{title:"RestH",type:"boolean",default:!1},ifthen:{title:"Condition",type:"integer",minimum:0,default:0}}}};function qe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $e(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qe(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ke(t,e){var n=Ye.logic.properties,r={};return He(r,"number",t),He(r,"range",e.range,n.range.default),He(r,"resth",e.resth,n.resth.default),He(r,"ifthen",e.ifthen,n.ifthen.default),r}function Xe(t){var e=new Nt;return t.atoms.forEach((function(t){"rg-label"===t.type&&e.atoms.add(function(t){var e={label:"R#"};He(e,"pp",{x:t.location[0],y:t.location[1],z:t.location[2]||0}),He(e,"attpnt",t.attachmentPoints);var n=function(t){var e=0;return t.forEach((function(t){e|=1<<t-1})),e}(t.$refs.map((function(t){return parseInt(t.slice(3))})));return He(e,"rglabel",n),new Ot(e)}(t)),"atom-list"===t.type&&e.atoms.add(function(t){var e={label:"L#"};He(e,"pp",{x:t.location[0],y:t.location[1],z:t.location[2]||0}),He(e,"attpnt",t.attachmentPoints);var n=t.elements.map((function(t){return ut.map[t]}));return He(e,"atomList",{ids:n,notList:t.notList}),new Ot(e)}(t)),t.type||e.atoms.add(function(t){var e={};return He(e,"label",t.label),He(e,"alias",t.alias),He(e,"pp",{x:t.location[0],y:t.location[1],z:t.location[2]||0}),He(e,"charge",t.charge),He(e,"explicitValence",t.explicitValence),He(e,"isotope",t.isotope),He(e,"radical",t.radical),He(e,"attpnt",t.attachmentPoints),He(e,"stereoLabel",t.stereoLabel),He(e,"stereoParity",t.stereoParity),He(e,"weight",t.weight),He(e,"ringBondCount",t.ringBondCount),He(e,"substitutionCount",t.substitutionCount),He(e,"unsaturatedAtom",!!t.unsaturatedAtom),He(e,"hCount",t.hCount),He(e,"aam",t.mapping),He(e,"invRet",t.invRet),He(e,"exactChangeFlag",!!t.exactChangeFlag),new Ot(e)}(t))})),t.bonds&&t.bonds.forEach((function(t){return e.bonds.add(function(t){var e={};return He(e,"type",t.type),He(e,"topology",t.topology),He(e,"reactingCenterStatus",t.center),He(e,"stereo",t.stereo),He(e,"begin",t.atoms[0]),He(e,"end",t.atoms[1]),new At(e)}(t))})),t.sgroups&&t.sgroups.forEach((function(t){return e.sgroups.add(function(t){var e=new Ct(t.type);switch(He(e,"atoms",t.atoms),t.type){case"GEN":break;case"MUL":He(e.data,"mul",t.mul);break;case"SRU":He(e.data,"subscript",t.subscript),He(e.data,"connectivity",t.connectivity.toLowerCase());break;case"SUP":He(e.data,"name",t.name);break;case"DAT":He(e.data,"absolute",t.placement),He(e.data,"attached",t.display),He(e.data,"context",t.context),He(e.data,"fieldName",t.fieldName),He(e.data,"fieldValue",t.fieldData)}return e}(t))})),e.initHalfBonds(),e.initNeighbors(),e.markFragments(),t.stereoFlag&&(e.frags.get(0).enhancedStereoFlag=t.stereoFlag),e}function Ze(t){var e=Xe(t),n=function(t){var e={};return He(e,"range",t.range),He(e,"resth",t.resth),He(e,"ifthen",t.ifthen),new Rt(e)}(t.rlogic);return e.frags.forEach((function(t,e){n.frags.add(e)})),t.rlogic&&e.rgroups.set(t.rlogic.number,n),e}function Qe(t,e){return"arrow"===t.type?e.rxnArrows.add(new It({pp:{x:t.location[0],y:t.location[1],z:t.location[2]}})):e.rxnPluses.add(new Bt({pp:{x:t.location[0],y:t.location[1],z:t.location[2]}})),e}function Je(t,e){var n;if("undefined"===typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(!t)return;if("string"===typeof t)return tn(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tn(t,e)}(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return i=t.done,t},e:function(t){s=!0,o=t},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw o}}}}function tn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function en(t,e){var n=t.getCoordBoundingBox(e);return pt.centre(n.min,n.max)}function nn(t,e){switch(t.type){case"arrow":case"plus":Qe(t,e);break;case"simpleObject":!function(t,e){e.simpleObjects.add(new Lt(t.data))}(t,e);break;case"molecule":Xe(t).mergeInto(e);break;case"rgroup":Ze(t).mergeInto(e)}}var rn={toGraph:function(t){var e={root:{nodes:[]}},n=function(t){var e={},n=_e.header.properties;return He(e,"moleculeName",t.name,n.moleculeName.default),He(e,"creatorProgram",null,n.moleculeName.default),He(e,"comment",null,n.moleculeName.default),0!==Object.keys(e).length?e:null}(t);n&&(e.header=n);var r=function(t){var e,n=[],r=new Set,a=Je(t.rgroups.entries());try{for(a.s();!(e=a.n()).done;){var o=u()(e.value,2),i=o[0],s=o[1];s.frags.forEach((function(t){return r.add(t)}));var c=Array.from(s.frags.values()).reduce((function(e,n){return e.union(t.getFragmentIds(n))}),new yt);n.push({type:"rgroup",fragment:t.clone(c),center:en(t,c),data:{rgnumber:i,rgroup:s}})}}catch(p){a.e(p)}finally{a.f()}var l=Array.from(t.frags.keys()).filter((function(t){return!r.has(t)})).reduce((function(e,n){var r=t.getFragmentIds(n);return e=e.union(r)}),new yt);return n.push({type:"molecule",fragment:t.clone(l),center:en(t,l)}),t.rxnArrows.forEach((function(t){n.push({type:"arrow",center:t.pp,data:{}})})),t.rxnPluses.forEach((function(t){n.push({type:"plus",center:t.pp,data:{}})})),t.simpleObjects.forEach((function(t){n.push({type:"simpleObject",center:t.pos[0],data:{mode:t.mode,pos:t.pos}})})),n.sort((function(t,e){return t.center.x-e.center.x}))}(t),a=0;return r.forEach((function(t){switch(t.type){case"molecule":e.root.nodes.push({$ref:"mol".concat(a)}),e["mol".concat(a++)]=Ge(t.fragment);break;case"rgroup":e.root.nodes.push({$ref:"rg".concat(t.data.rgnumber)}),e["rg".concat(t.data.rgnumber)]=function(t,e){var n=$e({rlogic:Ke(e.rgnumber,e.rgroup)},Ge(t));return $e($e({},n),{},{type:"rgroup"})}(t.fragment,t.data);break;case"plus":e.root.nodes.push(function(t){var e=t.center;return{type:"plus",location:[e.x,e.y,e.z],prop:t.data}}(t));break;case"arrow":e.root.nodes.push(function(t){var e=t.center;return{type:"arrow",location:[e.x,e.y,e.z],prop:t.data}}(t));break;case"simpleObject":e.root.nodes.push({type:"simpleObject",data:t.data})}})),e},fromGraph:function(t){var e=new Nt;e.name=t.header?t.header.moleculeName:null;var n=t.root.nodes;return Object.keys(n).forEach((function(r){n[r].type?nn(n[r],e):n[r].$ref&&nn(t[n[r].$ref],e)})),e}},an={mol:{name:"MDL Molfile",mime:"chemical/x-mdl-molfile",ext:[".mol"],supportsCoords:!0},rxn:{name:"MDL Rxnfile",mime:"chemical/x-mdl-rxnfile",ext:[".rxn"],supportsCoords:!0},smiles:{name:"Daylight SMILES",mime:"chemical/x-daylight-smiles",ext:[".smi",".smiles"]},"smiles-ext":{name:"Extended SMILES",mime:"chemical/x-chemaxon-cxsmiles",ext:[".cxsmi",".cxsmiles"]},smarts:{name:"Daylight SMARTS",mime:"chemical/x-daylight-smarts",ext:[".smarts"]},inchi:{name:"InChI",mime:"chemical/x-inchi",ext:[".inchi"]},"inchi-aux":{name:"InChI AuxInfo",mime:"chemical/x-inchi-aux",ext:[".inchi"]},cml:{name:"CML",mime:"chemical/x-cml",ext:[".cml",".mrv"],supportsCoords:!0},graph:{name:"Graph Format",mime:"application/json",ext:[".ket"]}};function on(t,e,n,r){if("graph"===e){var a=rn.toGraph(t);return Promise.resolve(JSON.stringify(a,null,4))}return new Promise((function(a){var o=Re(t);if("mol"===e||"rxn"===e)a(o);else if("smiles"===e)a(ze(t));else{a(n.then((function(){return n.convert({struct:o,output_format:an[e].mime},r)})).catch((function(t){throw"Server is not compatible"===t.message?Error("".concat(an[e].name," is not supported in standalone mode.")):Error("Convert error!\n".concat(t.message))})).then((function(t){return t.struct})))}}))}function sn(t,e,n,r){return new Promise((function(a){var o=function(t,e){var n=t.trim();try{if(JSON.parse(n))return"graph"}catch(o){}if(-1!==n.indexOf("$RXN"))return"rxn";var r=n.match(/^(M {2}END|\$END MOL)$/m);if(r){var a=r.index+r[0].length;if(a===n.length||-1!==n.slice(a,a+20).search(/^\$(MOL|END CTAB)$/m))return"mol"}return"<"===n[0]&&-1!==n.indexOf("<molecule")?"cml":"InChI"===n.slice(0,5)?"inchi":-1===n.indexOf("\n")?"smiles":e?null:"mol"}(t);if("graph"===o)a(rn.fromGraph(JSON.parse(t)));else if("mol"===o&&"V2000"===Ne(t)||"rxn"===o){a(je(t,e))}else{var i=an[o].supportsCoords;a(n.then((function(){return i?n.convert({struct:t,output_format:an.mol.mime},r):n.layout({struct:t.trim(),output_format:an.mol.mime},r)})).catch((function(t){if("Server is not compatible"===t.message){var e="smiles"===o?"".concat(an["smiles-ext"].name," and opening of ").concat(an.smiles.name):an[o].name;throw Error("".concat(e," is not supported in standalone mode."))}throw Error("Convert error!\n".concat(t.message))})).then((function(t){var e=je(t.struct);return i||e.rescale(),e})))}}))}var cn=a.a.createContext({}),ln=a.a.createContext(null);function un(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var pn=window.clipboardData,dn=function(t){v()(n,t);var e=un(n);function n(t){var a;return d()(this,n),(a=e.call(this,t)).textAreaRef=Object(r.createRef)(),a}return f()(n,[{key:"componentDidMount",value:function(){var t=this,e=this.textAreaRef.current;this.target=this.props.target||e.parentNode,this.listeners={mouseup:function(n){var r;(e===n.target||!hn(n.target)&&t.props.focused())&&((r=e).value=" ",r.focus(),r.select())},mousedown:function(t){t.shiftKey&&!hn(t.target)&&t.preventDefault()},copy:function(e){if(t.props.focused()&&t.props.onCopy){var n=t.props.onCopy();n&&fn(e.clipboardData,n),e.preventDefault()}},cut:function(e){if(t.props.focused()&&t.props.onCut){var n=t.props.onCut();n&&fn(e.clipboardData,n),e.preventDefault()}},paste:function(e){if(t.props.focused()&&t.props.onPaste){var n=function(t,e){var n={};!t&&pn?n["text/plain"]=pn.getData("text"):(n["text/plain"]=t.getData("text/plain"),n=e.reduce((function(e,n){var r=t.getData(n);return r&&(e[n]=r),e}),n));return n}(e.clipboardData,t.props.formats);n&&t.props.onPaste(n),e.preventDefault()}}},Object.keys(this.listeners).forEach((function(e){t.target.addEventListener(e,t.listeners[e])}))}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillUnmount",value:function(){var t=this;Object.keys(this.listeners).forEach((function(e){t.target.removeEventListener(e,t.listeners[e])}))}},{key:"render",value:function(){return a.a.createElement("textarea",{ref:this.textAreaRef,className:"cliparea",contentEditable:!0,autoFocus:!0,suppressContentEditableWarning:!0})}}]),n}(r.Component);function hn(t){return("INPUT"!==t.tagName||"button"!==t.type)&&["INPUT","SELECT","TEXTAREA","OPTION","LABEL"].includes(t.tagName)}function fn(t,e){if(!t&&pn)pn.setData("text",e["text/plain"]);else{var n=null;t.setData("text/plain",e["text/plain"]);try{Object.keys(e).forEach((function(r){n=r,t.setData(r,e[r])}))}catch(r){console.info("Could not write exact type ".concat(n))}}}var mn=["cut","copy","paste"];function gn(t){var e=document.queryCommandSupported(t);if(e)try{e=document.execCommand(t)||window.ClipboardEvent||pn}catch(n){e=!1}return e}var bn="undefined"!==typeof navigator&&/Mac/.test(navigator.platform);function vn(t){var e,n,r,a,o=t.split(/\+(?!$)/),i=o[o.length-1];"Space"===i&&(i=" ");for(var s=0;s<o.length-1;s++){var c=o[s];if(/^(cmd|meta|m)$/i.test(c))a=!0;else if(/^a(lt)?$/i.test(c))e=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))r=!0;else{if(!/^mod$/i.test(c))throw new Error("Unrecognized modifier name: "+c);bn?a=!0:n=!0}}return e&&(i="Alt+"+i),n&&(i="Ctrl+"+i),a&&(i="Meta+"+i),r&&(i="Shift+"+i),i}function yn(t){var e=Object.create(null);return Object.keys(t).forEach((function(n){e[vn(n)]=t[n]})),e}function wn(t,e,n){return e.altKey&&(t="Alt+"+t),e.ctrlKey&&(t="Ctrl+"+t),e.metaKey&&(t="Meta+"+t),!1!==n&&e.shiftKey&&(t="Shift+"+t),t}function En(t,e){return t.replace(/[\u0430-\u044f]/,L.a[e.keyCode]).replace(/[\u0410-\u042f]/,L.c[e.keyCode])}function On(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=En(Object(L.b)(t),t),r=1===n.length&&" "!==n;return r&&!e?wn(n,t,!r):wn(L.a[t.keyCode],t,!0)}function xn(t){return t instanceof KeyboardEvent?On.apply(void 0,arguments):"object"===B()(t)?yn(t):vn(t)}function Sn(t,e){return t.oneOf.reduce((function(t,n){return t[function(t,e){var n=t.properties[e];return n.constant||n.enum[0]}(n,e)]=n,t}),{})}xn.lookup=function(t,e){var n=En(Object(L.b)(e),e);"Add"===n&&(n="+"),"Subtract"===n&&(n="-");var r,a=1===n.length&&" "!==n,o=t[wn(n,e,!a)];return e.shiftKey&&a&&(r=L.a[e.keyCode])&&(o=t[wn(r,e,!0)]||o),o};var An={title:"Atom",type:"object",required:"label",properties:{label:{title:"Label",type:"string",maxLength:3,invalidMessage:"Wrong label"},alias:{title:"Alias",type:"string",invalidMessage:"Leading and trailing spaces are not allowed"},charge:{title:"Charge",type:"string",pattern:/^([+-]?)(\d{1,3}|1000)([+-]?)$/,maxLength:5,default:"0",invalidMessage:"Invalid charge value"},explicitValence:{title:"Valence",enum:[-1,0,1,2,3,4,5,6,7,8],enumNames:["","0","I","II","III","IV","V","VI","VII","VIII"],default:-1},isotope:{title:"Isotope",type:"integer",minimum:0,default:0,invalidMessage:"There must be integer"},radical:{title:"Radical",enum:[0,2,1,3],enumNames:["","Monoradical","Diradical (singlet)","Diradical (triplet)"],default:0},ringBondCount:{title:"Ring bond count",enum:[0,-2,-1,2,3,4],enumNames:["","As drawn","0","2","3","4"],default:0},hCount:{title:"H count",enum:[0,1,2,3,4,5],enumNames:["","0","1","2","3","4"],default:0},substitutionCount:{title:"Substitution count",enum:[0,-2,-1,1,2,3,4,5,6],enumNames:["","As drawn","0","1","2","3","4","5","6"],default:0},unsaturatedAtom:{title:"Unsaturated",type:"boolean",default:!1},invRet:{title:"Inversion",enum:[0,1,2],enumNames:["","Inverts","Retains"],default:0},exactChangeFlag:{title:"Exact change",type:"boolean",default:!1}}},Pn={title:"R-group",type:"object",properties:{values:{type:"array",items:{type:"string",enum:Object(M.range)(1,33),enumNames:Object(M.range)(1,33).map((function(t){return"R"+t}))}}}},Tn={title:"Label Edit",type:"object",required:["label"],properties:{label:{title:"Atom",default:"",invalidMessage:"Wrong atom symbol"}}},Cn={title:"Attachment Points",type:"object",properties:{primary:{title:"Primary attachment point",type:"boolean"},secondary:{title:"Secondary attachment point",type:"boolean"}}},Rn={title:"Bond",type:"object",required:["type"],properties:{type:{title:"Type",enum:["single","up","down","updown","double","crossed","triple","aromatic","any","singledouble","singlearomatic","doublearomatic"],enumNames:["Single","Single Up","Single Down","Single Up/Down","Double","Double Cis/Trans","Triple","Aromatic","Any","Single/Double","Single/Aromatic","Double/Aromatic"],default:"single"},topology:{title:"Topology",enum:[0,1,2],enumNames:["Either","Ring","Chain"],default:0},center:{title:"Reacting Center",enum:[0,-1,1,2,4,8,12],enumNames:["Unmarked","Not center","Center","No change","Made/broken","Order changes","Made/broken and changes"],default:0}}},jn=Sn({title:"SGroup",type:"object",required:["type"],oneOf:[{key:"GEN",title:"Generic",properties:{type:{enum:["GEN"]}}},{key:"MUL",title:"Multiple group",type:"object",properties:{type:{enum:["MUL"]},mul:{title:"Repeat count",type:"integer",default:1,minimum:1,maximum:1e3,invalidMessage:"Value out of range: must be between 1 and 1000"}},required:["mul"]},{key:"SRU",title:"SRU polymer",properties:{type:{enum:["SRU"]},subscript:{title:"Polymer label",type:"string",default:"n",pattern:/^[a-zA-Z]$/,invalidMessage:"SRU subscript should consist of a single letter"},connectivity:{title:"Repeat Pattern",enum:["ht","hh","eu"],enumNames:["Head-to-tail","Head-to-head","Either unknown"],default:"ht"}},required:["subscript","connectivity"]},{key:"SUP",title:"Superatom",properties:{type:{enum:["SUP"]},name:{title:"Name",type:"string",default:"",minLength:1,invalidMessage:"Please, provide a name for the superatom"}},required:["name"]}]},"type"),Nn={title:"R-Group",type:"object",properties:{range:{title:"Occurrence",type:"string",maxLength:50,invalidMessage:"Wrong value"},resth:{title:"RestH",type:"boolean"},ifthen:{title:"Condition",type:"integer",minium:0}}},Mn={enum:["Absolute","Relative","Attached"],default:"Absolute"},kn={title:"Context",enum:["Fragment","Multifragment","Bond","Atom","Group"],default:"Fragment"},Bn={Fragment:{title:"Fragment",type:"Object",oneOf:[{key:"FRG_STR",title:"MDLBG_FRAGMENT_STEREO",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_FRAGMENT_STEREO"],default:"MDLBG_FRAGMENT_STEREO"},fieldValue:{title:"Field value",type:"array",items:{enum:["abs","(+)-enantiomer","(-)-enantiomer","racemate","steric","rel","R(a)","S(a)","R(p)","S(p)"]},default:["abs"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_COEFF",title:"MDLBG_FRAGMENT_COEFFICIENT",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_FRAGMENT_COEFFICIENT"],default:"MDLBG_FRAGMENT_COEFFICIENT"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_CHRG",title:"MDLBG_FRAGMENT_CHARGE",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_FRAGMENT_CHARGE"],default:"MDLBG_FRAGMENT_CHARGE"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]},{key:"FRG_RAD",title:"MDLBG_FRAGMENT_RADICALS",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_FRAGMENT_RADICALS"],default:"MDLBG_FRAGMENT_RADICALS"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]}]},Multifragment:{title:"Multifragment",type:"Object",oneOf:[{key:"MLT_FRG",title:"KETCHER_MULTIPLE_FRAGMENT",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["KETCHER_MULTIPLE_FRAGMENT"],default:"KETCHER_MULTIPLE_FRAGMENT"},fieldValue:{title:"Field value",type:"array",items:{enum:["aerosol","alloy","catenane","complex","composite","co-polymer","emulsion","host-guest complex","mixture","rotaxane","suspension"]},default:["aerosol"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]}]},Bond:{title:"Bond",type:"Object",oneOf:[{key:"SB_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_STEREO_KEY"],default:"MDLBG_STEREO_KEY"},fieldValue:{title:"Field value",type:"array",items:{enum:["erythro","threo","alpha","beta","endo","exo","anti","syn","ECL","STG"]},default:["erythro"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]},{key:"SB_BND",title:"MDLBG_BOND_KEY",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_BOND_KEY"],default:"MDLBG_BOND_KEY"},fieldValue:{title:"Field value",type:"array",items:{enum:["Value=4"]},default:["Value=4"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]}]},Atom:{title:"Atom",type:"Object",oneOf:[{key:"AT_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_STEREO_KEY"],default:"MDLBG_STEREO_KEY"},fieldValue:{title:"Field value",type:"array",items:{enum:["RS","SR","P-3","P-3-PI","SP-4","SP-4-PI","T-4","T-4-PI","SP-5","SP-5-PI","TB-5","TB-5-PI","OC-6","TP-6","PB-7","CU-8","SA-8","DD-8","HB-9","TPS-9"]},default:["RS"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]}]},Group:{title:"Group",type:"Object",oneOf:[{key:"GRP_STR",title:"MDLBG_STEREO_KEY",properties:{type:{enum:["DAT"]},fieldName:{title:"Field name",enum:["MDLBG_STEREO_KEY"],default:"MDLBG_STEREO_KEY"},fieldValue:{title:"Field value",type:"array",items:{enum:["cis","trans"]},default:["cis"]},radiobuttons:Mn},required:["fieldName","fieldValue","radiobuttons"]}]}},Ln={key:"Custom",properties:{type:{enum:["DAT"]},context:{title:"Context",enum:["Fragment","Multifragment","Bond","Atom","Group"],default:"Fragment"},fieldName:{title:"Field name",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field name"},fieldValue:{title:"Field value",type:"string",default:"",minLength:1,invalidMessage:"Please, specify field value"},radiobuttons:{enum:["Absolute","Relative","Attached"],default:"Absolute"}},required:["context","fieldName","fieldValue","radiobuttons"]},In=Object.keys(Bn).reduce((function(t,e){return t[e]=Sn(Bn[e],"fieldName"),Object.keys(t[e]).forEach((function(n){t[e][n].properties.context=kn})),t}),{});function Dn(t){return Object.keys(t)[0]}function zn(t,e){return t||e?e?In[t][e]?In[t][e].properties.fieldValue.default:"":Dn(In[t]):Dn(In)}function _n(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Hn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_n(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_n(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Vn(t){return"R#"===t.label?Hn({type:"rlabel",values:Un(t.rglabel)},t):"L#"===t.label?{type:(e=t).atomList.notList?"not-list":"list",values:e.atomList.ids.map((function(t){return ut[t].label}))}:ut.map[t.label]?function(t){var e=t.alias||"",n=t.charge.toString();return{alias:e,label:t.label,charge:n,isotope:t.isotope,explicitValence:t.explicitValence,radical:t.radical,invRet:t.invRet,exactChangeFlag:!!t.exactChangeFlag,ringBondCount:t.ringBondCount,substitutionCount:t.substitutionCount,unsaturatedAtom:!!t.unsaturatedAtom,hCount:t.hCount,stereoParity:t.stereoParity}}(t):!t.label&&"attpnt"in t?{ap:(n=t.attpnt,{primary:(1&(n||0))>0,secondary:(2&(n||0))>0})}:t;var e,n}function Fn(t){return"rlabel"===t.type?{label:t.values.length?"R#":"C",rglabel:0===t.values.length?null:Wn(t.values)}:"list"===t.type||"not-list"===t.type?function(t){return{pseudo:null,label:"L#",atomList:new Et({notList:"not-list"===t.type,ids:t.values.map((function(t){return ut.map[t]}))})}}(t):!t.label&&"ap"in t?{attpnt:(e=t.ap,(e.primary&&1)+(e.secondary&&2))}:ut.map[Object(M.capitalize)(t.label)]?Gn(t):"A"===t.label||"*"===t.label||"Q"===t.label||"X"===t.label||"R"===t.label?(t.pseudo=t.label,Gn(t)):t;var e}function Gn(t){var e=An.properties.charge.pattern.exec(t.charge),n=e?parseInt(e[1]+e[3]+e[2]):t.charge,r=Object.assign({},t,{label:Object(M.capitalize)(t.label),alias:t.alias||null});return void 0!==n&&(r.charge=n),r}function Un(t){var e,n,r=[];for(e=0;e<32;e++)t&1<<e&&(n=e+1,r.push(n));return r}function Wn(t){var e=0;return t.forEach((function(t){e|=1<<t-1})),e}function Yn(t){return Hn({topology:t.topology,reactingCenterStatus:t.center},qn(t.type))}function qn(t){return Object.assign({},Kn[t])}function $n(t,e){for(var n in Kn)if(Kn[n].type===t&&Kn[n].stereo===e)return n;throw Error("No such bond caption")}var Kn={single:{type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.NONE},up:{type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.UP},down:{type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.DOWN},updown:{type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.EITHER},double:{type:At.PATTERN.TYPE.DOUBLE,stereo:At.PATTERN.STEREO.NONE},crossed:{type:At.PATTERN.TYPE.DOUBLE,stereo:At.PATTERN.STEREO.CIS_TRANS},triple:{type:At.PATTERN.TYPE.TRIPLE,stereo:At.PATTERN.STEREO.NONE},aromatic:{type:At.PATTERN.TYPE.AROMATIC,stereo:At.PATTERN.STEREO.NONE},singledouble:{type:At.PATTERN.TYPE.SINGLE_OR_DOUBLE,stereo:At.PATTERN.STEREO.NONE},singlearomatic:{type:At.PATTERN.TYPE.SINGLE_OR_AROMATIC,stereo:At.PATTERN.STEREO.NONE},doublearomatic:{type:At.PATTERN.TYPE.DOUBLE_OR_AROMATIC,stereo:At.PATTERN.STEREO.NONE},any:{type:At.PATTERN.TYPE.ANY,stereo:At.PATTERN.STEREO.NONE}};function Xn(t){var e=t.type||"GEN",n=t.attrs,r=n.context,a=n.fieldName,o=n.fieldValue,i=n.absolute,s=n.attached;return t.attrs.radiobuttons=!1===i&&!1===s?"Relative":s?"Attached":"Absolute",In[r][a]&&In[r][a].properties.fieldValue.items&&(t.attrs.fieldValue=o.split("\n")),Object.assign({type:e},t.attrs)}function Zn(t){var e=t.type,n=t.radiobuttons,r=Hn({},D()(t,["type","radiobuttons"]));switch(n){case"Absolute":r.absolute=!0,r.attached=!1;break;case"Attached":r.absolute=!1,r.attached=!0;break;case"Relative":r.absolute=!1,r.attached=!1}return r.fieldName&&(r.fieldName=r.fieldName.trim()),r.fieldValue&&(r.fieldValue="string"===typeof r.fieldValue?r.fieldValue.trim():r.fieldValue),{type:e,attrs:r}}var Qn={single:"1",double:"2",triple:"3",up:"1",down:"1",updown:"1",crossed:"2",any:"0",aromatic:"4"},Jn=Rn.properties.type,tr=Jn.enum.reduce((function(t,e,n){return t["bond-".concat(e)]={title:"".concat(Jn.enumNames[n]," Bond"),shortcut:Qn[e],action:{tool:"bond",opts:qn(e)}},t}),{"select-lasso":{title:"Lasso Selection",shortcut:"Escape",action:{tool:"select",opts:"lasso"}},"select-rectangle":{title:"Rectangle Selection",shortcut:"Escape",action:{tool:"select",opts:"rectangle"}},"select-fragment":{title:"Fragment Selection",shortcut:"Escape",action:{tool:"select",opts:"fragment"}},erase:{title:"Erase",shortcut:["Delete","Backspace"],action:{tool:"eraser",opts:1}},chain:{title:"Chain",action:{tool:"chain"}},"enhanced-stereo":{shortcut:"Alt+e",title:"Enhanced Stereo",action:{tool:"enhancedStereo"}},"charge-plus":{shortcut:"5",title:"Charge Plus",action:{tool:"charge",opts:1}},"charge-minus":{shortcut:"5",title:"Charge Minus",action:{tool:"charge",opts:-1}},"transform-rotate":{shortcut:"Alt+r",title:"Rotate Tool",action:{tool:"rotate"}},"transform-flip-h":{shortcut:"Alt+h",title:"Horizontal Flip",action:{tool:"rotate",opts:"horizontal"}},"transform-flip-v":{shortcut:"Alt+v",title:"Vertical Flip",action:{tool:"rotate",opts:"vertical"}},sgroup:{shortcut:"Mod+g",title:"S-Group",action:{tool:"sgroup"}},"sgroup-data":{shortcut:"Mod+g",title:"Data S-Group",action:{tool:"sgroup",opts:"DAT"}},"reaction-arrow":{title:"Reaction Arrow Tool",action:{tool:"reactionarrow"}},"reaction-plus":{title:"Reaction Plus Tool",action:{tool:"reactionplus"}},"reaction-map":{title:"Reaction Mapping Tool",action:{tool:"reactionmap"}},"reaction-unmap":{title:"Reaction Unmapping Tool",action:{tool:"reactionunmap"}},"rgroup-label":{shortcut:"Mod+r",title:"R-Group Label Tool",action:{tool:"rgroupatom"}},"rgroup-fragment":{shortcut:["Mod+Shift+r","Mod+r"],title:"R-Group Fragment Tool",action:{tool:"rgroupfragment"}},"rgroup-attpoints":{shortcut:"Mod+r",title:"Attachment Point Tool",action:{tool:"apoint"}},"shape-circle":{title:"Shape Circle",action:{tool:"simpleobject",opts:"circle"}},"shape-rectangle":{title:"Shape Rectangle",action:{tool:"simpleobject",opts:"rectangle"}},"shape-line":{title:"Shape Line",action:{tool:"simpleobject",opts:"line"}}}),er=["H","C","N","O","S","P","F","Cl","Br","I"],nr={H:"h",C:"c",N:"n",O:"o",S:"s",P:"p",F:"f",Cl:"Shift+c",Br:"Shift+b",I:"i",A:"a"},rr=Object.keys(nr).reduce((function(t,e){return t["atom-".concat(e.toLowerCase())]={title:"Atom ".concat(e),shortcut:nr[e],action:{tool:"atom",opts:{label:e}}},t}),{}),ar=[.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2,1.3,1.4,1.5,1.7,2,2.5,3,3.5,4],or={zoom:{selected:function(t){return t.zoom()}},"zoom-out":{shortcut:["-","_","Shift+-"],title:"Zoom Out",disabled:function(t){return t.zoom()<=ar[0]},action:function(t){var e=t.zoom(),n=Object(M.findIndex)((function(t){return t>=e}),ar);t.zoom(ar[ar[n]===e&&n>0?n-1:n])}},"zoom-in":{shortcut:["+","=","Shift+="],title:"Zoom In",disabled:function(t){return ar[ar.length-1]<=t.zoom()},action:function(t){var e=t.zoom(),n=Object(M.findLastIndex)((function(t){return t<=e}),ar);t.zoom(ar[ar[n]===e&&n<ar.length-1?n+1:n])}}};function ir(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function sr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ir(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var cr={"smart-layout":{title:"Smart-layout",type:"boolean",default:!0},"ignore-stereochemistry-errors":{title:"Ignore stereochemistry errors",type:"boolean",default:!0},"mass-skip-error-on-pseudoatoms":{title:"Ignore pseudoatoms at mass",type:"boolean",default:!1},"gross-formula-add-rsites":{title:"Add Rsites at mass calculation",type:"boolean",default:!0},"gross-formula-add-isotopes":{title:"Add Isotopes at mass calculation",type:"boolean",default:!0}},lr=Object.keys(cr),ur={miewMode:{title:"Display mode",enum:["LN","BS","LC"],enumNames:["Lines","Balls and Sticks","Licorice"],default:"LN"},miewTheme:{title:"Background color",enum:["light","dark"],enumNames:["Light","Dark"],default:"light"},miewAtomLabel:{title:"Label coloring",enum:["no","bright","blackAndWhite","black"],enumNames:["No","Bright","Black and White","Black"],default:"bright"}},pr=Object.keys(ur),dr={title:"Settings",type:"object",required:[],properties:sr(sr(sr(sr(sr({},{resetToSelect:{title:"Reset to Select Tool",enum:[!0,"paste",!1],enumNames:["on","After Paste","off"],default:"paste"},rotationStep:{title:"Rotation Step, \xba",type:"integer",minimum:1,maximum:90,default:15}}),{showValenceWarnings:{title:"Show valence warnings",type:"boolean",default:!0},atomColoring:{title:"Atom coloring",type:"boolean",default:!0},hideStereoFlags:{title:"Do not show the Stereo flags",type:"boolean",default:!1},font:{title:"Font",type:"string",default:"30px Arial"},fontsz:{title:"Font size",type:"integer",default:13,minimum:1,maximum:96},fontszsub:{title:"Sub font size",type:"integer",default:13,minimum:1,maximum:96},carbonExplicitly:{title:"Display carbon explicitly",type:"boolean",default:!1},showCharge:{title:"Display charge",type:"boolean",default:!0},showValence:{title:"Display valence",type:"boolean",default:!0},showHydrogenLabels:{title:"Show hydrogen labels",enum:["off","Hetero","Terminal","Terminal and Hetero","on"],default:"on"},aromaticCircle:{title:"Aromatic Bonds as circle",type:"boolean",default:!0},doubleBondWidth:{title:"Double bond width",type:"integer",default:6,minimum:1,maximum:96},bondThickness:{title:"Bond thickness",type:"integer",default:2,minimum:1,maximum:96},stereoBondWidth:{title:"Stereo (Wedge) bond width",type:"integer",default:6,minimum:1,maximum:96}}),cr),{showAtomIds:{title:"Show atom Ids",type:"boolean",default:!1},showBondIds:{title:"Show bonds Ids",type:"boolean",default:!1},showHalfBondIds:{title:"Show half bonds Ids",type:"boolean",default:!1},showLoopIds:{title:"Show loop Ids",type:"boolean",default:!1}}),ur)};function hr(){return Object.keys(dr.properties).reduce((function(t,e){return t[e]=dr.properties[e].default,t}),{})}var fr="Your changes will be lost after the tab closing. See Help (Note 2).",mr=function(){try{return localStorage}catch(t){return!1}},gr=function(t){var e=null;try{e=JSON.parse(localStorage.getItem(t))}catch(n){}return e},br=function(t,e){var n=null;try{localStorage.setItem(t,JSON.stringify(e)),n=!0}catch(r){n=!1}return n};function vr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function yr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vr(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var wr={app:{server:!1,templates:!1},analyse:{values:null,roundWeight:3,roundMass:3},check:{checkOptions:["valence","radicals","pseudoatoms","stereo","query","overlapping_atoms","overlapping_bonds","rgroups","chiral","3d","chiral_flag"]},recognize:{file:null,structStr:null,fragment:!1,version:null},settings:Object.assign(hr(),function(t){if("object"!==B()(t)||null===t)return null;var e=(new _.a.Validator).validate(t,dr).errors.map((function(t){return t.property.split(".")[1]}));return Object.keys(t).reduce((function(n,r){return dr.properties[r]&&-1===e.indexOf(r)&&(n[r]=t[r]),n}),{})}(gr("ketcher-opts"))),getServerSettings:function(){return Object(M.pick)(lr,this.settings)}};function Er(t){return function(e){e({type:"APP_OPTIONS",data:t}),e({type:"UPDATE"})}}var Or=["SET_RECOGNIZE_STRUCT","CHANGE_RECOGNIZE_FILE","CHANGE_IMAGO_VERSION","IS_FRAGMENT_RECOGNIZE"];function xr(t){return{type:"SET_RECOGNIZE_STRUCT",data:{structStr:t}}}function Sr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ar(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Sr(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Pr=function(t,e){var n=e.valid,r=e.errors,a=t.result,o=a.fieldName,i=a.fieldValue;return{result:t.result,valid:n&&!!o&&!!i,errors:r}},Tr=function(t,e){var n=e.context,r=e.fieldValue,a=zn(n),o=r;return o===t.result.fieldValue&&(o=zn(n,a)),{result:Ar(Ar({},e),{},{context:n,fieldName:a,fieldValue:o})}},Cr=function(t,e){var n=e.fieldName,r=t.result.context,a=e.fieldValue;return In[r][n]&&(a=zn(r,n)),a===t.result.fieldValue&&In[r][t.result.fieldName]&&(a=""),{result:Ar(Ar({},e),{},{fieldName:n,fieldValue:a})}},Rr={atomProps:{errors:{},valid:!0,result:{label:"",charge:0,explicitValence:-1,hCount:0,invRet:0,isotope:0,radical:0,ringBondCount:0,substitutionCount:0}},attachmentPoints:{errors:{},valid:!0,result:{primary:!1,secondary:!1}},automap:{errors:{},valid:!0,result:{mode:"discard"}},bondProps:{errors:{},valid:!0,result:{type:"single",topology:0,center:0}},check:{errors:{},moleculeErrors:{}},labelEdit:{errors:{},valid:!0,result:{label:""}},rgroup:{errors:{},valid:!0,result:{values:[]}},rgroupLogic:{errors:{},valid:!0,result:{ifthen:0,range:">0",resth:!1}},save:{errors:{},valid:!0,result:{filename:"ketcher",format:"mol"}},settings:{errors:{},valid:!0,result:hr()},sgroup:{errors:{},valid:!0,result:{type:"GEN"}},sdata:function(){var t=zn(),e=zn(t);return{errors:{},valid:!0,result:{context:t,fieldName:e,fieldValue:zn(t,e),radiobuttons:"Absolute",type:"DAT"}}}()};function jr(t){return{type:"UPDATE_FORM",data:t}}function Nr(t,e,n){return"sdata"===n?function(t,e){if(e.data.result.init)return Pr(Ar(Ar({},t),{},{result:Object.assign({},t.result,e.data.result)}),e.data);var n=e.data.result.context,r=e.data.result.fieldName,a=null;return n!==t.result.context?a=Tr(t,e.data.result):r!==t.result.fieldName&&(a=Cr(t,e.data.result)),a=a||Ar(Ar({},t),{},{result:Object.assign({},t.result,e.data.result)}),Pr(a,e.data)}(t,e):Object.assign({},t,e.data)}function Mr(t){return t&&t.dialog?{type:"MODAL_OPEN",data:{name:t.dialog}}:t&&t.thunk?t.thunk:{type:"ACTION",action:t}}function kr(t){return function(e,n){n().editor.struct(t)}}function Br(t,e){return function(n,r){var a=r(),o=a.editor,i=a.server;return sn(t,e=e||{},i).then((function(t){e.rescale&&t.rescale(),t.isBlank()||(e.fragment?n(Mr({tool:"paste",opts:t})):o.struct(t))}),(function(t){}))}}function Lr(t){return function(e,n){var r=n(),a=r.editor,o=r.server,i=function(t,e){var n={};if(e.includes("chiral_flag")&&Array.from(t.frags.values()).some((function(t){return!!t&&"abs"===t.enhancedStereoFlag}))&&(n.chiral_flag="Chiral flag is present on the canvas"),e.includes("valence")){var r=0;t.atoms.forEach((function(t){return t.badConn&&r++})),r>0&&(n.valence="Structure contains ".concat(r," atom").concat(1!==r?"s":""," with bad valence"))}return n}(a.struct(),t),s=n().options.getServerSettings();return s.data={types:Object(M.without)(["valence","chiral_flag"],t)},Dr(a,o,"check",s).then((function(t){t=Object.assign(t,i),e({type:"UPDATE_FORM",data:{moleculeErrors:t}})})).catch((function(t){}))}}function Ir(t,e,n){return function(r,a){var o=a(),i=o.options.getServerSettings();i.data=e,Dr(o.editor,o.server,t,i,n).then((function(e){return r(Br(e.struct,{rescale:"layout"===t,reactionRelayout:"clean"===t}))})).catch((function(t){}))}}function Dr(t,e,n,r,a){var o,i=t.selection(),s=[];if(i&&(s=i.atoms?i.atoms:t.explicitSelected().atoms),!a){var c=new Map;a=t.struct().clone(null,null,!1,c);var l=(o=a.getComponents()).reactants.concat(o.products).reduce((function(t,e){return Array.from(e).forEach((function(e){t.add(e)})),t}),new mt);s=s.map((function(t){return l.get(c.get(t))}))}return e.then((function(){return e[n](Object.assign({struct:Re(a,{ignoreErrors:!0})},s&&s.length>0?{selected:s}:null,r.data),Object(M.omit)("data",r))}))}var zr={layout:{shortcut:"Mod+l",title:"Layout",action:{thunk:Ir("layout")},disabled:function(t,e,n){return!n.app.server}},clean:{shortcut:"Mod+Shift+l",title:"Clean Up",action:{thunk:Ir("clean")},disabled:function(t,e,n){return!n.app.server}},arom:{title:"Aromatize",action:{thunk:Ir("aromatize")},disabled:function(t,e,n){return!n.app.server}},dearom:{title:"Dearomatize",action:{thunk:Ir("dearomatize")},disabled:function(t,e,n){return!n.app.server}},cip:{shortcut:"Mod+p",title:"Calculate CIP",action:{thunk:Ir("calculateCip")},disabled:function(t,e,n){return!n.app.server}},check:{title:"Check Structure",action:{dialog:"check"},disabled:function(t,e,n){return!n.app.server}},analyse:{title:"Calculated Values",action:{dialog:"analyse"},disabled:function(t,e,n){return!n.app.server}},recognize:{title:"Recognize Molecule",action:{dialog:"recognize"},disabled:function(t,e,n){return!n.app.server}},miew:{title:"3D Viewer",action:{dialog:"miew"},disabled:function(){return!window.Miew}}},_r={"force-update":{shortcut:"Ctrl+Shift+r",action:function(t){t.update(!0)}},"qs-serialize":{shortcut:"Alt+Shift+r",action:function(t){var e=Re(t.struct()),n="mol="+encodeURIComponent(e).replace(/%20/g,"+"),r=document.location.search;document.location.search=r?-1===r.search("mol=")?r+"&"+n:r.replace(/mol=[^&$]*/,n):"?"+n}}},Hr=["Benzene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  6  1  0     0  0\n  6  1  2  0     0  0\nM  END\n","Cyclopentadiene\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.0000    1.4257    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.5000   -0.1132    0.0000 C   0  0  0  0  0  0        0  0  0\n   -0.8090    0.8379    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  2  0     0  0\n  3  4  1  0     0  0\n  4  5  2  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclohexane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  6  6  0     0  0            999 V2000\n    0.8660    2.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7320    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.8660    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.5000    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  6  1  0     0  0\n  6  1  1  0     0  0\nM  END\n","Cyclopentane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  5  5  0     0  0            999 V2000\n    0.8090    1.5389    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.6180    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.3090    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.9511    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  3  4  1  0     0  0\n  4  5  1  0     0  0\n  5  1  1  0     0  0\nM  END\n","Cyclopropane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  3  3  0     0  0            999 V2000\n   -3.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.2250   -0.2750    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.7250    0.5910    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  2  3  1  0     0  0\n  1  3  1  0     0  0\nM  END\n","Cyclobutane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  4  4  0     0  0            999 V2000\n   -3.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -3.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    1.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n   -2.8250    0.5500    0.0000 C   0  0  0  0  0  0        0  0  0\n  1  2  1  0     0  0\n  1  3  1  0     0  0\n  3  4  1  0     0  0\n  4  2  1  0     0  0\nM  END\n","Cycloheptane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  7  7  0     0  0            999 V2000\n    0.0000    1.6293    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    2.2465    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7559    2.0242    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.1897    1.1289    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    0.6228    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7566    0.2224    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7835    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n  6  7  1  0     0  0\n  5  7  1  0     0  0\n  1  5  1  0     0  0\n  4  6  1  0     0  0\n  3  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n","Cyclooctane\n  Ketcher 11161218352D 1   1.00000     0.00000     0\n\n  8  8  0     0  0            999 V2000\n    0.0000    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.0000    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7053    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n    0.7056    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    0.0000    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    0.7053    0.0000 C   0  0  0  0  0  0        0  0  0\n    2.4133    1.7078    0.0000 C   0  0  0  0  0  0        0  0  0\n    1.7079    2.4131    0.0000 C   0  0  0  0  0  0        0  0  0\n  8  3  1  0     0  0\n  7  8  1  0     0  0\n  6  7  1  0     0  0\n  5  6  1  0     0  0\n  4  5  1  0     0  0\n  1  4  1  0     0  0\n  2  3  1  0     0  0\n  1  2  1  0     0  0\nM  END\n"].map((function(t){return je(t)})),Vr=Hr.reduce((function(t,e,n){return t["template-".concat(n)]={title:"".concat(e.name),shortcut:"t",action:{tool:"template",opts:{struct:e}}},t}),{"template-lib":{shortcut:"Shift+t",title:"Custom Templates",action:{dialog:"templates"},disabled:function(t,e,n){return!n.app.templates}}});function Fr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Gr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fr(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ur=Gr(Gr(Gr(Gr(Gr(Gr({new:{shortcut:"Mod+Delete",title:"Clear Canvas",action:{thunk:function(t,e){var n=e().editor;n.struct().isBlank()||n.struct(null),t({type:"ACTION",action:tr["select-lasso"].action})}}},open:{shortcut:"Mod+o",title:"Open\u2026",action:{dialog:"open"}},save:{shortcut:"Mod+s",title:"Save As\u2026",action:{dialog:"save"}},undo:{shortcut:"Mod+z",title:"Undo",action:function(t){t.undo()},disabled:function(t){return 0===t.historySize().undo}},redo:{shortcut:["Mod+Shift+z","Mod+y"],title:"Redo",action:function(t){t.redo()},disabled:function(t){return 0===t.historySize().redo}},cut:{shortcut:"Mod+x",title:"Cut",action:function(){gn("cut")||Yr("Cut")},disabled:function(t){return!Wr(t)}},copy:{shortcut:"Mod+c",title:"Copy",action:function(){gn("copy")||Yr("Copy")},disabled:function(t){return!Wr(t)}},paste:{shortcut:"Mod+v",title:"Paste",action:function(){gn("paste")||Yr("Paste")},selected:function(t){var e=t.actions;return e&&e.active&&"paste"===e.active.tool}},settings:{title:"Settings",action:{dialog:"settings"}},help:{shortcut:["?","&","Shift+/"],title:"Help",action:{dialog:"help"}},about:{title:"About",action:{dialog:"about"}},"reaction-automap":{title:"Reaction Auto-Mapping Tool",action:{dialog:"automap"},disabled:function(t,e,n){return!n.app.server||!t.struct().hasRxnArrow()}},"period-table":{title:"Periodic Table",action:{dialog:"period-table"}},"select-all":{title:"Select All",shortcut:"Mod+a",action:{thunk:function(t,e){e().editor.selection("all");var n=e().toolbar.visibleTools.select;t({type:"ACTION",action:tr[n].action})}}},"deselect-all":{title:"Deselect All",shortcut:"Mod+Shift+a",action:function(t){t.selection(null)}},"select-descriptors":{title:"Select descriptors",shortcut:"Mod+d",action:{thunk:function(t,e){var n=e().toolbar.visibleTools.select,r=e().editor;r.alignDescriptors(),r.selection("descriptors"),t({type:"ACTION",action:tr[n].action})}}}},zr),_r),tr),rr),or),Vr);function Wr(t){var e=t.selection();return e&&(Object.keys(e).length>1||!e.sgroupData)}function Yr(t){alert("This action is unavailable via menu.\nInstead, use shortcut to "+t+".")}function qr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function $r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qr(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Kr(t,e,n){return new Promise((function(r,a){t({type:"MODAL_OPEN",data:{name:e,prop:$r($r({},n),{},{onResult:r,onCancel:a})}})}))}function Xr(t){return function(e,n){var r=function(){var t,e={};return Object.keys(Ur).forEach((function(n){(t=Ur[n]).shortcut&&(Array.isArray(t.shortcut)?t.shortcut.forEach((function(t){Zr(t,n,e)})):Zr(t.shortcut,n,e))})),xn(e)}();t.addEventListener("keydown",(function(t){return function(t,e,n,r){if(e.modal)return;var a=e.editor,o=e.actionState,i=o.activeTool,s=xn(r),c=a.selection()&&a.selection().atoms,l=null;if(s&&1===s.length&&c&&s.match(/\w/))Kr(t,"labelEdit",{letter:s}).then((function(e){t(Mr({tool:"atom",opts:e}))})).catch((function(){return null})),r.preventDefault();else if(void 0!==(l=xn.lookup(n,r))){var u=function(t,e){var n=t.indexOf(e.tool);return t.forEach((function(t,r){Object(M.isEqual)(Ur[t].action,e)&&(n=r)})),n}(l,i);u=(u+1)%l.length;var p=l[u];if(o[p]&&!0===o[p].disabled)return void r.preventDefault();if(-1===mn.indexOf(p)){var d=Ur[p].action;t(Mr(d)),r.preventDefault()}else window.clipboardData&&gn(r)}}(e,n(),r,t)}))}}function Zr(t,e,n){Array.isArray(n[t])?n[t].push(e):n[t]=[e]}var Qr=/\$RXN\n+\s+0\s+0\s+0\n*/;function Jr(e,n){var r=Object.keys(an).map((function(t){return an[t].mime})),a=Object(M.debounce)(0,(function(t){return e(Mr(t))})),o=Object(M.debounce)(0,(function(t,n){return e(Br(t,n))}));return{formats:r,focused:function(){return!t.currentState.modal},onCut:function(){var e=t.currentState.editor,n=ta(e);return n?a({tool:"eraser",opts:1}):e.selection(null),n},onCopy:function(){var e=t.currentState.editor,n=ta(e);return e.selection(null),n},onPaste:function(t){var e=t["application/json"]||t["chemical/x-mdl-molfile"]||t["chemical/x-mdl-rxnfile"]||t["text/plain"],r=n().editor.render.ctab.molecule;!e||r.hasRxnArrow()&&Qr.test(t["text/plain"])||o(e,{fragment:!0})}}}function ta(t){var e={},n=t.structSelected();if(n.isBlank())return null;try{var r=rn.toGraph(n);e["application/json"]=JSON.stringify(r);var a=n.isReaction?"chemical/x-mdl-molfile":"chemical/x-mdl-rxnfile",o=Re(n);return e["text/plain"]=o,e[a]=o,e}catch(i){}return null}var ea={stringify:function(t,e){return t.reduce((function(t,n){return t+=Re(n.struct,e),Object.keys(n.props).forEach((function(e){t+="> <"+e+">\n",t+=n.props[e]+"\n\n"})),t+"$$$$"}),"")},parse:function(t,e){for(var n,r,a=/^[^]+?\$\$\$\$$/gm,o=[];null!==(n=a.exec(t));){var i=(r=(r=n[0].replace(/\r/g,"")).trim()).indexOf("M  END");if(-1!==i){var s={},c=r.substr(i+7).trim().split(/^$\n?/m);s.struct=je(r.substring(0,i+6),e),s.props=c.reduce((function(t,e){var n=e.match(/^> [ \d]*<(\S+)>/);if(n){var r=n[1],a=e.split("\n")[1].trim();t[r]=isFinite(a)?+a:a}return t}),{}),o.push(s)}}return o}};function na(t){return{type:"TMPL_INIT",data:{lib:t}}}function ra(t,e,n){aa("".concat(e,"/templates/library.sdf")).then((function(t){var r=ea.parse(t);return function(t,e,n){var r=t.reduce((function(t,e){var n=oa(e).file;return n&&-1===t.indexOf(n)&&t.push(n),t}),[]);return Promise.all(r.map((function(t){return aa(e+t).catch((function(){return null}))}))).then((function(t){return t.forEach((function(t){t&&(n.innerHTML+=t)})),r.filter((function(e,n){return!!t[n]}))}))}(r,e+"/templates/",n).then((function(t){return r.map((function(e){var n=oa(e);return n.file&&(e.props.prerender=-1!==t.indexOf(n.file)?"#".concat(n.id):""),e}))}))})).then((function(e){var n=e.concat(function(){var t=gr("ketcher-tmpls");return Array.isArray(t)&&0!==t.length?t.map((function(t){try{return""===t.props&&(t.props={}),t.props.group="User Templates",{struct:je(t.struct),props:t.props}}catch(e){return null}})).filter((function(t){return null!==t})):[]}());t(na(n)),t(Er({templates:!0}))}))}function aa(t){return fetch(t,{credentials:"same-origin"}).then((function(e){if(e.ok)return e.text();throw Error("Could not fetch "+t)}))}function oa(t){var e=t.props.prerender,n=e&&e.split("#",2);return{file:e&&n[0],id:e&&n[1]}}function ia(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function sa(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ia(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ca(t){var e=t.filter((function(t){return"User Templates"===t.props.group})).map((function(t){return{struct:Re(t.struct),props:Object.assign({},Object(M.omit)(["group"],t.props))}}));br("ketcher-tmpls",e)}var la={lib:[],selected:null,filter:"",group:null,attach:{}},ua=["TMPL_INIT","TMPL_SELECT","TMPL_CHANGE_GROUP","TMPL_CHANGE_FILTER"],pa=["INIT_ATTACH","SET_ATTACH_POINTS","SET_TMPL_NAME"];function da(){return a.a.useContext(cn)}function ha(){return a.a.useContext(ln)}var fa=Object(N.b)(null,(function(t){return{onInitTmpls:function(e){return ra(t,".",e)}}}))((function(t){var e=t.onInitTmpls,n=Object(r.useRef)(null),o=da().staticResourcesUrl;return Object(r.useEffect)((function(){e(n.current,o)}),[]),a.a.createElement("div",{className:"cellar",ref:n})})),ma=Object(N.b)(null,(function(t){return t(Jr)}))(dn);function ga(e,n){var r=Object(M.debounce)(100,(function(){return e({type:"UPDATE"})})),a=function(t){return new Promise((function(e){return setTimeout(e,t)}))};function o(e){var n=t.currentState,a=n.actionState.activeTool.tool;if("select"!==a){var o=n.toolbar.visibleTools.select,i=n.options.settings.resetToSelect;!0===i||i===a?e({type:"ACTION",action:Ur[o].action}):r()}}return{onInit:function(t){e({type:"INIT",editor:t})},onChange:function(t){void 0===t?a(0).then((function(){return e(o)})):e(o)},onSelectionChange:function(){r()},onElementEdit:function(t){var r=Vn(t),a=null;if(ut.map[r.label])a=Kr(e,"atomProps",r);else if(1===Object.keys(r).length&&"ap"in r)a=Kr(e,"attachmentPoints",r.ap).then((function(t){return{ap:t}}));else if("list"===r.type||"not-list"===r.type)a=Kr(e,"period-table",r);else if("rlabel"===r.type){var o=n().editor.struct().rgroups,i={type:"atom",values:r.values,disabledIds:Array.from(o.entries()).reduce((function(t,e){var n=u()(e,2),a=n[0];return n[1].frags.has(r.fragId)&&t.push(a),t}),[])};a=Kr(e,"rgroup",i).then((function(t){return{values:t.values,type:"rlabel"}}))}else a=Kr(e,"period-table",r);return a.then(Fn)},onEnhancedStereoEdit:function(t){var n=t.type,r=D()(t,["type"]);return a(0).then((function(){return"atoms"===n&&(r=function(t){if(null===t)return{type:null};var e=t.split("-");return{type:e[0],number:+e[1]||0}}(r.stereoLabel)),Kr(e,"enhancedStereo",{type:n,init:r}).then((function(t){return"atoms"===n?null===(e=t).type?null:"abs"===e.type?"abs":"".concat(e.type,"-").concat(e.number):t;var e}))}))},onQuickEdit:function(t){return Kr(e,"labelEdit",t)},onBondEdit:function(t){return Kr(e,"bondProps",(n=t,{type:$n(n.type,n.stereo),topology:n.topology||0,center:n.reactingCenterStatus||0})).then(Yn);var n},onRgroupEdit:function(t){var r=n().editor.struct();if(Object.keys(t).length>2){var a=Array.from(r.rgroups.keys());return t.range||(t.range=">0"),Kr(e,"rgroupLogic",Object.assign({rgroupLabels:a},t))}var o=Array.from(r.atoms.values()).reduce((function(e,n){return n.fragment===t.fragId&&null!==n.rglabel?e.concat(Vn(n).values):e}),[]),i={type:"fragment",values:[t.label],disabledIds:o};return Kr(e,"rgroup",i).then((function(t){return{label:t.values[0]}}))},onSgroupEdit:function(t){return a(0).then((function(){return Kr(e,"sgroup",Xn(t))})).then(Zn)},onSdataEdit:function(t){return a(0).then((function(){return Kr(e,"DAT"===t.type?"sdata":"sgroup",Xn(t))})).then(Zn)},onMessage:function(t){t.error},onAromatizeStruct:function(t){var e=n(),r=e.options.getServerSettings();return Dr(e.editor,e.server,"aromatize",r,t)},onDearomatizeStruct:function(t){var e=n(),r=e.options.getServerSettings();return Dr(e.editor,e.server,"dearomatize",r,t)},onMouseDown:function(){r()}}}W.a.el.translateAbs=function(t,e){this.delta=this.delta||new pt,this.delta.x+=t-0,this.delta.y+=e-0,this.transform("t"+this.delta.x.toString()+","+this.delta.y.toString())},W.a.st.translateAbs=function(t,e){this.forEach((function(n){n.translateAbs(t,e)}))};var ba={scaled2obj:function(t,e){return t.scaled(1/e.scale)},obj2scaled:function(t,e){return t.scaled(e.scale)}};var va={tfx:function(t){return parseFloat(t).toFixed(8)},relBox:function(t){return{x:t.x,y:t.y,width:t.width,height:t.height}},shiftRayBox:function(t,e,n){var r=[n.p0,new pt(n.p1.x,n.p0.y),n.p1,new pt(n.p0.x,n.p1.y)].map((function(e){return e.sub(t)}));e=e.normalized();for(var a=r.map((function(t){return pt.cross(t,e)})),o=r.map((function(t){return pt.dot(t,e)})),i=-1,s=-1,c=0;c<4;++c)a[c]>0?(i<0||o[i]<o[c])&&(i=c):(s<0||o[s]<o[c])&&(s=c);if(s<0||i<0)return 0;var l=o[i]>o[s]?s:i,u=o[i]>o[s]?i:s;return o[l]+Math.abs(a[l])*(o[u]-o[l])/(Math.abs(a[l])+Math.abs(a[u]))}};function ya(t){this.type=t,this.paths=[],this.boxes=[],this.boundingBox=null}function wa(){}ya.prototype.add=function(t,e,n){this.paths.push(t),e&&(this.boxes.push(e),this.boundingBox=null==this.boundingBox?e:wt.union(this.boundingBox,e)),n&&this.exts.push(n)},ya.prototype.clear=function(){this.paths=[],this.boxes=[],this.exts=[],this.boundingBox=null},ya.prototype.translate=function(t,e){if(arguments.length>2)throw new Error("One vector or two scalar arguments expected");if(void 0===e)this.translate(t.x,t.y);else{for(var n=new pt(t,e),r=0;r<this.paths.length;++r)this.paths[r].translateAbs(t,e);for(var a=0;a<this.boxes.length;++a)this.boxes[a]=this.boxes[a].translate(n);null!==this.boundingBox&&(this.boundingBox=this.boundingBox.translate(n))}},wa.prototype.init=function(t){this.visel=new ya(t),this.highlight=!1,this.highlighting=null,this.selected=!1,this.selectionPlate=null},wa.prototype.getVBoxObj=function(t){var e=this.visel.boundingBox;return null===e?null:(t.options.offset&&(e=e.translate(t.options.offset.negated())),e.transform(ba.scaled2obj,t.options))},wa.prototype.setHighlight=function(t,e){if(t){var n="highlighting"in this&&null!==this.highlighting;if(n)if("set"===this.highlighting.type){if(!this.highlighting[0])return;n=!this.highlighting[0].removed}else n=!this.highlighting.removed;n?this.highlighting.show():(e.paper.setStart(),this.drawHighlight(e),this.highlighting=e.paper.setFinish())}else this.highlighting&&this.highlighting.hide();this.highlight=t},wa.prototype.drawHighlight=function(){},wa.prototype.makeSelectionPlate=function(){};var Ea={H:["#000000","#000000"],He:["#89a1a1","#d9ffff"],Li:["#bd77ed","#cc80ff"],Be:["#8fbc00","#c2ff00"],B:["#c18989","#ffb5b5"],C:["#000000","#000000"],N:["#304ff7","#304ff7"],O:["#ff0d0d","#ff0d0d"],F:["#78bc42","#8fe04f"],Ne:["#80a2af","#b3e3f5"],Na:["#ab5cf2","#ab5cf2"],Mg:["#6fcd00","#8aff00"],Al:["#a99393","#bfa6a6"],Si:["#b29478","#f0c7a1"],P:["#ff8000","#ff8000"],S:["#c99a19","#d9a61a"],Cl:["#1fd01f","#1fd01f"],Ar:["#69acba","#80d1e3"],K:["#8f40d4","#8f40d4"],Ca:["#38e900","#3dff00"],Sc:["#999999","#e6e6e6"],Ti:["#979a9e","#bfc2c7"],V:["#99999e","#a6a6ab"],Cr:["#8a99c7","#8a99c7"],Mn:["#9c7ac7","#9c7ac7"],Fe:["#e06633","#e06633"],Co:["#d37e8e","#f08fa1"],Ni:["#4ece4e","#4fd14f"],Cu:["#c78033","#c78033"],Zn:["#7d80b0","#7d80b0"],Ga:["#bc8b8b","#c28f8f"],Ge:["#668f8f","#668f8f"],As:["#b87ddd","#bd80e3"],Se:["#e59100","#ffa100"],Br:["#a62929","#a62929"],Kr:["#59b1c9","#5cb8d1"],Rb:["#702eb0","#702eb0"],Sr:["#00ff00","#00ff00"],Y:["#66afaf","#94ffff"],Zr:["#71abab","#94e0e0"],Nb:["#67aeb4","#73c2c9"],Mo:["#54b5b5","#54b5b5"],Tc:["#3b9e9e","#3b9e9e"],Ru:["#248f8f","#248f8f"],Rh:["#0a7d8c","#0a7d8c"],Pd:["#006985","#006985"],Ag:["#9a9a9a","#bfbfbf"],Cd:["#b29764","#ffd98f"],In:["#a67573","#a67573"],Sn:["#668080","#668080"],Sb:["#9e63b5","#9e63b5"],Te:["#d47a00","#d47a00"],I:["#940094","#940094"],Xe:["#429eb0","#429eb0"],Cs:["#57178f","#57178f"],Ba:["#00c900","#00c900"],La:["#5caed1","#70d4ff"],Ce:["#9d9d7b","#ffffc7"],Pr:["#8ca581","#d9ffc7"],Nd:["#84a984","#c7ffc7"],Pm:["#71b18a","#a3ffc7"],Sm:["#66b68e","#8fffc7"],Eu:["#4ac298","#61ffc7"],Gd:["#37cb9e","#45ffc7"],Tb:["#28d1a4","#30ffc7"],Dy:["#1bd7a8","#1fffc7"],Ho:["#00e98f","#00ff9c"],Er:["#00e675","#00e675"],Tm:["#00d452","#00d452"],Yb:["#00bf38","#00bf38"],Lu:["#00ab24","#00ab24"],Hf:["#47b3ec","#4dc2ff"],Ta:["#4da6ff","#4da6ff"],W:["#2194d6","#2194d6"],Re:["#267dab","#267dab"],Os:["#266696","#266696"],Ir:["#175487","#175487"],Pt:["#9898a3","#d1d1e0"],Au:["#c19e1c","#ffd124"],Hg:["#9797ac","#b8b8d1"],Tl:["#a6544d","#a6544d"],Pb:["#575961","#575961"],Bi:["#9e4fb5","#9e4fb5"],Po:["#ab5c00","#ab5c00"],At:["#754f45","#754f45"],Rn:["#428296","#428296"],Fr:["#420066","#420066"],Ra:["#007d00","#007d00"],Ac:["#6aa2ec","#70abfa"],Th:["#00baff","#00baff"],Pa:["#00a1ff","#00a1ff"],U:["#008fff","#008fff"],Np:["#0080ff","#0080ff"],Pu:["#006bff","#006bff"],Am:["#545cf2","#545cf2"],Cm:["#785ce3","#785ce3"],Bk:["#8a4fe3","#8a4fe3"],Cf:["#a136d4","#a136d4"],Es:["#b31fd4","#b31fd4"],Fm:["#000000","#000000"],Md:["#000000","#000000"],No:["#000000","#000000"],Lr:["#000000","#000000"],Rf:["#47b3ec","#4dc2ff"],Db:["#4da6ff","#4da6ff"],Sg:["#2194d6","#2194d6"],Bh:["#267dab","#267dab"],Hs:["#266696","#266696"],Mt:["#175487","#175487"],Ds:["#9898a3","#d1d1e0"],Rg:["#c19e1c","#ffd124"],Cn:["#9797ac","#b8b8d1"],Nh:["#000000","#000000"],Fl:["#000000","#000000"],Mc:["#000000","#000000"],Lv:["#000000","#000000"],Ts:["#000000","#000000"],Og:["#000000","#000000"]},Oa=Object.keys(Ea).reduce((function(t,e){return t[e]=Ea[e][0],t}),{}),xa=(Object.keys(Ea).reduce((function(t,e){return t[e]=Ea[e][1],t}),{}),va.tfx);function Sa(t,e){return"M"+xa(t.x)+","+xa(t.y)+"L"+xa(e.x)+","+xa(e.y)+"\t"}function Aa(t,e,n){for(var r=0,a=pt.dist(t,e),o=pt.diff(e,t).normalized(),i=!0,s="",c=0;r<a;){var l=n[c%n.length],u=r+Math.min(l,a-r);i&&(s+="M "+t.addScaled(o,r).coordStr()+" L "+t.addScaled(o,u).coordStr()),r+=l,i=!i,c++}return s}function Pa(t,e){if(W.a.vml){var n=.16*e.height;t.translateAbs(0,n),e.y+=n}}var Ta={recenterText:Pa,arrow:function(t,e,n,r){return t.path("M{0},{1}L{2},{3}L{4},{5}M{2},{3}L{4},{6}",xa(e.x),xa(e.y),xa(n.x),xa(n.y),xa(n.x-7),xa(n.y-5),xa(n.y+5)).attr(r.lineattr)},plus:function(t,e,n){var r=n.scale/5;return t.path("M{0},{4}L{0},{5}M{2},{1}L{3},{1}",xa(e.x),xa(e.y),xa(e.x-r),xa(e.x+r),xa(e.y-r),xa(e.y+r)).attr(n.lineattr)},aromaticBondPaths:function(t,e,n,r,a,o){return[o&&1&a?Aa(t,n,o):Sa(t,n),o&&2&a?Aa(e,r,o):Sa(e,r)]},bondSingle:function(t,e,n,r){var a=e.p,o=n.p;return t.path(Sa(a,o)).attr(r.lineattr)},bondSingleUp:function(t,e,n,r,a){return t.path("M{0},{1}L{2},{3}L{4},{5}Z",xa(e.x),xa(e.y),xa(n.x),xa(n.y),xa(r.x),xa(r.y)).attr(a.lineattr).attr({fill:"#000"})},bondSingleStereoBold:function(t,e,n,r,a,o){return t.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}Z",xa(e.x),xa(e.y),xa(n.x),xa(n.y),xa(r.x),xa(r.y),xa(a.x),xa(a.y)).attr(o.lineattr).attr({stroke:"#000",fill:"#000"})},bondDoubleStereoBold:function(t,e,n,r,a){return t.set([e,t.path("M{0},{1}L{2},{3}",xa(n.x),xa(n.y),xa(r.x),xa(r.y)).attr(a.lineattr)])},bondSingleDown:function(t,e,n,r,a,o){for(var i,s=e.p,c=e.norm,l=.7*o.stereoBond,u="",p=0;p<r;++p)u+=Sa((i=s.addScaled(n,a*p)).addScaled(c,l*(p+.5)/(r-.5)),i.addScaled(c,-l*(p+.5)/(r-.5)));return t.path(u).attr(o.lineattr)},bondSingleEither:function(t,e,n,r,a,o){for(var i=e.p,s=e.norm,c=.7*o.stereoBond,l="M"+xa(i.x)+","+xa(i.y),u=i,p=0;p<r;++p)u=i.addScaled(n,a*(p+.5)).addScaled(s,(1&p?-1:1)*c*(p+.5)/(r-.5)),l+="L"+xa(u.x)+","+xa(u.y);return t.path(l).attr(o.lineattr)},bondDouble:function(t,e,n,r,a,o,i){return t.path(o?"M{0},{1}L{6},{7}M{4},{5}L{2},{3}":"M{0},{1}L{2},{3}M{4},{5}L{6},{7}",xa(e.x),xa(e.y),xa(r.x),xa(r.y),xa(n.x),xa(n.y),xa(a.x),xa(a.y)).attr(i.lineattr)},bondSingleOrDouble:function(t,e,n,r,a){for(var o,i=e.p,s=n.p,c=e.norm,l=a.bondSpace/2,u="",p=i,d=1;d<=r;++d)o=pt.lc2(i,(r-d)/r,s,d/r),1&d?u+=Sa(p,o):(u+=Sa(p.addScaled(c,l),o.addScaled(c,l)),u+=Sa(p.addScaled(c,-l),o.addScaled(c,-l))),p=o;return t.path(u).attr(a.lineattr)},bondTriple:function(t,e,n,r){var a=e.p,o=n.p,i=e.norm,s=a.addScaled(i,r.bondSpace),c=o.addScaled(i,r.bondSpace),l=a.addScaled(i,-r.bondSpace),u=o.addScaled(i,-r.bondSpace);return t.path(Sa(a,o)+Sa(s,c)+Sa(l,u)).attr(r.lineattr)},bondAromatic:function(t,e,n,r){var a=t.path(e[0]).attr(r.lineattr),o=t.path(e[1]).attr(r.lineattr);return void 0!==n&&null!==n&&(n>0?a:o).attr({"stroke-dasharray":"- "}),t.set([a,o])},bondAny:function(t,e,n,r){var a=e.p,o=n.p;return t.path(Sa(a,o)).attr(r.lineattr).attr({"stroke-dasharray":"- "})},reactingCenter:function(t,e,n){for(var r="",a=0;a<e.length/2;++a)r+=Sa(e[2*a],e[2*a+1]);return t.path(r).attr(n.lineattr)},topologyMark:function(t,e,n,r){var a=t.text(e.x,e.y,n).attr({font:r.font,"font-size":r.fontszsub,fill:"#000"}),o=va.relBox(a.getBBox());return Pa(a,o),a},radicalCap:function(t,e,n){var r=.9*n.lineWidth,a=r,o=2*r;return t.path("M{0},{1}L{2},{3}L{4},{5}",xa(e.x-a),xa(e.y+o),xa(e.x),xa(e.y),xa(e.x+a),xa(e.y+o)).attr({stroke:"#000","stroke-width":.7*n.lineWidth,"stroke-linecap":"square","stroke-linejoin":"miter"})},radicalBullet:function(t,e,n){return t.circle(xa(e.x),xa(e.y),n.lineWidth).attr({stroke:null,fill:"#000"})},bracket:function(t,e,n,r,a,o,i){a=a||.25,o=o||1;var s=r.addScaled(n,-.5*o),c=r.addScaled(n,.5*o),l=s.addScaled(e,-a),u=c.addScaled(e,-a);return t.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}",xa(l.x),xa(l.y),xa(s.x),xa(s.y),xa(c.x),xa(c.y),xa(u.x),xa(u.y)).attr(i.sgroupBracketStyle)},selectionRectangle:function(t,e,n,r){return t.rect(xa(Math.min(e.x,n.x)),xa(Math.min(e.y,n.y)),xa(Math.abs(n.x-e.x)),xa(Math.abs(n.y-e.y))).attr(r.lassoStyle)},selectionPolygon:function(t,e,n){for(var r=e[e.length-1],a="M"+xa(r.x)+","+xa(r.y),o=0;o<e.length;++o)a+="L"+xa(e[o].x)+","+xa(e[o].y);return t.path(a).attr(n.lassoStyle)},selectionLine:function(t,e,n,r){return t.path(Sa(e,n)).attr(r.lassoStyle)},circle:function(t,e,n){var r=pt.dist(e[0],e[1]);return t.circle(e[0].x,e[0].y,r)},rectangle:function(t,e,n){return t.rect(xa(Math.min(e[0].x,e[1].x)),xa(Math.min(e[0].y,e[1].y)),xa(Math.abs(e[1].x-e[0].x)),xa(Math.abs(e[1].y-e[0].y)))},polyline:function(t,e,n){for(var r=["M",e[0].x,e[0].y],a=1;a<e.length;a++)r.push("L",e[a].x,e[a].y);return t.path(r)},line:function(t,e,n){var r=["M",e[0].x,e[0].y];return r.push("L",e[1].x,e[1].y),t.path(r)}};function Ca(t){this.init("atom"),this.a=t,this.showLabel=!1,this.hydrogenOnTheLeft=!1,this.color="#000000",this.component=-1}function Ra(t,e,n,r){t.translateAbs(n,r),e.x+=n,e.y+=r}function ja(t,e){var n=[];t.a.neighbors.forEach((function(t){var r=e.halfBonds.get(t);n.push(r.ang)})),n=n.sort((function(t,e){return t-e}));for(var r=[],a=0;a<n.length-1;++a)r.push(n[(a+1)%n.length]-n[a]);r.push(n[0]-n[n.length-1]+2*Math.PI);var o=0,i=-Math.PI/2;for(a=0;a<n.length;++a)r[a]>o&&(o=r[a],i=n[a]+r[a]/2);return new pt(Math.cos(i),Math.sin(i))}function Na(t,e,n,r){for(var a=0,o=t.visel,i=0;i<o.exts.length;++i){var s=o.exts[i].translate(e);a=Math.max(a,va.shiftRayBox(e,n,s))}return a>0&&(e=e.addScaled(n,a+r)),e}function Ma(t){this.init("bond"),this.b=t,this.doubleBondShift=0}function ka(t,e,n,r){return t.neighbors.findIndex((function(t){var a=r.molecule.halfBonds.get(t),o=a.bid;if(o===e)return!1;var i=r.bonds.get(o);return i.b.type===At.PATTERN.TYPE.SINGLE&&i.b.stereo===At.PATTERN.STEREO.UP?i.b.end===a.begin||i.boldStereo&&n:!(i.b.type!==At.PATTERN.TYPE.DOUBLE||i.b.stereo!==At.PATTERN.STEREO.NONE||!n||!i.boldStereo)}))}function Ba(t,e,n){var r=[e.b.begin,e.b.end].map((function(e){var r=n.molecule.atoms.get(e),a=ka(r,t,!0,n);return a<0?-1:r.neighbors[a]}));e.neihbid1=n.atoms.get(e.b.begin).showLabel?-1:r[0],e.neihbid2=n.atoms.get(e.b.end).showLabel?-1:r[1]}function La(t,e,n,r,a){var o=t.options,i=Da(e,r.neihbid1,o.stereoBond,a),s=Da(n,r.neihbid2,o.stereoBond,a),c=i[0],l=i[1],u=s[0],p=s[1];return Ta.bondSingleStereoBold(t.paper,c,l,u,p,o)}function Ia(t,e){return e<0||Math.abs(t)>.9?0:e/(1-t)}function Da(t,e,n,r){var a=r.halfBonds.get(e),o=pt.dot(t.dir,a.dir),i=pt.cross(t.dir,a.dir),s=Math.sqrt(.5*(1-o)),c=a.dir.rotateSC((i>=0?-1:1)*s,Math.sqrt(.5*(1+o))),l=t.p.addScaled(c,.7*n/(s+.3)),u=t.p.addScaled(c.negated(),.7*n/(s+.3));return i>0?[l,u]:[u,l]}function za(t,e,n,r,a,o){var i=[.125,.125,.005,.125],s=null,c=null,l=t.options,u=r.doubleBondShift;r.b.type===At.PATTERN.TYPE.SINGLE_OR_AROMATIC&&(s=u>0?1:2,c=i.map((function(t){return t*l.scale}))),r.b.type===At.PATTERN.TYPE.DOUBLE_OR_AROMATIC&&(s=3,c=i.map((function(t){return t*l.scale})));var p=function(t,e,n,r,a,o,i,s){var c=t.p,l=e.p,u=t.norm,p=o/2,d=p+n*p,h=n*p-p,f=c.addScaled(u,d),m=l.addScaled(u,d),g=c.addScaled(u,h),b=l.addScaled(u,h);n>0?(r&&(f=f.addScaled(t.dir,o*Ia(t.rightCos,t.rightSin))),a&&(m=m.addScaled(t.dir,-o*Ia(e.leftCos,e.leftSin)))):n<0&&(r&&(g=g.addScaled(t.dir,o*Ia(t.leftCos,t.leftSin))),a&&(b=b.addScaled(t.dir,-o*Ia(e.rightCos,e.rightSin))));return Ta.aromaticBondPaths(f,g,m,b,i,s)}(e,n,u,a,o,l.bondSpace,s,c);return Ta.bondAromatic(t.paper,p,u,l)}function _a(t,e,n,r,a,o,i,s){var c=pt.lc(n.p,o,r.p,i,s,a),l=e.text(c.x,c.y,t.toString()),u=va.relBox(l.getBBox());return Ta.recenterText(l,u),l}function Ha(t,e,n){var r=e.render,a=e.atoms.get(t.b.begin),o=e.atoms.get(t.b.end),i=ba.obj2scaled(a.a.pp,r.options),s=ba.obj2scaled(o.a.pp,r.options),c=e.molecule.halfBonds.get(t.b.hb1),l=e.molecule.halfBonds.get(t.b.hb2);c.p=Va(a,i,c.dir,2*n.lineWidth),l.p=Va(o,s,l.dir,2*n.lineWidth),t.b.center=pt.lc2(a.a.pp,.5,o.a.pp,.5),t.b.len=pt.dist(i,s),t.b.sb=5*n.lineWidth,t.b.sa=Math.max(t.b.sb,t.b.len/2-2*n.lineWidth),t.b.angle=180*Math.atan2(c.dir.y,c.dir.x)/Math.PI}function Va(t,e,n,r){for(var a=0,o=t.visel,i=0;i<o.exts.length;++i){var s=o.exts[i].translate(e);a=Math.max(a,va.shiftRayBox(e,n,s))}return a>0&&(e=e.addScaled(n,a+r)),e}function Fa(t){this.init("rxnPlus"),this.item=t}function Ga(t){this.init("rxnArrow"),this.item=t}function Ua(t){this.init("frag"),this.item=t}Ca.prototype=new wa,Ca.isSelectable=function(){return!0},Ca.prototype.getVBoxObj=function(t){return this.visel.boundingBox?wa.prototype.getVBoxObj.call(this,t):new wt(this.a.pp,this.a.pp)},Ca.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},Ca.prototype.makeHighlightPlate=function(t){var e=t.paper,n=t.options,r=ba.obj2scaled(this.a.pp,n);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.highlightStyle)},Ca.prototype.makeSelectionPlate=function(t,e,n){var r=ba.obj2scaled(this.a.pp,t.render.options);return e.circle(r.x,r.y,n.atomSelectionPlateRadius).attr(n.selectionStyle)},Ca.prototype.show=function(t,e,n){var r=t.render,a=ba.obj2scaled(this.a.pp,r.options);if(this.hydrogenOnTheLeft=function(t,e){if(0===e.a.neighbors.length){var n=ut.map[e.a.label];return!n||ut[n].leftH}var r=1,a=1,o=0,i=0;return e.a.neighbors.forEach((function(e){var n=t.halfBonds.get(e).dir;n.x<=0?(r=Math.min(r,Math.abs(n.y)),o++):(a=Math.min(a,Math.abs(n.y)),i++)})),r<.51||a<.51?a<r:i>o}(t.molecule,this),this.showLabel=function(t,e,n){var r="off"!==e.showHydrogenLabels&&"Hetero"!==e.showHydrogenLabels;if(0===n.a.neighbors.length||n.a.neighbors.length<2&&r||e.carbonExplicitly||n.a.alias||0!==n.a.isotope||0!==n.a.radical||0!==n.a.charge||n.a.explicitValence>=0||null!==n.a.atomList||null!==n.a.rglabel||n.a.badConn&&e.showValenceWarnings||"c"!==n.a.label.toLowerCase())return!0;if(2===n.a.neighbors.length){var a=n.a.neighbors[0],o=n.a.neighbors[1],i=t.molecule.halfBonds.get(a),s=t.molecule.halfBonds.get(o),c=t.bonds.get(i.bid),l=t.bonds.get(s.bid);if(c.b.type===l.b.type&&c.b.stereo===At.PATTERN.STEREO.NONE&&l.b.stereo===At.PATTERN.STEREO.NONE&&Math.abs(pt.cross(i.dir,s.dir))<.2)return!0}return!1}(t,r.options,this),this.color="black",this.showLabel){var o=function(t,e,n,r){var a={};a.text=function(t){if(null!==t.atomList)return t.atomList.label();if(t.pseudo)return t.pseudo;if(t.alias)return t.alias;if("R#"===t.label&&null!==t.rglabel){for(var e="",n=0;n<32;n++)t.rglabel&1<<n&&(e+="R"+(n+1).toString());return e}return t.label}(t.a),""===a.text&&(a="R#");if(a.text===t.a.label){var o=ut.map[a.text];r.atomColoring&&o&&(t.color=Oa[a.text]||"#000")}a.path=e.text(n.x,n.y,a.text).attr({font:r.font,"font-size":r.fontsz,fill:t.color,"font-style":t.a.pseudo?"italic":""}),a.rbb=va.relBox(a.path.getBBox()),Ta.recenterText(a.path,a.rbb),null!==t.a.atomList&&Ra(a.path,a.rbb,(t.hydrogenOnTheLeft?-1:1)*(a.rbb.width-a.rbb.height)/2,0);return t.label=a,a}(this,r.paper,a,n),i=.5*n.lineWidth,s=o.rbb.width/2,c=-o.rbb.width/2,l=Math.floor(this.a.implicitH),u="H"===o.text;t.addReObjectPath("data",this.visel,o.path,a,!0);var p=null;n.showAtomIds&&((p={}).text=e.toString(),p.path=r.paper.text(a.x,a.y,p.text).attr({font:n.font,"font-size":n.fontszsub,fill:"#070"}),p.rbb=va.relBox(p.path.getBBox()),Ta.recenterText(p.path,p.rbb),t.addReObjectPath("indices",this.visel,p.path,a)),this.setHighlight(this.highlight,r)}if(this.showLabel&&!this.a.alias&&!this.a.pseudo){var d=null;if(u&&l>0&&(s+=(d=function(t,e,n,r){var a=ba.obj2scaled(t.a.pp,e.options),o=e.options,i=.5*o.lineWidth,s={};return s.text=(n+1).toString(),s.path=e.paper.text(a.x,a.y,s.text).attr({font:o.font,"font-size":o.fontszsub,fill:t.color}),s.rbb=va.relBox(s.path.getBBox()),Ta.recenterText(s.path,s.rbb),Ra(s.path,s.rbb,r+.5*s.rbb.width+i,.2*t.label.rbb.height),s}(this,r,l,s)).rbb.width+i,t.addReObjectPath("data",this.visel,d.path,a,!0)),0!=this.a.radical){var h=function(t,e){var n,r=ba.obj2scaled(t.a.pp,e.options),a=e.options,o=e.paper,i={};switch(t.a.radical){case 1:i.path=o.set(),n=1.6*a.lineWidth,i.path.push(Ta.radicalBullet(o,r.add(new pt(-n,0)),a),Ta.radicalBullet(o,r.add(new pt(n,0)),a)),i.path.attr("fill",t.color);break;case 2:i.path=o.set(),i.path.push(Ta.radicalBullet(o,r,a)),i.path.attr("fill",t.color);break;case 3:i.path=o.set(),n=1.6*a.lineWidth,i.path.push(Ta.radicalCap(o,r.add(new pt(-n,0)),a),Ta.radicalCap(o,r.add(new pt(n,0)),a)),i.path.attr("stroke",t.color)}i.rbb=va.relBox(i.path.getBBox());var s=-.5*(t.label.rbb.height+i.rbb.height);3===t.a.radical&&(s-=a.lineWidth/2);return Ra(i.path,i.rbb,0,s),i}(this,r);t.addReObjectPath("data",this.visel,h.path,a,!0)}if(0!=this.a.isotope){var f=function(t,e,n){var r=ba.obj2scaled(t.a.pp,e.options),a=e.options,o=.5*a.lineWidth,i={};return i.text=t.a.isotope.toString(),i.path=e.paper.text(r.x,r.y,i.text).attr({font:a.font,"font-size":a.fontszsub,fill:t.color}),i.rbb=va.relBox(i.path.getBBox()),Ta.recenterText(i.path,i.rbb),Ra(i.path,i.rbb,n-.5*i.rbb.width-o,-.3*t.label.rbb.height),i}(this,r,c);c-=f.rbb.width+i,t.addReObjectPath("data",this.visel,f.path,a,!0)}if(!u&&l>0&&function(t,e){return"on"===t||"Terminal"===t&&e.a.neighbors.length<2||"Hetero"===t&&"c"!==e.label.text.toLowerCase()||"Terminal and Hetero"===t&&(e.a.neighbors.length<2||"c"!==e.label.text.toLowerCase())}(n.showHydrogenLabels,this)){var m=function(t,e,n,r){var a=r.hydroIndex,o=t.hydrogenOnTheLeft,i=ba.obj2scaled(t.a.pp,e.options),s=e.options,c=.5*s.lineWidth,l=r.hydrogen;l.text="H",l.path=e.paper.text(i.x,i.y,l.text).attr({font:s.font,"font-size":s.fontsz,fill:t.color}),l.rbb=va.relBox(l.path.getBBox()),Ta.recenterText(l.path,l.rbb),o||(Ra(l.path,l.rbb,r.rightMargin+.5*l.rbb.width+c,0),r.rightMargin+=l.rbb.width+c);n>1&&((a={}).text=n.toString(),a.path=e.paper.text(i.x,i.y,a.text).attr({font:s.font,"font-size":s.fontszsub,fill:t.color}),a.rbb=va.relBox(a.path.getBBox()),Ta.recenterText(a.path,a.rbb),o||(Ra(a.path,a.rbb,r.rightMargin+.5*a.rbb.width+c,.2*t.label.rbb.height),r.rightMargin+=a.rbb.width+c));o&&(null!=a&&(Ra(a.path,a.rbb,r.leftMargin-.5*a.rbb.width-c,.2*t.label.rbb.height),r.leftMargin-=a.rbb.width+c),Ra(l.path,l.rbb,r.leftMargin-.5*l.rbb.width-c,0),r.leftMargin-=l.rbb.width+c);return Object.assign(r,{hydrogen:l,hydroIndex:a})}(this,r,l,{hydrogen:{},hydroIndex:d,rightMargin:s,leftMargin:c}),g=m.hydrogen;d=m.hydroIndex,s=m.rightMargin,c=m.leftMargin,t.addReObjectPath("data",this.visel,g.path,a,!0),null!=d&&t.addReObjectPath("data",this.visel,d.path,a,!0)}if(0!=this.a.charge&&n.showCharge){var b=function(t,e,n){var r=ba.obj2scaled(t.a.pp,e.options),a=e.options,o=.5*a.lineWidth,i={text:""},s=Math.abs(t.a.charge);1!==s&&(i.text=s.toString());t.a.charge<0?i.text+="\u2013":i.text+="+";return i.path=e.paper.text(r.x,r.y,i.text).attr({font:a.font,"font-size":a.fontszsub,fill:t.color}),i.rbb=va.relBox(i.path.getBBox()),Ta.recenterText(i.path,i.rbb),Ra(i.path,i.rbb,n+.5*i.rbb.width+o,-.3*t.label.rbb.height),i}(this,r,s);s+=b.rbb.width+i,t.addReObjectPath("data",this.visel,b.path,a,!0)}if(this.a.explicitValence>=0&&n.showValence){var v=function(t,e,n){var r=ba.obj2scaled(t.a.pp,e.options),a=e.options,o=.5*a.lineWidth,i={};if(i.text={0:"0",1:"I",2:"II",3:"III",4:"IV",5:"V",6:"VI",7:"VII",8:"VIII",9:"IX",10:"X",11:"XI",12:"XII",13:"XIII",14:"XIV"}[t.a.explicitValence],!i.text)throw new Error("invalid valence "+t.a.explicitValence.toString());return i.text="("+i.text+")",i.path=e.paper.text(r.x,r.y,i.text).attr({font:a.font,"font-size":a.fontszsub,fill:t.color}),i.rbb=va.relBox(i.path.getBBox()),Ta.recenterText(i.path,i.rbb),Ra(i.path,i.rbb,n+.5*i.rbb.width+o,-.3*t.label.rbb.height),i}(this,r,s);s+=v.rbb.width+i,t.addReObjectPath("data",this.visel,v.path,a,!0)}if(this.a.badConn&&n.showValenceWarnings){var y=function(t,e,n,r){var a=ba.obj2scaled(t.a.pp,e.options),o=.5*e.options.lineWidth,i=va.tfx,s={},c=a.y+t.label.rbb.height/2+o;return s.path=e.paper.path("M{0},{1}L{2},{3}",i(a.x+n),i(c),i(a.x+r),i(c)).attr(e.options.lineattr).attr({stroke:"#F00"}),s.rbb=va.relBox(s.path.getBBox()),s}(this,r,c,s);t.addReObjectPath("warnings",this.visel,y.path,a,!0)}p&&Ra(p.path,p.rbb,-.5*o.rbb.width-.5*p.rbb.width-i,.3*o.rbb.height)}this.a.attpnt&&function(t,e,n,r){var a,o,i=ba.obj2scaled(t.a.pp,e.options),s=e.options,c=va.tfx;for(a=0;a<4;++a){var l="";if(t.a.attpnt&1<<a){for(l.length>0&&(l+=" "),l+="\u2217",o=0;o<(0==a?0:a+1);++o)l+="'";var u=new pt(i),p=i.addScaled(n,.7*s.scale),d=e.paper.text(p.x,p.y,l).attr({font:s.font,"font-size":s.fontsz,fill:t.color}),h=va.relBox(d.getBBox());Ta.recenterText(d,h);var f=n.negated();p=p.addScaled(f,va.shiftRayBox(p,f,wt.fromRelBox(h))+s.lineWidth/2),u=Na(t,u,n,s.lineWidth);var m=n.rotateSC(1,0),g=p.addScaled(m,.05*s.scale).addScaled(f,.09*s.scale),b=p.addScaled(m,-.05*s.scale).addScaled(f,.09*s.scale),v=e.paper.set();v.push(d,e.paper.path("M{0},{1}L{2},{3}M{4},{5}L{2},{3}L{6},{7}",c(u.x),c(u.y),c(p.x),c(p.y),c(g.x),c(g.y),c(b.x),c(b.y)).attr(e.options.lineattr).attr({"stroke-width":s.lineWidth/2})),r("indices",t.visel,v,i),n=n.rotate(Math.PI/6)}}}(this,r,ja(this,t.molecule),t.addReObjectPath.bind(t));var w=this.a.stereoLabel,E=function(t){var e="";t.a.aam>0&&(e+=t.a.aam);if(t.a.invRet>0)if(e.length>0&&(e+=","),1==t.a.invRet)e+="Inv";else{if(2!=t.a.invRet)throw new Error("Invalid value for the invert/retain flag");e+="Ret"}if(t.a.exactChangeFlag>0){if(e.length>0&&(e+=","),1!=t.a.exactChangeFlag)throw new Error("Invalid value for the exact change flag");e+="ext"}return e}(this),O=this.a.alias||this.a.pseudo?"":function(t){var e="";if(0!=t.a.ringBondCount)if(t.a.ringBondCount>0)e+="rb"+t.a.ringBondCount.toString();else if(-1==t.a.ringBondCount)e+="rb0";else{if(-2!=t.a.ringBondCount)throw new Error("Ring bond count invalid");e+="rb*"}if(0!=t.a.substitutionCount)if(e.length>0&&(e+=","),t.a.substitutionCount>0)e+="s"+t.a.substitutionCount.toString();else if(-1==t.a.substitutionCount)e+="s0";else{if(-2!=t.a.substitutionCount)throw new Error("Substitution count invalid");e+="s*"}if(t.a.unsaturatedAtom>0){if(e.length>0&&(e+=","),1!=t.a.unsaturatedAtom)throw new Error("Unsaturated atom invalid value");e+="u"}t.a.hCount>0&&(e.length>0&&(e+=","),e+="H"+(t.a.hCount-1).toString());return e}(this),x=(w?"".concat(w,"\n"):"")+(O.length>0?"".concat(O,"\n"):"")+(E.length>0?".".concat(E,"."):"");if(x.length>0){var S=ut.map[this.a.label],A=r.paper.text(a.x,a.y,x).attr({font:n.font,"font-size":n.fontszsub,fill:n.atomColoring&&S?Oa[this.a.label]:"#000"}),P=va.relBox(A.getBBox());Ta.recenterText(A,P);for(var T=ja(this,t.molecule),C=this.visel,R=3,j=0;j<C.exts.length;++j)R=Math.max(R,va.shiftRayBox(a,T,C.exts[j].translate(a)));R+=va.shiftRayBox(a,T.negated(),wt.fromRelBox(P)),Ra(A,P,(T=T.scaled(8+R)).x,T.y),t.addReObjectPath("data",this.visel,A,a,!0)}},Ma.prototype=new wa,Ma.isSelectable=function(){return!0},Ma.prototype.drawHighlight=function(t){var e=this.makeHighlightPlate(t);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},Ma.prototype.makeHighlightPlate=function(t){var e=t.options;Ha(this,t.ctab,e);var n=ba.obj2scaled(this.b.center,e);return t.paper.circle(n.x,n.y,.8*e.atomSelectionPlateRadius).attr(e.highlightStyle)},Ma.prototype.makeSelectionPlate=function(t,e,n){Ha(this,t,n);var r=ba.obj2scaled(this.b.center,n);return e.circle(r.x,r.y,.8*n.atomSelectionPlateRadius).attr(n.selectionStyle)},Ma.prototype.show=function(t,e,n){var r=t.render,a=t.molecule,o=r.paper,i=a.halfBonds.get(this.b.hb1),s=a.halfBonds.get(this.b.hb2);!function(t,e,n){var r=[e.b.begin,e.b.end].map((function(e){var r=n.molecule.atoms.get(e),a=ka(r,t,!1,n);return a<0?-1:r.neighbors[a]}));e.boldStereo=r[0]>=0&&r[1]>=0}(e,this,t),Ha(this,t,n),function(t,e){var n,r;if(n=e.halfBonds.get(t.b.hb1).loop,r=e.halfBonds.get(t.b.hb2).loop,n>=0&&r>=0){var a=e.loops.get(n).dblBonds,o=e.loops.get(r).dblBonds,i=e.loops.get(n).hbs.length,s=e.loops.get(r).hbs.length;t.doubleBondShift=function(t,e,n,r){return 6==t&&6!=e&&(n>1||1==r)?-1:6==e&&6!=t&&(r>1||1==n)?1:e*n>t*r?-1:e*n<t*r?1:e>t?-1:1}(i,s,a,o)}else t.doubleBondShift=n>=0?-1:r>=0?1:function(t,e){var n=t.halfBonds.get(e.b.hb1),r=t.halfBonds.get(e.b.hb2),a=(n.leftSin>.3?1:0)+(r.rightSin>.3?1:0),o=(r.leftSin>.3?1:0)+(n.rightSin>.3?1:0);return a>o?-1:a<o||(n.leftSin>.3?1:0)+(n.rightSin>.3?1:0)==1?1:0}(e,t)}(this,a),this.path=function(t,e,n,r){var a=null,o=t.render,i=t.molecule,s=!t.atoms.get(n.begin).showLabel,c=!t.atoms.get(r.begin).showLabel;switch(e.b.type){case At.PATTERN.TYPE.SINGLE:switch(e.b.stereo){case At.PATTERN.STEREO.UP:Ba(n.bid,e,t),a=e.boldStereo&&e.neihbid1>=0&&e.neihbid2>=0?La(o,n,r,e,i):function(t,e,n,r,a){var o=e.p,i=n.p,s=e.norm,c=t.options,l=.7*c.stereoBond,u=i.addScaled(s,l),p=i.addScaled(s,-l);if(r.neihbid2>=0){var d=Da(n,r.neihbid2,c.stereoBond,a);u=d[0],p=d[1]}return Ta.bondSingleUp(t.paper,o,u,p,c)}(o,n,r,e,i);break;case At.PATTERN.STEREO.DOWN:a=function(t,e,n){var r=e.p,a=n.p,o=t.options,i=a.sub(r),s=i.length()+.2;i=i.normalized();var c=1.2*o.lineWidth,l=Math.max(Math.floor((s-o.lineWidth)/(o.lineWidth+c)),0)+2,u=s/(l-1);return Ta.bondSingleDown(t.paper,e,i,l,u,o)}(o,n,r);break;case At.PATTERN.STEREO.EITHER:a=function(t,e,n){var r=e.p,a=n.p,o=t.options,i=a.sub(r),s=i.length();i=i.normalized();var c=.6*o.lineWidth,l=Math.max(Math.floor((s-o.lineWidth)/(o.lineWidth+c)),0)+2,u=s/(l-.5);return Ta.bondSingleEither(t.paper,e,i,l,u,o)}(o,n,r);break;default:a=Ta.bondSingle(o.paper,n,r,o.options)}break;case At.PATTERN.TYPE.DOUBLE:Ba(n.bid,e,t),a=e.b.stereo===At.PATTERN.STEREO.NONE&&e.boldStereo&&e.neihbid1>=0&&e.neihbid2>=0?function(t,e,n,r,a,o,i){var s=e.p,c=n.p,l=e.norm,u=r.doubleBondShift,p=1.5*t.options.stereoBond,d=s.addScaled(l,p*u),h=c.addScaled(l,p*u);u>0?(o&&(d=d.addScaled(e.dir,p*Ia(e.rightCos,e.rightSin))),i&&(h=h.addScaled(e.dir,-p*Ia(n.leftCos,n.leftSin)))):u<0&&(o&&(d=d.addScaled(e.dir,p*Ia(e.leftCos,e.leftSin))),i&&(h=h.addScaled(e.dir,-p*Ia(n.rightCos,n.rightSin))));var f=La(t,e,n,r,a);return Ta.bondDoubleStereoBold(t.paper,f,d,h,t.options)}(o,n,r,e,i,s,c):function(t,e,n,r,a,o){var i=r.b.stereo===At.PATTERN.STEREO.CIS_TRANS,s=e.p,c=n.p,l=e.norm,u=i?0:r.doubleBondShift,p=t.options,d=p.bondSpace/2,h=d+u*d,f=u*d-d,m=s.addScaled(l,h),g=c.addScaled(l,h),b=s.addScaled(l,f),v=c.addScaled(l,f);u>0?(a&&(m=m.addScaled(e.dir,p.bondSpace*Ia(e.rightCos,e.rightSin))),o&&(g=g.addScaled(e.dir,-p.bondSpace*Ia(n.leftCos,n.leftSin)))):u<0&&(a&&(b=b.addScaled(e.dir,p.bondSpace*Ia(e.leftCos,e.leftSin))),o&&(v=v.addScaled(e.dir,-p.bondSpace*Ia(n.rightCos,n.rightSin))));return Ta.bondDouble(t.paper,m,b,g,v,i,p)}(o,n,r,e,s,c);break;case At.PATTERN.TYPE.TRIPLE:a=Ta.bondTriple(o.paper,n,r,o.options);break;case At.PATTERN.TYPE.AROMATIC:var l=n.loop>=0&&i.loops.get(n.loop).aromatic||r.loop>=0&&i.loops.get(r.loop).aromatic;a=l?Ta.bondSingle(o.paper,n,r,o.options):za(o,n,r,e,s,c);break;case At.PATTERN.TYPE.SINGLE_OR_DOUBLE:a=function(t,e,n){var r=e.p,a=n.p,o=t.options,i=(pt.dist(r,a)/(o.bondSpace+o.lineWidth)).toFixed()-0;1&i||(i+=1);return Ta.bondSingleOrDouble(t.paper,e,n,i,o)}(o,n,r);break;case At.PATTERN.TYPE.SINGLE_OR_AROMATIC:case At.PATTERN.TYPE.DOUBLE_OR_AROMATIC:a=za(o,n,r,e,s,c);break;case At.PATTERN.TYPE.ANY:a=Ta.bondAny(o.paper,n,r,o.options);break;default:throw new Error("Bond type "+e.b.type+" not supported")}return a}(t,this,i,s),this.rbb=va.relBox(this.path.getBBox()),t.addReObjectPath("data",this.visel,this.path,null,!0);var c={};c.path=function(t,e,n,r){var a=n.p,o=r.p,i=o.add(a).scaled(.5),s=o.sub(a).normalized(),c=s.rotateSC(1,0),l=[],u=t.options.lineWidth,p=t.options.bondSpace/2,d=u,h=2*u,f=1.5*p,m=1.5*p,g=3*p;switch(e.b.reactingCenterStatus){case At.PATTERN.REACTING_CENTER.NOT_CENTER:l.push(i.addScaled(c,g).addScaled(s,.2*g)),l.push(i.addScaled(c,-g).addScaled(s,-.2*g)),l.push(i.addScaled(c,g).addScaled(s,-.2*g)),l.push(i.addScaled(c,-g).addScaled(s,.2*g));break;case At.PATTERN.REACTING_CENTER.CENTER:l.push(i.addScaled(c,g).addScaled(s,.2*g).addScaled(s,d)),l.push(i.addScaled(c,-g).addScaled(s,-.2*g).addScaled(s,d)),l.push(i.addScaled(c,g).addScaled(s,.2*g).addScaled(s,-d)),l.push(i.addScaled(c,-g).addScaled(s,-.2*g).addScaled(s,-d)),l.push(i.addScaled(s,f).addScaled(c,m)),l.push(i.addScaled(s,-f).addScaled(c,m)),l.push(i.addScaled(s,f).addScaled(c,-m)),l.push(i.addScaled(s,-f).addScaled(c,-m));break;case At.PATTERN.REACTING_CENTER.MADE_OR_BROKEN:l.push(i.addScaled(c,g).addScaled(s,h)),l.push(i.addScaled(c,-g).addScaled(s,h)),l.push(i.addScaled(c,g).addScaled(s,-h)),l.push(i.addScaled(c,-g).addScaled(s,-h));break;case At.PATTERN.REACTING_CENTER.ORDER_CHANGED:l.push(i.addScaled(c,g)),l.push(i.addScaled(c,-g));break;case At.PATTERN.REACTING_CENTER.MADE_OR_BROKEN_AND_CHANGED:l.push(i.addScaled(c,g).addScaled(s,h)),l.push(i.addScaled(c,-g).addScaled(s,h)),l.push(i.addScaled(c,g).addScaled(s,-h)),l.push(i.addScaled(c,-g).addScaled(s,-h)),l.push(i.addScaled(c,g)),l.push(i.addScaled(c,-g));break;default:return null}return Ta.reactingCenter(t.paper,l,t.options)}(r,this,i,s),c.path&&(c.rbb=va.relBox(c.path.getBBox()),t.addReObjectPath("data",this.visel,c.path,null,!0));var l={};l.path=function(t,e,n,r){var a=t.options,o=null;if(e.b.topology===At.PATTERN.TOPOLOGY.RING)o="rng";else{if(e.b.topology!==At.PATTERN.TOPOLOGY.CHAIN)return null;o="chn"}var i=n.p,s=r.p,c=s.add(i).scaled(.5),l=s.sub(i).normalized().rotateSC(1,0),u=a.lineWidth;e.doubleBondShift>0?l=l.scaled(-e.doubleBondShift):0==e.doubleBondShift&&(u+=a.bondSpace/2);var p=new pt(2,1).scaled(a.bondSpace);e.b.type==At.PATTERN.TYPE.TRIPLE&&(u+=a.bondSpace);var d=c.add(new pt(l.x*(p.x+u),l.y*(p.y+u)));return Ta.topologyMark(t.paper,d,o,a)}(r,this,i,s),l.path&&(l.rbb=va.relBox(l.path.getBBox()),t.addReObjectPath("data",this.visel,l.path,null,!0)),this.setHighlight(this.highlight,r);var u=null,p=.6*n.subFontSize;n.showBondIds&&(u=_a(e,o,i,s,p,.5,.5,i.norm),t.addReObjectPath("indices",this.visel,u)),n.showHalfBondIds&&(u=_a(this.b.hb1,o,i,s,p,.8,.2,i.norm),t.addReObjectPath("indices",this.visel,u),u=_a(this.b.hb2,o,i,s,p,.2,.8,s.norm),t.addReObjectPath("indices",this.visel,u)),n.showLoopIds&&!n.showBondIds&&(u=_a(i.loop,o,i,s,p,.5,.5,s.norm),t.addReObjectPath("indices",this.visel,u),u=_a(s.loop,o,i,s,p,.5,.5,i.norm),t.addReObjectPath("indices",this.visel,u))},Fa.prototype=new wa,Fa.isSelectable=function(){return!0},Fa.prototype.highlightPath=function(t){var e=ba.obj2scaled(this.item.pp,t.options),n=t.options.scale;return t.paper.rect(e.x-n/4,e.y-n/4,n/2,n/2,n/8)},Fa.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},Fa.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},Fa.prototype.show=function(t,e,n){var r=t.render,a=ba.obj2scaled(this.item.pp,n),o=Ta.plus(r.paper,a,n),i=n.offset;null!=i&&o.translateAbs(i.x,i.y),this.visel.add(o,wt.fromRelBox(va.relBox(o.getBBox())))},Ga.prototype=new wa,Ga.isSelectable=function(){return!0},Ga.prototype.highlightPath=function(t){var e=ba.obj2scaled(this.item.pp,t.options),n=t.options.scale;return t.paper.rect(e.x-n,e.y-n/4,2*n,n/2,n/8)},Ga.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},Ga.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},Ga.prototype.show=function(t,e,n){var r=t.render,a=ba.obj2scaled(this.item.pp,n),o=Ta.arrow(r.paper,new pt(a.x-n.scale,a.y),new pt(a.x+n.scale,a.y),n),i=n.offset;null!=i&&o.translateAbs(i.x,i.y),this.visel.add(o,wt.fromRelBox(va.relBox(o.getBBox())))},Ua.prototype=new wa,Ua.isSelectable=function(){return!1},Ua.prototype.fragGetAtoms=function(t,e){return Array.from(t.atoms.keys()).filter((function(n){return t.atoms.get(n).a.fragment===e}))},Ua.prototype.fragGetBonds=function(t,e){return Array.from(t.bonds.keys()).filter((function(n){var r=t.bonds.get(n).b,a=t.atoms.get(r.begin).a.fragment,o=t.atoms.get(r.end).a.fragment;return a===e&&o===e}))},Ua.prototype.calcBBox=function(e,n,r){var a;return e.atoms.forEach((function(e){if(e.a.fragment===n){var o=e.visel.boundingBox;if(o)r||(r=t._ui_editor.render),o=o.translate((r.options.offset||new pt).negated()).transform(ba.scaled2obj,r.options);else{o=new wt(e.a.pp,e.a.pp);var i=new pt(.05*3,.05*3);o=o.extend(i,i)}a=a?wt.union(a,o):o}})),a},Ua.prototype._draw=function(t,e,n){var r=this.calcBBox(t.ctab,e,t);if(r){var a=ba.obj2scaled(new pt(r.p0.x,r.p0.y),t.options),o=ba.obj2scaled(new pt(r.p1.x,r.p1.y),t.options);return t.paper.rect(a.x,a.y,o.x-a.x,o.y-a.y,0).attr(n)}},Ua.prototype.draw=function(t){return null},Ua.prototype.drawHighlight=function(t){},Ua.prototype.setHighlight=function(t,e){var n=e.ctab.frags.keyOf(this);(n||0===n)&&(n=parseInt(n,10),e.ctab.atoms.forEach((function(r){r.a.fragment===n&&r.setHighlight(t,e)})),e.ctab.bonds.forEach((function(r){e.ctab.atoms.get(r.b.begin).a.fragment===n&&r.setHighlight(t,e)})))};var Wa=new pt(.05*3,.05*3);function Ya(t){this.init("rgroup"),this.labelBox=null,this.item=t}function qa(t,e){var n=e.ifthen>0?"IF ":"",r=e.range.startsWith(">")||e.range.startsWith("<")||e.range.startsWith("="),a=null;a=e.range.length>0?r?e.range:"="+e.range:">0";var o=e.resth?" (RestH)":"",i=e.ifthen>0?"\nTHEN R"+e.ifthen.toString():"";return"".concat(n,"R").concat(t.toString()).concat(a).concat(o).concat(i)}function $a(t){this.init("sgroupData"),this.sgroup=t}function Ka(t,e){this.init("enhancedFlag"),this.flag=t,this.pp=e}Ya.prototype=new wa,Ya.isSelectable=function(){return!1},Ya.prototype.getAtoms=function(t){var e=[];return this.item.frags.forEach((function(n){e=e.concat(t.ctab.frags.get(n).fragGetAtoms(t.ctab,n))})),e},Ya.prototype.getBonds=function(t){var e=[];return this.item.frags.forEach((function(n){e=e.concat(t.ctab.frags.get(n).fragGetBonds(t.ctab,n))})),e},Ya.prototype.calcBBox=function(t){var e=null;return this.item.frags.forEach((function(n){var r=t.ctab.frags.get(n).calcBBox(t.ctab,n,t);r&&(e=e?wt.union(e,r):r)})),e&&(e=e.extend(Wa,Wa)),e},Ya.prototype.draw=function(t,e){var n=this.calcBBox(t);if(!n)return{};var r={data:[]},a=ba.obj2scaled(n.p0,e),o=ba.obj2scaled(n.p1,e),i=t.paper.set();!function(t,e,n,r){r=ba.obj2scaled(r||new pt(1,0),e.options);var a=Math.min(.25,.3*n.sz().x),o=n.p1.y-n.p0.y,i=.5*(n.p1.y+n.p0.y),s=Ta.bracket(e.paper,r.negated(),r.negated().rotateSC(1,0),ba.obj2scaled(new pt(n.p0.x,i),e.options),a,o,e.options),c=Ta.bracket(e.paper,r,r.rotateSC(1,0),ba.obj2scaled(new pt(n.p1.x,i),e.options),a,o,e.options);t.push(s,c)}(i,t,n),r.data.push(i);var s=t.ctab.rgroups.keyOf(this),c=t.paper.set(),l=t.paper.text(a.x,(a.y+o.y)/2,"R"+s+"=").attr({font:e.font,"font-size":e.fontRLabel,fill:"black"}),u=va.relBox(l.getBBox());l.translateAbs(-u.width/2-e.lineWidth,0),c.push(l);for(var p={font:e.font,"font-size":e.fontRLogic,fill:"black"},d=[qa(s,this.item)],h=u.height/2+e.lineWidth/2,f=0;f<d.length;++f){var m=t.paper.text(a.x,(a.y+o.y)/2,d[f]).attr(p),g=va.relBox(m.getBBox());h+=g.height/2,m.translateAbs(-g.width/2-6*e.lineWidth,h),h+=g.height/2+e.lineWidth/2,r.data.push(m),c.push(m)}return r.data.push(l),this.labelBox=wt.fromRelBox(c.getBBox()).transform(ba.scaled2obj,t.options),r},Ya.prototype._draw=function(t,e,n){var r=this.getVBoxObj(t).extend(Wa,Wa);if(!r)return null;var a=ba.obj2scaled(r.p0,t.options),o=ba.obj2scaled(r.p1,t.options);return t.paper.rect(a.x,a.y,o.x-a.x,o.y-a.y,0).attr(n)},Ya.prototype.drawHighlight=function(t){var e=t.ctab.rgroups.keyOf(this);if(!e)return null;var n=this._draw(t,e,t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,n),this.item.frags.forEach((function(e,n){t.ctab.frags.get(n).drawHighlight(t)})),n},Ya.prototype.show=function(t,e,n){var r=this,a=this.draw(t.render,n);Object.keys(a).forEach((function(e){for(;a[e].length>0;)t.addReObjectPath(e,r.visel,a[e].shift(),null,!0)}))},$a.prototype=new wa,$a.isSelectable=function(){return!0},$a.prototype.highlightPath=function(t){var e=this.sgroup.dataArea,n=ba.obj2scaled(e.p0,t.options),r=ba.obj2scaled(e.p1,t.options).sub(n);return t.paper.rect(n.x,n.y,r.x,r.y)},$a.prototype.drawHighlight=function(t){var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},$a.prototype.makeSelectionPlate=function(t,e,n){return this.highlightPath(t.render).attr(n.selectionStyle)},Ka.prototype=new wa,Ka.isSelectable=function(){return!0},Ka.prototype.highlightPath=function(t){var e=wt.fromRelBox(this.path.getBBox()),n=e.p1.sub(e.p0),r=e.p0.sub(t.options.offset);return t.paper.rect(r.x,r.y,n.x,n.y)},Ka.prototype.drawHighlight=function(t){if(!this.path)return null;var e=this.highlightPath(t).attr(t.options.highlightStyle);return t.ctab.addReObjectPath("highlighting",this.visel,e),e},Ka.prototype.makeSelectionPlate=function(t,e,n){return this.path?this.highlightPath(t.render).attr(n.selectionStyle):null},Ka.prototype.show=function(t,e,n){var r=t.render;if(this.flag){if(!this.pp){var a=t.molecule.getFragment(e).getCoordBoundingBox();this.pp=new pt(a.max.x,a.min.y-1)}var o=r.paper,i=ba.obj2scaled(this.pp,n);this.path=o.text(i.x,i.y,Pt.STEREO_FLAG[this.flag]||"").attr({font:n.font,"font-size":n.fontsz,fill:"#000"}),r.ctab.addReObjectPath("data",this.visel,this.path,null,!0)}};var Xa=va.tfx;function Za(t){this.init("sgroup"),this.item=t}function Qa(t,e,n,r,a,o,i,s,c,l){for(var u=function(t,e,n,r,a,o,i){function s(t,e,n,r){this.c=t,this.d=e,this.n=e.rotateSC(1,0),this.w=n,this.h=r}var c=[],l=a.rotateSC(1,0);e.length<2?function(){a=a||new pt(1,0),l=l||a.rotateSC(1,0);var t=Math.min(.25,.3*r.sz().x),e=pt.lc2(a,r.p0.x,l,.5*(r.p0.y+r.p1.y)),n=pt.lc2(a,r.p1.x,l,.5*(r.p0.y+r.p1.y)),o=r.sz().y;c.push(new s(e,a.negated(),t,o),new s(n,a,t,o))}():2===e.length?function(){var n=t.bonds.get(e[0]),r=t.bonds.get(e[1]),a=n.getCenter(t),l=r.getCenter(t),u=-1,p=-1,d=-1,h=-1,f=pt.centre(a,l),m=pt.diff(l,a).normalized(),g=m.negated(),b=m.rotateSC(1,0),v=b.negated();t.sGroupForest.children.get(i).forEach((function(t){var e=o.ctab.sgroups.get(t).visel.boundingBox;e=e.translate((o.options.offset||new pt).negated()).transform(ba.scaled2obj,o.options),u=Math.max(u,va.shiftRayBox(a,g,e)),p=Math.max(p,va.shiftRayBox(l,m,e)),d=Math.max(d,va.shiftRayBox(f,b,e)),h=Math.max(h,va.shiftRayBox(f,v,e))}),this),u=Math.max(u+.2,0),p=Math.max(p+.2,0);var y=1.5+(d=Math.max(Math.max(d,h)+.1,0));c.push(new s(a.addScaled(g,u),g,.25,y),new s(l.addScaled(m,p),m,.25,y))}():function(){for(var r=0;r<e.length;++r){var a=t.bonds.get(e[r]),o=a.getCenter(t),i=n.has(a.begin)?a.getDir(t):a.getDir(t).negated();c.push(new s(o,i,.2,1))}}();return c}(e.ctab.molecule,r,a,o,i,e,n.id),p=-1,d=0;d<u.length;++d){var h=u[d],f=Ta.bracket(e.paper,ba.obj2scaled(h.d,e.options),ba.obj2scaled(h.n,e.options),ba.obj2scaled(h.c,e.options),h.w,h.h,e.options);t.push(f),(p<0||u[p].d.x<h.d.x||u[p].d.x==h.d.x&&u[p].d.y>h.d.y)&&(p=d)}var m=u[p];function g(n,r){var a=ba.obj2scaled(m.c.addScaled(m.n,r*m.h),e.options),o=e.paper.text(a.x,a.y,n).attr({font:e.options.font,"font-size":e.options.fontszsub});l&&o.attr(l);var i=wt.fromRelBox(va.relBox(o.getBBox())),s=Math.max(va.shiftRayBox(a,m.d.negated(),i),3)+2;o.translateAbs(s*m.d.x,s*m.d.y),t.push(o)}s&&g(s,.5),c&&g(c,-.5)}function Ja(t,e,n,r){var a=t.text(e.x,e.y,n.data.fieldValue).attr({font:r.font,"font-size":r.fontsz}),o=a.getBBox(),i=t.rect(o.x-1,o.y-1,o.width+2,o.height+2,3,3);i=n.selected?i.attr(r.selectionStyle):i.attr({fill:"#fff",stroke:"#fff"});var s=t.set();return s.push(i,a.toFront()),s}function to(t,e){return t.some((function(t){if(!t.pp)return!1;var n=t.pp.add(new pt(.5,.5)),r=e.add(new pt(.5,.5));return wt.segmentIntersection(t.pp,n,e,r)}))}function eo(t,e,n,r){var a=t.atoms;if(r&&2===r.length){var o=n.bonds.get(r[0]).getCenter(n),i=n.bonds.get(r[1]).getCenter(n);t.bracketDir=pt.diff(i,o).normalized()}else t.bracketDir=new pt(1,0);var s=t.bracketDir,c=null,l=[];a.forEach((function(t){var r=n.atoms.get(t),a=e?e.ctab.atoms.get(t).visel.boundingBox:null;if(a)a=a.translate((e.options.offset||new pt).negated()).transform(ba.scaled2obj,e.options);else{var o=new pt(r.pp),i=new pt(.05*3,.05*3);a=new wt(o,o).extend(i,i)}l.push(a)})),n.sGroupForest.children.get(t.id).forEach((function(t){var n=e.ctab.sgroups.get(t).visel.boundingBox;n=n.translate((e.options.offset||new pt).negated()).transform(ba.scaled2obj,e.options),l.push(n)})),l.forEach((function(t){var e=null;[t.p0.x,t.p1.x].forEach((function(n){[t.p0.y,t.p1.y].forEach((function(t){var r=new pt(n,t),a=new pt(pt.dot(r,s),pt.dot(r,s.rotateSC(1,0)));e=null===e?new wt(a,a):e.include(a)}))})),c=null===c?e:wt.union(c,e)}));var u=new pt(.2,.4);null!==c&&(c=c.extend(u,u)),t.bracketBox=c}Za.prototype=new wa,Za.isSelectable=function(){return!1},Za.prototype.draw=function(t,e){var n=t.render,r=n.paper.set(),a=[],o=new yt(e.atoms);Ct.getCrossBonds([],a,t.molecule,o),eo(e,n,t.molecule,a);var i=e.bracketBox,s=e.bracketDir;switch(e.areas=[i],e.type){case"MUL":Qa(r,n,e,a,o,i,s,e.data.mul);break;case"SRU":var c=e.data.connectivity||"eu";"ht"===c&&(c=""),Qa(r,n,e,a,o,i,s,e.data.subscript||"n",c);break;case"SUP":Qa(r,n,e,a,o,i,s,e.data.name,null,{"font-style":"italic"});break;case"GEN":Qa(r,n,e,a,o,i,s);break;case"DAT":r=function(t,e){var n=t.render;eo(e,n,t.molecule),e.areas=e.bracketBox?[e.bracketBox]:[],null===e.pp&&(e.pp=function(t,e){for(var n=e.bracketBox.p1.add(new pt(.5,.5)),r=Array.from(t.molecule.sgroups.values()),a=0;a<t.molecule.sgroups.size&&to(r,n);++a)n=n.add(new pt(0,.5));return n}(t,e));return e.data.attached?function(t,e){var n=t.render,r=n.options,a=n.paper,o=a.set();return Ct.getAtoms(t,e).forEach((function(i){var s=t.atoms.get(i),c=ba.obj2scaled(s.a.pp,r),l=s.visel.boundingBox;null!==l&&(c.x=Math.max(c.x,l.p1.x)),c.x+=r.lineWidth;var u=Ja(a,c,e,r),p=va.relBox(u.getBBox());u.translateAbs(.5*p.width,-.3*p.height),o.push(u);var d=wt.fromRelBox(va.relBox(u.getBBox()));d=d.transform(ba.scaled2obj,n.options),e.areas.push(d)})),o}(t,e):function(t,e){var n=t.render,r=n.options,a=n.paper,o=a.set(),i=e.pp.scaled(r.scale),s=Ja(a,i,e,r),c=va.relBox(s.getBBox());s.translateAbs(.5*c.width,-.5*c.height),o.push(s);var l=wt.fromRelBox(va.relBox(s.getBBox()));e.dataArea=l.transform(ba.scaled2obj,n.options),t.sgroupData.has(e.id)||t.sgroupData.set(e.id,new $a(e));return o}(t,e)}(t,e)}return r},Za.prototype.drawHighlight=function(t){var e=t.options,n=t.paper,r=this.item,a=r.bracketBox.transform(ba.obj2scaled,e),o=e.lineWidth,i=new pt(4*o,6*o);a=a.extend(i,i);var s=r.bracketDir,c=s.rotateSC(1,0),l=pt.lc2(s,a.p0.x,c,a.p0.y),u=pt.lc2(s,a.p0.x,c,a.p1.y),p=pt.lc2(s,a.p1.x,c,a.p0.y),d=pt.lc2(s,a.p1.x,c,a.p1.y),h=n.set();r.highlighting=n.path("M{0},{1}L{2},{3}L{4},{5}L{6},{7}L{0},{1}",Xa(l.x),Xa(l.y),Xa(u.x),Xa(u.y),Xa(d.x),Xa(d.y),Xa(p.x),Xa(p.y)).attr(e.highlightStyle),h.push(r.highlighting),Ct.getAtoms(t.ctab.molecule,r).forEach((function(e){h.push(t.ctab.atoms.get(e).makeHighlightPlate(t))}),this),Ct.getBonds(t.ctab.molecule,r).forEach((function(e){h.push(t.ctab.bonds.get(e).makeHighlightPlate(t))}),this),t.ctab.addReObjectPath("highlighting",this.visel,h)},Za.prototype.show=function(t){var e=t.render,n=this.item;if("MRV_IMPLICIT_H"!==n.data.fieldName){var r=e.ctab,a=this.draw(r,n);t.addReObjectPath("data",this.visel,a,null,!0),this.setHighlight(this.highlight,e)}};var no=va.tfx;function ro(t){this.loop=t,this.visel=new ya("loop"),this.centre=new pt,this.radius=new pt}ro.prototype=new wa,ro.isSelectable=function(){return!1},ro.prototype.show=function(t,e,n){var r=this,a=t.render.paper,o=t.molecule,i=this.loop;this.centre=new pt,i.hbs.forEach((function(e){var a=o.halfBonds.get(e),s=t.bonds.get(a.bid),c=ba.obj2scaled(t.atoms.get(a.begin).a.pp,n);s.b.type!==At.PATTERN.TYPE.AROMATIC&&(i.aromatic=!1),r.centre.add_(c)})),i.convex=!0;for(var s=0;s<this.loop.hbs.length;++s){var c=o.halfBonds.get(i.hbs[s]),l=o.halfBonds.get(i.hbs[(s+1)%i.hbs.length]),u=Math.atan2(pt.cross(c.dir,l.dir),pt.dot(c.dir,l.dir));u>0&&(i.convex=!1)}if(this.centre=this.centre.scaled(1/i.hbs.length),this.radius=-1,i.hbs.forEach((function(e){var a=o.halfBonds.get(e),i=ba.obj2scaled(t.atoms.get(a.begin).a.pp,n),s=ba.obj2scaled(t.atoms.get(a.end).a.pp,n),c=pt.diff(s,i).rotateSC(1,0).normalized(),l=pt.dot(pt.diff(i,r.centre),c);r.radius=r.radius<0?l:Math.min(r.radius,l)})),this.radius*=.7,i.aromatic){var p=null;if(i.convex&&n.aromaticCircle)p=a.circle(this.centre.x,this.centre.y,this.radius).attr({stroke:"#000","stroke-width":n.lineattr["stroke-width"]});else{var d="";for(s=0;s<i.hbs.length;++s){c=o.halfBonds.get(i.hbs[s]),l=o.halfBonds.get(i.hbs[(s+1)%i.hbs.length]),u=Math.atan2(pt.cross(c.dir,l.dir),pt.dot(c.dir,l.dir));var h=(Math.PI-u)/2,f=l.dir.rotate(h),m=ba.obj2scaled(t.atoms.get(l.begin).a.pp,n),g=Math.sin(h);Math.abs(g)<.1&&(g=.1*g/Math.abs(g));var b=n.bondSpace/g,v=m.addScaled(f,-b);d+=0===s?"M":"L",d+=no(v.x)+","+no(v.y)}d+="Z",p=a.path(d).attr({stroke:"#000","stroke-width":n.lineattr["stroke-width"],"stroke-dasharray":"- "})}t.addReObjectPath("data",this.visel,p,null,!0)}},ro.prototype.isValid=function(t,e){var n=t.halfBonds;return this.loop.hbs.every((function(t){return n.has(t)&&n.get(t).loop===e}))};var ao=va.tfx;function oo(t){this.init("simpleObject"),this.item=t}function io(t,e,n,r){var a=null;switch(t){case"circle":a=Ta.circle(e,n,r);break;case"rectangle":a=Ta.rectangle(e,n,r);break;case"line":a=Ta.line(e,n,r);break;default:throw new Error("Unsupported shape type")}return a}oo.prototype=new wa,oo.isSelectable=function(){return!0},oo.prototype.calcDistance=function(t,e){var n,r=new pt(t.x,t.y),a=null,o=this.item,i=o.mode,s=o.pos;switch(i){case"circle":var c=pt.dist(r,s[0]),l=pt.dist(s[0],s[1]);a=Math.max(c,l)-Math.min(c,l);break;case"rectangle":var u=Math.min(s[0].x,s[1].x),p=Math.min(s[0].y,s[1].y),d=Math.max(s[0].x,s[1].x),h=Math.max(s[0].y,s[1].y),f=[];r.x>=u&&r.x<=d&&(r.y<p?f.push(p-r.y):r.y>h?f.push(r.y-h):f.push(r.y-p,h-r.y)),r.x<u&&r.y<p&&f.push(pt.dist(new pt(u,p),r)),r.x>d&&r.y>h&&f.push(pt.dist(new pt(d,h),r)),r.x<u&&r.y>h&&f.push(pt.dist(new pt(u,h),r)),r.x>d&&r.y<p&&f.push(pt.dist(new pt(d,p),r)),r.y>=p&&r.y<=h&&(r.x<u?f.push(u-r.x):r.x>d?f.push(r.x-d):f.push(r.x-u,d-r.x)),a=Math.min.apply(Math,f);break;case"line":if((r.x<Math.min(s[0].x,s[1].x)||r.x>Math.max(s[0].x,s[1].x))&&(r.y<Math.min(s[0].y,s[1].y)||r.y>Math.max(s[0].y,s[1].y)))a=Math.min(pt.dist(s[0],r),pt.dist(s[1],r));else{var m=pt.dist(s[0],s[1]),g=pt.dist(s[0],r),b=pt.dist(s[1],r),v=(m+g+b)/2;a=2/m*Math.sqrt(v*(v-m)*(v-g)*(v-b))}break;default:throw new Error("Unsupported shape type")}return{minDist:a,refPoint:(n=this.getReferencePointDistance(t)).minDist<=8/e?n.refPoint:null}},oo.prototype.getReferencePointDistance=function(t){var e=[];return this.getReferencePoints().forEach((function(n){e.push({minDist:Math.abs(pt.dist(t,n)),refPoint:n})})),e.reduce((function(t,e){return t&&t.minDist<e.minDist?t:e}),null)},oo.prototype.getReferencePoints=function(){var t=[];switch(this.item.mode){case"circle":var e=this.item.pos[0],n=pt.dist(this.item.pos[0],this.item.pos[1]);t.push(new pt(e.x-n,e.y),new pt(e.x,e.y-n),new pt(e.x+n,e.y),new pt(e.x,e.y+n));break;case"rectangle":var r=new pt(ao(Math.min(this.item.pos[0].x,this.item.pos[1].x)),ao(Math.min(this.item.pos[0].y,this.item.pos[1].y))),a=Math.abs(pt.diff(this.item.pos[0],this.item.pos[1]).x),o=Math.abs(pt.diff(this.item.pos[0],this.item.pos[1]).y);t.push(r,new pt(r.x+.5*a,r.y),new pt(r.x+a,r.y),new pt(r.x+a,r.y+.5*o),new pt(r.x+a,r.y+o),new pt(r.x+.5*a,r.y+o),new pt(r.x,r.y+o),new pt(r.x,r.y+.5*o));break;case"line":this.item.pos.forEach((function(e){return t.push(e)}));break;default:throw new Error("Unsupported shape type")}return t},oo.prototype.highlightPath=function(t){var e=[];this.item.pos.forEach((function(n,r){e[r]=ba.obj2scaled(n,t.options)}));var n=t.options.scale,r=[];switch(this.item.mode){case"circle":var a=pt.dist(e[0],e[1]);r.push(t.paper.circle(e[0].x,e[0].y,a+n/8),t.paper.circle(e[0].x,e[0].y,a-n/8));break;case"rectangle":r.push(t.paper.rect(ao(Math.min(e[0].x,e[1].x)-n/8),ao(Math.min(e[0].y,e[1].y)-n/8),ao(Math.max(e[0].x,e[1].x)-Math.min(e[0].x,e[1].x)+n/4),ao(Math.max(e[0].y,e[1].y)-Math.min(e[0].y,e[1].y)+n/4))),r.push(t.paper.rect(ao(Math.min(e[0].x,e[1].x)+n/8),ao(Math.min(e[0].y,e[1].y)+n/8),ao(Math.max(e[0].x,e[1].x)-Math.min(e[0].x,e[1].x)-n/4),ao(Math.max(e[0].y,e[1].y)-Math.min(e[0].y,e[1].y)-n/4)));break;case"line":var o=[],i=Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x)),s={x:0,y:0},c={x:0,y:0},l=e[0].x>e[1].x?-1:1;s.x=e[0].x-l*(n/8*Math.cos(i)),s.y=e[0].y-l*(n/8*Math.sin(i)),c.x=e[1].x+l*(n/8*Math.cos(i)),c.y=e[1].y+l*(n/8*Math.sin(i)),o.push("M",s.x+l*n/8*Math.sin(i),s.y-l*n/8*Math.cos(i)),o.push("L",c.x+l*n/8*Math.sin(i),c.y-l*n/8*Math.cos(i)),o.push("L",c.x-l*n/8*Math.sin(i),c.y+l*n/8*Math.cos(i)),o.push("L",s.x-l*n/8*Math.sin(i),s.y+l*n/8*Math.cos(i)),o.push("L",s.x+l*n/8*Math.sin(i),s.y-l*n/8*Math.cos(i)),r.push(t.paper.path(o));break;default:throw new Error("Unsupported shape type")}var u=r.map((function(t){return{path:t,stylesApplied:!1}}));return this.getReferencePoints().forEach((function(e){var r=ba.obj2scaled(e,t.options);u.push({path:t.paper.circle(r.x,r.y,n/8).attr({fill:"black"}),stylesApplied:!0})})),u},oo.prototype.drawHighlight=function(t){var e=this.highlightPath(t).map((function(e){return e.stylesApplied?e.path:e.path.attr(t.options.highlightStyle)}));return t.ctab.addReObjectPath("highlighting",this.visel,e),e},oo.prototype.makeSelectionPlate=function(t,e,n){var r=this.item.pos.map((function(e){return ba.obj2scaled(e,t.render.options)||new pt}));return io(this.item.mode,e,r).attr(n.highlightStyleSimpleObject)},oo.prototype.show=function(t,e,n){var r=t.render,a=this.item.pos.map((function(t,e){return ba.obj2scaled(t,n)||new pt})),o=io(this.item.mode,r.paper,a,n),i=n.offset;null!=i&&o.translateAbs(i.x,i.y),this.visel.add(o,wt.fromRelBox(va.relBox(o.getBBox())))};var so={background:0,selectionPlate:1,highlighting:2,warnings:3,data:4,indices:5};function co(t,e){var n=this;this.render=e,this.atoms=new Map,this.bonds=new Map,this.reloops=new Map,this.rxnPluses=new Map,this.rxnArrows=new Map,this.frags=new mt,this.rgroups=new mt,this.sgroups=new Map,this.sgroupData=new Map,this.enhancedFlags=new Map,this.simpleObjects=new Map,this.molecule=t||new Nt,this.initialized=!1,this.layers=[],this.initLayers(),this.connectedComponents=new mt,this.ccFragmentType=new mt,this.clearMarks(),this.structChanged=!1,t.atoms.forEach((function(t,e){n.atoms.set(e,new Ca(t))})),t.bonds.forEach((function(t,e){n.bonds.set(e,new Ma(t))})),t.loops.forEach((function(t,e){n.reloops.set(e,new ro(t))})),t.rxnPluses.forEach((function(t,e){n.rxnPluses.set(e,new Fa(t))})),t.rxnArrows.forEach((function(t,e){n.rxnArrows.set(e,new Ga(t))})),t.simpleObjects.forEach((function(t,e){n.simpleObjects.set(e,new oo(t))})),t.frags.forEach((function(e,r){n.frags.set(r,new Ua(e));var a=t.getFragment(r).getCoordBoundingBox();e&&n.enhancedFlags.set(r,new Ka(e.enhancedStereoFlag||null,new pt(a.max.x,a.min.y-1)))})),t.rgroups.forEach((function(t,e){n.rgroups.set(e,new Ya(t))})),t.sgroups.forEach((function(t,e){n.sgroups.set(e,new Za(t)),"DAT"!==t.type||t.data.attached||n.sgroupData.set(e,new $a(t))}))}function lo(t,e){if("set"==t.type)for(var n=0;n<t.length;++n)lo(t[n],e);else"undefined"!==typeof t.attrs&&("font-size"in t.attrs?t.attr("font-size",t.attrs["font-size"]*e):"stroke-width"in t.attrs&&t.attr("stroke-width",t.attrs["stroke-width"]*e)),t.scale(e,e,0,0)}co.prototype.connectedComponentRemoveAtom=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!((e=e||this.atoms.get(t)).component<0)){var n=this.connectedComponents.get(e.component);n.delete(t),n.size<1&&this.connectedComponents.delete(e.component),e.component=-1}},co.prototype.clearConnectedComponents=function(){this.connectedComponents.clear(),this.atoms.forEach((function(t){t.component=-1}))},co.prototype.getConnectedComponent=function(t,e){for(var n=this,r=Array.isArray(t)?Array.from(t):[t],a=new yt;r.length>0;){var o=r.pop();a.add(o);var i=this.atoms.get(o);i.component>=0&&e.add(i.component),i.a.neighbors.forEach((function(t){var e=n.molecule.halfBonds.get(t).end;a.has(e)||r.push(e)}))}return a},co.prototype.addConnectedComponent=function(t){var e=this,n=this.connectedComponents.add(t),r=new yt,a=this.getConnectedComponent(Array.from(t),r);r.delete(n);var o=-1;return a.forEach((function(t){var r=e.atoms.get(t);r.component=n,-1!==r.a.rxnFragmentType&&(o=r.a.rxnFragmentType)})),this.ccFragmentType.set(n,o),n},co.prototype.removeConnectedComponent=function(t){var e=this;return this.connectedComponents.get(t).forEach((function(t){e.atoms.get(t).component=-1})),this.connectedComponents.delete(t)},co.prototype.assignConnectedComponents=function(){var t=this;this.atoms.forEach((function(e,n){if(!(e.component>=0)){var r=new yt,a=t.getConnectedComponent(n,r);r.forEach((function(e){t.removeConnectedComponent(e)})),t.addConnectedComponent(a)}}))},co.prototype.initLayers=function(){for(var t in so)this.layers[so[t]]=this.render.paper.rect(0,0,10,10).attr({class:t+"Layer",fill:"#000",opacity:"0.0"}).toFront()},co.prototype.addReObjectPath=function(t,e,n,r,a){var o=this;n&&this.layers[so[t]].node.parentNode&&(Array.isArray(n)?n:[n]).forEach((function(n){var i=o.render.options.offset,s=a?wt.fromRelBox(va.relBox(n.getBBox())):null,c=r&&s?s.translate(r.negated()):null;null!==i&&(n.translateAbs(i.x,i.y),s=s?s.translate(i):null),e.add(n,s,c),n.insertBefore(o.layers[so[t]])}))},co.prototype.clearMarks=function(){var t=this;Object.keys(co.maps).forEach((function(e){t[e+"Changed"]=new Map})),this.structChanged=!1},co.prototype.markItemRemoved=function(){this.structChanged=!0},co.prototype.markBond=function(t,e){this.markItem("bonds",t,e)},co.prototype.markAtom=function(t,e){this.markItem("atoms",t,e)},co.prototype.markItem=function(t,e,n){var r=this[t+"Changed"],a=r.has(e)?Math.max(n,r.get(e)):n;r.set(e,a),this[t].has(e)&&this.clearVisel(this[t].get(e).visel)},co.prototype.clearVisel=function(t){t.paths.forEach((function(t){t.remove()})),t.clear()},co.prototype.eachItem=function(t){var e=this;Object.keys(co.maps).forEach((function(n){e[n].forEach(t)}))},co.prototype.getVBoxObj=function(t){var e=this;(function(t){return!t||!Object.keys(co.maps).some((function(e){return t[e]&&t[e].length>0}))})(t=t||{})&&Object.keys(co.maps).forEach((function(n){t[n]=Array.from(e[n].keys())}));var n=null;return Object.keys(co.maps).forEach((function(r){t[r]&&t[r].forEach((function(t){var a=e[r].get(t).getVBoxObj(e.render);a&&(n=n?wt.union(n,a):a.clone())}))})),n=n||new wt(0,0,0,0)},co.prototype.translate=function(t){this.eachItem((function(e){return e.visel.translate(t)}))},co.prototype.scale=function(t){this.eachItem((function(e){return function(t,e){for(var n=0;n<t.paths.length;++n)lo(t.paths[n],e)}(e.visel,t)}))},co.prototype.clearVisels=function(){var t=this;this.eachItem((function(e){return t.clearVisel(e.visel)}))},co.prototype.update=function(t){var e=this;t=t||!this.initialized,Object.keys(co.maps).forEach((function(n){var r=e[n+"Changed"];t?e[n].forEach((function(t,e){return r.set(e,1)})):r.forEach((function(t,a){e[n].has(a)||r.delete(a)}))})),this.atomsChanged.forEach((function(t,n){return e.connectedComponentRemoveAtom(n)})),this.frags.filter((function(t,n){return!n.calcBBox(e.render.ctab,t,e.render)})).forEach((function(t,n){e.clearVisel(t.visel),e.frags.delete(n),e.molecule.frags.delete(n)})),Object.keys(co.maps).forEach((function(t){var n=e[t+"Changed"];n.forEach((function(r,a){e.clearVisel(e[t].get(a).visel),e.structChanged|=n.get(a)>0}))})),this.sgroups.forEach((function(t){e.clearVisel(t.visel),t.highlighting=null,t.selectionPlate=null})),this.frags.forEach((function(t){e.clearVisel(t.visel)})),this.rgroups.forEach((function(t){e.clearVisel(t.visel)})),t&&(this.clearConnectedComponents(),this.molecule.initHalfBonds(),this.molecule.initNeighbors());var n=Array.from(this.atomsChanged.keys());this.molecule.updateHalfBonds(n),this.molecule.sortNeighbors(n),this.assignConnectedComponents(),this.initialized=!0,this.verifyLoops();var r=t||this.structChanged;return r&&this.updateLoops(),this.setImplicitHydrogen(),this.showLabels(),this.showBonds(),r&&this.showLoops(),this.showReactionSymbols(),this.showSGroups(),this.showFragments(),this.showRGroups(),this.showEnhancedFlags(),this.showSimpleObjects(),this.clearMarks(),!0},co.prototype.updateLoops=function(){var t=this;this.reloops.forEach((function(e){t.clearVisel(e.visel)}));var e=this.molecule.findLoops();e.bondsToMark.forEach((function(e){t.markBond(e,1)})),e.newLoops.forEach((function(e){t.reloops.set(e,new ro(t.molecule.loops.get(e)))}))},co.prototype.showLoops=function(){var t=this,e=this.render.options;this.reloops.forEach((function(n,r){n.show(t,r,e)}))},co.prototype.showSimpleObjects=function(){var t=this,e=this.render.options;this.simpleObjectsChanged.forEach((function(n,r){t.simpleObjects.get(r).show(t,r,e)}))},co.prototype.showReactionSymbols=function(){var t=this,e=this.render.options;this.rxnArrowsChanged.forEach((function(n,r){t.rxnArrows.get(r).show(t,r,e)})),this.rxnPlusesChanged.forEach((function(n,r){t.rxnPluses.get(r).show(t,r,e)}))},co.prototype.showSGroups=function(){var t=this,e=this.render.options;this.molecule.sGroupForest.getSGroupsBFS().reverse().forEach((function(n){t.sgroups.get(n).show(t,n,e)}))},co.prototype.showFragments=function(){var t=this;this.frags.forEach((function(e,n){var r=e.draw(t.render,n);r&&t.addReObjectPath("data",e.visel,r,null,!0)}))},co.prototype.showRGroups=function(){var t=this,e=this.render.options;this.rgroups.forEach((function(n,r){n.show(t,r,e)}))},co.prototype.setImplicitHydrogen=function(){this.molecule.setImplicitHydrogen(Array.from(this.atomsChanged.keys()))},co.prototype.loopRemove=function(t){var e=this;if(this.reloops.has(t)){var n=this.reloops.get(t);this.clearVisel(n.visel);var r=[];n.loop.hbs.forEach((function(t){if(e.molecule.halfBonds.has(t)){var n=e.molecule.halfBonds.get(t);n.loop=-1,e.markBond(n.bid,1),e.markAtom(n.begin,1),r.push(n.bid)}})),this.reloops.delete(t),this.molecule.loops.delete(t)}},co.prototype.verifyLoops=function(){var t=this;this.reloops.forEach((function(e,n){e.isValid(t.molecule,n)||t.loopRemove(n)}))},co.prototype.showLabels=function(){var t=this,e=this.render.options;this.atomsChanged.forEach((function(n,r){t.atoms.get(r).show(t,r,e)}))},co.prototype.showEnhancedFlags=function(){var t=this,e=this.render.options;this.enhancedFlagsChanged.forEach((function(n,r){t.enhancedFlags.get(r).show(t,r,e)}))},co.prototype.showBonds=function(){var t=this,e=this.render.options;this.bondsChanged.forEach((function(n,r){t.bonds.get(r).show(t,r,e)}))},co.prototype.setSelection=function(t){var e=this,n=0===arguments.length;Object.keys(co.maps).forEach((function(r){co.maps[r].isSelectable()&&e[r].forEach((function(a,o){var i=n?a.selected:t&&t[r]&&t[r].indexOf(o)>-1;e.showItemSelection(a,i)}))}))},co.prototype.showItemSelection=function(t,e){var n=null!==t.selectionPlate&&!t.selectionPlate.removed;if(t.selected=e,t instanceof $a&&(t.sgroup.selected=e),e){if(!n){var r=this.render,a=r.options,o=r.paper;t.selectionPlate=t.makeSelectionPlate(this,o,a),this.addReObjectPath("selectionPlate",t.visel,t.selectionPlate)}t.selectionPlate&&t.selectionPlate.show()}else n&&t.selectionPlate&&t.selectionPlate.hide()},co.maps={atoms:Ca,bonds:Ma,rxnPluses:Fa,rxnArrows:Ga,frags:Ua,rgroups:Ya,sgroupData:$a,enhancedFlags:Ka,sgroups:Za,reloops:ro,simpleObjects:oo};var uo=Math.PI/12;function po(t,e){var n=pt.diff(e,t);return Math.atan2(n.y,n.x)}function ho(t,e){return e&&(t=po(t,e)),Math.round(t/uo)*uo}function fo(t){var e=Math.round(t/Math.PI*180);return e>180?e-=360:e<=-180&&(e+=360),e}var mo={calcAngle:po,fracAngle:ho,calcNewAtomPos:function(t,e,n){var r=new pt(1,0).rotate(n?po(t,e):ho(t,e));return r.add_(t),r},degrees:fo,setFracAngle:function(t){uo=Math.PI/180*t},mergeBondsParams:function(t,e,n,r){var a=t.atoms.get(e.begin),o=n.atoms.get(r.begin),i=t.atoms.get(e.end),s=n.atoms.get(r.end),c=po(a.pp,i.pp)-po(o.pp,s.pp),l=Math.abs(fo(c)%180),u=pt.dist(a.pp,i.pp)/pt.dist(o.pp,s.pp);return{merged:!Object(Y.inRange)(l,10,170)&&Object(Y.inRange)(u,.8,1.2),angle:c,scale:u,cross:Math.abs(fo(c))>90}}};var go={debug:!1,logcnt:0,logmouse:!1,hl:!1};function bo(t,e){var n=t.clientWidth-10,r=t.clientHeight-10;n=n>0?n:0,r=r>0?r:0,this.userOpts=e,this.clientArea=t,this.paper=new W.a(t,n,r),this.sz=pt.ZERO,this.ctab=new co(new Nt,this),this.options=function(t){var e=t.scale||100;t.rotationStep&&mo.setFracAngle(t.rotationStep);var n=Math.ceil(e/6*1.9),r=Math.ceil(.7*n),a={showAtomIds:!1,showBondIds:!1,showHalfBondIds:!1,showLoopIds:!1,showValenceWarnings:!0,autoScale:!1,autoScaleMargin:0,maxBondLength:0,atomColoring:!0,hideImplicitHydrogen:!1,hideTerminalLabels:!1,carbonExplicitly:!1,showCharge:!0,showHydrogenLabels:"on",showValence:!0,aromaticCircle:!0,scale:e,zoom:1,offset:new pt,lineWidth:e/20,bondSpace:t.doubleBondWidth||e/7,stereoBond:t.stereoBondWidth||e/7,subFontSize:r,font:"30px Arial",fontsz:n,fontszsub:r,fontRLabel:1.2*n,fontRLogic:.7*n,lineattr:{stroke:"#000","stroke-width":t.bondThickness||e/20,"stroke-linecap":"round","stroke-linejoin":"round"},selectionStyle:{fill:"#7f7",stroke:"none"},highlightStyle:{stroke:"#0c0","stroke-width":.6*e/20},sgroupBracketStyle:{stroke:"darkgray","stroke-width":.5*e/20},lassoStyle:{stroke:"gray","stroke-width":"1px"},highlightStyleSimpleObject:{stroke:"#0c0","stroke-width":e/4,"stroke-linecap":"round","stroke-opacity":.6},atomSelectionPlateRadius:1.2*n};return Object.assign({},a,t)}(this.userOpts)}function vo(){this.type="OpBase",this.execute=function(){throw new Error("Operation.execute() is not implemented")},this.invert=function(){throw new Error("Operation.invert() is not implemented")},this.perform=function(t){return this.execute(t),this._inverted||(this._inverted=this.invert(),this._inverted._inverted=this),this._inverted},this.isDummy=function(t){return!!this._isDummy&&this._isDummy(t)}}function yo(t,e,n){var r=t.atoms.get(e);t.markAtom(e,n?1:0);var a=t.molecule.halfBonds;r.a.neighbors.forEach((function(e){if(a.has(e)){var r=a.get(e);t.markBond(r.bid,1),t.markAtom(r.end,0),n&&wo(t,r.bid)}}))}function wo(t,e){var n=t.bonds.get(e),r=t.molecule.halfBonds.get(n.b.hb1).loop,a=t.molecule.halfBonds.get(n.b.hb2).loop;r>=0&&t.loopRemove(r),a>=0&&t.loopRemove(a)}function Eo(t,e){var n=t.bonds.get(e);wo(t,e),yo(t,n.b.begin,0),yo(t,n.b.end,0)}function Oo(t,e,n,r){"atoms"===e?yo(t,n,r):"bonds"===e?(Eo(t,n),r>0&&wo(t,n)):t.markItem(e,n,r)}function xo(t){this.frid="undefined"===typeof t?null:t,this.execute=function(t){var e=t.molecule,n=new Pt;null===this.frid?this.frid=e.frags.add(n):e.frags.set(this.frid,n),t.frags.set(this.frid,new Ua(n)),t.enhancedFlags.set(this.frid,new Ka(null,null))},this.invert=function(){return new So(this.frid)}}function So(t){this.frid=t,this.execute=function(t){var e=t.molecule;e.frags.get(this.frid)&&(Oo(t,"frags",this.frid,1),t.frags.delete(this.frid),e.frags.delete(this.frid),t.clearVisel(t.enhancedFlags.get(this.frid).visel),t.enhancedFlags.delete(this.frid))},this.invert=function(){return new xo(this.frid)}}function Ao(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.frid=t,this.flag=e,this.invert_flag=null,this.execute=function(t){var e=t.molecule,n=e.frags.get(this.frid);this.invert_flag||(this.invert_flag=n.enhancedStereoFlag),n.updateStereoFlag(e,this.flag),Co(t,this.frid,n.enhancedStereoFlag)},this.invert=function(){var t=new Ao(this.frid);return t.flag=this.invert_flag,t.invert_flag=this.flag,t}}function Po(t,e){this.data={frid:t,aid:e},this.execute=function(t){var e=t.molecule.frags.get(this.data.frid);e.updateStereoAtom(t.molecule,this.data.aid,!0),Co(t,this.data.frid,e.enhancedStereoFlag)},this.invert=function(){return new To(this.data.frid,this.data.aid)}}function To(t,e){this.data={frid:t,aid:e},this.execute=function(t){var e=t.molecule.frags.get(this.data.frid);e.updateStereoAtom(t.molecule,this.data.aid,!1),Co(t,this.data.frid,e.enhancedStereoFlag)},this.invert=function(){return new Po(this.data.frid,this.data.aid)}}function Co(t,e,n){var r=t.enhancedFlags.get(e);r.flag!==n&&(r.flag=n,Oo(t,"enhancedFlags",e,1))}function Ro(t,e){this.data={frid:t,p:e},this.execute=function(t){if(!this.data.p){var e=t.molecule.getFragment(this.data.frid).getCoordBoundingBox();this.data.p=new pt(e.max.x,e.min.y-1)}var n=t.enhancedFlags.get(this.data.frid);(null===n||void 0===n?void 0:n.pp)&&n.pp.add_(this.data.p),this.data.p=this.data.p.negated(),Oo(t,"enhancedFlags",this.data.frid,1)},this.invert=function(){var t=new Ro;return t.data=this.data,t}}go.logMethod=function(){},bo.prototype.view2obj=function(t,e){var n=this.scrollPos();return this.useOldZoom||(t=t.scaled(1/this.options.zoom),n=n.scaled(1/this.options.zoom)),t=e?t:t.add(n).sub(this.options.offset),ba.scaled2obj(t,this.options)},bo.prototype.obj2view=function(t,e){var n=ba.obj2scaled(t,this.options);return n=e?n:n.add(this.options.offset).sub(this.scrollPos().scaled(1/this.options.zoom)),this.useOldZoom||(n=n.scaled(this.options.zoom)),n},bo.prototype.scrollPos=function(){return new pt(this.clientArea.scrollLeft,this.clientArea.scrollTop)},bo.prototype.page2obj=function(t){var e=function(t){var e=0,n=0;if(t.parentNode)do{e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent}while(t);return{left:n,top:e}}(this.clientArea),n=new pt(t.pageX-e.left,t.pageY-e.top);return this.view2obj(n)},bo.prototype.setPaperSize=function(t){go.logMethod("setPaperSize"),this.sz=t,this.paper.setSize(t.x*this.options.zoom,t.y*this.options.zoom),this.setViewBox(this.options.zoom)},bo.prototype.setOffset=function(t){go.logMethod("setOffset");var e=new pt(t.x-this.options.offset.x,t.y-this.options.offset.y);this.clientArea.scrollLeft+=e.x,this.clientArea.scrollTop+=e.y,this.options.offset=t},bo.prototype.setZoom=function(t){this.options.zoom=t,this.paper.setSize(this.sz.x*t,this.sz.y*t),this.setViewBox(t)},bo.prototype.setScrollOffset=function(t,e){var n=this.clientArea,r=n.clientWidth,a=n.clientHeight,o=function(t,e,n,r,a){var o=e<0?-e:0,i=n<0?-n:0;return t.x<r&&(o+=r-t.x),t.y<a&&(i+=a-t.y),new pt(o,i)}(this.sz.scaled(this.options.zoom),t,e,r+t,a+e).scaled(1/this.options.zoom);if(o.x>0||o.y>0){this.setPaperSize(this.sz.add(o));var i=new pt(t<0?-t:0,e<0?-e:0).scaled(1/this.options.zoom);(i.x>0||i.y>0)&&(this.ctab.translate(i),this.setOffset(this.options.offset.add(i)))}n.scrollLeft=t,n.scrollTop=e,this.update(!1)},bo.prototype.setScale=function(t){this.options.offset&&(this.options.offset=this.options.offset.scaled(1/t).scaled(t)),this.userOpts.scale*=t,this.options=null,this.update(!0)},bo.prototype.setViewBox=function(t){this.useOldZoom?this.setScale(t):this.paper.canvas.setAttribute("viewBox","0 0 "+this.sz.x+" "+this.sz.y)},bo.prototype.setMolecule=function(t){go.logMethod("setMolecule"),this.paper.clear(),this.ctab=new co(t,this),this.options.offset=new pt,this.update(!1)},bo.prototype.update=function(t,e){e=e||new pt(this.clientArea.clientWidth||100,this.clientArea.clientHeight||100);var n=this.ctab.update(t);if(this.ctab.setSelection(),n){var r=this.options.scale,a=this.ctab.getVBoxObj().transform(ba.obj2scaled,this.options).translate(this.options.offset||new pt);if(this.options.autoScale){var o=a.sz(),i=this.options.autoScaleMargin,s=new pt(i,i),c=e;if(c.x<2*i+1||c.y<2*i+1)throw new Error("View box too small for the given margin");var l=Math.max(o.x/(c.x-2*i),o.y/(c.y-2*i));this.options.maxBondLength/l>1&&(l=1);var u=o.add(s.scaled(2*l));this.paper.setViewBox(a.pos().x-i*l-(c.x*l-u.x)/2,a.pos().y-i*l-(c.y*l-u.y)/2,c.x*l,c.y*l)}else{var p=pt.UNIT.scaled(r),d=a.sz().length()>0?a.extend(p,p):a,h=new wt(this.scrollPos(),e.scaled(1/this.options.zoom).sub(pt.UNIT.scaled(20))),f=wt.union(h,d);this.oldCb||(this.oldCb=new wt);var m=f.sz().floor(),g=this.oldCb.p0.sub(f.p0).ceil();this.oldBb=a,this.sz&&m.x==this.sz.x&&m.y==this.sz.y||this.setPaperSize(m),this.options.offset=this.options.offset||new pt,0==g.x&&0==g.y||(this.setOffset(this.options.offset.add(g)),this.ctab.translate(g))}}},xo.prototype=new vo,So.prototype=new vo,Ao.prototype=new vo,Po.prototype=new vo,To.prototype=new vo,Ro.prototype=new vo;var jo=va.tfx;function No(t,e){this.data={atom:t,pos:e,aid:null},this.execute=function(t){var e=this,n=t.molecule,r={};this.data.atom&&Object.keys(this.data.atom).forEach((function(t){r[t]=e.data.atom[t]})),r.label=r.label||"C","number"!==typeof this.data.aid?this.data.aid=n.atoms.add(new Ot(r)):n.atoms.set(this.data.aid,new Ot(r));var a=new Ca(n.atoms.get(this.data.aid));a.component=t.connectedComponents.add(new yt([this.data.aid])),t.atoms.set(this.data.aid,a),t.markAtom(this.data.aid,1),n.atomSetPos(this.data.aid,new pt(this.data.pos));var o=n.rxnArrows.get(0);o&&(n.atoms.get(this.data.aid).rxnFragmentType=n.defineRxnFragmentTypeForAtomset(new yt([this.data.aid]),o.pp.x))},this.invert=function(){var t=new Mo;return t.data=this.data,t}}function Mo(t){this.data={aid:t,atom:null,pos:null},this.execute=function(t){var e=t.molecule;this.data.atom||(this.data.atom=e.atoms.get(this.data.aid),this.data.pos=this.data.atom.pp);var n=t.atoms.get(this.data.aid),r=t.connectedComponents.get(n.component);r.delete(this.data.aid),0===r.size&&t.connectedComponents.delete(n.component),t.clearVisel(n.visel),t.atoms.delete(this.data.aid),t.markItemRemoved(),e.atoms.delete(this.data.aid)},this.invert=function(){var t=new No;return t.data=this.data,t}}function ko(t,e,n){this.data={aid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.atoms.get(this.data.aid);this.data2||(this.data2={aid:this.data.aid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,yo(t,this.data.aid)},this._isDummy=function(t){return t.molecule.atoms.get(this.data.aid)[this.data.attribute]===this.data.value},this.invert=function(){var t=new ko;return t.data=this.data2,t.data2=this.data,t}}function Bo(t,e,n){this.data={aid:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.aid,r=this.data.d;e.atoms.get(n).pp.add_(r),t.atoms.get(n).visel.translate(ba.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||yo(t,n,1)},this._isDummy=function(){return 0===this.data.d.x&&0===this.data.d.y},this.invert=function(){var t=new Bo;return t.data=this.data,t}}function Lo(t,e){this.data={bid:t,d:e},this.execute=function(t){t.bonds.get(this.data.bid).visel.translate(ba.obj2scaled(this.data.d,t.render.options)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new Lo;return t.data=this.data,t}}function Io(t,e){this.data={id:t,d:e},this.execute=function(t){t.reloops.get(this.data.id)&&t.reloops.get(this.data.id).visel&&t.reloops.get(this.data.id).visel.translate(ba.obj2scaled(this.data.d,t.render.options)),this.data.d=this.data.d.negated()},this.invert=function(){var t=new Io;return t.data=this.data,t}}function Do(t,e){this.type="OpSGroupAtomAdd",this.data={sgid:t,aid:e},this.execute=function(t){var e=t.molecule,n=this.data.aid,r=this.data.sgid,a=e.atoms.get(n);if(e.sgroups.get(r).atoms.indexOf(n)>=0)throw new Error("The same atom cannot be added to an S-group more than once");if(!a)throw new Error("OpSGroupAtomAdd: Atom "+n+" not found");e.atomAddToSGroup(r,n),yo(t,n)},this.invert=function(){var t=new zo;return t.data=this.data,t}}function zo(t,e){this.type="OpSGroupAtomRemove",this.data={sgid:t,aid:e},this.execute=function(t){var e=this.data.aid,n=this.data.sgid,r=t.molecule,a=r.atoms.get(e),o=r.sgroups.get(n);Ct.removeAtom(o,e),a.sgs.delete(n),yo(t,e)},this.invert=function(){var t=new Do;return t.data=this.data,t}}function _o(t,e,n){this.type="OpSGroupAttr",this.data={sgid:t,attr:e,value:n},this.execute=function(t){var e=t.molecule,n=this.data.sgid,r=e.sgroups.get(n);"DAT"===r.type&&t.sgroupData.has(n)&&(t.clearVisel(t.sgroupData.get(n).visel),t.sgroupData.delete(n)),this.data.value=r.setAttr(this.data.attr,this.data.value)},this.invert=function(){var t=new _o;return t.data=this.data,t}}function Ho(t,e,n){this.type="OpSGroupCreate",this.data={sgid:t,type:e,pp:n},this.execute=function(t){var e=t.molecule,n=new Ct(this.data.type),r=this.data.sgid;n.id=r,e.sgroups.set(r,n),this.data.pp&&(e.sgroups.get(r).pp=new pt(this.data.pp)),t.sgroups.set(r,new Za(e.sgroups.get(r))),this.data.sgid=r},this.invert=function(){var t=new Vo;return t.data=this.data,t}}function Vo(t){this.type="OpSGroupDelete",this.data={sgid:t},this.execute=function(t){var e=t.molecule,n=this.data.sgid,r=t.sgroups.get(n);if(this.data.type=r.item.type,this.data.pp=r.item.pp,"DAT"===r.item.type&&t.sgroupData.has(n)&&(t.clearVisel(t.sgroupData.get(n).visel),t.sgroupData.delete(n)),t.clearVisel(r.visel),0!==r.item.atoms.length)throw new Error("S-Group not empty!");t.sgroups.delete(n),e.sgroups.delete(n)},this.invert=function(){var t=new Ho;return t.data=this.data,t}}function Fo(t,e,n){this.type="OpSGroupAddToHierarchy",this.data={sgid:t,parent:e,children:n},this.execute=function(t){var r=t.molecule,a=r.sgroups.get(this.data.sgid),o=r.sGroupForest.insert(a,e,n);this.data.parent=o.parent,this.data.children=o.children},this.invert=function(){var t=new Go;return t.data=this.data,t}}function Go(t){this.type="OpSGroupRemoveFromHierarchy",this.data={sgid:t},this.execute=function(t){var e=t.molecule,n=this.data.sgid;this.data.parent=e.sGroupForest.parent.get(n),this.data.children=e.sGroupForest.children.get(n),e.sGroupForest.remove(n)},this.invert=function(){var t=new Fo;return t.data=this.data,t}}function Uo(t,e,n){this.data={bond:n,begin:t,end:e,bid:null},this.execute=function(t){var e=this,n=t.molecule;if(this.data.begin===this.data.end)throw new Error("Distinct atoms expected");yo(t,this.data.begin,1),yo(t,this.data.end,1);var r={};this.data.bond&&Object.keys(this.data.bond).forEach((function(t){r[t]=e.data.bond[t]})),r.type=r.type||At.PATTERN.TYPE.SINGLE,r.begin=this.data.begin,r.end=this.data.end,"number"!==typeof this.data.bid?this.data.bid=n.bonds.add(new At(r)):n.bonds.set(this.data.bid,new At(r)),n.bondInitHalfBonds(this.data.bid),n.atomAddNeighbor(n.bonds.get(this.data.bid).hb1),n.atomAddNeighbor(n.bonds.get(this.data.bid).hb2),t.bonds.set(this.data.bid,new Ma(n.bonds.get(this.data.bid))),t.markBond(this.data.bid,1)},this.invert=function(){var t=new Wo;return t.data=this.data,t}}function Wo(t){this.data={bid:t,bond:null,begin:null,end:null},this.execute=function(t){var e=t.molecule;this.data.bond||(this.data.bond=e.bonds.get(this.data.bid),this.data.begin=this.data.bond.begin,this.data.end=this.data.bond.end),Eo(t,this.data.bid);var n=t.bonds.get(this.data.bid);[n.b.hb1,n.b.hb2].forEach((function(e){var n=t.molecule.halfBonds.get(e);n.loop>=0&&t.loopRemove(n.loop)}),t),t.clearVisel(n.visel),t.bonds.delete(this.data.bid),t.markItemRemoved();var r=e.bonds.get(this.data.bid);[r.hb1,r.hb2].forEach((function(t){var n=e.halfBonds.get(t),r=e.atoms.get(n.begin),a=r.neighbors.indexOf(t),o=(a+r.neighbors.length-1)%r.neighbors.length,i=(a+1)%r.neighbors.length;e.setHbNext(r.neighbors[o],r.neighbors[i]),r.neighbors.splice(a,1)})),e.halfBonds.delete(r.hb1),e.halfBonds.delete(r.hb2),e.bonds.delete(this.data.bid)},this.invert=function(){var t=new Uo;return t.data=this.data,t}}function Yo(t,e,n){this.data={bid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.bonds.get(this.data.bid);this.data2||(this.data2={bid:this.data.bid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,Eo(t,this.data.bid),"type"===this.data.attribute&&wo(t,this.data.bid)},this._isDummy=function(t){return t.molecule.bonds.get(this.data.bid)[this.data.attribute]===this.data.value},this.invert=function(){var t=new Yo;return t.data=this.data2,t.data2=this.data,t}}function qo(t,e,n){this.data={rgid:t,attribute:e,value:n},this.data2=null,this.execute=function(t){var e=t.molecule.rgroups.get(this.data.rgid);this.data2||(this.data2={rgid:this.data.rgid,attribute:this.data.attribute,value:e[this.data.attribute]}),e[this.data.attribute]=this.data.value,Oo(t,"rgroups",this.data.rgid)},this._isDummy=function(t){return t.molecule.rgroups.get(this.data.rgid)[this.data.attribute]===this.data.value},this.invert=function(){var t=new qo;return t.data=this.data2,t.data2=this.data,t}}function $o(t,e,n){this.type="OpAddOrDeleteRGFragment",this.rgid_new=t,this.rg_new=n,this.rgid_old=null,this.rg_old=null,this.frid=e,this.execute=function(t){var e=t.molecule;if(this.rgid_old=this.rgid_old||Rt.findRGroupByFragment(e.rgroups,this.frid),this.rg_old=this.rgid_old?e.rgroups.get(this.rgid_old):null,this.rg_old&&(this.rg_old.frags.delete(this.frid),t.clearVisel(t.rgroups.get(this.rgid_old).visel),0===this.rg_old.frags.size?(t.rgroups.delete(this.rgid_old),e.rgroups.delete(this.rgid_old),t.markItemRemoved()):t.markItem("rgroups",this.rgid_old,1)),this.rgid_new){var n=e.rgroups.get(this.rgid_new);n?t.markItem("rgroups",this.rgid_new,1):(n=this.rg_new||new Rt,e.rgroups.set(this.rgid_new,n),t.rgroups.set(this.rgid_new,new Ya(n))),n.frags.add(this.frid)}},this.invert=function(){return new $o(this.rgid_old,this.frid,this.rg_old)}}function Ko(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];this.type="OpUpdateIfThenValues",this.rgid_new=t,this.rgid_old=e,this.ifThenHistory=new Map,this.execute=function(t){var e=this,r=t.molecule;r.rgroups.forEach((function(t,a){t.ifthen!==e.rgid_old||n.includes(a)||(t.ifthen=e.rgid_new,e.ifThenHistory.set(a,e.rgid_old),r.rgroups.set(a,t))}))},this.invert=function(){return new Xo(this.rgid_new,this.rgid_old,this.ifThenHistory)}}function Xo(t,e,n){this.type="OpRestoreIfThenValues",this.rgid_new=t,this.rgid_old=e,this.ifThenHistory=n||new Map,this.execute=function(t){var e=t.molecule;this.ifThenHistory.forEach((function(t,n){var r=e.rgroups.get(n);r.ifthen=t,e.rgroups.set(n,r)}))},this.invert=function(){return new Ko(this.rgid_old,this.rgid_new)}}function Zo(t){this.data={pos:t,arid:null},this.execute=function(t){var e=t.molecule;"number"!==typeof this.data.arid?this.data.arid=e.rxnArrows.add(new It):e.rxnArrows.set(this.data.arid,new It),t.rxnArrows.set(this.data.arid,new Ga(e.rxnArrows.get(this.data.arid))),e.rxnArrowSetPos(this.data.arid,new pt(this.data.pos));var n=e.getComponents(),r=n.reactants,a=n.products;r=r.reduce((function(t,e){return t.concat.apply(t,P()(e))}),[]),a=a.reduce((function(t,e){return t.concat.apply(t,P()(e))}),[]),r.forEach((function(t){e.atoms.get(t).rxnFragmentType=1})),a.forEach((function(t){e.atoms.get(t).rxnFragmentType=2})),Oo(t,"rxnArrows",this.data.arid,1)},this.invert=function(){var t=new Qo;return t.data=this.data,t}}function Qo(t){this.data={arid:t,pos:null},this.execute=function(t){var e=t.molecule;this.data.pos||(this.data.pos=e.rxnArrows.get(this.data.arid).pp),t.markItemRemoved(),t.clearVisel(t.rxnArrows.get(this.data.arid).visel),t.rxnArrows.delete(this.data.arid),e.rxnArrows.delete(this.data.arid),e.atoms.forEach((function(t){t.rxnFragmentType=-1}))},this.invert=function(){var t=new Zo;return t.data=this.data,t}}function Jo(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d;e.rxnArrows.get(n).pp.add_(r),t.rxnArrows.get(n).visel.translate(ba.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||Oo(t,"rxnArrows",n,1)},this.invert=function(){var t=new Jo;return t.data=this.data,t}}function ti(t){this.data={plid:null,pos:t},this.execute=function(t){var e=t.molecule;"number"!==typeof this.data.plid?this.data.plid=e.rxnPluses.add(new Bt):e.rxnPluses.set(this.data.plid,new Bt),t.rxnPluses.set(this.data.plid,new Fa(e.rxnPluses.get(this.data.plid))),e.rxnPlusSetPos(this.data.plid,new pt(this.data.pos)),Oo(t,"rxnPluses",this.data.plid,1)},this.invert=function(){var t=new ei;return t.data=this.data,t}}function ei(t){this.data={plid:t,pos:null},this.execute=function(t){var e=t.molecule;this.data.pos||(this.data.pos=e.rxnPluses.get(this.data.plid).pp),t.markItemRemoved(),t.clearVisel(t.rxnPluses.get(this.data.plid).visel),t.rxnPluses.delete(this.data.plid),e.rxnPluses.delete(this.data.plid)},this.invert=function(){var t=new ti;return t.data=this.data,t}}function ni(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d;e.rxnPluses.get(n).pp.add_(r),t.rxnPluses.get(n).visel.translate(ba.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||Oo(t,"rxnPluses",n,1)},this.invert=function(){var t=new ni;return t.data=this.data,t}}function ri(t,e){this.data={id:t,d:e},this.execute=function(t){t.molecule.sgroups.get(this.data.id).pp.add_(this.data.d),this.data.d=this.data.d.negated(),Oo(t,"sgroupData",this.data.id,1)},this.invert=function(){var t=new ri;return t.data=this.data,t}}function ai(t){this.data={struct:t},this.execute=function(t){var e=t.molecule;t.clearVisels(),t.render.setMolecule(this.data.struct),this.data.struct=e},this.invert=function(){var t=new ai;return t.data=this.data,t}}function oi(){this.type="OpAlignDescriptors",this.history={},this.execute=function(t){var e=this,n=Array.from(t.molecule.sgroups.values()).reverse(),r=t.molecule.getCoordBoundingBoxObj(),a=new pt(r.max.x,r.min.y).add(new pt(2,-1));n.forEach((function(n){e.history[n.id]=new pt(n.pp),a=a.add(new pt(0,.5)),n.pp=a,t.molecule.sgroups.set(n.id,n),Oo(t,"sgroupData",n.id,1)}))},this.invert=function(){return new ii(this.history)}}function ii(t){this.type="OpRestoreDescriptorsPosition",this.history=t,this.execute=function(t){var e=this;Array.from(t.molecule.sgroups.values()).forEach((function(n){n.pp=e.history[n.id],t.molecule.sgroups.set(n.id,n),Oo(t,"sgroupData",n.id,1)}))},this.invert=function(){return new oi}}function si(t,e){this.data={id:null,pos:t,mode:e};var n=!1;this.execute=function(t){var r=t.molecule;n?r.simpleObjects.set(this.data.id,new Lt({mode:e})):(this.data.id=r.simpleObjects.add(new Lt({mode:e})),n=!0),t.simpleObjects.set(this.data.id,new oo(r.simpleObjects.get(this.data.id))),r.simpleObjectSetPos(this.data.id,this.data.pos.map((function(t){return new pt(t)}))),Oo(t,"simpleObjects",this.data.id,1)},this.invert=function(){var t=new ci;return t.data=this.data,t}}function ci(t){this.data={id:t,pos:null,item:null},this.execute=function(t){var e=t.molecule,n=e.simpleObjects.get(this.data.id);this.data.pos=n.pos,this.data.mode=n.mode,t.markItemRemoved(),t.clearVisel(t.simpleObjects.get(this.data.id).visel),t.simpleObjects.delete(this.data.id),e.simpleObjects.delete(this.data.id)},this.invert=function(){var t=new si;return t.data=this.data,t}}function li(t,e,n){this.data={id:t,d:e,noinvalidate:n},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d;e.simpleObjects.get(n).pos.forEach((function(t){return t.add_(r)})),t.simpleObjects.get(n).visel.translate(ba.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||Oo(t,"simpleObjects",n,1)},this.invert=function(){var t=new li;return t.data=this.data,t}}function ui(t,e,n,r,a){this.data={id:t,d:e,current:n,anchor:r,noinvalidate:a},this.execute=function(t){var e=t.molecule,n=this.data.id,r=this.data.d,a=this.data.current,o=e.simpleObjects.get(n),i=this.data.anchor;if("circle"===o.mode){var s=o.pos[1].get_xy0();o.pos[1].x=a.x,o.pos[1].y=a.y,this.data.current=s}else if("line"===o.mode&&i){var c=i.get_xy0();i.x=a.x,i.y=a.y,this.data.current=c}else if("rectangle"===o.mode&&i){var l=o.pos[0].get_xy0(),u=o.pos[1].get_xy0();jo(i.x)===jo(o.pos[1].x)&&(o.pos[1].x=i.x=a.x,this.data.current.x=u.x),jo(i.y)===jo(o.pos[1].y)&&(o.pos[1].y=i.y=a.y,this.data.current.y=u.y),jo(i.x)===jo(o.pos[0].x)&&(o.pos[0].x=i.x=a.x,this.data.current.x=l.x),jo(i.y)===jo(o.pos[0].y)&&(o.pos[0].y=i.y=a.y,this.data.current.y=l.y)}else o.pos[1].add_(r);t.simpleObjects.get(n).visel.translate(ba.obj2scaled(r,t.render.options)),this.data.d=r.negated(),this.data.noinvalidate||Oo(t,"simpleObjects",n,1)},this.invert=function(){var t=new ui;return t.data=this.data,t}}No.prototype=new vo,Mo.prototype=new vo,ko.prototype=new vo,Bo.prototype=new vo,Lo.prototype=new vo,Io.prototype=new vo,Do.prototype=new vo,zo.prototype=new vo,_o.prototype=new vo,Ho.prototype=new vo,Vo.prototype=new vo,Fo.prototype=new vo,Go.prototype=new vo,Uo.prototype=new vo,Wo.prototype=new vo,Yo.prototype=new vo,qo.prototype=new vo,$o.prototype=new vo,Ko.prototype=new vo,Xo.prototype=new vo,Zo.prototype=new vo,Qo.prototype=new vo,Jo.prototype=new vo,ti.prototype=new vo,ei.prototype=new vo,ni.prototype=new vo,ri.prototype=new vo,ai.prototype=new vo,oi.prototype=new vo,ii.prototype=new vo,si.prototype=new vo,ci.prototype=new vo,li.prototype=new vo,ui.prototype=new vo;var pi={AtomAdd:No,AtomDelete:Mo,AtomAttr:ko,AtomMove:Bo,BondMove:Lo,LoopMove:Io,SGroupAtomAdd:Do,SGroupAtomRemove:zo,SGroupAttr:_o,SGroupCreate:Ho,SGroupDelete:Vo,SGroupAddToHierarchy:Fo,SGroupRemoveFromHierarchy:Go,BondAdd:Uo,BondDelete:Wo,BondAttr:Yo,RGroupAttr:qo,RGroupFragment:$o,RxnArrowAdd:Zo,RxnArrowDelete:Qo,RxnArrowMove:Jo,RxnPlusAdd:ti,RxnPlusDelete:ei,RxnPlusMove:ni,SGroupDataMove:ri,CanvasLoad:ai,UpdateIfThen:Ko,AlignDescriptors:oi,FragmentAdd:xo,FragmentDelete:So,FragmentStereoFlag:Ao,FragmentAddStereoAtom:Po,FragmentDeleteStereoAtom:To,EnhancedFlagMove:Ro,SimpleObjectAdd:si,SimpleObjectDelete:ci,SimpleObjectMove:li,SimpleObjectResize:ui};function di(){this.operations=[]}function hi(t,e){var n=new di;return n.addOp(new pi.CanvasLoad(e)),n.perform(t)}function fi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}di.prototype.addOp=function(t,e){return e&&t.isDummy(e)||this.operations.push(t),t},di.prototype.mergeWith=function(t){return this.operations=this.operations.concat(t.operations),this},di.prototype.perform=function(t){var e=new di;return this.operations.forEach((function(n){e.addOp(n.perform(t))})),e.operations.reverse(),e},di.prototype.isDummy=function(t){return void 0===this.operations.find((function(e){return!t||!e.isDummy(t)}))};var mi={atoms:gi,bonds:bi,enhancedFlags:function(t,e){var n,r=null;return t.enhancedFlags.forEach((function(t,a){var o=t.pp;if(o&&!(Math.abs(e.x-o.x)>=1)){var i=Math.abs(e.y-o.y);i<.3&&(!r||i<n)&&(r={id:a,dist:n=i})}})),r},sgroupData:function(t,e){var n=null,r=null;return t.sgroupData.forEach((function(t,a){if("DAT"!==t.sgroup.type)throw new Error("Data group expected");if("MRV_IMPLICIT_H"!==t.sgroup.data.fieldName){var o=t.sgroup.dataArea,i=o.p0.y<e.y&&o.p1.y>e.y&&o.p0.x<e.x&&o.p1.x>e.x,s=Math.min(Math.abs(o.p0.x-e.x),Math.abs(o.p1.x-e.x));i&&(null===r||s<n)&&(r={id:a,dist:s},n=s)}})),r},sgroups:function(t,e){var n=null,r=.4;if(t.molecule.sgroups.forEach((function(t,a){var o=t.bracketDir,i=o.rotateSC(1,0),s=new pt(pt.dot(e,o),pt.dot(e,i));t.areas.forEach((function(t){var e=t.p0.y<s.y&&t.p1.y>s.y&&t.p0.x<s.x&&t.p1.x>s.x,o=Math.min(Math.abs(t.p0.x-s.x),Math.abs(t.p1.x-s.x));e&&(null===n||o<r)&&(n=a,r=o)}))})),null!==n)return{id:n,dist:r};return null},rxnArrows:function(t,e){var n=null,r=null;return t.rxnArrows.forEach((function(t,a){var o=t.item.pp;if(!(Math.abs(e.x-o.x)>=1)){var i=Math.abs(e.y-o.y);i<.3&&(!r||i<n)&&(r={id:a,dist:n=i})}})),r},rxnPluses:function(t,e){var n=null,r=null;return t.rxnPluses.forEach((function(t,a){var o=t.item.pp,i=Math.max(Math.abs(e.x-o.x),Math.abs(e.y-o.y));i<.3&&(!r||i<n)&&(r={id:a,dist:n=i})})),r},frags:function(t,e,n,r,a){r=Math.min(r||.4,.4);var o=t.molecule,i=gi(t,e,n,r);if(i)return{id:o.atoms.get(i.id).fragment,dist:i.dist};var s=bi(t,e,n,r,a);if(s){var c=o.bonds.get(s.id).begin;return{id:o.atoms.get(c).fragment,dist:s.dist}}return null},rgroups:function(t,e,n,r){r=Math.min(r||.4,.4);var a=null;return t.rgroups.forEach((function(t,o){if(o!==n&&t.labelBox&&t.labelBox.contains(e,.5)){var i=pt.dist(t.labelBox.centre(),e);(!a||i<r)&&(a={id:o,dist:r=i})}})),a},simpleObjects:function(t,e){var n=null,r=null,a=null;return t.simpleObjects.forEach((function(o,i){var s=o.calcDistance(e,t.render.options.scale);s.minDist<.3&&(!a||s.minDist<n)&&(n=s.minDist,r=s.refPoint,a={id:i,dist:n,ref:r})})),a}};function gi(t,e,n,r){var a=null,o=n&&"atoms"===n.map?n.id:null;return r=r||.4,r=Math.min(r,.4),t.atoms.forEach((function(t,n){if(n!==o){var i=pt.dist(e,t.a.pp);i<r&&(a=n,r=i)}})),null!==a?{id:a,dist:r}:null}function bi(t,e,n,r,a){var o=null,i=null,s=n&&"bonds"===n.map?n.id:null;r=r||.8*.4;var c=r=Math.min(r,.8*.4);return t.bonds.forEach((function(n,r){if(r!==s){var a=t.atoms.get(n.b.begin).a.pp,o=t.atoms.get(n.b.end).a.pp,l=pt.lc2(a,.5,o,.5),u=pt.dist(e,l);u<c&&(c=u,i=r)}})),t.bonds.forEach((function(n,a){if(a!==s){var i=t.molecule.halfBonds.get(n.b.hb1),c=i.dir,l=i.norm,u=t.atoms.get(n.b.begin).a.pp,p=t.atoms.get(n.b.end).a.pp;if(pt.dot(e.sub(u),c)*pt.dot(e.sub(p),c)<0){var d=Math.abs(pt.dot(e.sub(u),l));d<r&&(o=a,r=d)}}})),null!==i?{id:i,dist:c}:null!==o&&r>.4*a?{id:o,dist:r}:null}var vi={atom:gi,item:function(t,e,n,r,a){return(n=n||Object.keys(mi)).reduce((function(n,o){var i=n?n.dist:null,s=mi[o](t,e,r,i,a);return null!==s&&(null===n||s.dist<n.dist)?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fi(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({map:o,id:s.id,dist:s.dist},D()(s,["id","dist"])):n}),null)},merge:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:["atoms","bonds"],r=arguments.length>3?arguments[3]:void 0,a={atoms:new Map,bonds:new Map},o=t.molecule;e.atoms.forEach((function(t){a.atoms.set(t,o.atoms.get(t).pp)})),e.bonds.forEach((function(t){var e=o.bonds.get(t);a.bonds.set(t,pt.lc2(o.atoms.get(e.begin).pp,.5,o.atoms.get(e.end).pp,.5))}));var i={};return n.forEach((function(n){i[n]=Array.from(a[n].keys()).reduce((function(o,i){var s={map:n,id:i},c=mi[n](t,a[n].get(i),s,null,r);return c&&!e[n].includes(c.id)&&o.set(i,c.id),o}),new Map)})),i}};function yi(t,e,n){return t.molecule.atoms.get(e)[n]}function wi(t,e){return t.atoms.get(e).a.neighbors.length}function Ei(t,e){return t.atoms.get(e).a.neighbors.map((function(e){var n=t.molecule.halfBonds.get(e);return{aid:n.end,bid:n.bid}}))}function Oi(t,e){return Array.from(t.atoms.get(e).a.sgs)}function xi(t,e){return t.molecule.atoms.get(e).pp}function Si(t){return["atoms","bonds","frags","sgroups","rgroups","rxnArrows","rxnPluses","simpleObjects"].reduce((function(e,n){return e[n]=Array.from(t[n].keys()),e}),{})}function Ai(t,e){var n,r=[],a=xi(t,e);Ei(t,e).forEach((function(e){var n=xi(t,e.aid);pt.dist(a,n)<.1||r.push({id:e.aid,v:pt.diff(n,a)})})),r.sort((function(t,e){return Math.atan2(t.v.y,t.v.x)-Math.atan2(e.v.y,e.v.x)}));var o,i=0,s=0;for(n=0;n<r.length;n++)(o=pt.angle(r[n].v,r[(n+1)%r.length].v))<0&&(o+=2*Math.PI),o>s&&(i=n,s=o);var c=new pt(1,0);if(r.length>0){if(1===r.length){s=-4*Math.PI/3;var l=Ei(t,e)[0];if(wi(t,l.aid)>1){var u=[],p=xi(t,l.aid),d=pt.diff(a,p),h=Math.atan2(d.y,d.x);Ei(t,l.aid).forEach((function(e){var n=xi(t,e.aid);if(!(e.bid===l.bid||pt.dist(p,n)<.1)){var r=pt.diff(n,p),a=Math.atan2(r.y,r.x)-h;a<0&&(a+=2*Math.PI),u.push(a)}})),u.sort((function(t,e){return t-e})),u[0]<=1.01*Math.PI&&u[u.length-1]<=1.01*Math.PI&&(s*=-1)}}o=s/2+Math.atan2(r[i].v.y,r[i].v.x),c=c.rotate(o)}c.add_(a);var f=vi.atom(t,c,null,.1);return{atom:f=null===f?{label:"C"}:f.id,pos:c}}function Pi(t,e){return t.molecule.sgroups.filter((function(t,n){return!n.data.attached&&!n.data.absolute&&0===Object(Y.difference)(n.atoms,e).length}))}var Ti="Fragment",Ci="Multifragment",Ri="Bond",ji="Atom",Ni="Group";function Mi(t,e,n,r){var a=r.fieldValue;return"string"===typeof a||"DAT"!==e?Li(t,e,n,r,t.molecule.sgroups.newId()):a.reduce((function(a,o){var i=Object.assign({},r);return i.fieldValue=o,a.mergeWith(Li(t,e,n,i,t.molecule.sgroups.newId()))}),new di)}function ki(t,e){var n=new di;return Object.keys(e).forEach((function(r){n.addOp(new pi.SGroupAttr(t,r,e[r]))})),n}function Bi(t,e){var n=new di,r=t.molecule,a=t.sgroups.get(e).item;"SRU"===a.type&&(r.sGroupsRecalcCrossBonds(),a.neiAtoms.forEach((function(e){"*"===yi(t,e,"label")&&n.addOp(new pi.AtomAttr(e,"label","C"))})));var o=r.sgroups.get(e),i=Ct.getAtoms(r,o),s=o.getAttrs();return n.addOp(new pi.SGroupRemoveFromHierarchy(e)),i.forEach((function(t){n.addOp(new pi.SGroupAtomRemove(e,t))})),n.addOp(new pi.SGroupDelete(e)),(n=n.perform(t)).mergeWith(ki(e,s)),n}function Li(t,e,n,r,a,o){var i=new di;if(a=a-0===a?a:t.molecule.sgroups.newId(),i.addOp(new pi.SGroupCreate(a,e,o)),n.forEach((function(t){i.addOp(new pi.SGroupAtomAdd(a,t))})),i.addOp("DAT"!==e?new pi.SGroupAddToHierarchy(a):new pi.SGroupAddToHierarchy(a,-1,[])),i=i.perform(t),"SRU"===e){t.molecule.sGroupsRecalcCrossBonds();var s=new di;t.sgroups.get(a).item.neiAtoms.forEach((function(e){var n=t.atoms.get(e).a.isPlainCarbon();1===wi(t,e)&&n&&s.addOp(new pi.AtomAttr(e,"label","*"))})),(s=s.perform(t)).mergeWith(i),i=s}return function(t,e,n){var r=new di;return Object.keys(n).forEach((function(t){r.addOp(new pi.SGroupAttr(e,t,n[t]))})),r.perform(t)}(t,a,r).mergeWith(i)}function Ii(t,e,n,r,a){if(t===Ri)return function(t,e,n,r){var a=t.molecule,o=Hi(a,n);r.bonds&&(o=Object(Y.uniq)(o.concat(r.bonds)));return o.reduce((function(n,r){var o=a.bonds.get(r);return n.action=n.action.mergeWith(Mi(t,e.type,[o.begin,o.end],e.attrs)),n.selection.bonds.push(r),n}),{action:new di,selection:{atoms:n,bonds:[]}})}(e,n,r,a);var o,i=(o=e.molecule,(a.bonds||[]).reduce((function(t,e){var n=o.bonds.get(e);return t=t.concat([n.begin,n.end])}),[])),s=Object(Y.uniq)(r.concat(i));return t===Ti?Di(e,n,s,Array.from(e.atoms.keys())):t===Ci?function(t,e,n){var r=Hi(t.molecule,n);return{action:Mi(t,e.type,n,e.attrs),selection:{atoms:n,bonds:r}}}(e,n,s):t===Ni?Di(e,n,s,s):t===ji?function(t,e,n){return n.reduce((function(n,r){return n.action=n.action.mergeWith(Mi(t,e.type,[r],e.attrs)),n}),{action:new di,selection:{atoms:n,bonds:[]}})}(e,n,s):{action:Mi(e,n.type,r,n.attrs)}}function Di(t,e,n,r){var a=new yt(n.map((function(e){return t.atoms.get(e).a.fragment})));return Array.from(a).reduce((function(n,a){var o=r.reduce((function(e,n){var r=t.atoms.get(n).a;return a===r.fragment&&e.push(n),e}),[]),i=Hi(t.molecule,o);return n.action=n.action.mergeWith(Mi(t,e.type,o,e.attrs)),n.selection.atoms=n.selection.atoms.concat(o),n.selection.bonds=n.selection.bonds.concat(i),n}),{action:new di,selection:{atoms:[],bonds:[]}})}function zi(t,e,n){var r=Oi(e,n);return r.length>0&&(r.forEach((function(e){t.addOp(new pi.SGroupAtomRemove(e,n))})),!0)}function _i(t,e,n){var r=e.molecule,a=new Map;n.forEach((function(t){Oi(e,t).forEach((function(t){a.set(t,a.has(t)?a.get(t)+1:1)}))})),a.forEach((function(n,a){var o=e.sgroups.get(a).item;if(Ct.getAtoms(e.molecule,o).length===n){var i=r.sgroups.get(a);t.mergeWith(ki(a,i.getAttrs())),t.addOp(new pi.SGroupRemoveFromHierarchy(a)),t.addOp(new pi.SGroupDelete(a))}}))}function Hi(t,e){var n=new yt(e);return Array.from(t.bonds.keys()).filter((function(e){var r=t.bonds.get(e);return n.has(r.begin)&&n.has(r.end)}))}function Vi(t,e,n){var r=new di;return Object.keys(n).forEach((function(t){r.addOp(new pi.RGroupAttr(e,t,n[t]))})),r.perform(t)}function Fi(t,e,n){var r=new di;return r.addOp(new pi.RGroupFragment(e,n)),r.perform(t)}function Gi(t,e,n,r){var a=new di;return t.molecule.rgroups.get(n)||a.addOp(new pi.UpdateIfThen(e,n,r)),a.perform(t)}function Ui(t,e,n){n=Object.assign({},n);var r=new di;return n.fragment=r.addOp((new pi.FragmentAdd).perform(t)).frid,r.addOp(new pi.AtomAdd(n,e).perform(t)),r}function Wi(t,e,n,r){var a=new di;return(Array.isArray(e)?e:[e]).forEach((function(t){Object.keys(Ot.attrlist).forEach((function(e){if(("attpnt"!==e||e in n)&&(e in n||r)){var o=e in n?n[e]:Ot.attrGetDefault(e);a.addOp(new pi.AtomAttr(t,e,o))}})),r||!("label"in n)||null===n.label||"L#"===n.label||n.atomList||a.addOp(new pi.AtomAttr(t,"atomList",null))})),a.perform(t)}function Yi(t,e,n,r){var a=new di,o=t.molecule.atoms.get(e);if(o){var i=o.fragment;"stereoParity"in n&&a.addOp(new pi.AtomAttr(e,"stereoParity",n.stereoParity).perform(t)),"stereoLabel"in n&&(a.addOp(new pi.AtomAttr(e,"stereoLabel",n.stereoLabel).perform(t)),null===n.stereoLabel?a.addOp(new pi.FragmentDeleteStereoAtom(i,e).perform(t)):a.addOp(new pi.FragmentAddStereoAtom(i,e).perform(t))),r&&a.operations.reverse()}return a}function qi(t,e,n){var r=new di;return e.forEach((function(e){var a=t.molecule.atoms.get(e),o=a.fragment;r.addOp(new pi.AtomAttr(e,"fragment",n)),null!==a.stereoLabel&&(r.addOp(new pi.FragmentAddStereoAtom(n,e)),r.addOp(new pi.FragmentDeleteStereoAtom(o,e)))})),r.perform(t)}function $i(t,e,n){if(e===n)return new di;var r=new di;Ki(r,t,e,n);var a=new di;Ei(t,e).forEach((function(e){var r=t.molecule.bonds.get(e.bid);if(n!==r.begin&&n!==r.end){var o=r.begin===e.aid?e.aid:n,i=r.begin===e.aid?n:e.aid,s=t.molecule.findBondId(o,i);if(null===s)a.addOp(new pi.BondAdd(o,i,r));else{var c=At.getAttrHash(r);Object.keys(c).forEach((function(t){a.addOp(new pi.BondAttr(s,t,c[t]))}))}a.addOp(new pi.BondDelete(e.bid))}else a.addOp(new pi.BondDelete(e.bid))}));var o=Ot.getAttrHash(t.molecule.atoms.get(e));return 1===wi(t,e)&&"*"===o.label&&(o.label="C"),Object.keys(o).forEach((function(t){a.addOp(new pi.AtomAttr(n,t,o[t]))})),zi(a,t,e)&&_i(a,t,[e]),a.addOp(new pi.AtomDelete(e)),a.perform(t).mergeWith(r)}function Ki(t,e,n,r){var a=yi(e,n,"fragment"),o=yi(e,r,"fragment");if(o!==a&&"number"===typeof o){var i=e.molecule,s=Rt.findRGroupByFragment(i.rgroups,o);"undefined"!==typeof s&&t.mergeWith(Fi(e,null,o)).mergeWith(Gi(e,0,s));var c=i.getFragmentIds(a),l=[];i.atoms.forEach((function(t,e){t.fragment===o&&l.push(e)}));var u=qi(e,l,a);Xi(t,e,c,r),t.addOp(new pi.FragmentDelete(o).perform(e)),t.mergeWith(u)}}function Xi(t,e,n,r){Oi(e,r).forEach((function(r){var a=e.molecule.sgroups.get(r);"DAT"===a.type&&["Atom","Bond","Group"].includes(a.data.context)||Object(M.without)(a.atoms,n).forEach((function(n){return t.addOp(new pi.SGroupAtomAdd(r,n).perform(e))}))}))}function Zi(t){if(!(this instanceof Zi))return t.selection(null),new Zi(t);this.editor=t}function Qi(t,e,n){var r=t.render.ctab.molecule,a=e||0===e?r.atoms.get(e):null,o=a?a.rglabel:0,i=a?a.label:"R#",s=t.event.elementEdit.dispatch({label:"R#",rglabel:o,fragId:a?a.fragment:null});Promise.resolve(s).then((function(r){r=Object.assign({},Ot.attrlist,r),!e&&0!==e&&r.rglabel?t.update(Ui(t.render.ctab,n,r)):o!==r.rglabel&&(r.aam=a.aam,r.attpnt=a.attpnt,r.rglabel||"R#"===i||(r.label=i),t.update(Wi(t.render.ctab,e,r)))})).catch((function(){return null}))}function Ji(t,e){for(var n=new pt(0,1),r=n.rotate(Math.PI/2),a=pt.diff(t[t.length-1],e),o=pt.dot(r,a),i=pt.dot(n,a),s=null,c=0,l=!1,u=!1,p=0;p<t.length;++p){var d=pt.diff(t[p],e),h=pt.diff(d,a),f=pt.dot(r,d),m=pt.dot(n,d);l=!1,f*o<0&&(m*i>-1e-5?i>-1e-5&&(l=!0):(Math.abs(o)*Math.abs(m)-Math.abs(f)*Math.abs(i))*m>0&&(l=!0)),l&&u&&pt.dot(h,r)*pt.dot(s,r)>=0&&(l=!1),l&&c++,a=d,o=f,i=m,s=h,u=l}return c%2!==0}Zi.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["atoms"]))},Zi.prototype.click=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]);return n?"atoms"!==n.map||(this.editor.hover(null),Qi(this.editor,n.id),!0):(this.editor.hover(null),Qi(this.editor,null,e.page2obj(t)),!0)};var ts={inRectangle:function(t,e,n){var r=[],a=[],o=Math.min(e.x,n.x),i=Math.max(e.x,n.x),s=Math.min(e.y,n.y),c=Math.max(e.y,n.y);t.bonds.forEach((function(e,n){var a=pt.lc2(t.atoms.get(e.b.begin).a.pp,.5,t.atoms.get(e.b.end).a.pp,.5);a.x>o&&a.x<i&&a.y>s&&a.y<c&&r.push(n)})),t.atoms.forEach((function(t,e){t.a.pp.x>o&&t.a.pp.x<i&&t.a.pp.y>s&&t.a.pp.y<c&&a.push(e)}));var l=[],u=[],p=[];t.rxnArrows.forEach((function(t,e){t.item.pp.x>o&&t.item.pp.x<i&&t.item.pp.y>s&&t.item.pp.y<c&&l.push(e)})),t.rxnPluses.forEach((function(t,e){t.item.pp.x>o&&t.item.pp.x<i&&t.item.pp.y>s&&t.item.pp.y<c&&u.push(e)})),t.simpleObjects.forEach((function(t,e){t.item.pos[0].x>o&&t.item.pos[0].x<i&&t.item.pos[0].y>s&&t.item.pos[0].y<c&&p.push(e)}));var d=[];t.enhancedFlags.forEach((function(t,e){t.pp&&t.pp.x>o&&t.pp.x<i&&t.pp.y>s&&t.pp.y<c&&d.push(e)}));var h=[];return t.sgroupData.forEach((function(t,e){t.sgroup.pp.x>o&&t.sgroup.pp.x<i&&t.sgroup.pp.y>s&&t.sgroup.pp.y<c&&h.push(e)})),{atoms:a,bonds:r,rxnArrows:l,rxnPluses:u,enhancedFlags:d,sgroupData:h,simpleObjects:p}},inPolygon:function(t,e){for(var n=[],r=[],a=[],o=0;o<e.length;++o)a[o]=new pt(e[o].x,e[o].y);t.bonds.forEach((function(e,r){var o=pt.lc2(t.atoms.get(e.b.begin).a.pp,.5,t.atoms.get(e.b.end).a.pp,.5);Ji(a,o)&&n.push(r)})),t.atoms.forEach((function(t,e){Ji(a,t.a.pp)&&r.push(e)}));var i=[],s=[],c=[];t.rxnArrows.forEach((function(t,e){Ji(a,t.item.pp)&&i.push(e)})),t.rxnPluses.forEach((function(t,e){Ji(a,t.item.pp)&&s.push(e)})),t.simpleObjects.forEach((function(t,e){Ji(a,t.item.pos[0])&&c.push(e)}));var l=[];t.enhancedFlags.forEach((function(t,e){t.pp&&Ji(a,t.pp)&&l.push(e)}));var u=[];return t.sgroupData.forEach((function(t,e){Ji(a,t.sgroup.pp)&&u.push(e)})),{atoms:r,bonds:n,rxnArrows:i,rxnPluses:s,enhancedFlags:l,sgroupData:u,simpleObjects:c}}};function es(t,e,n){this.mode=t,this.fragment=n,this.editor=e}es.prototype.getSelection=function(){var t=this.editor.render;if(0===this.mode)return ts.inPolygon(t.ctab,this.points);if(1===this.mode)return ts.inRectangle(t.ctab,this.points[0],this.points[1]);throw new Error("Selector mode unknown")},es.prototype.begin=function(t){var e=this.editor.render;this.points=[e.page2obj(t)],1===this.mode&&this.points.push(this.points[0])},es.prototype.running=function(){return!!this.points},es.prototype.addPoint=function(t){if(!this.points)return null;var e=this.editor.render;return 0===this.mode?this.points.push(e.page2obj(t)):1===this.mode&&(this.points=[this.points[0],e.page2obj(t)]),this.update(),this.getSelection()},es.prototype.update=function(){if(this.selection&&(this.selection.remove(),this.selection=null),this.points&&this.points.length>1){var t=this.editor.render,e=this.points.map((function(e){return ba.obj2scaled(e,t.options).add(t.options.offset)}));this.selection=0===this.mode?Ta.selectionPolygon(t.paper,e,t.options):Ta.selectionRectangle(t.paper,e[0],e[1],t.options)}},es.prototype.end=function(){var t=this.getSelection();return this.points=null,this.update(null),t};var ns=["atoms","bonds","sgroups","sgroupData"];function rs(t,e){if(!(this instanceof rs)){var n=t.selection()||{};if(!n.atoms&&!n.bonds)return new rs(t,e);var r=t.render.ctab.molecule.sgroups,a=t.selection().atoms,o=r.find((function(t,e){return $()(e.atoms,a)}));return as(t,void 0!==o?o:null,e),null}this.editor=t,this.type=e,this.lassoHelper=new es(1,t),this.editor.selection(null)}function as(t,e,n){var r=t.render.ctab,a=r.molecule,o=t.selection()||{},i=null!==e?a.sgroups.get(e):null,s=i?i.type:n,c="DAT"===s?"sdataEdit":"sgroupEdit";if(o.atoms||o.bonds||i){var l=null;i?(l=i.getAttrs()).context=function(t,e){var n=t.molecule;if(1===e.length)return ji;if(cs(t,e))return Ci;if(ss(t,e))return Ti;var r=new yt(e);return is(Array.from(n.bonds.values()).filter((function(t){return r.has(t.begin)&&r.has(t.end)})))?Ni:Ri}(r,i.atoms):l={context:os(r,o)};var u=t.event[c].dispatch({type:s,attrs:l});Promise.resolve(u).then((function(n){if("DAT"!==n.type&&function(t,e){var n=e.reduce((function(e,n){var r=t.atoms.get(n);return e.union(r.sgs)}),new yt);return Array.from(n).some((function(n){var r=t.sgroups.get(n);if("DAT"===r.type)return!1;var a=Ct.getAtoms(t,r);return a.length<e.length?a.findIndex((function(t){return-1===e.indexOf(t)}))>=0:e.findIndex((function(t){return-1===a.indexOf(t)}))>=0}))}(a,o.atoms||[]))t.event.message.dispatch({error:"Partial S-group overlapping is not allowed."});else{if(!i&&"DAT"!==n.type&&(!o.atoms||0===o.atoms.length))return;if(i&&i.getAttrs().context===n.attrs.context){var s=Mi(r,n.type,i.atoms,n.attrs).mergeWith(Bi(r,e));return t.update(s),void t.selection(o)}var c=function(t,e,n,r){var a=e.render.ctab,o=a.molecule.sgroups.get(t),i=o&&o.atoms||r.atoms||[],s=Ii(n.attrs.context,a,n,i,r);s.selection=s.selection||r,null!==t&&void 0!==t&&(s.action=s.action.mergeWith(Bi(a,t)));return e.selection(s.selection),s}(e,t,n,o);t.update(c.action),t.selection(null)}})).catch((function(){return null}))}}function os(t,e){var n=t.molecule;if(e.atoms&&!e.bonds)return ji;var r=e.bonds.map((function(t){return n.bonds.get(t)}));if(!is(r))return Ri;e.atoms=e.atoms||[];var a=new yt(e.atoms),o=r.every((function(t){return a.has(t.begin)&&a.has(t.end)}));return ss(t,e.atoms)&&o?Ti:cs(t,e.atoms)?Ci:Ni}function is(t){if(0===t.length)return!0;for(var e=0;e<t.length;++e)for(var n=t[e],r=0;r<t.length;++r)if(e!==r){var a=t[r];if(n.end===a.begin||n.end===a.end)return!0}return!1}function ss(t,e){return 1===ls(t,e)}function cs(t,e){return ls(t,e)>1}function ls(t,e){var n=new yt(e);return Array.from(t.connectedComponents.values()).reduce((function(t,e){return t+(n.isSuperset(e)?1:0)}),0)}function us(t,e,n,r,a,o){if(void 0===r){var i=Ai(t,n);r=i.atom,a=i.pos}var s=new di,c=!1,l=null;"number"!==typeof n?"number"===typeof r&&(l=yi(t,r,"fragment")):(l=yi(t,n,"fragment"),"number"===typeof r&&(c=!0)),null==l&&(l=s.addOp((new pi.FragmentAdd).perform(t)).frid),"number"!==typeof n?(n.fragment=l,n=s.addOp(new pi.AtomAdd(n,a).perform(t)).data.aid,"number"===typeof r&&Xi(s,t,[n],r),a=o):"*"===yi(t,n,"label")&&s.addOp(new pi.AtomAttr(n,"label","C").perform(t)),"number"!==typeof r?(r.fragment=l,r=s.addOp(new pi.AtomAdd(r,a).perform(t)).data.aid,"number"===typeof n&&Xi(s,t,[r],n)):"*"===yi(t,r,"label")&&s.addOp(new pi.AtomAttr(r,"label","C").perform(t));var u=s.addOp(new pi.BondAdd(n,r,e).perform(t)).data.bid;return e.stereo>0&&s.mergeWith(hs(t,u)),s.operations.reverse(),c&&Ki(s,t,n,r),[s,n,r,u]}function ps(t,e,n,r){var a=new di;return(Array.isArray(e)?e:[e]).forEach((function(e){Object.keys(At.attrlist).forEach((function(o){if(o in n||r){var i=o in n?n[o]:At.attrGetDefault(o);a.addOp(new pi.BondAttr(e,o,i).perform(t)),"stereo"===o&&o in n&&a.mergeWith(hs(t,e,!0))}}))})),a}function ds(t,e){var n=t.molecule.bonds.get(e),r=new di;return r.addOp(new pi.BondDelete(e)),r.addOp(new pi.BondAdd(n.end,n.begin,n)).data.bid=e,r.perform(t)}function hs(t,e,n){var r=t.molecule,a=r.bonds.get(e),o=new di;if(a.stereo===At.PATTERN.STEREO.NONE){var i=Ei(t,a.begin),s=i.find((function(t){return t.bid!==e&&r.bonds.get(t.bid).stereo>0}));if(i.length<3||!s)return o.mergeWith(Yi(t,a.begin,{stereoParity:Ot.PATTERN.STEREO_PARITY.NONE,stereoLabel:null},n)),o;a=r.bonds.get(s.bid)}var c=null;switch(a.stereo){case At.PATTERN.STEREO.UP:c=Ot.PATTERN.STEREO_PARITY.ODD;break;case At.PATTERN.STEREO.EITHER:c=Ot.PATTERN.STEREO_PARITY.EITHER;break;case At.PATTERN.STEREO.DOWN:c=Ot.PATTERN.STEREO_PARITY.EVEN;break;default:return o}return o.mergeWith(Yi(t,a.begin,{stereoParity:c,stereoLabel:"and-1"},n)),o}function fs(t,e,n,r){if(r.stereo!==At.PATTERN.STEREO.NONE&&r.type===At.PATTERN.TYPE.SINGLE&&n.type===r.type&&n.stereo===r.stereo)return ds(t,e);var a=ms.includes(r.type)?ms:null;r.stereo===At.PATTERN.STEREO.NONE&&r.type===At.PATTERN.TYPE.SINGLE&&n.stereo===At.PATTERN.STEREO.NONE&&a&&(r.type=a[(a.indexOf(n.type)+1)%a.length]);var o=function(t,e,n){return n.type===At.PATTERN.TYPE.SINGLE&&e.stereo===At.PATTERN.STEREO.NONE&&n.stereo!==At.PATTERN.STEREO.NONE&&t.atoms.get(e.begin).neighbors.length<t.atoms.get(e.end).neighbors.length}(t.molecule,n,r)?ds(t,e):new di;return ps(t,e,r).mergeWith(o)}rs.prototype.mousedown=function(t){this.editor.findItem(t,ns)||this.lassoHelper.begin(t)},rs.prototype.mousemove=function(t){this.lassoHelper.running(t)?this.editor.selection(this.lassoHelper.addPoint(t)):this.editor.hover(this.editor.findItem(t,ns))},rs.prototype.mouseleave=function(t){this.lassoHelper.running(t)&&this.lassoHelper.end(t)},rs.prototype.mouseup=function(t){var e=null,n=null;if(this.lassoHelper.running(t))n=this.lassoHelper.end(t);else{var r=this.editor.findItem(t,ns);if(!r)return;if(this.editor.hover(null),"atoms"===r.map)n={atoms:[r.id]};else if("bonds"===r.map){var a=this.editor.render.ctab.bonds.get(r.id);n={atoms:[a.b.begin,a.b.end]}}else{if("sgroups"!==r.map&&"sgroupData"!==r.map)return;e=r.id}}(null!==e||n&&n.atoms)&&as(this.editor,e,this.type)},rs.prototype.cancel=function(){this.lassoHelper.running()&&this.lassoHelper.end(),this.editor.selection(null)};var ms=[At.PATTERN.TYPE.SINGLE,At.PATTERN.TYPE.DOUBLE,At.PATTERN.TYPE.TRIPLE];function gs(t,e){if(!(this instanceof gs)){if(!t.selection()||!t.selection().atoms)return new gs(t,e);var n=Wi(t.render.ctab,t.selection().atoms,e,!0);return t.update(n),t.selection(null),null}this.editor=t,this.atomProps=e,this.bondProps={type:1,stereo:At.PATTERN.STEREO.NONE}}function bs(t,e){var n=t.dragCtx,r=t.editor,a=n.item&&n.item.id,o=void 0!==a&&null!==a?e.ctab.molecule.atoms.get(a):new Ot({label:""});n.timeout=setTimeout((function(){delete t.dragCtx,r.selection(null);var i=r.event.quickEdit.dispatch(o);Promise.resolve(i).then((function(t){var o=a?Wi(e.ctab,a,t):Ui(e.ctab,n.xy0,t);r.update(o)})).catch((function(){return null}))}),750),n.stopTapping=function(){n.timeout&&(clearTimeout(n.timeout),delete n.timeout)}}function vs(t,e,n){n=new pt(n);var r=new di,a=t.molecule,o=new yt,i=new yt;if(e.atoms){var s=new yt(e.atoms),c=[];if(t.bonds.forEach((function(t,e){if(s.has(t.b.begin)&&s.has(t.b.end))return c.push(e),void["hb1","hb2"].forEach((function(e){var n=a.halfBonds.get(t.b[e]).loop;n>=0&&o.add(n)}));s.has(t.b.begin)?i.add(t.b.begin):s.has(t.b.end)&&i.add(t.b.end)})),c.forEach((function(t){r.addOp(new pi.BondMove(t,n))})),o.forEach((function(e){t.reloops.get(e)&&t.reloops.get(e).visel&&r.addOp(new pi.LoopMove(e,n))})),e.atoms.forEach((function(t){r.addOp(new pi.AtomMove(t,n,!i.has(t)))})),e.sgroupData&&0===e.sgroupData.length)Pi(t,e.atoms).forEach((function(t){r.addOp(new pi.SGroupDataMove(t.id,n))}))}return e.rxnArrows&&e.rxnArrows.forEach((function(t){r.addOp(new pi.RxnArrowMove(t,n,!0))})),e.rxnPluses&&e.rxnPluses.forEach((function(t){r.addOp(new pi.RxnPlusMove(t,n,!0))})),e.simpleObjects&&e.simpleObjects.forEach((function(t){r.addOp(new pi.SimpleObjectMove(t,n,!0))})),e.sgroupData&&e.sgroupData.forEach((function(t){r.addOp(new pi.SGroupDataMove(t,n))})),e.enhancedFlags&&e.enhancedFlags.forEach((function(t){r.addOp(new pi.EnhancedFlagMove(t,n))})),r.perform(t)}function ys(t,e,n){var r=new di;if(!n){var a=t.molecule;t.molecule.frags.get(e).stereoAtoms.forEach((function(t){null===a.atoms.get(t).stereoLabel&&r.addOp(new pi.FragmentDeleteStereoAtom(e,t))}))}return r.addOp(new pi.FragmentStereoFlag(e,n)),r.perform(t)}function ws(t,e,n,r){for(var a=[e],o=new yt(a);a.length>0;){var i=a.shift();Ei(t,i).forEach((function(e){t.molecule.atoms.get(e.aid).fragment!==n||o.has(e.aid)||(o.add(e.aid),a.push(e.aid))}))}return qi(t,o,r)}function Es(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new di,a=Rt.findRGroupByFragment(t.molecule.rgroups,e);return t.molecule.atoms.forEach((function(n,o){if(n.fragment===e){var i=r.addOp((new pi.FragmentAdd).perform(t)).frid;r.mergeWith(ws(t,o,e,i)),a&&r.mergeWith(Fi(t,a,i))}})),-1!==e&&(r.mergeWith(Fi(t,0,e)),r.addOp(new pi.FragmentDelete(e).perform(t)),r.mergeWith(Gi(t,0,a,n))),r.operations.reverse(),r}function Os(t,e){var n=new di;if(!e)return n;var r=new Set;return e.atoms.forEach((function(e,a){r.has(e)||r.has(a)||(n=$i(t,a,e).mergeWith(n),r.add(e).add(a))})),n=function(t,e){var n=t.molecule,r=new Map,a=new di;return e.forEach((function(t,e){var a=n.bonds.get(e),o=n.bonds.get(t),i=mo.mergeBondsParams(n,a,n,o);i.merged&&(r.set(a.begin,i.cross?o.end:o.begin),r.set(a.end,i.cross?o.begin:o.end))})),r.forEach((function(e,n){a=$i(t,n,e).mergeWith(a)})),a}(t,e.bonds).mergeWith(n)}function xs(t,e){var n=t.render.ctab.molecule,r=e||{atoms:Array.from(n.atoms.keys()),bonds:Array.from(n.bonds.keys())};return function(t,e){var n={atoms:new Map(e.atoms),bonds:new Map(e.bonds)};return e.bonds.forEach((function(e,r){var a=t.bonds.get(r),o=t.bonds.get(e);mo.mergeBondsParams(t,a,t,o).merged?(n.atoms.delete(a.begin),n.atoms.delete(a.end)):n.bonds.delete(r)})),0===n.atoms.size&&0===n.bonds.size?null:n}(n,t.findMerge(r,["atoms","bonds"]))}function Ss(t){if(!t)return null;var e={atoms:Array.from(t.atoms.values()),bonds:Array.from(t.bonds.values())};return{map:"merge",id:+Date.now(),items:e}}function As(t,e){if(!(this instanceof As))return new As(t,e);this.editor=t,this.lassoHelper=new es("lasso"===e?0:1,t,"fragment"===e)}function Ps(t){var e={};return e[t.map]=[t.id],e}function Ts(t,e,n){return e&&Object.keys(e).forEach((function(r){t[r]?t[r]=function(t,e,n){return e.reduce((function(e,r){return n?t=Object(M.xor)(t,[r]):t.includes(r)||t.push(r),t}),[])}(t[r],e[r],n):t[r]=e[r].slice()})),t}function Cs(t,e){return t&&t[e.map]&&t[e.map].includes(e.id)}function Rs(t,e){var n=new di;return n.addOp(new pi.SimpleObjectDelete(e)),n.perform(t)}function js(t,e,n){var r=new di;return r.addOp(new pi.SimpleObjectAdd(e,n)),r.perform(t)}function Ns(t,e,n,r,a){var o=new di;return o.addOp(new pi.SimpleObjectResize(e,n,r,a)),o.perform(t)}function Ms(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=new di,a=t.molecule.bonds.get(e),o=[];return r.addOp(new pi.BondDelete(e)),n.includes(a.begin)||1!==wi(t,a.begin)||(zi(r,t,a.begin)&&o.push(a.begin),r.addOp(new pi.AtomDelete(a.begin))),n.includes(a.end)||1!==wi(t,a.end)||(zi(r,t,a.end)&&o.push(a.end),r.addOp(new pi.AtomDelete(a.end))),_i(r,t,o),r=r.perform(t),a.stereo&&r.mergeWith(Yi(t,a.begin,{stereoParity:Ot.PATTERN.STEREO_PARITY.NONE,stereoLabel:null})),r}function ks(t,e){var n=new di,r=[],a=[];e={atoms:e.atoms||[],bonds:e.bonds||[],rxnPluses:e.rxnPluses||[],rxnArrows:e.rxnArrows||[],sgroupData:e.sgroupData||[],simpleObjects:e.simpleObjects||[]};var o=new di;t.molecule.sgroups.forEach((function(n,r){(e.sgroupData.includes(r)||new yt(e.atoms).isSuperset(new yt(n.atoms)))&&o.mergeWith(Bi(t,r))})),e.atoms.forEach((function(n){Ei(t,n).forEach((function(t){-1===e.bonds.indexOf(t.bid)&&(e.bonds=e.bonds.concat([t.bid]))}))}));var i=new di;e.bonds.forEach((function(n){var r=t.molecule.getBondFragment(n);a.indexOf(r)<0&&a.push(r),i.mergeWith(Ms(t,n,e.atoms))})),e.atoms.forEach((function(e){var o=t.molecule.atoms.get(e).fragment;a.indexOf(o)<0&&a.push(o),zi(n,t,e)&&r.push(e),n.addOp(new pi.AtomDelete(e))})),_i(n,t,r),e.rxnArrows.forEach((function(t){n.addOp(new pi.RxnArrowDelete(t))})),e.rxnPluses.forEach((function(t){n.addOp(new pi.RxnPlusDelete(t))})),e.simpleObjects.forEach((function(t){n.addOp(new pi.SimpleObjectDelete(t))})),(n=n.perform(t)).mergeWith(i);for(var s=a.map((function(e){return Rt.findRGroupByFragment(t.molecule.rgroups,e)}));a.length>0;)n=Es(t,a.pop(),s).mergeWith(n);return n.mergeWith(o),n}function Bs(t,e){if(!(this instanceof Bs)){if(!t.selection())return new Bs(t,e);var n=ks(t.render.ctab,t.selection());return t.update(n),t.selection(null),null}this.editor=t,this.maps=["atoms","bonds","rxnArrows","rxnPluses","sgroups","sgroupData","simpleObjects"],this.lassoHelper=new es(e||0,t)}function Ls(t,e){if(!(this instanceof Ls)){if(!t.selection()||!t.selection().bonds)return new Ls(t,e);var n=ps(t.render.ctab,t.selection().bonds,e);return t.update(n),t.selection(null),null}this.editor=t,this.atomProps={label:"C"},this.bondProps=e}function Is(t){if(!(this instanceof Is))return new Is(t);this.editor=t,this.editor.selection(null)}function Ds(t,e,n,r,a){var o=e.molecule,i=t.molecule,s=i.getBondFragment(n),c=_s(i,s),l=null,p=null,d=new di;return zs(c.frag)&&zs(o)?Promise.all([r.aromatizeStruct.dispatch(c.frag).then((function(t){return je(t.struct)})),r.aromatizeStruct.dispatch(o).then((function(t){return je(t.struct)}))]).then((function(o){var i=u()(o,2),h=i[0],f=i[1],m=function(t,e,n){var r=new di;return e.bonds.forEach((function(e,a){e.type===At.PATTERN.TYPE.AROMATIC&&r.addOp(new pi.BondAttr(n.get(a),"type",At.PATTERN.TYPE.AROMATIC).perform(t))})),r}(t,h,c.bondMap),g={bid:e.bid,molecule:f},b=a(t,g,n);return p=b[1],d=b[0].mergeWith(m),l=_s(t.molecule,s),r.dearomatizeStruct.dispatch(l.frag).then((function(t){return je(t.struct)}))})).then((function(e){e.bonds.forEach((function(t){if(t.type===At.PATTERN.TYPE.AROMATIC)throw Error("Bad dearomatize")}));var n=function(t,e,n){var r=new di;return e.bonds.forEach((function(e,a){r.addOp(new pi.BondAttr(n.get(a),"type",e.type).perform(t))})),r}(t,e,l.bondMap);return[d=n.mergeWith(d),p]})).catch((function(r){return d.perform(t),a(t,e,n)})):(d=a(t,e,n),Promise.resolve(d))}function zs(t){0===t.loops.size&&t.prepareLoopStructure();var e=t.loops.find((function(t,e){return e.aromatic}));return 0!==t.loops.size&&!e&&void 0!==t.loops.find((function(t,e){return e.dblBonds===e.hbs.length/2}))}function _s(t,e){var n=t.getFragmentIds(e),r=Array.from(n),a=t.clone(n),o=new Map;return a.bonds.forEach((function(e,n){o.set(n,t.findBondId(r[e.begin],r[e.end]))})),{frag:a,bondMap:o}}function Hs(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Vs(e),o=pt.diff(n,a),i=new di,s=new Map,c=new Map,l={atoms:[],bonds:[]};return e.atoms.forEach((function(e,o){c.has(e.fragment)||c.set(e.fragment,i.addOp((new pi.FragmentAdd).perform(t)).frid);var u=Object.assign(e.clone(),{fragment:c.get(e.fragment)}),p=new pi.AtomAdd(u,pt.diff(e.pp,a).rotate(r).add(n)).perform(t);i.addOp(p),s.set(o,p.data.aid),l.atoms.push(p.data.aid)})),e.frags.forEach((function(e,n){e.stereoAtoms.forEach((function(e){return i.addOp(new pi.FragmentAddStereoAtom(c.get(n),s.get(e)).perform(t))}))})),e.bonds.forEach((function(e){var n=new pi.BondAdd(s.get(e.begin),s.get(e.end),e).perform(t);i.addOp(n),l.bonds.push(n.data.bid)})),e.sgroups.forEach((function(e){var n=t.molecule.sgroups.newId(),r=e.atoms.map((function(t){return s.get(t)}));Li(t,e.type,r,e.data,n,e.pp?e.pp.add(o):null).operations.reverse().forEach((function(t){i.addOp(t)}))})),t.rxnArrows.size<1&&e.rxnArrows.forEach((function(e){i.addOp(new pi.RxnArrowAdd(e.pp.add(o)).perform(t))})),e.rxnPluses.forEach((function(e){i.addOp(new pi.RxnPlusAdd(e.pp.add(o)).perform(t))})),e.simpleObjects.forEach((function(e){i.addOp(new pi.SimpleObjectAdd(e.pos.map((function(t){return t.add(o)})),e.mode).perform(t))})),e.rgroups.forEach((function(n,r){n.frags.forEach((function(e,n){i.addOp(new pi.RGroupFragment(r,c.get(n)).perform(t))}));var a=e.rgroups.get(r).ifthen,o=e.rgroups.get(a)?a:0;i.mergeWith(Vi(t,r,n.getAttrs())).mergeWith(Gi(t,o,n.ifthen))})),i.operations.reverse(),[i,l]}function Vs(t){if(t.atoms.size>0){var e=1e50,n=e,r=-e,a=-n;return t.atoms.forEach((function(t){e=Math.min(e,t.pp.x),n=Math.min(n,t.pp.y),r=Math.max(r,t.pp.x),a=Math.max(a,t.pp.y)})),new pt((e+r)/2,(n+a)/2)}return t.rxnArrows.size>0?t.rxnArrows.get(0).pp:t.rxnPluses.size>0?t.rxnPluses.get(0).pp:t.simpleObjects.size>0?t.simpleObjects.get(0).center():null}function Fs(t,e,n,r){return Hs(t,e.molecule,n,r)}function Gs(t,e,n,r,a){var o=new di,i=e.molecule,s=t.molecule,c=s.atoms.get(n),l=n,u=null;if(a){var p=function(t,e,n){var r=new di,a=yi(t,e,"fragment"),o=null;if(null===n){var i=Ai(t,e),s=us(t,{type:1},e,i.atom,i.pos.get_xy0());(r=s[0]).operations.reverse(),o=s[2]}else{var c=new pi.AtomAdd({label:"C",fragment:a},new pt(1,0).rotate(n).add(t.molecule.atoms.get(e).pp).get_xy0()).perform(t);r.addOp(c),r.addOp(new pi.BondAdd(e,c.data.aid,{type:1}).perform(t)),o=c.data.aid}return{action:r,aid1:o}}(t,n,r);o=p.action,l=p.aid1,c=s.atoms.get(l),u=mo.calcAngle(s.atoms.get(n).pp,c.pp)-e.angle0}else null===r&&(r=mo.calcAngle(c.pp,Ai(t,n).pos)),u=r-e.angle0;var d=new Map,h=i.atoms.get(e.aid).pp,f=yi(t,n,"fragment"),m={atoms:[],bonds:[]};return i.atoms.forEach((function(n,r){var a=Ot.getAttrHash(n);if(a.fragment=f,r===e.aid)o.mergeWith(Wi(t,l,a,!0)),d.set(r,l),m.atoms.push(l);else{var i=pt.diff(n.pp,h).rotate(u).add(c.pp),s=new pi.AtomAdd(a,i.get_xy0()).perform(t);o.addOp(s),d.set(r,s.data.aid),m.atoms.push(s.data.aid)}})),Xi(o,t,m.atoms,n),i.bonds.forEach((function(e){var n=new pi.BondAdd(d.get(e.begin),d.get(e.end),e).perform(t);o.addOp(n),m.bonds.push(n.data.bid)})),o.operations.reverse(),[o,m]}function Us(t,e,n,r,a,o){if(!o)return Ws(t,e,n,a);return Ds(t,e,n,r,(function(t,e,n){return Ws(t,e,n,a)}))}function Ws(t,e,n,r){var a=new di,o=e.molecule,i=t.molecule,s=i.bonds.get(n),c=o.bonds.get(e.bid),l=o.atoms.get(r?c.end:c.begin),u=new Map([[c.begin,r?s.end:s.begin],[c.end,r?s.begin:s.end]]),p={begin:r?c.end:c.begin,end:r?c.begin:c.end},d=mo.mergeBondsParams(i,s,o,p),h=d.angle,f=d.scale,m=i.getBondFragment(n),g={atoms:[],bonds:[]};return o.atoms.forEach((function(e,n){var r=Ot.getAttrHash(e);if(r.fragment=m,n!==c.begin&&n!==c.end){var o=pt.diff(e.pp,l.pp).rotate(h).scaled(f).add(i.atoms.get(s.begin).pp),p=vi.atom(t,o,null,.1);if(null===p){var d=new pi.AtomAdd(r,o).perform(t);a.addOp(d),u.set(n,d.data.aid),g.atoms.push(d.data.aid)}else u.set(n,p.id),a.mergeWith(Wi(t,u.get(n),r,!0))}else a.mergeWith(Wi(t,u.get(n),r,!0))})),Xi(a,t,g.atoms,s.begin),o.bonds.forEach((function(e){var n=i.findBondId(u.get(e.begin),u.get(e.end));if(null===n){var r=new pi.BondAdd(u.get(e.begin),u.get(e.end),e).perform(t);a.addOp(r),g.bonds.push(r.data.bid)}else a.mergeWith(ps(t,n,c,!0))})),a.operations.reverse(),[a,g]}function Ys(t,e){if(!(this instanceof Ys))return new Ys(t,e);this.editor=t,this.editor.selection(null),this.template={aid:parseInt(e.aid)||0,bid:parseInt(e.bid)||0};var n=e.struct;n.rescale();var r=new pt;n.atoms.forEach((function(t){r.add_(t.pp)})),this.template.molecule=n,this.findItems=[],this.template.xy0=r.scaled(1/(n.atoms.size||1));var a=n.atoms.get(this.template.aid);a&&(this.template.angle0=mo.calcAngle(a.pp,this.template.xy0),this.findItems.push("atoms"));var o=n.bonds.get(this.template.bid);o&&(this.template.sign=qs(n,o,this.template.xy0),this.findItems.push("bonds"))}function qs(t,e,n){var r=t.atoms.get(e.begin).pp,a=t.atoms.get(e.end).pp,o=pt.cross(pt.diff(r,a),pt.diff(n,a));return o>0?1:o<0?-1:0}function $s(t,e){if(!(this instanceof $s))return new $s(t,e);this.editor=t,this.editor.selection(null),this.charge=e}function Ks(t){if(!(this instanceof Ks))return t.selection(null),new Ks(t);this.editor=t}function Xs(t){if(!(this instanceof Xs))return new Xs(t);this.editor=t,this.editor.selection(null)}function Zs(t,e){if(!(this instanceof Zs))return new Zs(t,e);this.attach=e||{atomid:0,bondid:0},this.editor=t,this.editor.selection({atoms:[this.attach.atomid],bonds:[this.attach.bondid]})}function Qs(t){if(!(this instanceof Qs))return new Qs(t);this.editor=t,this.editor.selection(null)}function Js(t){if(!(this instanceof Js))return new Js(t);this.editor=t,this.editor.selection(null)}function tc(t){if(!(this instanceof tc))return new tc(t);this.editor=t,this.editor.selection(null)}function ec(t,e,n){for(var r,a,o=0;(!r||!a)&&o<t.reactants.length;o++){var i=Array.from(t.reactants[o]);!r&&i.indexOf(e)>=0&&(r="r"),!a&&i.indexOf(n)>=0&&(a="r")}for(var s=0;(!r||!a)&&s<t.products.length;s++){var c=Array.from(t.products[s]);!r&&c.indexOf(e)>=0&&(r="p"),!a&&c.indexOf(n)>=0&&(a="p")}return r&&a&&r!==a}function nc(t){if(!(this instanceof nc))return new nc(t);this.editor=t,this.editor.selection(null)}function rc(t,e){if(!(this instanceof rc))return new rc(t,e);this.editor=t,this.editor.selection(null),this.struct=e;var n=t.render,r=t.lastEvent?n.page2obj(t.lastEvent):null,a=Hs(n.ctab,this.struct,r),o=u()(a,2),i=o[0],s=o[1];this.action=i,this.editor.update(this.action,!0),this.mergeItems=xs(this.editor,s),this.editor.hover(Ss(this.mergeItems),this)}function ac(t,e,n,r){var a=t.molecule,o=new di;if(e||(e=Si(a)),!e.atoms)return o.perform(t);var i=e.atoms.reduce((function(t,e){var n=a.atoms.get(e);return t[n.fragment]||(t[n.fragment]=[]),t[n.fragment].push(e),t}),{});return Object.keys(i).find((function(t){return t=parseInt(t,10),!a.getFragmentIds(t).equals(new yt(i[t]))}))?o:(Object.keys(i).forEach((function(s){var c=new yt(i[s]),l=a.getCoordBoundingBox(c),u=r||new pt((l.max.x+l.min.x)/2,(l.max.y+l.min.y)/2);(c.forEach((function(t){var e=oc(a.atoms.get(t),u,n);o.addOp(new pi.AtomMove(t,e))})),e.sgroupData)||Pi(t,Array.from(c)).forEach((function(t){var e=oc(t,u,n);o.addOp(new pi.SGroupDataMove(t.id,e))}))})),e.bonds&&e.bonds.forEach((function(t){var e=a.bonds.get(t);e.type===At.PATTERN.TYPE.SINGLE&&(e.stereo!==At.PATTERN.STEREO.UP?e.stereo===At.PATTERN.STEREO.DOWN&&o.addOp(new pi.BondAttr(t,"stereo",At.PATTERN.STEREO.UP)):o.addOp(new pi.BondAttr(t,"stereo",At.PATTERN.STEREO.DOWN)))})),o.perform(t))}function oc(t,e,n){var r=new pt;return"horizontal"===n?r.x=e.x>t.pp.x?2*(e.x-t.pp.x):-2*(t.pp.x-e.x):r.y=e.y>t.pp.y?2*(e.y-t.pp.y):-2*(t.pp.y-e.y),r}function ic(t,e,n,r){var a=t.molecule,o=new di;(e||(e=Si(a)),e.atoms)&&(e.atoms.forEach((function(t){var e=a.atoms.get(t);o.addOp(new pi.AtomMove(t,sc(e.pp,n,r)))})),e.sgroupData||Pi(t,e.atoms).forEach((function(t){o.addOp(new pi.SGroupDataMove(t.id,sc(t.pp,n,r)))})));return e.rxnArrows&&e.rxnArrows.forEach((function(t){var e=a.rxnArrows.get(t);o.addOp(new pi.RxnArrowMove(t,sc(e.pp,n,r)))})),e.rxnPluses&&e.rxnPluses.forEach((function(t){var e=a.rxnPluses.get(t);o.addOp(new pi.RxnPlusMove(t,sc(e.pp,n,r)))})),e.sgroupData&&e.sgroupData.forEach((function(t){var e=a.sgroups.get(t);o.addOp(new pi.SGroupDataMove(t,sc(e.pp,n,r)))})),e.enhancedFlags&&e.enhancedFlags.forEach((function(e){var a=t.enhancedFlags.get(e);o.addOp(new pi.EnhancedFlagMove(e,sc(a.pp,n,r)))})),o.perform(t)}function sc(t,e,n){var r=t.sub(e);return(r=r.rotate(n)).add_(e),r.sub(t)}function cc(t,e){if(!(this instanceof cc)){if(!e)return new cc(t);var n=t.render.ctab,r=t.selection(),a=r&&r.bonds&&1===Object.keys(r).length&&1===r.bonds.length?function(t,e,n){var r=t.molecule,a=r.bonds.get(e),o=r.atoms.get(a.begin),i=r.atoms.get(a.end),s=o.pp.add(i.pp).scaled(.5),c=mo.calcAngle(o.pp,i.pp),l=Array.from(r.getFragmentIds(o.fragment));return 0===(c="horizontal"===n?-c:Math.PI/2-c)||Math.abs(c)===Math.PI?ac(t,{atoms:l},n,s):ic(t,{atoms:l},s,c)}(n,r.bonds[0],e):ac(n,r,e);return t.update(a),null}this.editor=t,t.selection()&&t.selection().atoms||this.editor.selection(null)}function lc(t,e){if(!(this instanceof lc))return new lc(t,e);this.mode=e,this.editor=t,this.editor.selection(null)}gs.prototype.mousedown=function(t){this.editor.hover(null),this.editor.selection(null);var e=this.editor.findItem(t,["atoms"]);e?"atoms"===e.map&&(this.dragCtx={item:e}):this.dragCtx={}},gs.prototype.mousemove=function(t){var e=this.editor.render;if(this.dragCtx&&this.dragCtx.item){var n=this.dragCtx,r=this.editor.findItem(t,["atoms"]);if(r&&"atoms"===r.map&&r.id===n.item.id)this.editor.hover(this.editor.findItem(t,["atoms"]));else{var a=e.ctab.molecule.atoms.get(n.item.id),o=mo.calcAngle(a.pp,e.page2obj(t));t.ctrlKey||(o=mo.fracAngle(o));var i=mo.degrees(o);this.editor.event.message.dispatch({info:i+"\xba"});var s=mo.calcNewAtomPos(a.pp,e.page2obj(t),t.ctrlKey);n.action&&n.action.perform(e.ctab),n.action=us(e.ctab,this.bondProps,n.item.id,Object.assign({},this.atomProps),s,s)[0],this.editor.update(n.action,!0)}}else this.editor.hover(this.editor.findItem(t,["atoms"]))},gs.prototype.mouseup=function(t){if(this.dragCtx){var e=this.dragCtx,n=this.editor.render;this.editor.update(e.action||(e.item?Wi(n.ctab,e.item.id,this.atomProps,!0):Ui(n.ctab,n.page2obj(t),this.atomProps))),delete this.dragCtx}this.editor.event.message.dispatch({info:!1})},As.prototype.mousedown=function(t){var e=this.editor.render,n=e.ctab,r=n.molecule;this.editor.hover(null);var a=this.lassoHelper.fragment||t.ctrlKey,o=this.editor.findItem(t,a?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","enhancedFlags","simpleObjects"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","enhancedFlags","simpleObjects"]);if(this.dragCtx={item:o,xy0:e.page2obj(t)},o&&"atoms"!==o.map||bs(this,e),!o)return delete this.dragCtx.item,this.lassoHelper.fragment||this.lassoHelper.begin(t),!0;var i=Ps(o),s=this.editor.selection();if("frags"===o.map){var c=n.frags.get(o.id);i={atoms:c.fragGetAtoms(n,o.id),bonds:c.fragGetBonds(n,o.id)}}else if("sgroups"===o.map){var l=n.sgroups.get(o.id).item;i={atoms:Ct.getAtoms(r,l),bonds:Ct.getBonds(r,l)}}else if("rgroups"===o.map){var u=n.rgroups.get(o.id);i={atoms:u.getAtoms(e),bonds:u.getBonds(e)}}else if("sgroupData"===o.map&&Cs(s,o))return!0;return t.shiftKey?this.editor.selection(Ts(i,s,!0)):this.editor.selection(Cs(s,o)?s:i),!0},As.prototype.mousemove=function(t){var e=this.editor,n=e.render,r=e.render.ctab,a=this.dragCtx;if(a&&a.stopTapping&&a.stopTapping(),a&&a.item){var o=r.molecule.atoms,i=e.selection();if("atoms"===a.item.map&&1===o.get(a.item.id).neighbors.length&&1===i.atoms.length&&!i.bonds){var s=n.page2obj(t),c=mo.calcAngle(a.xy0,s),l=mo.degrees(c);this.editor.event.message.dispatch({info:l+"\xba"})}a.action&&(a.action.perform(r),e.update(a.action,!0));var u=e.explicitSelected();return a.action=vs(r,u,e.render.page2obj(t).sub(a.xy0)),a.mergeItems=xs(e,u),e.hover(Ss(a.mergeItems)),e.update(a.action,!0),!0}if(this.lassoHelper.running()){var p=this.lassoHelper.addPoint(t);return e.selection(t.shiftKey?Ts(p,e.selection(),!1):p),!0}var d=this.lassoHelper.fragment||t.ctrlKey?["frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","enhancedFlags","simpleObjects"]:["atoms","bonds","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","enhancedFlags","simpleObjects"];return e.hover(e.findItem(t,d)),!0},As.prototype.mouseup=function(t){var e=this.editor,n=e.render.ctab,r=this.dragCtx;if(r&&r.stopTapping&&r.stopTapping(),r&&r.item)r.action=r.action?Os(n,r.mergeItems).mergeWith(r.action):Os(n,r.mergeItems),e.hover(null),r.mergeItems&&e.selection(null),0!==r.action.operations.length&&e.update(r.action),delete this.dragCtx;else if(this.lassoHelper.running()){var a=this.lassoHelper.end();e.selection(t.shiftKey?Ts(a,e.selection()):a)}else this.lassoHelper.fragment&&(t.shiftKey||e.selection(null));return this.editor.event.message.dispatch({info:!1}),!0},As.prototype.dblclick=function(t){var e=this.editor,n=this.editor.render,r=this.editor.findItem(t,["atoms","bonds","sgroups","sgroupData"]);if(!r)return!0;var a=n.ctab.molecule;if("atoms"===r.map){this.editor.selection(Ps(r));var o=a.atoms.get(r.id),i=e.event.elementEdit.dispatch(o);Promise.resolve(i).then((function(t){e.update(Wi(n.ctab,r.id,t))})).catch((function(){return null}))}else if("bonds"===r.map){this.editor.selection(Ps(r));var s=n.ctab.bonds.get(r.id).b,c=e.event.bondEdit.dispatch(s);Promise.resolve(c).then((function(t){e.update(ps(n.ctab,r.id,t))})).catch((function(){return null}))}else"sgroups"!==r.map&&"sgroupData"!==r.map||(this.editor.selection(Ps(r)),as(this.editor,r.id));return!0},As.prototype.cancel=function(){if(this.dragCtx&&this.dragCtx.stopTapping&&this.dragCtx.stopTapping(),this.dragCtx&&this.dragCtx.action){var t=this.dragCtx.action;this.editor.update(t)}this.lassoHelper.running()&&this.editor.selection(this.lassoHelper.end()),delete this.dragCtx,this.editor.hover(null)},As.prototype.mouseleave=As.prototype.cancel,Bs.prototype.mousedown=function(t){this.editor.findItem(t,this.maps)||this.lassoHelper.begin(t)},Bs.prototype.mousemove=function(t){this.lassoHelper.running()?this.editor.selection(this.lassoHelper.addPoint(t)):this.editor.hover(this.editor.findItem(t,this.maps))},Bs.prototype.mouseup=function(t){var e=this.editor.render;this.lassoHelper.running()&&(this.editor.update(ks(e.ctab,this.lassoHelper.end(t))),this.editor.selection(null))},Bs.prototype.click=function(t){var e=this.editor.render.ctab,n=this.editor.findItem(t,this.maps);if(n){if(this.editor.hover(null),"atoms"===n.map)this.editor.update(function(t,e){return ks(t,{atoms:[e]})}(e,n.id));else if("bonds"===n.map)this.editor.update(function(t,e){var n=t.molecule.getBondFragment(e),r=Ms(t,e);return r=Es(t,n).mergeWith(r)}(e,n.id));else if("sgroups"===n.map||"sgroupData"===n.map)this.editor.update(Bi(e,n.id));else if("rxnArrows"===n.map)this.editor.update(function(t,e){var n=new di;return n.addOp(new pi.RxnArrowDelete(e)),n.perform(t)}(e,n.id));else if("rxnPluses"===n.map)this.editor.update(function(t,e){var n=new di;return n.addOp(new pi.RxnPlusDelete(e)),n.perform(t)}(e,n.id));else{if("simpleObjects"!==n.map)return;this.editor.update(Rs(e,n.id))}this.editor.selection(null)}},Bs.prototype.mouseleave=Bs.prototype.mouseup,Bs.prototype.cancel=function(){this.lassoHelper.running()&&this.lassoHelper.end(),this.editor.selection(null)},Ls.prototype.mousedown=function(t){var e=this.editor.render;return this.editor.hover(null),this.editor.selection(null),this.dragCtx={xy0:e.page2obj(t),item:this.editor.findItem(t,["atoms","bonds"])},this.dragCtx.item||delete this.dragCtx.item,!0},Ls.prototype.mousemove=function(t){var e=this.editor,n=e.render;if("dragCtx"in this){var r=this.dragCtx,a=n.page2obj(t),o=mo.calcAngle(r.xy0,a);t.ctrlKey||(o=mo.fracAngle(o));var i=mo.degrees(o);if(this.editor.event.message.dispatch({info:i+"\xba"}),!("item"in r)||"atoms"===r.item.map){var s,c,l,u;"action"in r&&r.action.perform(n.ctab),"item"in r&&"atoms"===r.item.map?(s=r.item.id,c=e.findItem(t,["atoms"],r.item)):(s=this.atomProps,l=r.xy0,c=e.findItem(t,["atoms"]));var p=Number.MAX_VALUE;if(c&&"atoms"===c.map)c=c.id;else{c=this.atomProps;var d=n.page2obj(t);if(p=pt.dist(r.xy0,d),l)u=mo.calcNewAtomPos(l,d,t.ctrlKey);else{var h=n.ctab.molecule.atoms.get(s);l=mo.calcNewAtomPos(h.pp.get_xy0(),d,t.ctrlKey)}}return p>.3?r.action=us(n.ctab,this.bondProps,s,c,l,u)[0]:delete r.action,this.editor.update(r.action,!0),!0}}return this.editor.hover(this.editor.findItem(t,["atoms","bonds"])),!0},Ls.prototype.mouseup=function(t){if("dragCtx"in this){var e=this.dragCtx,n=this.editor.render,r=n.ctab.molecule;if("action"in e)this.editor.update(e.action);else if("item"in e){if("atoms"===e.item.map)this.editor.update(us(n.ctab,this.bondProps,e.item.id)[0]);else if("bonds"===e.item.map){var a=Object.assign({},this.bondProps),o=r.bonds.get(e.item.id);this.editor.update(fs(n.ctab,e.item.id,o,a))}}else{var i=n.page2obj(t),s=new pt(.5,0).rotate(this.bondProps.type===At.PATTERN.TYPE.SINGLE?-Math.PI/6:0),c=us(n.ctab,this.bondProps,{label:"C"},{label:"C"},pt.diff(i,s),pt.sum(i,s));this.editor.update(c[0])}delete this.dragCtx}return this.editor.event.message.dispatch({info:!1}),!0},Is.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms","bonds"]);return this.editor.hover(null),this.dragCtx={xy0:e.page2obj(t),item:n},n&&"atoms"===n.map&&(this.editor.selection({atoms:[n.id]}),bs(this,e)),this.dragCtx.item||delete this.dragCtx.item,!0},Is.prototype.mousemove=function(t){var e=this.editor,n=e.render.ctab,r=this.dragCtx;if(e.hover(this.editor.findItem(t,["atoms","bonds"])),!r)return!0;if(r&&r.stopTapping&&r.stopTapping(),e.selection(null),!r.item||"atoms"===r.item.map){r.action&&r.action.perform(n);var a=n.molecule.atoms,o=r.item?a.get(r.item.id).pp:r.xy0,i=e.render.page2obj(t),s=Math.ceil(pt.diff(i,o).length()),c=function(t,e,n,r,a){var o=Math.cos(Math.PI/6),i=Math.sin(Math.PI/6),s=new di,c=null!==a?yi(t,a,"fragment"):s.addOp((new pi.FragmentAdd).perform(t)).frid,l={atoms:[],bonds:[]},u=null!==a?a:s.addOp(new pi.AtomAdd({label:"C",fragment:c},e).perform(t)).data.aid;l.atoms.push(u),s.operations.reverse();for(var p=0;p<r;p++){var d=us(t,{},u,{},new pt(o*(p+1),1&p?0:i).rotate(n).add(e));s=d[0].mergeWith(s),u=d[2],l.bonds.push(d[3]),l.atoms.push(u)}return[s,l]}(n,o,t.ctrlKey?mo.calcAngle(o,i):mo.fracAngle(o,i),s,r.item?r.item.id:null),l=u()(c,2),p=l[0],d=l[1];return e.event.message.dispatch({info:s+" sectors"}),r.action=p,e.update(r.action,!0),r.mergeItems=xs(e,d),e.hover(Ss(r.mergeItems)),!0}return!0},Is.prototype.mouseup=function(){var t=this.dragCtx;if(!t)return!0;delete this.dragCtx;var e=this.editor,n=e.render.ctab,r=n.molecule;if(t.stopTapping&&t.stopTapping(),!t.action&&t.item&&"bonds"===t.item.map){var a=r.bonds.get(t.item.id);t.action=fs(n,t.item.id,a,{type:At.PATTERN.TYPE.SINGLE,stereo:At.PATTERN.STEREO.NONE})}else t.action=t.action?Os(n,t.mergeItems).mergeWith(t.action):Os(n,t.mergeItems);return e.selection(null),e.hover(null),t.action&&e.update(t.action),e.event.message.dispatch({info:!1}),!0},Is.prototype.cancel=Is.prototype.mouseup,Is.prototype.mouseleave=Is.prototype.mouseup,Ys.prototype.mousedown=function(t){var e=this.editor,n=e.render.ctab;this.editor.hover(null),this.dragCtx={xy0:e.render.page2obj(t),item:e.findItem(t,this.findItems)};var r=this.dragCtx,a=r.item;if(!a)return delete r.item,!0;if("bonds"===a.map){var o=n.molecule,i=new pt,s=o.bonds.get(a.id),c=o.atoms.get(s.begin).fragment,l=o.getFragmentIds(c),u=0,p=o.halfBonds.get(s.hb1).loop;if(p<0&&(p=o.halfBonds.get(s.hb2).loop),p>=0)o.loops.get(p).hbs.forEach((function(t){i.add_(o.atoms.get(o.halfBonds.get(t).begin).pp),u++}));else l.forEach((function(t){i.add_(o.atoms.get(t).pp),u++}));r.v0=i.scaled(1/u);var d=qs(o,s,r.v0);r.sign1=d||1,r.sign2=this.template.sign}return!0},Ys.prototype.mousemove=function(t){var e=this.editor.render.ctab;if(!this.dragCtx)return this.editor.hover(this.editor.findItem(t,this.findItems)),!0;var n=this.dragCtx,r=n.item,a=null,o=this.editor.render.page2obj(t),i=e.molecule;if(r&&"bonds"===r.map){var s=i.bonds.get(r.id),c=qs(i,s,o);if(n.sign1*this.template.sign>0&&(c=-c),c!==n.sign2||!n.action){n.action&&n.action.perform(e),n.sign2=c;var l=Us(e,this.template,r.id,this.editor.event,n.sign1*n.sign2>0,!1),p=u()(l,2);g=p[0],m=p[1],n.action=g,this.editor.update(n.action,!0),n.mergeItems=xs(this.editor,m),this.editor.hover(Ss(n.mergeItems))}return!0}var d=null;r?"atoms"===r.map&&(a=i.atoms.get(r.id).pp,d=pt.dist(a,o)>1):a=n.xy0;var h=mo.calcAngle(a,o);t.ctrlKey||(h=mo.fracAngle(h));var f=mo.degrees(h);if(this.editor.event.message.dispatch({info:f+"\xba"}),n.hasOwnProperty("angle")&&n.angle===f&&(!n.hasOwnProperty("extra_bond")||n.extra_bond===d))return!0;n.action&&n.action.perform(e),n.angle=f;var m,g=null;if(r){if("atoms"===r.map){var b=Gs(e,this.template,r.id,h,d),v=u()(b,2);g=v[0],m=v[1],n.extra_bond=d}}else{var y=Fs(e,this.template,a,h),w=u()(y,2);g=w[0],m=w[1]}return n.action=g,this.editor.update(n.action,!0),n.mergeItems=xs(this.editor,m),this.editor.hover(Ss(n.mergeItems)),!0},Ys.prototype.mouseup=function(t){var e=this,n=this.dragCtx;if(!n)return!0;delete this.dragCtx;var r,a=this.editor.render.ctab,o=a.molecule,i=n.item;if(n.action&&i&&"bonds"===i.map)return n.action.perform(a),Us(a,this.template,i.id,this.editor.event,n.sign1*n.sign2>0,!0).then((function(t){var n=u()(t,2),r=n[0],o=n[1],i=xs(e.editor,o);r=Os(a,i).mergeWith(r),e.editor.update(r)})),!0;var s=null;if(!n.action)if(i){if("atoms"===i.map){var c,l,p=a.atoms.get(i.id).a.neighbors.length;if(p>1)c=null,l=!0;else if(1===p){var d=o.atoms.get(i.id),h=o.halfBonds.get(d.neighbors[0]).end,f=o.atoms.get(h);c=t.ctrlKey?mo.calcAngle(f.pp,d.pp):mo.fracAngle(mo.calcAngle(f.pp,d.pp)),l=!1}else c=0,l=!1;var m=Gs(a,this.template,i.id,c,l),g=u()(m,2);r=g[0],s=g[1],n.action=r}else if("bonds"===i.map)return Us(a,this.template,i.id,this.editor.event,n.sign1*n.sign2>0,!0).then((function(t){var n=u()(t,2),r=n[0],o=n[1],i=xs(e.editor,o);r=Os(a,i).mergeWith(r),e.editor.update(r)})),!0}else{var b=Fs(a,this.template,n.xy0,0),v=u()(b,2);r=v[0],s=v[1],n.action=r}this.editor.selection(null),!n.mergeItems&&s&&(n.mergeItems=xs(this.editor,s)),n.action=n.action?Os(a,n.mergeItems).mergeWith(n.action):Os(a,n.mergeItems),this.editor.hover(null);var y=n.action;return y&&!y.isDummy()&&this.editor.update(y),this.editor.event.message.dispatch({info:!1}),!0},Ys.prototype.cancel=Ys.prototype.mouseup,Ys.prototype.mouseleave=Ys.prototype.mouseup,$s.prototype.mousemove=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms"]),r=e.ctab.molecule;return n&&"atoms"===n.map&&ut.map[r.atoms.get(n.id).label]?this.editor.hover(n):this.editor.hover(null),!0},$s.prototype.click=function(t){var e=this.editor,n=e.render,r=n.ctab.molecule,a=e.findItem(t,["atoms"]);return a&&"atoms"===a.map&&ut.map[r.atoms.get(a.id).label]&&(this.editor.hover(null),this.editor.update(Wi(n.ctab,a.id,{charge:r.atoms.get(a.id).charge+this.charge}))),!0},Ks.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["frags","rgroups"]))},Ks.prototype.click=function(t){var e=this.editor,n=e.render.ctab.molecule,r=e.findItem(t,["frags","rgroups"]);if(!r)return!0;this.editor.hover(null);var a="rgroups"===r.map?r.id:Rt.findRGroupByFragment(n.rgroups,r.id),o=Object.assign({label:a},"frags"===r.map?{fragId:r.id}:n.rgroups.get(r.id)),i=e.event.rgroupEdit.dispatch(o);return Promise.resolve(i).then((function(t){var n=e.render.ctab,a=null;if("rgroups"!==r.map){var o=Rt.findRGroupByFragment(n.molecule.rgroups,r.id);a=Fi(n,t.label,r.id).mergeWith(Gi(n,t.label,o))}else a=Vi(n,r.id,t);e.update(a)})).catch((function(){return null})),!0},Ks.prototype.cancel=function(){this.editor.hover(null)},Xs.prototype.mousemove=function(t){this.editor.hover(this.editor.findItem(t,["atoms"]))},Xs.prototype.click=function(t){var e=this.editor,n=e.render.ctab.molecule,r=e.findItem(t,["atoms"]);if(r&&"atoms"===r.map){this.editor.hover(null);var a=n.atoms.get(r.id),o=e.event.elementEdit.dispatch({attpnt:a.attpnt});return Promise.resolve(o).then((function(t){if(a.attpnt!==t.attpnt){var n=Wi(e.render.ctab,r.id,t);e.update(n)}})).catch((function(){return null})),!0}return!0},Zs.prototype.mousemove=function(t){var e=this.editor.render,n=this.editor.findItem(t,["atoms","bonds"]),r=e.ctab.molecule;return n&&("atoms"===n.map&&ut.map[r.atoms.get(n.id).label]||"bonds"===n.map)?this.editor.hover(n):this.editor.hover(null),!0},Zs.prototype.click=function(t){var e=this.editor,n=e.render.ctab.molecule,r=e.findItem(t,["atoms","bonds"]);return r&&("atoms"===r.map&&ut.map[n.atoms.get(r.id).label]||"bonds"===r.map)&&("atoms"===r.map?this.attach.atomid=r.id:this.attach.bondid=r.id,this.editor.selection({atoms:[this.attach.atomid],bonds:[this.attach.bondid]}),this.editor.event.attachEdit.dispatch(this.attach)),!0},Qs.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnArrows"]);n&&"rxnArrows"===n.map&&(this.editor.hover(null),this.editor.selection({rxnArrows:[n.id]}),this.dragCtx={xy0:e.page2obj(t),action:new di})},Qs.prototype.mousemove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(e.ctab),this.dragCtx.action=vs(e.ctab,this.editor.selection()||{},e.page2obj(t).sub(this.dragCtx.xy0)),this.editor.update(this.dragCtx.action,!0)):this.editor.hover(this.editor.findItem(t,["rxnArrows"]))},Qs.prototype.mouseup=function(){this.dragCtx&&(this.editor.update(this.dragCtx.action),delete this.dragCtx)},Qs.prototype.click=function(t){var e=this.editor.render;e.ctab.molecule.rxnArrows.size<1&&this.editor.update(function(t,e){var n=new di;return t.molecule.rxnArrows.size<1&&n.addOp(new pi.RxnArrowAdd(e).perform(t)),n}(e.ctab,e.page2obj(t)))},Js.prototype.mousedown=function(t){var e=this.editor.render,n=this.editor.findItem(t,["rxnPluses"]);n&&"rxnPluses"===n.map&&(this.editor.hover(null),this.editor.selection({rxnPluses:[n.id]}),this.dragCtx={xy0:e.page2obj(t)})},Js.prototype.mousemove=function(t){var e=this.editor.render;"dragCtx"in this?(this.dragCtx.action&&this.dragCtx.action.perform(e.ctab),this.dragCtx.action=vs(e.ctab,this.editor.selection()||{},e.page2obj(t).sub(this.dragCtx.xy0)),this.editor.update(this.dragCtx.action,!0)):this.editor.hover(this.editor.findItem(t,["rxnPluses"]))},Js.prototype.mouseup=function(){return!this.dragCtx||(this.dragCtx.action&&this.editor.update(this.dragCtx.action),delete this.dragCtx,!0)},Js.prototype.click=function(t){var e=this.editor.render;this.editor.findItem(t,["rxnPluses"])||this.editor.update(function(t,e){var n=new di;return n.addOp(new pi.RxnPlusAdd(e).perform(t)),n}(e.ctab,e.page2obj(t)))},tc.prototype.mousedown=function(t){var e=this.editor.render;this.rcs=e.ctab.molecule.getComponents();var n=this.editor.findItem(t,["atoms"]);n&&"atoms"===n.map&&(this.editor.hover(null),this.dragCtx={item:n,xy0:e.page2obj(t)})},tc.prototype.mousemove=function(t){var e=this.editor.render;if("dragCtx"in this){var n=this.editor.findItem(t,["atoms"],this.dragCtx.item),r=e.ctab.molecule.atoms;n&&"atoms"===n.map&&ec(this.rcs,this.dragCtx.item.id,n.id)?(this.editor.hover(n),this.updateLine(r.get(this.dragCtx.item.id).pp,r.get(n.id).pp)):(this.editor.hover(null),this.updateLine(r.get(this.dragCtx.item.id).pp,e.page2obj(t)))}else this.editor.hover(this.editor.findItem(t,["atoms"]))},tc.prototype.updateLine=function(t,e){if(this.line&&(this.line.remove(),this.line=null),t&&e){var n=this.editor.render;this.line=Ta.selectionLine(n.paper,ba.obj2scaled(t,n.options).add(n.options.offset),ba.obj2scaled(e,n.options).add(n.options.offset),n.options)}},tc.prototype.mouseup=function(t){var e=this;if("dragCtx"in this){var n=this.editor.render,r=this.editor.findItem(t,["atoms"],this.dragCtx.item);if(r&&"atoms"===r.map&&ec(this.rcs,this.dragCtx.item.id,r.id)){var a=new di,o=n.ctab.molecule.atoms,i=o.get(this.dragCtx.item.id),s=o.get(r.id),c=i.aam,l=s.aam;if(!c||c!==l){if((c&&c!==l||!c&&l)&&o.forEach((function(t,r){r!==e.dragCtx.item.id&&(c&&t.aam===c||l&&t.aam===l)&&a.mergeWith(Wi(n.ctab,r,{aam:0}))})),c)a.mergeWith(Wi(n.ctab,r.id,{aam:c}));else{var u=0;o.forEach((function(t){u=Math.max(u,t.aam||0)})),a.mergeWith(Wi(n.ctab,this.dragCtx.item.id,{aam:u+1})),a.mergeWith(Wi(n.ctab,r.id,{aam:u+1}))}this.editor.update(a)}}this.updateLine(null),delete this.dragCtx}this.editor.hover(null)},nc.prototype.mousemove=function(t){var e=this.editor.findItem(t,["atoms"]);e&&"atoms"===e.map?this.editor.hover(this.editor.render.ctab.molecule.atoms.get(e.id).aam?e:null):this.editor.hover(null)},nc.prototype.mouseup=function(t){var e=this,n=this.editor.findItem(t,["atoms"]),r=this.editor.render.ctab.molecule.atoms;if(n&&"atoms"===n.map&&r.get(n.id).aam){var a=new di,o=r.get(n.id).aam;r.forEach((function(t,n){t.aam===o&&a.mergeWith(Wi(e.editor.render.ctab,n,{aam:0}))})),this.editor.update(a)}this.editor.hover(null)},rc.prototype.mousemove=function(t){var e=this.editor.render;this.action&&this.action.perform(e.ctab);var n=Hs(e.ctab,this.struct,e.page2obj(t)),r=u()(n,2),a=r[0],o=r[1];this.action=a,this.editor.update(this.action,!0),this.mergeItems=xs(this.editor,o),this.editor.hover(Ss(this.mergeItems))},rc.prototype.mouseup=function(){var t=this.editor,e=t.render.ctab;if(t.selection(null),this.action=this.action?Os(e,this.mergeItems).mergeWith(this.action):Os(e,this.mergeItems),t.hover(null),this.action){var n=this.action;delete this.action,this.editor.update(n)}},rc.prototype.cancel=function(){var t=this.editor.render;this.editor.hover(null),this.action&&(this.action.perform(t.ctab),delete this.action,t.update())},rc.prototype.mouseleave=rc.prototype.cancel,cc.prototype.mousedown=function(t){var e,n=new pt,r=this.editor.selection(),a=this.editor.render,o=a.ctab.molecule;if(r&&r.atoms){var i=null,s=!1;r.atoms.forEach((function(t){var e=o.atoms.get(t);n.add_(e.pp),s||e.neighbors.find((function(e){var n=o.halfBonds.get(e);if(-1===r.atoms.indexOf(n.end)){if(n.loop>=0)if(!o.atoms.get(t).neighbors.find((function(t){var e=o.halfBonds.get(t);return e.loop>=0&&-1!==r.atoms.indexOf(e.end)})))return s=!0,!0;if(null==i)i=t;else if(i!==t)return s=!0,!0}return!1}))})),n=s||null===i?n.scaled(1/r.atoms.length):o.atoms.get(i).pp}else(null===(e=o.atoms)||void 0===e?void 0:e.size)?(o.atoms.forEach((function(t){n.add_(t.pp)})),n=n.scaled(1/o.atoms.size)):n=a.page2obj(t);return this.dragCtx={xy0:n,angle1:mo.calcAngle(n,a.page2obj(t))},!0},cc.prototype.mousemove=function(t){if(!this.dragCtx)return!0;var e=this.editor.render,n=this.dragCtx,r=e.page2obj(t),a=mo.calcAngle(n.xy0,r)-n.angle1;t.ctrlKey||(a=mo.fracAngle(a));var o=mo.degrees(a);if("angle"in n&&n.angle===o)return!0;"action"in n&&n.action.perform(e.ctab),n.angle=o,n.action=ic(e.ctab,this.editor.selection(),n.xy0,a),this.editor.event.message.dispatch({info:o+"\xba"});var i=this.editor.explicitSelected();return n.mergeItems=xs(this.editor,i),this.editor.hover(Ss(n.mergeItems)),this.editor.update(n.action,!0),!0},cc.prototype.mouseup=function(){if(!this.dragCtx)return!0;var t=this.dragCtx,e=this.editor.render.ctab,n=t.action?Os(e,t.mergeItems).mergeWith(t.action):Os(e,t.mergeItems);return delete this.dragCtx,this.editor.update(n),this.editor.hover(null),t.mergeItems&&this.editor.selection(null),this.editor.event.message.dispatch({info:!1}),!0},cc.prototype.cancel=cc.prototype.mouseup,cc.prototype.mouseleave=cc.prototype.mouseup,lc.prototype.mousedown=function(t){var e=this.editor.render.page2obj(t);this.dragCtx={p0:e};var n=this.editor.findItem(t,["simpleObjects"]);n&&"simpleObjects"===n.map?(this.editor.hover(null),this.editor.selection({simpleObjects:[n.id]}),this.dragCtx.ci=n):this.dragCtx.isNew=!0},lc.prototype.mousemove=function(t){var e=this.editor.render;if(this.dragCtx){var n=e.page2obj(t),r=n.sub(this.dragCtx.p0);if(this.dragCtx.previous=n,this.dragCtx.ci)this.dragCtx.action&&this.dragCtx.action.perform(e.ctab),this.dragCtx.ci.ref?this.dragCtx.action=Ns(e.ctab,this.dragCtx.ci.id,r,n,this.dragCtx.ci.ref):this.dragCtx.action=vs(e.ctab,this.editor.selection()||{},r),this.editor.update(this.dragCtx.action,!0);else{if(this.dragCtx.action)this.dragCtx.action.perform(e.ctab);else{var a=js(e.ctab,[this.dragCtx.p0,this.dragCtx.p0],this.mode),o=a.operations[0].data.id;this.dragCtx.itemId=o,this.dragCtx.action=a,this.editor.update(this.dragCtx.action,!0)}this.dragCtx.action=Ns(e.ctab,this.dragCtx.itemId,r,n,null),this.editor.update(this.dragCtx.action,!0)}}else{var i=this.editor.findItem(t,["simpleObjects"]);this.editor.hover(i)}},lc.prototype.mouseup=function(t){if(!this.dragCtx)return!0;if(this.dragCtx.action){if(this.dragCtx.isNew){var e=this.editor.render;this.editor.update(Rs(e.ctab,this.dragCtx.itemId),!0),this.dragCtx.action=js(e.ctab,[this.dragCtx.p0,this.dragCtx.previous],this.mode)}this.editor.update(this.dragCtx.action)}return delete this.dragCtx,!0};var uc={rgroupatom:Zi,select:As,sgroup:rs,eraser:Bs,atom:gs,bond:Ls,chain:Is,template:Ys,charge:$s,rgroupfragment:Ks,apoint:Xs,attach:Zs,reactionarrow:Qs,reactionplus:Js,reactionmap:tc,reactionunmap:nc,paste:rc,rotate:cc,enhancedStereo:function t(e){if(!(this instanceof t)){var n=e.selection();if(!n||!n.atoms)return null;var r=(a=e.struct(),n.atoms.filter((function(t){return null!==a.atoms.get(t).stereoLabel})));if(0===r.length)return null;!function(t,e){var n=t.struct(),r=n.atoms.get(e.atoms[0]).fragment,a=new yt(n.getFragmentIds(r)),o=new yt(e.atoms);return a.equals(o)}(e,n)?function(t,e){var n=t.struct(),r=t.render.ctab;return t.event.enhancedStereoEdit.dispatch({type:"atoms",stereoLabel:n.atoms.get(e[0]).stereoLabel}).then((function(t){var a=Wi(r,e,{stereoLabel:t}).mergeWith(ys(r,n.atoms.get(e[0]).fragment));return a.operations.reverse(),a}))}(e,r).then((function(t){return t&&e.update(t)})):function(t,e){var n=t.struct(),r=t.render.ctab,a=n.atoms.get(e[0]).fragment,o=n.frags.get(a).enhancedStereoFlag;return t.event.enhancedStereoEdit.dispatch({type:"fragment",stereoFlag:o}).then((function(t){var n=t.stereoFlag;if(n===o)return null;var i=null!==n?"".concat(n).concat("abs"!==n?"-1":""):null;return ys(r,a,n).mergeWith(Wi(r,e,{stereoLabel:i}))}))}(e,r).then((function(t){return t&&e.update(t)}))}var a},simpleobject:lc},pc=["atoms","bonds","frags","sgroups","sgroupData","rgroups","rxnArrows","rxnPluses","enhancedFlags","simpleObjects"];function dc(t,e){this.render=new bo(t,Object.assign({scale:40},e)),this._selection=null,this._tool=null,this.historyStack=[],this.historyPtr=0,this.event={message:new G.a.Subscription,elementEdit:new G.a.PipelineSubscription,bondEdit:new G.a.PipelineSubscription,rgroupEdit:new G.a.PipelineSubscription,sgroupEdit:new G.a.PipelineSubscription,sdataEdit:new G.a.PipelineSubscription,quickEdit:new G.a.PipelineSubscription,attachEdit:new G.a.PipelineSubscription,change:new G.a.PipelineSubscription,selectionChange:new G.a.PipelineSubscription,aromatizeStruct:new G.a.PipelineSubscription,dearomatizeStruct:new G.a.PipelineSubscription,enhancedStereoEdit:new G.a.PipelineSubscription},function(t,e){["click","dblclick","mousedown","mousemove","mouseup","mouseleave"].forEach((function(n){t.event[n]=new G.a.DOMSubscription;var r=t.event[n];e.addEventListener(n,r.dispatch.bind(r)),r.add((function(e){if("mouseup"!==n&&"mouseleave"!==n&&(function(t){return t.which&&3===t.which||t.button&&2===t.button}(e)||!e.target||"DIV"===e.target.nodeName))return t.hover(null),!0;var r=t.tool();return t.lastEvent=e,r&&n in r&&r[n](e),!0}),-1)}))}(this,t)}dc.prototype.tool=function(t,e){if(arguments.length>0){this._tool&&this._tool.cancel&&this._tool.cancel();var n=uc[t](this,e);if(!n)return null;this._tool=n}return this._tool},dc.prototype.clear=function(){this.struct(null)},dc.prototype.struct=function(t){return arguments.length>0&&(this.selection(null),this.update(hi(this.render.ctab,t||new Nt)),fc(this,mc(this.render.ctab))),this.render.ctab.molecule},dc.prototype.options=function(t){if(arguments.length>0){var e=this.render.ctab.molecule,n=this.render.options.zoom;this.render.clientArea.innerHTML="",this.render=new bo(this.render.clientArea,Object.assign({scale:40},t)),this.render.setMolecule(e),this.render.setZoom(n),this.render.update()}return this.render.options},dc.prototype.zoom=function(t){return arguments.length>0&&(this.render.setZoom(t),fc(this,mc(this.render.ctab,this.selection())),this.render.update()),this.render.options.zoom},dc.prototype.selection=function(t){var e=this.render.ctab;if(arguments.length>0){if(this._selection=null,"all"===t&&(t=pc.reduce((function(t,n){return t[n]=Array.from(e[n].keys()),t}),{})),"descriptors"===t&&(e=this.render.ctab,t={sgroupData:Array.from(e.sgroupData.keys())}),t){var n={};Object.keys(t).forEach((function(e){t[e].length>0&&(n[e]=t[e].slice())})),0!==Object.keys(n).length&&(this._selection=n)}this.render.ctab.setSelection(this._selection),this.event.selectionChange.dispatch(this._selection),this.render.update()}return this._selection},dc.prototype.hover=function(t,e){var n=e||this._tool;!("ci"in n)||t&&n.ci.map===t.map&&n.ci.id===t.id||(this.highlight(n.ci,!1),delete n.ci),t&&this.highlight(t,!0)&&(n.ci=t)};var hc=["atoms","bonds","rxnArrows","rxnPluses","frags","merge","rgroups","sgroups","sgroupData","enhancedFlags","simpleObjects"];function fc(t,e){t.render.setScrollOffset(0,0)}function mc(t,e){var n=t.getVBoxObj(e||{});return pt.lc2(n.p0,.5,n.p1,.5)}function gc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function bc(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}function vc(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.struct,a=e.tool,o=e.toolOpts,i=e.options;r!==n.struct&&t.struct(r),a===n.tool&&o===n.toolOpts||(t.tool(a,o),o!==n.toolOpts&&t.event.message.dispatch({info:JSON.stringify(o)})),n.options&&i!==n.options&&t.options(i),Object.keys(t.event).forEach((function(r){var a="on".concat(Object(M.upperFirst)(r));e[a]!==n[a]&&(n[a]&&t.event[r].remove(n[a]),e[a]&&t.event[r].add(e[a]))}))}dc.prototype.highlight=function(t,e){if(-1===hc.indexOf(t.map))return!1;var n=this.render,r=null;if("merge"===t.map)return Object.keys(t.items).forEach((function(a){t.items[a].forEach((function(t){(r=n.ctab[a].get(t))&&r.setHighlight(e,n)}))})),!0;if(!(r=n.ctab[t.map].get(t.id)))return!0;if("sgroups"===t.map&&"DAT"===r.item.type||"sgroupData"===t.map){var a=n.ctab.sgroups.get(t.id),o=n.ctab.sgroupData.get(t.id);a&&a.setHighlight(e,n),o&&o.setHighlight(e,n)}else r.setHighlight(e,n);return!0},dc.prototype.update=function(t,e){!0===t?this.render.update(!0):(e||t.isDummy()||(this.historyStack.splice(this.historyPtr,33,t),this.historyStack.length>32&&this.historyStack.shift(),this.historyPtr=this.historyStack.length,this.event.change.dispatch(t)),this.render.update())},dc.prototype.historySize=function(){return{undo:this.historyPtr,redo:this.historyStack.length-this.historyPtr}},dc.prototype.undo=function(){if(0===this.historyPtr)throw new Error("Undo stack is empty");if(this.tool()&&this.tool().cancel&&this.tool().cancel(),this.selection(null),this._tool instanceof uc.paste)this.event.change.dispatch();else{this.historyPtr--;var t=this.historyStack[this.historyPtr].perform(this.render.ctab);this.historyStack[this.historyPtr]=t,this.event.change.dispatch(t),this.render.update()}},dc.prototype.redo=function(){if(this.historyPtr===this.historyStack.length)throw new Error("Redo stack is empty");if(this.tool()&&this.tool().cancel&&this.tool().cancel(),this.selection(null),this._tool instanceof uc.paste)this.event.change.dispatch();else{var t=this.historyStack[this.historyPtr].perform(this.render.ctab);this.historyStack[this.historyPtr]=t,this.historyPtr++,this.event.change.dispatch(t),this.render.update()}},dc.prototype.on=function(t,e){this.event[t].add(e)},dc.prototype.findItem=function(e,n,r){var a=t._ui_editor?new pt(this.render.page2obj(e)):new pt(e.pageX,e.pageY).sub(function(t){var e=0,n=0;do{e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent}while(t);return new pt(n,e)}(this.render.clientArea));return vi.item(this.render.ctab,a,n,r,this.render.options)},dc.prototype.findMerge=function(t,e){return vi.merge(this.render.ctab,t,e,this.render.options)},dc.prototype.explicitSelected=function(){var t=this.selection()||{},e=pc.reduce((function(e,n){return e[n]=t[n]?t[n].slice():[],e}),{}),n=this.render.ctab.molecule;return e.bonds&&e.bonds.forEach((function(t){var r=n.bonds.get(t);e.atoms=e.atoms||[],e.atoms.indexOf(r.begin)<0&&e.atoms.push(r.begin),e.atoms.indexOf(r.end)<0&&e.atoms.push(r.end)})),e.atoms&&e.bonds&&n.bonds.forEach((function(t,n){!e.bonds.indexOf(n)<0&&e.atoms.indexOf(t.begin)>=0&&e.atoms.indexOf(t.end)>=0&&(e.bonds=e.bonds||[],e.bonds.push(n))})),e},dc.prototype.structSelected=function(){var t=this.render.ctab.molecule,e=this.explicitSelected(),n=t.clone(new yt(e.atoms),new yt(e.bonds),!0,null,new yt(e.simpleObjects));return t.rxnArrows.forEach((function(t,r){-1!==e.rxnArrows.indexOf(r)&&n.rxnArrows.add(t.clone())})),t.rxnPluses.forEach((function(t,r){-1!==e.rxnPluses.indexOf(r)&&n.rxnPluses.add(t.clone())})),n.isReaction=t.isReaction&&(n.rxnArrows.size||n.rxnPluses.size),n},dc.prototype.alignDescriptors=function(){this.selection(null);var t=function(t){var e=new di;return e.addOp(new pi.AlignDescriptors(t)),e.perform(t)}(this.render.ctab);this.update(t),this.render.update(!0)};var yc=function(t){v()(n,t);var e=bc(n);function n(t){var a;return d()(this,n),(a=e.call(this,t)).editorRef=Object(r.createRef)(),a.logRef=Object(r.createRef)(),a}return f()(n,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentWillReceiveProps",value:function(t){vc(this.editor,t,this.props)}},{key:"componentDidMount",value:function(){var t=this;this.editor=new dc(this.editorRef.current,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gc(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},this.props.options)),vc(this.editor,this.props),this.props.onInit&&this.props.onInit(this.editor),this.editor.event.message.add((function(e){var n=t.logRef.current;e.info?(n.innerHTML=e.info,n.classList.add("visible")):n.classList.remove("visible")}))}},{key:"componentWillUnmount",value:function(){!function(t,e){Object.keys(t.event).forEach((function(n){var r="on".concat(Object(M.upperFirst)(n));e[r]&&t.event[n].remove(e[r])}))}(this.editor,this.props)}},{key:"render",value:function(){var t=this.props,e=t.Tag,n=void 0===e?"div":e,r=(t.struct,t.tool,t.toolOpts,t.options,t.onInit,t.onSelectionChange,t.onElementEdit,t.onEnhancedStereoEdit,t.onQuickEdit,t.onBondEdit,t.onRgroupEdit,t.onSgroupEdit,t.onSdataEdit,t.onMessage,t.onAromatizeStruct,t.onDearomatizeStruct,t.onAttachEdit,D()(t,["Tag","struct","tool","toolOpts","options","onInit","onSelectionChange","onElementEdit","onEnhancedStereoEdit","onQuickEdit","onBondEdit","onRgroupEdit","onSgroupEdit","onSdataEdit","onMessage","onAromatizeStruct","onDearomatizeStruct","onAttachEdit"]));return a.a.createElement(n,V()({onMouseDown:function(t){return t.preventDefault()}},r,{ref:this.editorRef}),a.a.createElement("div",{className:"measure-log",ref:this.logRef}))}}]),n}(r.Component),wc=Object(N.b)((function(t){return{options:t.options.settings}}),(function(t){return t(ga)}))(yc);function Ec(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Oc=function(t){v()(n,t);var e=Ec(n);function n(t){var a;return d()(this,n),(a=e.call(this,t)).formRef=Object(r.createRef)(),a}return f()(n,[{key:"exit",value:function(t){var e=this.props,n=e.params,r=e.result,a=void 0===r?function(){return null}:r,o=e.valid,i="OK"===t?"onOk":"onCancel";n&&i in n&&("onOk"!==i||(void 0===o?function(){return!!a()}:o)())&&n[i](a())}},{key:"keyDown",value:function(t){var e=Object(L.b)(t),n=document.activeElement,r=n&&"TEXTAREA"===n.tagName;("Escape"===e||"Enter"===e&&!r)&&(this.exit("Enter"===e?"OK":"Cancel"),t.preventDefault(),t.stopPropagation())}},{key:"componentDidMount",value:function(){var t=this.formRef.current.querySelector(["input:not([type=checkbox]):not([type=button])","textarea","[contenteditable]","select"].join(","))||this.formRef.current.querySelector(["button.close"].join(","));t.focus&&t.focus()}},{key:"componentWillUnmount",value:function(){(document.querySelector(".cliparea")||document.body).focus()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=e.title,o=e.params,i=void 0===o?{}:o,s=e.result,c=void 0===s?function(){return null}:s,l=e.valid,u=void 0===l?function(){return!!c()}:l,p=e.buttons,d=void 0===p?["Cancel","OK"]:p,h=D()(e,["children","title","params","result","valid","buttons"]);return a.a.createElement("form",V()({ref:this.formRef,role:"dialog",onSubmit:function(t){return t.preventDefault()},onKeyDown:function(e){return t.keyDown(e)},tabIndex:"-1"},h),a.a.createElement("header",null,r,i.onCancel&&r&&a.a.createElement("button",{className:"close",onClick:function(){return t.exit("Cancel")}},"\xd7")),a.a.createElement("div",{className:"dialog-body"},n),a.a.createElement("footer",null,d.map((function(e){return"string"!==typeof e?e:a.a.createElement("input",{key:e,type:"button",value:e,disabled:"OK"===e&&!u(),onClick:function(){return t.exit(e)}})}))))}}]),n}(r.Component);function xc(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Sc=function(e){v()(r,e);var n=xc(r);function r(e){var a;return d()(this,r),(a=n.call(this,e)).state={},e.server&&function(e){return new Promise((function(n,r){if(t.FileReader)n(Ac);else if(t.ActiveXObject)try{var a=new ActiveXObject("Scripting.FileSystemObject");n((function(t){return Promise.resolve(function(t,e){var n=t.OpenTextFile(e.name,1),r=n.ReadAll();return n.Close(),r}(a,t))}))}catch(o){r(o)}else e?n(e.then((function(){throw Error("Server doesn't still support echo method")}))):r(new Error("Your browser does not support opening files locally"))}))}(e.server).then((function(t){a.setState({opener:t})})),a}return f()(r,[{key:"open",value:function(t){var e=t.target.files,n=function(){return null},r=this.props,a=r.onLoad,o=void 0===a?n:a,i=r.onError,s=void 0===i?n:i;this.state.opener&&e.length?this.state.opener(e[0]).then(o,s):e.length&&o(e[0]),t.target.value=null,t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=e.type,o=(e.server,e.className),i=void 0===o?"open-button":o,s=D()(e,["children","type","server","className"]);return a.a.createElement("button",V()({onClick:function(){return t.btn.click()},className:i},s),a.a.createElement("input",{onChange:function(e){return t.open(e)},accept:r,type:"file",ref:function(e){t.btn=e}}),n)}}]),r}(r.Component);function Ac(t){return new Promise((function(e,n){var r=new FileReader;r.onload=function(){var n=r.result;t.msClose&&t.msClose(),e(n)},r.onerror=function(t){n(t)},r.readAsText(t,"UTF-8")}))}function Pc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Tc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pc(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Cc(t,e){var n=e.action,r=e.editor,a=e.server,o=e.options;if(n.tool){if(r.tool(n.tool,n.opts))return n}else"function"===typeof n&&n(r,a,o);return t}function Rc(t,e,n){var r=n.editor,a=n.server;return"function"===typeof t.selected?t.selected(r,a):!(!t.action||!t.action.tool)&&Object(M.isEqual)(e,t.action)}function jc(t,e){var n=e.editor,r=e.server,a=e.options;return"function"===typeof t.disabled&&t.disabled(n,r,a)}function Nc(t,e,n){var r=Ur[t];return Object(M.pickBy)((function(t){return t}),{selected:Rc(r,e,n),disabled:jc(r,n)})}function Mc(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function kc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Mc(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Mc(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Bc={freqAtoms:[],currentAtom:0,opened:null,visibleTools:{select:"select-lasso"}};function Lc(t,e){var n=/(bond)(-)(common|stereo|query)/,r=window.innerHeight;return Object.keys(t).reduce((function(e,a){return"bond"===a&&r>700||"transform"===a&&r>800||"rgroup"===a&&r>850||"shape"===a&&r>900||(!a.match(n)||r>700)&&(e[a]=t[a]),e}),kc({},e))}function Ic(t,e,n){return t=Object(M.capitalize)(t),er.indexOf(t)>-1||-1!==e.indexOf(t)?{freqAtoms:e}:(e[n]=t,{freqAtoms:e,currentAtom:n=(n+1)%7})}function Dc(t){var e=Object.keys(tr).find((function(e){return Object(M.isEqual)(t,tr[e].action)})),n=document.getElementById(e),r=n&&zc(n);return r&&""!==r.id?C()({},r.id,n.id):null}function zc(t,e){e=e||document.body;for(var n=t;"hidden"!==window.getComputedStyle(n).overflow&&!n.classList.contains("opened");){if(n===e)return null;n=n.parentNode}return n}function _c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Hc(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_c(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Vc=Object(K.c)({actionState:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=n.type,a=n.action,o=D()(n,["type","action"]);switch(r){case"INIT":a=Ur["select-lasso"].action;case"ACTION":t=Cc(e&&e.activeTool,Tc(Tc({},o),{},{action:a}));case"UPDATE":return Object.keys(Ur).reduce((function(t,e){var n=Nc(e,t.activeTool,o);return Object(M.isEmpty)(n)||(t[e]=n),t}),{activeTool:t||e.activeTool});default:return e}},toolbar:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Bc,e=arguments.length>1?arguments[1]:void 0,n=e.type,r=e.data;switch(n){case"ACTION":var a=Dc(e.action);return kc(kc({},t),{},a?{opened:null,visibleTools:kc(kc({},t.visibleTools),a)}:{opened:null});case"ADD_ATOMS":var o=Ic(r,t.freqAtoms,t.currentAtom);return kc(kc({},t),o);case"CLEAR_VISIBLE":var i=Dc(e.data),s=Lc(t.visibleTools,i);return kc(kc({},t),{},{opened:null,visibleTools:kc({},s)});case"OPENED":return r.isSelected&&t.opened?kc(kc({},t),{},{opened:null}):kc(kc({},t),{},{opened:r.menuName});case"UPDATE":case"MODAL_OPEN":return kc(kc({},t),{},{opened:null});default:return t}},modal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,n=e.type,r=e.data;if("UPDATE_FORM"===n){var a=Nr(t.form,e,t.name);return $r($r({},t),{},{form:a})}switch(n){case"MODAL_CLOSE":return null;case"MODAL_OPEN":return{name:r.name,form:Rr[r.name]||null,prop:r.prop||null};default:return t}},server:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t},editor:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t},options:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,n=e.type,r=e.data;return"APP_OPTIONS"===n?yr(yr({},t),{},{app:yr(yr({},t.app),r)}):"SAVE_SETTINGS"===n?yr(yr({},t),{},{settings:r}):"SAVE_CHECK_OPTS"===n?yr(yr({},t),{},{check:r}):"CHANGE_ANALYSE"===n?yr(yr({},t),{},{analyse:yr(yr({},t.analyse),r)}):Or.includes(n)?yr(yr({},t),{},{recognize:yr(yr({},t.recognize),r)}):t},templates:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:la,e=arguments.length>1?arguments[1]:void 0;if(ua.includes(e.type))return Object.assign({},t,e.data);if(pa.includes(e.type)){var n=Object.assign({},t.attach,e.data);return sa(sa({},t),{},{attach:n})}return t}});function Fc(e,n){switch(n.type){case"INIT":t._ui_editor=n.editor,t.ketcher.editor=n.editor;case"UPDATE":n.type;var r=D()(n,["type"]);r&&(e=Hc(Hc({},e),r))}var a=Vc(e,Hc(Hc({},n),Object(M.pick)(["editor","server","options"],e))),o=a===e.shared?e:Hc(Hc({},e),a);return t.currentState=o,o}function Gc(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Uc=function(t){v()(n,t);var e=Gc(n);function n(t){var a;return d()(this,n),(a=e.call(this,t)).state={structStr:"",fragment:!1},a.textAreaRef=Object(r.createRef)(),a}return f()(n,[{key:"result",value:function(){var t=this.state,e=t.structStr,n=t.fragment;return e?{structStr:e,fragment:n}:null}},{key:"changeStructStr",value:function(t){this.setState({structStr:t})}},{key:"changeFragment",value:function(t){this.setState({fragment:t.checked})}},{key:"render",value:function(){var t=this,e=this.state,n=e.structStr,r=e.fragment;return a.a.createElement(Oc,{title:"Open Structure",className:"open",result:function(){return t.result()},params:this.props,buttons:[a.a.createElement(Sc,{key:Wc().toString(),server:this.props.server,type:Wc(),onLoad:function(e){return t.changeStructStr(e)}},"Open From File\u2026"),"Cancel","OK"]},a.a.createElement("textarea",{value:n,onInput:function(e){return t.changeStructStr(e.target.value)}}),a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",checked:r,onClick:function(e){return t.changeFragment(e.target)}}),"Load as a fragment and copy to the Clipboard"),a.a.createElement(dn,{focused:function(){return!0},onCopy:function(){return{"text/plain":n}}}))}}]),n}(r.Component);function Wc(){return Object.keys(an).reduce((function(t,e){return t.concat.apply(t,[an[e].mime].concat(P()(an[e].ext)))}),[]).join(",")}var Yc=Object(N.b)((function(t){return{server:t.server}}),(function(t,e){return{onOk:function(n){n.fragment&&gn("copy"),t(Br(n.structStr,{badHeaderRecover:!0,fragment:n.fragment})),e.onOk(n)}}}))(Uc);function qc(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}function $c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Kc(t){t.schema;var e=t.value,n=void 0===e?"":e,r=t.onChange,o=t.type,i=void 0===o?"text":o,s=D()(t,["schema","value","onChange","type"]);return a.a.createElement("input",V()({type:i,value:n,onInput:r,onChange:r},s))}function Xc(t){t.schema;var e=t.value,n=t.onChange,r=D()(t,["schema","value","onChange"]);return a.a.createElement("textarea",V()({value:e,onInput:n},r))}function Zc(t){t.schema;var e=t.value,n=void 0===e?"":e,r=t.onChange,o=D()(t,["schema","value","onChange"]);return a.a.createElement("input",V()({type:"checkbox",checked:n,onClick:r,onChange:r},o))}function Qc(t){var e=t.schema,n=t.value,r=t.selected,o=t.onSelect,i=D()(t,["schema","value","selected","onSelect"]);return a.a.createElement("select",V()({onChange:o},i),tl(e,(function(t,e){return a.a.createElement("option",{key:e,selected:r(e,n),value:"object"!==B()(e)&&e},t)})))}function Jc(t){var e=t.schema,n=t.value,r=t.selected,o=t.onSelect,i=t.type,s=void 0===i?"radio":i,c=D()(t,["schema","value","selected","onSelect","type"]);return a.a.createElement("fieldset",{onClick:o,className:"radio"},tl(e,(function(t,e){return a.a.createElement("li",{key:t},a.a.createElement("label",null,a.a.createElement("input",V()({type:s,checked:r(e,n),value:"object"!==B()(e)&&e},c)),t))})))}function tl(t,e){var n=Array.isArray(t);if(!n&&t.items&&(t=t.items),"function"===typeof e)return(n?t:t.enum).map((function(r,a){var o=n?r.title:t.enumNames&&t.enumNames[a];return e(void 0!==o?o:r,r&&void 0!==r.value?r.value:r)}));if(!n)return t.enum[e];var r=t[e];return void 0!==r.value?r.value:r}function el(t,e,n){var r={};return e&&("number"!==e.type&&"integer"!==e.type||(r={type:"text"})),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$c(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({onChange:function(r){var a=t.val?t.val(r,e):r;n(a)}},r)}function nl(t,e){var n=e.schema,r=e.multiple,a=e.onChange;return n&&(n.enum||n.items||Array.isArray(n))&&"string"!==n.type?r||"array"===n.type?function(t,e,n){return{multiple:!0,selected:function(t,e){return e&&e.indexOf(t)>=0},onSelect:function(r,a){if(t.val){var o=t.val(r,e);void 0!==o&&n(o)}else{var i=a?a.indexOf(r):-1;n(i<0?a?[r].concat(P()(a)):[r]:[].concat(P()(a.slice(0,i)),P()(a.slice(i+1))))}}}}(t,n,a):function(t,e,n){return{selected:function(t,e){return e===t},onSelect:function(r){var a=t.val?t.val(r,e):r;void 0!==a&&n(a)}}}(t,n,a):el(t,n,a)}Kc.val=function(t,e){var n=t.target,r="number"===n.type||"range"===n.type||e&&("number"===e.type||"integer"===e.type),a=r?n.value.replace(/,/g,"."):n.value;return r&&!isNaN(a-0)?a-0:a},Xc.val=function(t){return t.target.value},Zc.val=function(t){return t.stopPropagation(),!!t.target.checked},Qc.val=function(t,e){var n=t.target;return n.multiple?[].reduce.call(n.options,(function(t,n,r){return n.selected?[tl(e,r)].concat(P()(t)):t}),[]):tl(e,n.selectedIndex)},Jc.val=function(t,e){var n=t.target;if("INPUT"===t.target.tagName){var r=n.parentNode.parentNode.parentNode,a=[].reduce.call(r.querySelectorAll("input"),(function(t,n,r){return n.checked?[tl(e,r)].concat(P()(t)):t}),[]);return"radio"===n.type?a[0]:a}t.stopPropagation()};var rl=function(t){v()(n,t);var e=qc(n);function n(t){var r;d()(this,n);var a=(r=e.call(this,t)).props.component;return r.component=a||function(t){var e=t.schema,n=t.type,r=t.multiple;return e&&(e.enum||e.items||Array.isArray(e))?r||"array"===e.type?"checkbox"===n?Jc:Qc:"radio"===n?Jc:Qc:"checkbox"===n||e&&"boolean"===e.type?Zc:"textarea"===n?Xc:Kc}(t),r.ctrl=nl(r.component,t),r}return f()(n,[{key:"shouldComponentUpdate",value:function(t){t.children,t.onChange,t.style;var e=D()(t,["children","onChange","style"]);return function(t,e){for(var n in t)if(!(n in e))return!0;for(var r in e)if(t[r]!==e[r])return!0;return!1}(Object(Y.omit)(this.props,["children","onChange","style"]),e)}},{key:"render",value:function(){var t=this.props,e=(t.children,t.onChange,D()(t,["children","onChange"])),n=this.component;return a.a.createElement(n,V()({},this.ctrl,e))}}]),n}(r.Component);function al(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}function ol(t){var e=t.value;return a.a.createElement("input",{type:"text",spellCheck:!1,value:e})}var il=/\b(\d*)([A-Z][a-z]{0,3}#?)(\d*)\s*\b/g,sl=/error:.*/g;function cl(t){return a.a.createElement("div",{className:"chem-input",spellCheck:"false",contentEditable:!0,suppressContentEditableWarning:!0},t)}function ll(t){var e=t.value;if(sl.test(e))return cl(e);for(var n,r=[],o=0;null!==(n=il.exec(e));)n[1].length>0&&r.push(a.a.createElement("sup",null,n[1])),r.push(e.substring(o,n.index)+n[2]),n[3].length>0&&r.push(a.a.createElement("sub",{key:n},n[3])),o=n.index+n[0].length;return 0===o?r.push(e):r.push(e.substring(o,e.length)),cl(r)}var ul=function(t){v()(n,t);var e=al(n);function n(t){var r;return d()(this,n),r=e.call(this,t),t.onAnalyse().catch(t.onCancel),r}return f()(n,[{key:"render",value:function(){var t=this.props,e=t.values,n=t.round,r=(t.onAnalyse,t.onChangeRound),o=D()(t,["values","round","onAnalyse","onChangeRound"]);return a.a.createElement(Oc,{title:"Calculated Values",className:"analyse",buttons:["Close"],params:o},a.a.createElement("ul",null,[{name:"Chemical Formula",key:"gross"},{name:"Molecular Weight",key:"molecular-weight",round:"roundWeight"},{name:"Exact Mass",key:"monoisotopic-mass",round:"roundMass"},{name:"Elemental Analysis",key:"mass-composition"}].map((function(t){return a.a.createElement("li",{key:t.key},a.a.createElement("label",null,t.name,":"),"gross"===t.key?a.a.createElement(ll,{value:e?e[t.key]:0}):a.a.createElement(ol,{value:e?pl(e[t.key],n[t.round]):0}),t.round?a.a.createElement(rl,{schema:{enum:Object(M.range)(0,8),enumNames:Object(M.range)(0,8).map((function(t){return"".concat(t," decimal places")}))},value:n[t.round],onChange:function(e){return r(t.round,e)}}):null)}))))}}]),n}(r.Component);function pl(t,e){return"number"===typeof t?t.toFixed(e):t.replace(/[0-9]*\.[0-9]+/g,(function(t){return(+t).toFixed(e)}))}var dl=Object(N.b)((function(t){return{values:t.options.analyse.values,round:{roundWeight:t.options.analyse.roundWeight,roundMass:t.options.analyse.roundMass}}}),(function(t){return{onAnalyse:function(){return t((function(t,e){var n=e(),r=n.editor,a=n.server,o=e().options.getServerSettings();return o.data={properties:["molecular-weight","most-abundant-mass","monoisotopic-mass","gross","mass-composition"]},Dr(r,a,"calculate",o).then((function(e){return t({type:"CHANGE_ANALYSE",data:{values:e}})})).catch((function(t){throw t}))}))},onChangeRound:function(e,n){return t(function(t,e){return{type:"CHANGE_ANALYSE",data:C()({},t,e)}}(e,n))}}}))(ul);function hl(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}function fl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ml(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fl(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fl(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var gl=function(t){v()(n,t);var e=hl(n);function n(t){var a;return d()(this,n),(a=e.call(this,t)).tagRef=Object(r.createRef)(),a}return f()(n,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var t,e=this.tagRef.current,n=this.props,r=n.struct,a=n.options;if(!(r instanceof Nt))try{t=je(r)}catch(o){t=null}!function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)if(null===e||void 0===e?void 0:e.prerender)t.innerHTML=e.prerender;else if(e){console.info("render!",t.clientWidth,t.clientWidth);var r=new bo(t,ml({autoScale:!0},n));r.setMolecule(e),r.update()}}(e,t,a)}},{key:"render",value:function(){var t=this.props,e=t.struct,n=t.Tag,r=void 0===n?"div":n,o=D()(t,["struct","Tag"]);return a.a.createElement(r,V()({ref:this.tagRef},o),e?null:"No molecule")}}]),n}(r.Component);function bl(t){var e=V()({},t);return a.a.createElement("div",V()({className:"ket-spinner"},e))}function vl(t){var e;return null===t||void 0===t||null===(e=t.type)||void 0===e?void 0:e.includes("image")}function yl(t){if(!t)return null;var e=window.URL||window.webkitURL;return e?e.createObjectURL(t):"No preview"}var wl=Object(N.b)((function(t){return{imagoVersions:t.options.app.imagoVersions,file:t.options.recognize.file,structStr:t.options.recognize.structStr,fragment:t.options.recognize.fragment,version:t.options.recognize.version||t.options.app.imagoVersions[0]}}),(function(t,e){return{isFragment:function(e){return t({type:"IS_FRAGMENT_RECOGNIZE",data:{fragment:e}})},onImage:function(e){return t(function(t){return{type:"CHANGE_RECOGNIZE_FILE",data:{file:t,structStr:null}}}(e))},onRecognize:function(e,n){return t(function(t,e){return function(n,r){var a=(0,r().server.recognize)(t,e).then((function(t){n(xr(t.struct))}),(function(){n(xr(null))}));n(xr(a))}}(e,n))},onChangeImago:function(e){return t({type:"CHANGE_IMAGO_VERSION",data:{version:e}})},onOk:function(n){t(Br(n.structStr,{rescale:!0,fragment:n.fragment})),e.onOk(n)}}}))((function(t){var e=t.file,n=t.structStr,o=t.fragment,i=t.version,s=t.imagoVersions,c=D()(t,["file","structStr","fragment","version","imagoVersions"]),l=c.onRecognize,p=c.isFragment,d=c.onImage,h=c.onChangeImago,f=D()(c,["onRecognize","isFragment","onImage","onChangeImago"]),m=Object(r.useState)(!0),g=u()(m,2),b=g[0],v=g[1],y=Object(r.useCallback)((function(){return d(null),!0}),[d]);return a.a.createElement(Oc,{title:"Import From Image",className:"recognize",params:f,result:function(){return!n||n instanceof Promise?null:{structStr:n,fragment:o}},buttons:[a.a.createElement(Sc,{key:"choose",onLoad:d,type:"image/*"},"Choose file\u2026"),a.a.createElement("span",{key:"open-file",className:"open-filename"},e?e.name:null),e&&a.a.createElement("button",{onClick:function(){return l(e,i)},disabled:n&&"string"!==typeof n},"Recognize"),"Cancel","OK"]},a.a.createElement("label",{className:"change-version"},"Imago version:",a.a.createElement(rl,{schema:{enum:s,enumNames:Object(M.range)(1,s.length+1).map((function(t){return"Version ".concat(t)}))},value:i,onChange:function(t){return h(t)}})),a.a.createElement("div",{className:"picture"},e&&vl(e)&&b&&a.a.createElement("img",{alt:"",id:"pic",src:yl(e)||"",onError:function(){v(!1)}}),e&&vl(e)&&!b&&a.a.createElement("div",null,"Preview of '",e.type,"' MIME type does not supported by current browser"),(!e||!vl(e)&&y())&&a.a.createElement("div",null,"Please choose image")),a.a.createElement("div",{className:"output"},n&&(n instanceof Promise||"string"!==typeof n?a.a.createElement(bl,null):a.a.createElement(gl,{className:"struct",struct:n}))),a.a.createElement("label",null,a.a.createElement(rl,{type:"checkbox",value:o,onChange:function(t){return p(t)}}),"Load as a fragment"))})),El=["alkali","alkaline-earth","transition","post-transition"];function Ol(t){return[El.indexOf(t.type)>=0?"".concat(t.type," metal"):t.type||"unknown-props",t.state||"unknown-state",t.origin]}function xl(t){var e=t.el,n=t.shortcut,r=t.className,o=D()(t,["el","shortcut","className"]);return a.a.createElement("button",V()({title:n?"".concat(e.title," (").concat(n,")"):e.title,className:[].concat(P()(Ol(e)),[r]).join(" "),style:{color:Oa[e.label]},value:ut.map[e.label]},o),a.a.createElement("span",null,e.label))}function Sl(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Al=function(t){v()(n,t);var e=Sl(n);function n(t){var r;return d()(this,n),(r=e.call(this,t)).state={},r.state.tabIndex=t.tabIndex||0,r.props.changeTab(r.state.tabIndex),r}return f()(n,[{key:"changeTab",value:function(t,e){this.setState({tabIndex:e}),this.props.changeTab&&this.props.changeTab(e)}},{key:"render",value:function(){var t=this,e=this.props,n=e.tabs,r=D()(e,["tabs"]),o=n[this.state.tabIndex],i=null===o||void 0===o?void 0:o.component,s=null===o||void 0===o?void 0:o.props;return a.a.createElement("ul",r,a.a.createElement("li",{className:"tabs"},n.map((function(e,n){return a.a.createElement("a",{key:n,className:t.state.tabIndex===n?"active":"",onClick:function(e){return t.changeTab(e,n)}},e.caption)}))),o&&a.a.createElement("li",{className:"tabs-content"},a.a.createElement(i,s)))}}]),n}(r.Component),Pl={atom:{any:{labels:["A","AH"]},"no-carbon":{labels:["Q","QH"]},metal:{labels:["M","MH"]},halogen:{labels:["X","XH"]}},group:{labels:["G","GH","G*","GH*"],acyclic:{labels:["ACY","ACH"],carbo:{labels:["ABC","ABH"],alkynyl:{labels:["AYL","AYH"]},alkyl:{labels:["ALK","ALH"]},alkenyl:{labels:["AEL","AEH"]}},hetero:{labels:["AHC","AHH"],alkoxy:{labels:["AOX","AOH"]}}},cyclic:{labels:["CYC","CYH"],"no-carbon":{labels:["CXX","CXH"]},carbo:{labels:["CBC","CBH"],aryl:{labels:["ARY","ARH"]},cycloalkyl:{labels:["CAL","CAH"]},cycloalkenyl:{labels:["CEL","CEH"]}},hetero:{labels:["CHC","CHH"],aryl:{labels:["HAR","HAH"]}}}},special:{labels:["H+","D","T","R","Pol"]}};function Tl(t,e,n){return Object.keys(t).reduce((function(n,r){return"labels"===r?t.labels.reduce((function(t,n){return t[n]=e||!0,t}),n):Tl(t[r],e?e.concat(r):[r],n)}),n||{})}Pl.map=Tl(Pl),Pl.map["*"]=Pl.map.A,Pl.get=function(t){return Tl(function(t,e){return e.reduce((function(t,e){return t&&t[e]||null}),t)}(t))};var Cl={atom:{caption:"Atom Generics",order:["any","no-carbon","metal","halogen"]},group:{caption:"Group Generics",order:["acyclic","cyclic"]},special:{caption:"Special Nodes",order:[]},"group/acyclic":{caption:"Acyclic",order:["carbo","hetero"]},"group/cyclic":{caption:"Cyclic",order:["no-carbon","carbo","hetero"]},"group/acyclic/carbo":{caption:"Carbo",order:["alkynyl","alkyl","alkenyl"]},"group/acyclic/hetero":{caption:"Hetero",order:["alkoxy"]},"group/cyclic/carbo":{caption:"Carbo",order:["aryl","cycloalkyl","cycloalkenyl"]},"group/cyclic/hetero":{caption:"Hetero",order:["aryl"]},"atom/any":"any atom","atom/no-carbon":"except C or H","atom/metal":"any metal","atom/halogen":"any halogen","group/cyclic/no-carbon":"no carbon","group/cyclic/hetero/aryl":"hetero aryl"};function Rl(t){var e=t.labels,n=t.caption,r=void 0===n?"":n,o=t.selected,i=t.onSelect,s=D()(t,["labels","caption","selected","onSelect"]);return a.a.createElement("fieldset",s,e.map((function(t){return a.a.createElement("button",{onClick:function(){return i(t)},className:o(t)?"selected":""},t)})),r?a.a.createElement("legend",null,r):null)}function jl(t){var e=t.gen,n=t.name,r=t.path,o=t.selected,i=t.onSelect,s=e[n],c=r?"".concat(r,"/").concat(n):n,l=Cl[c];return l&&l.caption?a.a.createElement("fieldset",{className:n},a.a.createElement("legend",null,l.caption),s.labels?a.a.createElement(Rl,{labels:s.labels,selected:o,onSelect:i}):null,l.order.map((function(t){return a.a.createElement(jl,{gen:s,name:t,path:c,selected:o,onSelect:i})}))):a.a.createElement(Rl,{labels:s.labels,caption:l||n,className:n,selected:o,onSelect:i})}function Nl(t){var e=t.selected,n=t.onSelect,r=D()(t,["selected","onSelect"]);return a.a.createElement("div",V()({summary:"Generic Groups"},r),a.a.createElement("div",{className:"col"},a.a.createElement(jl,{gen:Pl,name:"atom",selected:function(t){return e(t)},onSelect:function(t){return n(t)}}),a.a.createElement(jl,{gen:Pl,name:"special",selected:function(t){return e(t)},onSelect:function(t){return n(t)}})),a.a.createElement("div",{className:"col"},a.a.createElement(jl,{gen:Pl,name:"group",selected:function(t){return e(t)},onSelect:function(t){return n(t)}})))}function Ml(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function kl(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Bl=[{title:"Single",value:"atom"},{title:"List",value:"list"},{title:"Not List",value:"not-list"}],Ll={He:16,B:10,Al:10,Hf:1,Rf:1},Il=function(t){return t.reduce((function(t,e){var n=t[e.period-1];return n?(Ll[e.label]&&n.push(Ll[e.label]),n.push(e)):t.push([e]),t}),[])}(ut.filter((function(t){return t&&"actinide"!==t.type&&"lanthanide"!==t.type}))),Dl=ut.filter((function(t){return t&&"lanthanide"===t.type})),zl=ut.filter((function(t){return t&&"actinide"===t.type}));function _l(){return a.a.createElement("tbody",null,a.a.createElement("tr",null,Object(M.range)(0,19).map((function(t){return a.a.createElement("th",{key:t},t||"")}))))}function Hl(t){var e=t.value,n=t.onChange,r=D()(t,["value","onChange"]);return a.a.createElement("fieldset",null,Bl.map((function(t){return a.a.createElement("label",{key:t.title},a.a.createElement("input",V()({type:"radio",value:t.value,checked:t.value===e,onClick:function(){return n(t.value)}},r)),t.title)})))}function Vl(t){var e=t.row,n=t.caption,r=t.refer,o=t.selected,i=t.onSelect,s=t.curEvents;return a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("th",null,n),e.map((function(t){return"number"!==typeof t?a.a.createElement("td",null,a.a.createElement(xl,V()({el:t,className:o(t.label)?"selected":"",onClick:function(){return i(t.label)}},s(t)))):r(t)?a.a.createElement("td",{className:"ref"},r(t)):a.a.createElement("td",{colSpan:t})}))))}function Fl(t){var e=t.row,n=t.caption,r=t.selected,o=t.onSelect,i=t.curEvents;return a.a.createElement("tbody",null,a.a.createElement("tr",null,a.a.createElement("th",{colSpan:"3",className:"ref"},n),e.map((function(t){return a.a.createElement("td",{key:t.label},a.a.createElement(xl,V()({el:t,className:r(t.label)?"selected":"",onClick:function(){return o(t.label)}},i(t))))})),a.a.createElement("td",null)))}function Gl(t){var e=t.el,n=t.isInfo,r={color:Oa[e.label]||"black",fontSize:"1.2em"},o={color:Oa[e.label]||"black",fontWeight:"bold",fontSize:"2em"};return a.a.createElement("div",{className:"ket-atom-info ".concat(n?"":"none")},a.a.createElement("div",{style:r},ut.map[e.label]),a.a.createElement("span",{style:o},e.label),a.a.createElement("br",null),e.title,a.a.createElement("br",null),e.atomic_mass)}var Ul=function(t){v()(n,t);var e=kl(n);function n(t){var r;d()(this,n),r=e.call(this,t),C()(Q()(r),"curEvents",(function(t){return{onMouseEnter:function(){return r.setState({cur:t,isInfo:!0})},onMouseLeave:function(){return r.setState({isInfo:!1})}}}));var a=r.props.pseudo?"gen":null;return r.state={type:t.type||a||"atom",value:t.values||t.label||null,cur:ut[2],isInfo:!1},r.firstType=!0,r.selected=r.selected.bind(Q()(r)),r.onSelect=r.onSelect.bind(Q()(r)),r}return f()(n,[{key:"changeType",value:function(t){if(this.firstType)this.firstType=!1;else{var e="list"===this.state.type||"not-list"===this.state.type;("list"===t||"not-list"===t)&&e?this.setState({type:t}):this.setState({type:t,value:"atom"===t||"gen"===t?null:[]})}}},{key:"selected",value:function(t){var e=this.state,n=e.type,r=e.value;return"atom"===n||"gen"===n?r===t:r.includes(t)}},{key:"onSelect",value:function(t){var e=this.state,n=e.type,r=e.value;this.setState({value:"atom"===n||"gen"===n?t:Object(M.xor)([t],r)})}},{key:"result",value:function(){var t=this.state,e=t.type,n=t.value;return"atom"===e?n?{label:n,pseudo:null}:null:"gen"===e?n?{type:e,label:n,pseudo:n}:null:n.length?{type:e,values:n}:null}},{key:"render",value:function(){var t=this,e=this.state,n=e.type,r=[{caption:"Table",component:function(e){return a.a.createElement("div",{className:"period-table"},a.a.createElement(Gl,{el:t.state.cur,isInfo:t.state.isInfo}),a.a.createElement(Wl,{value:e,curEvents:t.curEvents.bind(t),selected:t.selected.bind(t),onSelect:t.onSelect.bind(t)}),a.a.createElement(Hl,{value:n,onChange:function(e){return t.changeType(e)}}))},props:{value:e.value}},{caption:"Extended",component:Nl,props:{className:"generic-groups",selected:this.selected.bind(this),onSelect:this.onSelect.bind(this)}}];return a.a.createElement(Oc,{title:"Periodic table",className:"elements-table",params:this.props,result:function(){return t.result()}},a.a.createElement(Al,{className:"tabs",captions:r,tabIndex:"gen"!==n?0:1,changeTab:function(e){return t.changeType(0===e?"atom":"gen")},tabs:r}))}}]),n}(r.Component),Wl=function(t){v()(n,t);var e=kl(n);function n(){return d()(this,n),e.apply(this,arguments)}return f()(n,[{key:"shouldComponentUpdate",value:function(t){return t.value!==this.props.value}},{key:"render",value:function(){var t=this.props,e={curEvents:t.curEvents,selected:t.selected,onSelect:t.onSelect};return a.a.createElement("table",{summary:"Periodic table of the chemical elements"},a.a.createElement(_l,null),Il.map((function(t,n){return a.a.createElement(Vl,V()({key:n,row:t,caption:n+1,refer:function(t){return 1===t&&(5===n?"*":"**")}},e))})),a.a.createElement(Fl,V()({row:Dl,caption:"*"},e)),a.a.createElement(Fl,V()({row:zl,caption:"**"},e)))}}]),n}(r.Component);function Yl(t){var e=t.selection();return e&&1===Object.keys(e).length&&e.atoms&&1===Object.keys(e.atoms).length?function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ml(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ml(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Vn(t.struct().atoms.get(e.atoms[0]))):{}}var ql=Object(N.b)((function(t,e){return e.values||e.label?{}:Yl(t.editor)}),(function(t,e){return{onOk:function(n){n.type&&"atom"!==n.type||t({type:"ADD_ATOMS",data:n.label}),t(Mr({tool:"atom",opts:Fn(n)})),e.onOk(n)}}}))(Ul);function $l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Kl(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Xl=function(t){v()(n,t);var e=Kl(n);function n(t){var r;d()(this,n);var a=(r=e.call(this,t)).props,o=a.onUpdate,i=a.schema,s=a.init;if(r.schema=eu(i,t),s){var c=r.schema.serialize(s),l=c.valid,u=au(c.errors);o(Object.assign({},s,{init:!0}),l,u)}return r}return f()(n,[{key:"updateState",value:function(t){var e=this.schema.serialize(t),n=e.instance,r=e.valid,a=au(e.errors);this.props.onUpdate(n,r,a)}},{key:"field",value:function(t,e){var n=this.props,r=n.result,a=n.errors,o=r[t],i=this;return{dataError:a&&a[t],value:o,onChange:function(n){var r=Object.assign({},i.props.result,C()({},t,n));i.updateState(r),e&&e(n)}}}},{key:"render",value:function(){var t=this.props,e=t.result,n=(t.errors,t.init,t.children),r=t.schema,o=(t.onUpdate,t.customValid,D()(t,["result","errors","init","children","schema","onUpdate","customValid"]));return r.key&&r.key!==this.schema.key&&(this.schema=eu(r,o),this.schema.serialize(e),this.updateState(e)),a.a.createElement("form",o,a.a.createElement(ln.Provider,{value:{schema:this.props.schema,stateStore:this}},n))}}]),n}(r.Component),Zl=Object(N.b)(null,(function(t){return{onUpdate:function(e,n,r){t(jr({result:e,valid:n,errors:r}))}}}))(Xl);function Ql(t){var e=t.labelPos,n=t.title,r=t.children,o=D()(t,["labelPos","title","children"]);return a.a.createElement("label",o,n&&"after"!==e?"".concat(n,":"):"",r,n&&"after"===e?n:"")}function Jl(t){var e=t.name,n=t.onChange,r=t.component,o=t.labelPos,i=D()(t,["name","onChange","component","labelPos"]),s=ha(),c=s.schema,l=s.stateStore,u=i.schema||c.properties[e],p=l.field(e,n),d=p.dataError,h=D()(p,["dataError"]),f=r,m=r?a.a.createElement(f,V()({name:e,schema:u},h,i)):a.a.createElement(rl,V()({name:e,schema:u},h,i));return!1===o?m:a.a.createElement(Ql,{className:tt()({"data-error":d}),error:d,title:i.title||u.title,labelPos:o},m)}var tu=function(t){var e=t.title,n=t.name,r=t.schema,o=D()(t,["title","name","schema"]),i={title:e,enum:[],enumNames:[]};return Object.keys(r).forEach((function(t){i.enum.push(t),i.enumNames.push(r[t].title||t)})),a.a.createElement(Jl,V()({name:n,schema:i},o))};function eu(t,e){var n=e.customValid,r=e.serialize,a=void 0===r?{}:r,o=e.deserialize,i=void 0===o?{}:o,s=new _.a.Validator;return n&&((t=Object.assign({},t)).properties=Object.keys(n).reduce((function(t,e){return s.customFormats[e]=n[e],t[e]=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$l(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({format:e},t[e]),t}),t.properties)),{key:t.key||"",serialize:function(e){return s.validate(e,t,{rewrite:nu.bind(null,a)})},deserialize:function(e){return s.validate(e,t,{rewrite:ru.bind(null,i)})}}}function nu(t,e,n){var r={};return"object"===B()(e)&&n.properties?(Object.keys(n.properties).forEach((function(n){n in e&&(r[n]=e[t[n]]||e[n])})),r):void 0!==e?e:n.default}function ru(t,e){return e}function au(t){var e,n={};return t.forEach((function(t){e=t.property.split(".")[1],n[e]||(n[e]=function(t){return t.schema.invalidMessage?"function"===typeof t.schema.invalidMessage?t.schema.invalidMessage(t.instance):t.schema.invalidMessage:t.message}(t))})),n}function ou(t){var e,n=t.value,r=t.onChange,o=t.schema,i=t.disabledIds,s=t.multiple;return a.a.createElement("ul",null,o.items.enum.map((function(t,c){return e=n.includes(t)?"selected":"",a.a.createElement("li",{key:t},a.a.createElement("button",{disabled:i.includes(t),type:"button",className:e,onClick:function(){return r(function(t,e,n){return t?Object(M.xor)(e,[n]):Object(M.xor)(e,e.concat([n]))}(s,n,t))}},o.items.enumNames[c]))})))}var iu=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.disabledIds,n=t.values,r=t.formState,o=t.type,i=D()(t,["disabledIds","values","formState","type"]);return a.a.createElement(Oc,{title:"R-Group",className:"rgroup",params:i,result:function(){return r.result}},a.a.createElement(Zl,V()({schema:Pn,init:{values:n}},r),a.a.createElement(Jl,{name:"values",multiple:"atom"===o,labelPos:!1,component:ou,disabledIds:e})))}));function su(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function cu(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var lu={selectionStyle:{fill:"#47b3ec",stroke:"none"},highlightStyle:{stroke:"#1a7090","stroke-width":1.2},highlightStyleSimpleObject:{"stroke-opacity":.3}},uu=function(t){v()(n,t);var e=cu(n);function n(t){var r,a=t.onInit,o=D()(t,["onInit"]);return d()(this,n),(r=e.call(this)).tmpl=function(t){var e={struct:du(t.struct),props:{atomid:+t.props.atomid||0,bondid:+t.props.bondid||0}};return e.struct.name=t.struct.name,e}(o.tmpl),a(r.tmpl.struct.name,r.tmpl.props),r.onResult=r.onResult.bind(Q()(r)),r}return f()(n,[{key:"onResult",value:function(){var t=this.props,e=t.name,n=t.atomid,r=t.bondid;return!e||e===this.tmpl.struct.name&&n===this.tmpl.props.atomid&&r===this.tmpl.props.bondid?null:{name:e,attach:{atomid:n,bondid:r}}}},{key:"render",value:function(){var t=this.props,e=t.name,n=t.atomid,r=t.bondid,o=t.onNameEdit,i=t.onAttachEdit,s=D()(t,["name","atomid","bondid","onNameEdit","onAttachEdit"]),c=this.tmpl.struct,l=Object.assign(lu,{scale:hu(c)});return a.a.createElement(Oc,{title:"Template Edit",className:"attach",result:this.onResult,params:s},a.a.createElement("label",null,"Template name:",a.a.createElement(rl,{value:e,onChange:o,placeholder:"tmpl"})),a.a.createElement("label",null,"Choose attachment atom and bond:"),a.a.createElement(yc,{className:"editor",struct:c,onAttachEdit:i,tool:"attach",toolOpts:{atomid:n,bondid:r},options:l}),mr()?null:a.a.createElement("div",{className:"warning"},fr))}}]),n}(r.Component),pu=Object(N.b)((function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?su(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):su(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.templates.attach)}),(function(t){return{onInit:function(e,n){return t(function(t,e){return{type:"INIT_ATTACH",data:{name:t,atomid:e.atomid,bondid:e.bondid}}}(e,n))},onAttachEdit:function(e){return t({type:"SET_ATTACH_POINTS",data:{atomid:(n=e).atomid,bondid:n.bondid}});var n},onNameEdit:function(e){return t(function(t){return{type:"SET_TMPL_NAME",data:{name:t}}}(e))}}}))(uu);function du(t){var e=t.clone(),n=e.getCoordBoundingBox();return e.atoms.forEach((function(t){t.pp=t.pp.sub(n.min)})),e.sgroups.forEach((function(t){t.pp=t.pp?t.pp.sub(n.min):n.min})),e.rxnArrows.forEach((function(t){t.pp=t.pp.sub(n.min)})),e.rxnPluses.forEach((function(t){t.pp=t.pp.sub(n.min)})),e}function hu(t){var e=t.getCoordBoundingBox(),n=220/Math.max(e.max.y-e.min.y,e.max.x-e.min.x);return n<35&&(n=35),n>60&&(n=60),n}function fu(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var mu=function(t){v()(n,t);var e=fu(n);function n(t){var a;return d()(this,n),a=e.call(this,t),C()(Q()(a),"resize",(function(t,e){var n=a.viewRef.current.offsetHeight;a.state.height!==n&&a.setState({height:n}),e&&(a.setState({offset:0}),a.viewRef.current.scrollTop=0)})),C()(Q()(a),"handleScroll",(function(){a.setState({offset:a.viewRef.current.scrollTop}),a.props.sync&&a.forceUpdate()})),a.viewRef=Object(r.createRef)(),a.state={offset:0,height:0},a}return f()(n,[{key:"componentDidUpdate",value:function(t){var e=t.data,n=e.length===this.props.data.length&&this.props.data.every((function(t,n){return t===e[n]}));this.resize(null,!n)}},{key:"componentDidMount",value:function(){this.resize(),addEventListener("resize",this.resize)}},{key:"componentWillUnmount",value:function(){removeEventListener("resize",this.resize)}},{key:"render",value:function(){var t=this.props,e=t.data,n=t.rowHeight,r=(t.children,t.Tag),o=void 0===r?"div":r,i=t.overscanCount,s=void 0===i?1:i,c=(t.sync,t.render),l=D()(t,["data","rowHeight","children","Tag","overscanCount","sync","render"]),u=this.state,p=u.offset,d=u.height,h=p/n||0,f=d/n||0;s&&(h=Math.max(0,h-h%s),f+=s);var m=h+1+f,g=e.slice(h,m);return a.a.createElement("div",V()({onScroll:this.handleScroll},l,{ref:this.viewRef}),a.a.createElement(o,null,g.map((function(t,e){return c(t,h+e)}))))}}]),n}(r.Component);function gu(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var bu=function(e){v()(r,e);var n=gu(r);function r(e){var a;return d()(this,r),(a=n.call(this,e)).state={},function(e){return new Promise((function(n,r){t.Blob&&nt.saveAs?n((function(t,e,n){var r=new Blob([t],{type:n});Object(nt.saveAs)(r,e)})):e?n(e.then((function(){throw Error("Server doesn't still support echo method")}))):r(new Error("Your browser does not support opening files locally"))}))}(e.server).then((function(t){a.setState({saver:t})})),a}return f()(r,[{key:"save",value:function(t){var e=function(){return null},n=this.props,r=n.filename,a=void 0===r?"unnamed":r,o=n.data,i=(n.className,n.type),s=void 0===i?"text/plain":i,c=n.onSave,l=void 0===c?e:c,u=n.onError,p=void 0===u?e:u;if(this.state.saver&&o)try{this.state.saver(o,a,s),l()}catch(d){p(d)}t.preventDefault()}},{key:"render",value:function(){var t=this,e=this.props,n=e.children,r=(e.filename,e.data),o=e.className,i=void 0===o?"save-button":o,s=(e.onSave,D()(e,["children","filename","data","className","onSave"]));return a.a.createElement("button",V()({onClick:function(e){return t.save(e)},className:this.state.saver&&r?i:"disabled ".concat(i)},s),n)}}]),r}(r.Component);function vu(t){var e=t.schema,n=t.value,r=t.onSelect,o=t.splitIndexes,i=(t.selected,t.component,D()(t,["schema","value","onSelect","splitIndexes","selected","component"]));return a.a.createElement("ul",i,e.enum.map((function(t,i){return a.a.createElement("li",{key:t,onClick:function(){return r(t,i)},className:(t===n?"selected ":"")+(yu(i,o)?"split":"")},e.enumNames?e.enumNames[i]:t)})))}function yu(t,e){return t>0&&e&&e.includes(t)}function wu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Eu(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Ou={Alpha:"A",alpha:"\u03b1",Beta:"B",beta:"\u03b2",Gamma:"\u0413",gamma:"\u03b3"};function xu(t,e){return console.assert(t.props&&t.props.group,"No group"),t.struct.name||"".concat(t.props.group," template ").concat(e+1)}var Su=new RegExp("\\b"+Object.keys(Ou).join("\\b|\\b")+"\\b","g");function Au(t){return t.replace(Su,(function(t){return Ou[t]}))}var Pu=Object(et.a)((function(t){return t.lib}),(function(t){return t.filter}),(function(t,e){console.warn("Filter",e);var n=new RegExp(Object(M.escapeRegExp)(Au(e)),"i");return Object(M.flow)(Object(M.filter)((function(t){return!e||n.test(Au(t.struct.name))||n.test(Au(t.props.group))})),Object(M.reduce)((function(t,e){return t[e.props.group]?t[e.props.group].push(e):t[e.props.group]=[e],t}),{}))(t)}));var Tu=Object(et.a)((function(t){return t.lib}),(function(t){return t.group}),(function(t){return t.COLS}),(function(t,e,n){return console.warn("Group",e),function(t,e){return console.warn("partition",t),Object(M.chunk)(t)(e)}(n,t[e])}));function Cu(t){var e=t.tmpl,n=D()(t,["tmpl"]);return e.props&&e.props.prerender?a.a.createElement("svg",n,a.a.createElement("use",{xlinkHref:e.props.prerender})):a.a.createElement(gl,V()({struct:e.struct,options:{autoScaleMargin:15}},n))}var Ru=function(t){v()(n,t);var e=Eu(n);function n(){return d()(this,n),e.apply(this,arguments)}return f()(n,[{key:"select",value:function(t){t===this.props.selected?this.props.onOk(this.result()):this.props.onSelect(t)}},{key:"result",value:function(){var t=this.props.selected;return console.assert(!t||t.props,"Incorrect SDF parse"),t?{struct:t.struct,aid:parseInt(t.props.atomid)||null,bid:parseInt(t.props.bondid)||null}:null}},{key:"renderRow",value:function(t,e,n){var r=this;return a.a.createElement("div",{className:"tr",key:e},t.map((function(t,o){return a.a.createElement("div",{className:t===r.props.selected?"td selected":"td",title:Au(xu(t,e*n+o))},a.a.createElement(Cu,{tmpl:t,className:"struct",onClick:function(){return r.select(t)}}),a.a.createElement("button",{className:"attach-button",onClick:function(){return r.props.onAttach(t)}},"Edit"))})))}},{key:"render",value:function(){var t=this,e=this.props,n=e.filter,r=e.onFilter,o=e.onChangeGroup,i=D()(e,["filter","onFilter","onChangeGroup"]),s=i.group,c=Pu(this.props);return s=c[s]?s:Object.keys(c)[0],a.a.createElement(Oc,{title:"Template Library",className:"template-lib",params:Object(M.omit)(["group"],i),result:function(){return t.result()},buttons:[a.a.createElement(bu,{key:"save-to-SDF",data:ea.stringify(this.props.lib),filename:"ketcher-tmpls.sdf"},"Save To SDF\u2026"),"Cancel","OK"]},a.a.createElement("label",null,"Filter:",a.a.createElement(rl,{type:"search",value:n,onChange:function(t){return r(t)}})),a.a.createElement(rl,{className:"groups",component:vu,splitIndexes:[Object.keys(c).indexOf("User Templates")],value:s,onChange:function(t){return o(t)},schema:{enum:Object.keys(c),enumNames:Object.keys(c).map((function(t){return Au(t)}))}}),a.a.createElement(mu,{data:Tu({lib:c,group:s,COLS:3}),rowHeight:120,className:"table",render:function(e,n){return t.renderRow(e,n,3)}}))}}]),n}(r.Component),ju=Object(N.b)((function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wu(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Object(M.omit)(["attach"],t.templates))}),(function(t,e){return{onFilter:function(e){return t(function(t){return{type:"TMPL_CHANGE_FILTER",data:{filter:t.trim(),selected:null}}}(e))},onSelect:function(e){return t(function(t){return{type:"TMPL_SELECT",data:{selected:t}}}(e))},onChangeGroup:function(e){return t(function(t){return{type:"TMPL_CHANGE_GROUP",data:{group:t,selected:null}}}(e))},onAttach:function(e){return t(function(t){return function(e,n){Kr(e,"attach",{tmpl:t}).then((function(e){var r=e.name,a=e.attach;t.struct.name=r,t.props=Object.assign({},t.props,a),"User Templates"===t.props.group&&ca(n().templates.lib)}),(function(){return null})).then((function(){return Kr(e,"templates").catch((function(){return null}))}))}}(e))},onOk:function(n){t(Mr({tool:"template",opts:n})),e.onOk(n)}}}))(Ru);function Nu(){return(Nu=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Mu=Object(r.createElement)("defs",null,Object(r.createElement)("linearGradient",{id:"logo_svg__linear-gradient",x1:732.63,y1:161.04,x2:427.29,y2:483.83,gradientUnits:"userSpaceOnUse"},Object(r.createElement)("stop",{offset:0,stopColor:"#3bc2d7"}),Object(r.createElement)("stop",{offset:.74,stopColor:"#1d9db1"})),Object(r.createElement)("clipPath",{id:"logo_svg__clip-path"},Object(r.createElement)("path",{d:"M58 179L339.06 16.7a115.52 115.52 0 01115.52 0L735.65 179a115.52 115.52 0 0157.76 100v324.57a115.52 115.52 0 01-57.76 100L454.57 865.89a115.52 115.52 0 01-115.52 0L58 703.62a115.52 115.52 0 01-57.76-100V279A115.52 115.52 0 0158 179z",fill:"none"})),Object(r.createElement)("style",null,".logo_svg__cls-3{fill:#676767}.logo_svg__cls-8{fill:#474648}")),ku=Object(r.createElement)("g",{id:"logo_svg__Layer_1","data-name":"Layer 1"},Object(r.createElement)("path",{className:"logo_svg__cls-3",d:"M498.45 698.74c-25.06-23.58-50.08-47.09-75.29-70.82-25.84-24.32-51.75-48.63-77.75-73.2V669q0 23.78.24 47.56c0 1.8-.24 3.33-.24 4.66v75.3c0 30.75 0 57.43.08 74.53l10.29 6c26.51 11.06 52.9 11.31 79.36 1.22l157.34-91.1c-13.23-12.04-51.48-48.34-94.03-88.43zM227.24 715.47v-40.25c.06-205.24.16-585.06.16-592.87v-.09L46.53 186.71c-31 21.68-46.45 52.51-46.45 92C.1 387.34.28 496 0 604.59c-.1 39.84 14.67 70.56 44.71 92.85l182.52 105.38V717.3c.02-.59.01-1.19.01-1.83z"}),Object(r.createElement)("path",{d:"M749.63 188.31L437.25 8c-26.48-10.67-53.66-10.71-81.85.42l-10 5.11s0 382.81 1.55 409.92c11.47-11.58 84.28-85.1 137.78-139.86q14.17-14.59 28.34-29.26c5.43-5.62 10.75-7.87 18.55-7.81-7.81-.06-13.12 2.21-18.55 7.82q-13.63 14.09-27.28 28.15c6.44-6.6 12.59-12.91 18.31-18.79 3-3.09 6-6 9-9.06 5.43-5.62 10.75-7.51 18.55-7.51h43.8q-21.89 0-43.78-.2 21.9.16 43.79.2H690.1c-.83 4-4.16 6.62-6.5 9-30.55 31.62-221.39 230.77-225 234.34 4.11-.26 234.95 232.77 240.4 235.58h.12l52.52-30.32c27.59-21.31 41.79-50.45 41.79-87.34V277.25c-.01-37.83-14.84-67.53-43.8-88.94z",fill:"url(#logo_svg__linear-gradient)"}),Object(r.createElement)("g",{clipPath:"url(#logo_svg__clip-path)"},Object(r.createElement)("path",{d:"M458.64 490.41v-.06c4.55-4.55 290.45-302.23 290.45-302.23l-109.34-63.33s-281.42 287-292.89 298.63c-1.52-27-1.64-407.12-1.64-409.9L227.45 82.27v.09c0 7.8-.21 715-.22 720.46l.09.05c0-26.48.13-26.48.11 0v-.05.05L345.22 871V554.72c26.07 24.57 234 220.36 247.26 232.87l106.54-61.51S462.75 490.14 458.64 490.41z",fill:"#ccc"})),Object(r.createElement)("path",{className:"logo_svg__cls-8",d:"M1118.72 604.25h-49.22L968.72 440.2v164.05h-42.18V276.14h42.18v159.37l91.4-159.37h49.22l-96.09 161.71zM1299.18 501.13h-121.87q0 23 3.75 38.2t11.48 24.37a42.83 42.83 0 0020.15 13.12q12.41 4 30.23 4h46.87v18.75a176.28 176.28 0 01-26.48 6.56 169 169 0 01-29.76 2.81q-26.26 0-45-5.86a64.57 64.57 0 01-30.7-19.92q-12-14.06-17.34-37.5t-5.39-58.59q0-35.15 5.16-58.59t15.47-37.5a56.23 56.23 0 0125.78-19.92q15.47-5.86 35.62-5.86t35.62 5.86a56.27 56.27 0 0125.78 19.94q10.3 14.06 15.47 37.5t5.16 58.59zM1257 473q0-23.91-3.28-39.61t-8.72-25.07q-5.4-9.37-12.66-13.36a31.12 31.12 0 00-30.47 0q-7.27 4-12.66 13.36t-8.67 25.08q-3.28 15.71-3.28 39.61zM1399.95 405v124.26q0 15.94 3 26t8 15.7a26.22 26.22 0 0010.78 7.73 32.59 32.59 0 0011 2.11h42.19v18.75a65.4 65.4 0 01-11 3.52q-6.8 1.65-14.06 3t-14.3 2.11q-7 .7-12.19.7a98.27 98.27 0 01-26-3.28 47.33 47.33 0 01-20.86-12q-8.91-8.67-13.83-24.14t-4.92-40.31V405h-28.12v-30.42h28.12v-56.25h42.19v56.25h65.62v21.09a176.28 176.28 0 01-26.48 6.56 169 169 0 01-29.76 2.81zM1594.47 393.33a59.66 59.66 0 00-23.2 4.22q-10.09 4.22-16.87 14.76t-10.31 28.59q-3.51 18-3.51 46.17t3.51 46.4q3.52 18.28 10.78 28.83a37.36 37.36 0 0018.28 14.53q11 4 26 4H1646v18.75a176.28 176.28 0 01-26.48 6.56 169 169 0 01-29.76 2.81q-23.91 0-41-5.86a60.8 60.8 0 01-28.36-19.92q-11.25-14.06-16.64-37.5t-5.39-58.59q0-35.15 5.39-58.59t16.17-37.5a58.55 58.55 0 0127-19.92q16.17-5.86 38.2-5.86a169.19 169.19 0 0129.76 2.81 177.32 177.32 0 0126.48 6.56v18.75zM1728.05 604.25h-42.18V276.14h42.18v100.78a131.72 131.72 0 0123.2-8.44 111.52 111.52 0 0128.36-3.28 115.33 115.33 0 0127.42 3 50.74 50.74 0 0121.56 11q9.14 8 14.06 21.56t4.92 34.69v168.8h-42.17V435.51q0-12.18-3.28-20.39a31.59 31.59 0 00-9.37-13.12 34.79 34.79 0 00-14.06-6.8 78.22 78.22 0 00-17.81-1.87 63.45 63.45 0 00-18.28 2.81q-9.38 2.81-14.53 6.56zM2063.19 501.13h-121.86q0 23 3.75 38.2t11.48 24.37a42.83 42.83 0 0020.15 13.12q12.41 4 30.23 4h46.87v18.75a176.28 176.28 0 01-26.48 6.56 169 169 0 01-29.76 2.81q-26.26 0-45-5.86a64.57 64.57 0 01-30.7-19.92q-12-14.06-17.34-37.5t-5.39-58.59q0-35.15 5.16-58.59t15.47-37.5a56.23 56.23 0 0125.78-19.92q15.47-5.86 35.62-5.86t35.62 5.86a56.27 56.27 0 0125.78 19.94q10.3 14.06 15.47 37.5t5.16 58.59zM2021 473q0-23.91-3.28-39.61t-8.67-25.08q-5.4-9.37-12.66-13.36a31.12 31.12 0 00-30.47 0q-7.27 4-12.66 13.36t-8.67 25.08q-3.28 15.71-3.28 39.61zM2156.93 604.25h-42.19V369.89h35.62l2.34 18.75h2.34q8.44-7 22.73-12.89t35.39-5.86h23.44V405h-46.87a71.27 71.27 0 00-17.34 2.11 44 44 0 00-15.47 7.26z"}));function Bu(t){return Object(r.createElement)("svg",Nu({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2236.62 885.56"},t),Mu,Object(r.createElement)("g",{style:{isolation:"isolate"}},ku))}function Lu(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}var Iu=Object(N.b)((function(t){return function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Lu(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Lu(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t.options.app)}))((function(t){var e=t.indigoVersion&&t.indigoVersion.split(".r");return a.a.createElement(Oc,{title:"About",className:"about",params:t,buttons:["Close"]},a.a.createElement("a",{href:"http://lifescience.opensource.epam.com/ketcher/",target:"_blank",rel:"noopener noreferrer"},a.a.createElement(Bu,null)),a.a.createElement("dl",null,a.a.createElement("dt",null,a.a.createElement("a",{href:"http://lifescience.opensource.epam.com/ketcher/help.html",target:"_blank",rel:"noopener noreferrer"},"Ketcher")),a.a.createElement("dd",null,"version",a.a.createElement("var",null,t.version)),a.a.createElement("dd",null,"build at ",a.a.createElement("time",null,t.buildDate)),t.indigoVersion?a.a.createElement("div",null,a.a.createElement("dt",null,a.a.createElement("a",{href:"http://lifescience.opensource.epam.com/indigo/",target:"_blank",rel:"noopener noreferrer"},"Indigo Toolkit")),a.a.createElement("dd",null,"version",a.a.createElement("var",null,e[0])),a.a.createElement("dd",null,"build #",a.a.createElement("var",null,e[1]))):a.a.createElement("dd",null,"standalone"),a.a.createElement("dt",null,a.a.createElement("a",{href:"http://lifescience.opensource.epam.com/",target:"_blank",rel:"noopener noreferrer"},"EPAM Life Sciences")),a.a.createElement("dd",null,a.a.createElement("a",{href:"http://lifescience.opensource.epam.com/ketcher/#feedback",target:"_blank",rel:"noopener noreferrer"},"Feedback"))))}));function Du(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var zu={dark:"0x202020",light:"0xcccccc"},_u={no:null,bright:{colorer:"EL"},blackAndWhite:{colorer:["UN",{color:16777215}],bg:"0x000"},black:{colorer:["UN",{color:0}]}};function Hu(t){var e={settings:{theme:t.miewTheme,autoPreset:!1,editing:!0,inversePanning:!0},reps:[{mode:t.miewMode}]},n=function(t){var e=t.miewAtomLabel;return null===_u[e]?null:{colorer:_u[e].colorer,selector:"not elem C",mode:["TX",{bg:_u[e].bg||zu[t.miewTheme],showBg:!0,template:"{{elem}}"}]}}(t);return n&&e.reps.push(n),e}var Vu=function(t){v()(n,t);var e=Du(n);function n(){return d()(this,n),e.apply(this,arguments)}return f()(n,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.struct,r=e.server,a=e.miewOpts,o=window.Miew;this.viewer=new o({container:this.miewContainer}),this.viewer.init()&&this.viewer.run(),on(n,"cml",r).then((function(e){return t.viewer.load(e,{sourceType:"immediate",fileType:"cml"})})).then((function(){return t.viewer.setOptions(a)})).catch((function(t){return console.error(t.message)}))}},{key:"exportCML",value:function(){var t=this.viewer.exportCML();this.props.onExportCML(t)}},{key:"render",value:function(){var t=this,e=this.props,n=(e.miewOpts,e.server,e.struct,D()(e,["miewOpts","server","struct"]));return a.a.createElement(Oc,{title:"Miew",className:"miew",params:n,buttons:[a.a.createElement("div",{className:"warning"},"Stereocenters can be changed after the strong 3D rotation"),"Close",a.a.createElement("button",{onClick:function(){return t.exportCML()}},"Apply")]},a.a.createElement("div",{ref:function(e){t.miewContainer=e},className:"miew-container",style:{width:"1024px",height:"600px",position:"relative"}}))}}]),n}(r.Component),Fu=Object(N.b)((function(t){return{miewOpts:Hu(Object(M.pick)(pr,t.options.settings)),server:t.options.app.server?t.server:null,struct:t.editor.struct()}}),(function(t,e){return{onExportCML:function(n){t(Br(n)),e.onOk()}}}))(Vu);function Gu(t){var e=t.label,n=ut.map[Object(M.capitalize)(e)]||"";return a.a.createElement("label",null,"Number:",a.a.createElement("input",{className:"number",type:"text",readOnly:!0,value:n}))}var Uu=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.formState,n=D()(t,["formState"]),o=Object(r.useState)(n.label),i=u()(o,2),s=i[0],c=i[1],l=Object(r.useCallback)((function(t){c(t)}),[]);return a.a.createElement(Oc,{title:"Atom Properties",className:"atom-props",result:function(){return e.result},valid:function(){return e.valid},params:n},a.a.createElement(Zl,V()({schema:An,customValid:{label:function(t){return function(t){return t&&!!ut.map[Object(M.capitalize)(t)]}(t)},charge:function(t){return function(t){var e=An.properties.charge.pattern.exec(t);return!(null===e||""!==e[1]&&""!==e[3])}(t)}},init:n},e),a.a.createElement("fieldset",{className:"main"},a.a.createElement(Jl,{name:"label",onChange:l}),a.a.createElement(Jl,{name:"alias"}),a.a.createElement(Gu,{label:s}),a.a.createElement(Jl,{name:"charge",maxLength:"5"}),a.a.createElement(Jl,{name:"explicitValence"}),a.a.createElement(Jl,{name:"isotope"}),a.a.createElement(Jl,{name:"radical"})),a.a.createElement("fieldset",{className:"query"},a.a.createElement("legend",null,"Query specific"),a.a.createElement(Jl,{name:"ringBondCount"}),a.a.createElement(Jl,{name:"hCount"}),a.a.createElement(Jl,{name:"substitutionCount"}),a.a.createElement(Jl,{name:"unsaturatedAtom"})),a.a.createElement("fieldset",{className:"reaction"},a.a.createElement("legend",null,"Reaction flags"),a.a.createElement(Jl,{name:"invRet"}),a.a.createElement(Jl,{name:"exactChangeFlag"})),"PARITY: ",t.stereoParity))}));var Wu=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.formState,n=D()(t,["formState"]);return a.a.createElement(Oc,{title:"Attachment Points",className:"attach-points",result:function(){return e.result},valid:function(){return e.valid},params:n},a.a.createElement(Zl,V()({schema:Cn,init:n},e),a.a.createElement(Jl,{name:"primary"}),a.a.createElement(Jl,{name:"secondary"})))})),Yu={title:"Reaction Auto-Mapping",type:"object",required:["mode"],properties:{mode:{title:"Mode",enum:["discard","keep","alter","clear"],enumNames:["Discard","Keep","Alter","Clear"],default:"discard"}}};var qu=Object(N.b)((function(t){return{formState:t.modal.form}}),(function(t,e){return{onOk:function(n){t(function(t){return Ir("automap",t)}(n)),e.onOk(n)}}}))((function(t){var e=t.formState,n=D()(t,["formState"]);return a.a.createElement(Oc,{title:"Reaction Auto-Mapping",className:"automap",result:function(){return e.result},valid:function(){return e.valid},params:n},a.a.createElement(Zl,V()({schema:Yu},e),a.a.createElement(Jl,{name:"mode"})))}));var $u=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.formState,n=D()(t,["formState"]);return a.a.createElement(Oc,{title:"Bond Properties",className:"bond",result:function(){return e.result},valid:function(){return e.valid},params:n},a.a.createElement(Zl,V()({schema:Rn,init:n},e),a.a.createElement(Jl,{name:"type"}),a.a.createElement(Jl,{name:"topology"}),a.a.createElement(Jl,{name:"center"})))})),Ku={title:"Check",type:"object",properties:{checkOptions:{type:"array",items:{type:"string",enum:["valence","radicals","pseudoatoms","stereo","query","overlapping_atoms","overlapping_bonds","rgroups","chiral","3d","chiral_flag"],enumNames:["Valence","Radical","Pseudoatom","Stereochemistry","Query","Overlapping Atoms","Overlapping Bonds","R-Groups","Chirality","3D Structure","Chiral flag"]}}}};function Xu(t){var e=t.moleculeErrors,n=Object.keys(e);return a.a.createElement("fieldset",null,0===n.length?a.a.createElement("dt",null,"No errors found"):n.map((function(t){return a.a.createElement("div",null,a.a.createElement("dt",null,function(t){var e=Ku.properties.checkOptions.items;return e.enumNames[e.enum.indexOf(t)]}(t)," warning:"),a.a.createElement("dd",null,e[t]))})))}var Zu=Object(N.b)((function(t){return{formState:t.modal.form,checkState:t.options.check}}),(function(t,e){return{onCheck:function(n){return t(Lr(n)).catch(e.onCancel)},onOk:function(n){t({type:"SAVE_CHECK_OPTS",data:n}),e.onOk(n)}}}))((function(t){var e=t.formState,n=t.checkState,r=t.onCheck,o=D()(t,["formState","checkState","onCheck"]),i=e.result,s=void 0===i?n:i,c=e.moleculeErrors,l=[{caption:"Check",component:Xu,props:{moleculeErrors:c}},{caption:"Settings",component:Jl,props:{name:"checkOptions",multiple:!0,type:"checkbox",labelPos:!1}}];return a.a.createElement(Oc,{title:"Structure Check",className:"check",result:function(){return s},params:o},a.a.createElement(Zl,V()({schema:Ku,init:n},e),a.a.createElement(Al,{className:"tabs",captions:l,changeTab:function(t){return 0===t?r(s.checkOptions):null},tabs:l},a.a.createElement(Xu,{moleculeErrors:c}),a.a.createElement(Jl,{name:"checkOptions",multiple:!0,type:"checkbox",labelPos:!1}))))})),Qu={title:"Enhanced Stereo",type:"object",oneOf:[{properties:{stereoFlag:{title:"Stereo Flag",enum:["and","or","abs"],enumNames:["AND Enantiomer","OR Enantiomer","ABS (Chiral)"]}}},{properties:{type:{title:"Stereo Label",enum:["and","or","abs",null],enumNames:["AND Enantiomer","OR Enantiomer","ABS (Chiral)","< Clear label >"]},number:{title:"Stereo Group",type:"integer",minimum:1,invalidMessage:"Only positive integer"}}}]};var Ju=Object(N.b)((function(t){return{formState:t.modal.form||{result:{},valid:!1}}}))((function(t){var e=t.type,n=t.formState,r=t.init,o=D()(t,["type","formState","init"]),i=n.result,s=n.valid,c="fragment"===e?Qu.oneOf[0]:Qu.oneOf[1];return a.a.createElement(Oc,{title:"Enhanced Stereo ".concat(e),className:"enhancedStereo",params:o,result:function(){return i},valid:function(){return s},buttons:["OK","Close"]},a.a.createElement(Zl,V()({schema:c,init:r},n),"fragment"===e&&[a.a.createElement(Jl,{name:"stereoFlag"})],"atoms"===e&&[a.a.createElement(Jl,{name:"type"}),a.a.createElement("hr",null),a.a.createElement(Jl,{name:"number",disabled:!i||"abs"===i.type||null===i.type})]))}));function tp(t){var e=Math.abs(t.charge),n=["",":",".","^^"][t.radical]||"",r="";return e&&(r=t.charge<0?"-":"+"),(t.isotope||"")+t.label+n+(e>1?e:"")+r}function ep(t){var e=t.match(/^(\d+)?([a-z*]{1,3})(\.|:|\^\^)?(\d+[-+]|[-+])?$/i);if(e){var n="*"===e[2]?"A":Object(M.capitalize)(e[2]),r=0,a=0,o=0;if(e[1]&&(a=parseInt(e[1])),e[3]&&(o={":":1,".":2,"^^":3}[e[3]]),e[4]&&(r=parseInt(e[4]),isNaN(r)&&(r=1),e[4].endsWith("-")&&(r=-r)),"A"===n||"Q"===n||"X"===n||"M"===n||ut.map[n])return{label:n,charge:r,isotope:a,radical:o}}return null}var np=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e={label:t.letter||tp(t)},n=t.formState,r=D()(t,["formState"]),o=n.result,i=n.valid;return a.a.createElement(Oc,{title:"Label Edit",className:"labeledit",valid:function(){return i},result:function(){return ep(o.label)},params:r},a.a.createElement(Zl,V()({schema:Tn,customValid:{label:function(t){return ep(t)}},init:e},n),a.a.createElement(Jl,{name:"label",maxLength:"20",size:"10"})))}));function rp(t){var e=t.name,n=t.rgids,r={title:ha().schema.properties[e].title,enum:[0],enumNames:["Always"]};return n.forEach((function(e){t.label!==e&&(r.enum.push(e),r.enumNames.push("IF R".concat(t.label," THEN R").concat(e)))})),a.a.createElement(Jl,V()({name:e,schema:r},t))}var ap=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.formState,n=t.label,r=t.rgroupLabels,o=D()(t,["formState","label","rgroupLabels"]);return a.a.createElement(Oc,{title:"R-Group Logic",className:"rgroup-logic",result:function(){return e.result},valid:function(){return e.valid},params:o},a.a.createElement(Zl,V()({schema:Nn,customValid:{range:function(t){return function(t){return t.replace(/\s*/g,"").replace(/,+/g,",").replace(/^,/,"").replace(/,$/,"").split(",").every((function(t){return t.match(/^[>,<=]?[0-9]+$/g)||t.match(/^[0-9]+-[0-9]+$/g)}))}(t)}},init:o},e),a.a.createElement(Jl,{name:"range"}),a.a.createElement(Jl,{name:"resth"}),a.a.createElement(rp,{name:"ifthen",className:"cond",label:n,rgids:r})))}));function op(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var ip={title:"Save",type:"object",properties:{filename:{title:"Filename",type:"string",maxLength:128,pattern:/^[^.<>:?"*|/\\][^<>:?"*|/\\]*$/,invalidMessage:function(t){return t?t.length>128?"Filename is too long":"A filename cannot contain characters: \\ / : * ? \" < > | and cannot start with '.'":"Filename should contain at least one character"}},format:{title:"Format",enum:Object.keys(an),enumNames:Object.keys(an).map((function(t){return an[t].name}))}}},sp=function(t){v()(n,t);var e=op(n);function n(t){var a;d()(this,n),(a=e.call(this,t)).state={},a.isRxn=a.props.struct.hasRxnArrow(),a.textAreaRef=Object(r.createRef)();var o=[a.isRxn?"rxn":"mol","smiles","graph"];return a.props.server&&o.push("smiles-ext","smarts","inchi","inchi-aux","cml"),a.saveSchema=ip,a.saveSchema.properties.format=Object.assign(a.saveSchema.properties.format,{enum:o,enumNames:o.map((function(t){return an[t].name}))}),a.changeType(a.isRxn?"rxn":"mol").then((function(e){return e instanceof Error?t.onCancel():null})),a}return f()(n,[{key:"componentDidMount",value:function(){var t=this.props.checkState.checkOptions;this.props.onCheck(t)}},{key:"showStructWarningMessage",value:function(t){var e=this.props.formState.errors;return"mol"!==t&&Object.keys(e).length>0}},{key:"changeType",value:function(t){var e=this,n=this.props,r=n.struct,a=n.server,o=n.options,i=n.formState;return on(r,t,a,o).then((function(t){e.setState({structStr:t}),setTimeout((function(){return e.textAreaRef.current.select()}),10)}),(function(t){return alert(t.message),e.props.onResetForm(i),t}))}},{key:"render",value:function(){var t=this,e=this.state.structStr,n=Object.assign({},this.props.formState);delete n.moleculeErrors;var r=n.result,o=r.filename,i=r.format,s=function(t,e){var n=[];return"inchi"!==e&&"inchi-aux"!==e&&"smiles"!==e&&"smiles-ext"!==e||(0!==t.rgroups.size&&n.push("In ".concat(an[e].name," the structure will be saved without R-group fragments")),null!==(t=t.clone()).atoms.find((function(t,e){return"R#"===e.label}))&&n.push("In ".concat(an[e].name," the structure will be saved without R-group members")),null!==t.sgroups.find((function(t,e){return"MUL"!==e.type&&!/^INDIGO_.+_DESC$/i.test(e.data.fieldName)}))&&n.push("In ".concat(an[e].name," the structure will be saved without S-groups"))),"smiles"!==e&&"smiles-ext"!==e&&"smarts"!==e&&"inchi"!==e&&"inchi-aux"!==e&&"cml"!==e||null!==t.atoms.find((function(t,e){return e.explicitValence>=0}))&&n.push("In ".concat(an[e].name," valence is not supported")),0!==n.length?n.join("\n"):null}(this.props.struct,i),c=this.props.struct.isBlank(),l=this.showStructWarningMessage(i);return a.a.createElement(Oc,{title:"Save Structure",className:"save",params:this.props,buttons:[a.a.createElement(bu,{data:e,filename:o+an[i].ext[0],key:"save-button",type:i.mime,server:this.props.server,onSave:function(){return t.props.onOk()},disabled:!n.valid||c},"Save To File\u2026"),a.a.createElement("button",{key:"save-tmpl",className:"save-tmpl",disabled:c,onClick:function(){return t.props.onTmplSave(t.props.struct)}},"Save to Templates"),"Close"]},a.a.createElement("div",{className:"form-container"},a.a.createElement(Zl,V()({schema:this.saveSchema,init:{filename:o,format:this.isRxn?"rxn":"mol"}},n),a.a.createElement(Jl,{name:"filename"}),a.a.createElement(Jl,{name:"format",onChange:function(e){return t.changeType(e)}})),a.a.createElement("textarea",{value:e,readOnly:!0,ref:this.textAreaRef}),l&&a.a.createElement("div",{className:"warning"},"Structure contains errors, please check the data, otherwise you can lose some properties or the whole structure after saving in this format."),s&&a.a.createElement("div",{className:"warnings-container"},a.a.createElement("div",{className:"warning"}),a.a.createElement("div",{className:"warnings-arr"},s))))}}]),n}(r.Component),cp=Object(N.b)((function(t){return{server:t.options.app.server?t.server:null,struct:t.editor.struct(),options:t.options.getServerSettings(),formState:t.modal.form,checkState:t.options.check}}),(function(t){return{onCheck:function(e){return t(Lr(e))},onTmplSave:function(e){return t(function(t){var e={struct:t.clone(),props:{}};return function(t,n){Kr(t,"attach",{tmpl:e}).then((function(r){var a=r.name,o=r.attach;e.struct.name=a,e.props=sa(sa({},o),{},{group:"User Templates"});var i=n().templates.lib.concat(e);t(na(i)),ca(i)})).catch((function(){return null}))}}(e))},onResetForm:function(e){return t(jr(e))}}}))(sp);function lp(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var up=function(t){v()(n,t);var e=lp(n);function n(t){var r;return d()(this,n),(r=e.call(this,t)).state={},r.state.active=t.active||[],r}return f()(n,[{key:"onActive",value:function(t){var e=this.props.multiple;void 0===e||e?this.setState((function(e){return{active:Object(M.xor)(e.active,[t])}})):this.setState({active:[t]})}},{key:"groupIsActive",value:function(t){return this.state.active.includes(t)}},{key:"render",value:function(){var t=this,e=this.props,n=(e.children,D()(e,["children"])),r=a.a.Children.map(this.props.children,(function(e,n){var r={isActive:t.groupIsActive.bind(t),onActive:t.onActive.bind(t),index:n};return a.a.isValidElement(e)?a.a.cloneElement(e,r):e}));return a.a.createElement("ul",n,r)}}],[{key:"Group",value:function(t){var e=t.caption,n=t.isActive,r=t.onActive,o=t.index,i=t.children;return a.a.createElement("li",{className:"ac_tab "+(n(o)?"active":"hidden")},a.a.createElement("a",{onClick:function(){return r(o)}},e),i)}}]),n}(r.Component);function pp(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var dp=function(t){v()(n,t);var e=pp(n);function n(t){var r;return d()(this,n),(r=e.call(this,t)).state={cust:t.value||t.schema.default,meas:"px"},r.calcValue=r.calcValue.bind(Q()(r)),r.handleChange=r.handleChange.bind(Q()(r)),r.handleMeasChange=r.handleMeasChange.bind(Q()(r)),r}return f()(n,[{key:"handleChange",value:function(t){var e=fp(t,this.state.meas,"px");this.state.cust=t,this.props.onChange(e)}},{key:"handleMeasChange",value:function(t){this.setState((function(e){return{meas:t,cust:fp(e.cust,e.meas,t)}}))}},{key:"calcValue",value:function(){var t=this;this.setState((function(e){return{cust:fp(t.props.value,"px",e.meas)}}))}},{key:"render",value:function(){var t=this.state,e=t.meas,n=t.cust,r=this.props,o=r.schema,i=r.value,s=(r.onChange,D()(r,["schema","value","onChange"]));return"px"===e&&n.toFixed()-0!==i&&this.setState({meas:"px",cust:i}),a.a.createElement("div",V()({style:{display:"inline-flex"}},s),a.a.createElement(rl,{schema:o,step:"px"===e||"pt"===e?"1":"0.001",style:{width:"75%"},value:n,onChange:this.handleChange,onBlur:this.calcValue}),a.a.createElement(rl,{schema:{enum:["cm","px","pt","inch"]},style:{width:"25%"},value:e,onChange:this.handleMeasChange}))}}]),n}(r.Component),hp={px:1,cm:37.795278,pt:1.333333,inch:96};function fp(t,e,n){return!t&&0!==t||isNaN(t)?null:"px"===n||"pt"===n?(t*hp[e]/hp[n]).toFixed()-0:(t*hp[e]/hp[n]).toFixed(3)-0}function mp(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var gp=["Arial","Arial Black","Comic Sans MS","Courier New","Georgia","Impact","Charcoal","Lucida Console","Monaco","Palatino Linotype","Book Antiqua","Palatino","Tahoma","Geneva","Times New Roman","Times","Verdana","Symbol","MS Serif","MS Sans Serif","New York","Droid Sans","Droid Serif","Droid Sans Mono","Roboto"];var bp=null,vp=function(t){v()(n,t);var e=mp(n);function n(t){var r,a;return d()(this,n),(r=e.call(this,t)).state={availableFonts:[(a=t.value,a.substring(a.indexOf("px ")+3))]},r.setAvailableFonts(),r}return f()(n,[{key:"setAvailableFonts",value:function(){var t=this;bp?this.setState({availableFonts:bp}):function(){var t=gp.map((function(t){return new ct.a(t).check().then((function(){return t}),(function(){return null}))}));return Promise.all(t)}().then((function(e){bp=e.filter((function(t){return null!==t})),t.setState({availableFonts:bp})}))}},{key:"render",value:function(){var t=V()({},this.props),e={enum:[],enumNames:[]};return this.state.availableFonts.forEach((function(t){e.enum.push("30px ".concat(t)),e.enumNames.push(t)})),1!==e.enum.length?a.a.createElement(rl,V()({},t,{schema:e})):a.a.createElement("select",null,a.a.createElement("option",null,e.enumNames[0]))}}]),n}(r.Component);function yp(t){var e=t.schema,n=D()(t,["schema"]),r={title:e.title,enum:[!0,!1],enumNames:["on","off"]};return a.a.createElement(rl,V()({schema:r},n))}var wp=Object(N.b)((function(t){return{server:t.options.app.server?t.server:null,appOpts:t.options.app,initState:t.options.settings,formState:t.modal.form}}),(function(t,e){return{onOpenFile:function(e){try{t(jr({result:JSON.parse(e)}))}catch(n){console.info("Bad file")}},onReset:function(){return t({type:"UPDATE_FORM",data:{result:hr(),valid:!0,errors:{}}})},onOk:function(n){var r;t((br("ketcher-opts",r=n),{type:"SAVE_SETTINGS",data:r})),e.onOk(n)}}}))((function(t){var e=t.initState,n=t.formState,r=t.server,o=t.onOpenFile,i=t.onReset,s=t.appOpts,c=D()(t,["initState","formState","server","onOpenFile","onReset","appOpts"]);return a.a.createElement(Oc,{title:"Settings",className:"settings",result:function(){return n.result},valid:function(){return n.valid},params:c,buttons:[a.a.createElement(Sc,{key:"settings",server:r,onLoad:o},"Open From File\u2026"),a.a.createElement(bu,{key:"ketcher-settings",data:JSON.stringify(n.result),filename:"ketcher-settings"},"Save To File\u2026"),a.a.createElement("button",{key:"settings-button",onClick:i},"Reset"),"Cancel","OK"]},a.a.createElement(Zl,V()({schema:dr,init:e},n),a.a.createElement(up,{className:"accordion",multiple:!1,active:[0]},a.a.createElement(up.Group,{caption:"Rendering customization options"},a.a.createElement("fieldset",{className:"render"},a.a.createElement(Jl,{name:"resetToSelect"}),a.a.createElement(Jl,{name:"rotationStep"}),a.a.createElement(Jl,{name:"showValenceWarnings",component:yp}),a.a.createElement(Jl,{name:"atomColoring",component:yp}),a.a.createElement(Jl,{name:"hideStereoFlags",component:yp}),a.a.createElement(Jl,{name:"font",component:vp}),a.a.createElement(Jl,{name:"fontsz",component:dp}),a.a.createElement(Jl,{name:"fontszsub",component:dp}))),a.a.createElement(up.Group,{caption:"Atoms"},a.a.createElement("fieldset",{className:"atoms"},a.a.createElement(Jl,{name:"carbonExplicitly",component:yp}),a.a.createElement(Jl,{name:"showCharge",component:yp}),a.a.createElement(Jl,{name:"showValence",component:yp}),a.a.createElement(Jl,{name:"showHydrogenLabels",component:yp}))),a.a.createElement(up.Group,{caption:"Bonds"},a.a.createElement("fieldset",{className:"bonds"},a.a.createElement(Jl,{name:"aromaticCircle",component:yp}),a.a.createElement(Jl,{name:"doubleBondWidth",component:dp}),a.a.createElement(Jl,{name:"bondThickness",component:dp}),a.a.createElement(Jl,{name:"stereoBondWidth",component:dp}))),a.a.createElement(up.Group,{caption:"Server"},a.a.createElement("fieldset",{className:"server",disabled:!s.server},a.a.createElement(Jl,{name:"smart-layout",component:yp}),a.a.createElement(Jl,{name:"ignore-stereochemistry-errors",component:yp}),a.a.createElement(Jl,{name:"mass-skip-error-on-pseudoatoms",component:yp}),a.a.createElement(Jl,{name:"gross-formula-add-rsites",component:yp}),a.a.createElement(Jl,{name:"gross-formula-add-isotopes",component:yp}))),a.a.createElement(up.Group,{caption:"3D Viewer"},a.a.createElement("fieldset",{className:"miew",disabled:!window.Miew},a.a.createElement(Jl,{name:"miewMode"}),a.a.createElement(Jl,{name:"miewTheme"}),a.a.createElement(Jl,{name:"miewAtomLabel"}))),a.a.createElement(up.Group,{caption:"Options for debugging"},a.a.createElement("fieldset",{className:"debug"},a.a.createElement(Jl,{name:"showAtomIds",component:yp}),a.a.createElement(Jl,{name:"showBondIds",component:yp}),a.a.createElement(Jl,{name:"showHalfBondIds",component:yp}),a.a.createElement(Jl,{name:"showLoopIds",component:yp})))),mr()?null:a.a.createElement("div",{className:"warning"},fr)))}));var Ep=function(t){return Object.keys(jn[t].properties).filter((function(t){return"type"!==t})).map((function(e){var n={};return"name"===e&&(n.maxLength=15),"fieldName"===e&&(n.maxLength=30),"fieldValue"===e&&(n.type="textarea"),"radiobuttons"===e&&(n.type="radio"),a.a.createElement(Jl,V()({name:e,key:"".concat(t,"-").concat(e)},n))}))},Op=Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.formState,n=D()(t,["formState"]),r=e.result,o=e.valid,i=r.type;return a.a.createElement(Oc,{title:"S-Group Properties",className:"sgroup",result:function(){return r},valid:function(){return o},params:n},a.a.createElement(Zl,V()({schema:jn[i],init:n},e),a.a.createElement(tu,{title:"Type",name:"type",schema:jn}),a.a.createElement("fieldset",{className:"DAT"===i?"data":"base"},Ep(i))))}));function xp(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Sp=function(t){v()(n,t);var e=xp(n);function n(t){var r;return d()(this,n),(r=e.call(this,t)).state={suggestsHidden:!0},r.click=r.click.bind(Q()(r)),r.blur=r.blur.bind(Q()(r)),r.updateInput=r.updateInput.bind(Q()(r)),r}return f()(n,[{key:"updateInput",value:function(t){var e=t.target.value||t.target.textContent;this.setState({suggestsHidden:!0}),this.props.onChange(e)}},{key:"click",value:function(){this.setState({suggestsHidden:!1})}},{key:"blur",value:function(){this.setState({suggestsHidden:!0})}},{key:"render",value:function(){var t=this,e=this.props,n=e.value,r=e.type,o=void 0===r?"text":r,i=e.schema.enumNames.filter((function(t){return t!==n})).map((function(e){return a.a.createElement("li",{key:e,onMouseDown:t.updateInput},e)})),s={display:this.state.suggestsHidden?"none":"block"};return a.a.createElement("div",null,a.a.createElement("input",{type:o,value:n,onClick:this.click,onBlur:this.blur,onInput:this.updateInput,autoComplete:"off"}),0!==i.length?a.a.createElement("ul",{className:"suggestList",style:s},i):"")}}]),n}(r.Component);function Ap(t){var e=t.title,n=t.name,r=t.schema,o=D()(t,["title","name","schema"]),i=Object.keys(r).reduce((function(t,e){return t.enum.push(e),t.enumNames.push(r[e].title||e),t}),{title:e,type:"string",default:"",minLength:1,enum:[],enumNames:[]});return a.a.createElement(Jl,V()({name:n,schema:i,component:Sp},o))}var Pp=function(t,e,n){return Object.keys(t.properties).filter((function(t){return"type"!==t&&"context"!==t&&"fieldName"!==t})).map((function(t){return"radiobuttons"===t?a.a.createElement(Jl,{name:t,type:"radio",key:"".concat(e,"-").concat(n,"-").concat(t,"-radio")}):a.a.createElement(Jl,{name:t,type:"textarea",multiple:!0,size:"10",key:"".concat(e,"-").concat(n,"-").concat(t,"-select")})}))},Tp={open:Yc,analyse:dl,recognize:wl,"period-table":ql,rgroup:iu,attach:pu,templates:ju,about:Iu,help:function(t){var e=Object(r.useState)(null),n=u()(e,2),o=n[0],s=n[1],l=da().staticResourcesUrl;Object(r.useEffect)((function(){(function(){var t=c()(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:fetch("".concat(l,"/docs/help.md")).then((function(t){return t.text()})).then((function(t){return s(t)}));case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}})()()}),[l]);var p=Object(r.useCallback)((function(t){return"".concat(l,"/docs/").concat(t)}),[l]);return o&&a.a.createElement(Oc,{title:"Help",params:t,buttons:["Close"]},o&&a.a.createElement(at.a,{plugins:[it.a],transformImageUri:p},o))},miew:Fu,atomProps:Uu,attachmentPoints:Wu,automap:qu,bondProps:$u,check:Zu,enhancedStereo:Ju,labelEdit:np,rgroupLogic:ap,save:cp,settings:wp,sgroup:Op,sdata:Object(N.b)((function(t){return{formState:t.modal.form}}))((function(t){var e=t.context,n=t.fieldName,r=t.fieldValue,o=t.type,i=t.radiobuttons,s=t.formState,c=D()(t,["context","fieldName","fieldValue","type","radiobuttons","formState"]),l=s.result,u=s.valid,p={context:e,fieldName:n||zn(e),type:o,radiobuttons:i};p.fieldValue=r||zn(e,p.fieldName);var d=In[l.context][l.fieldName]||Ln,h={context:l.context.trim(),fieldName:l.fieldName.trim(),fieldValue:"string"===typeof l.fieldValue?l.fieldValue.trim():l.fieldValue};return a.a.createElement(Oc,{title:"S-Group Properties",className:"sgroup",result:function(){return l},valid:function(){return u},params:c},a.a.createElement(Zl,V()({serialize:h,schema:d,init:p},s),a.a.createElement(tu,{title:"Context",name:"context",schema:In}),a.a.createElement("fieldset",{className:"data"},a.a.createElement(Ap,{title:"Field name",name:"fieldName",schema:In[l.context]}),Pp(d,l.context,l.fieldName))))}))};function Cp(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Rp(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Cp(Object(n),!0).forEach((function(e){C()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Cp(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var jp=Object(N.b)((function(t){return{modal:t.modal}}),(function(t){return{onOk:function(e){console.info("Output:",e),t({type:"MODAL_CLOSE"})},onCancel:function(){t({type:"MODAL_CLOSE"})}}}),(function(t,e){var n=t.modal&&t.modal.prop,r=n?Object(M.omit)(["onResult","onCancel"],n):{};return Rp(Rp({modal:t.modal},r),{},{onOk:function(t){n&&n.onResult&&n.onResult(t),e.onOk(t)},onCancel:function(){n&&n.onCancel&&n.onCancel(),e.onCancel()}})}))((function(t){var e=t.modal,n=D()(t,["modal"]);if(!e)return null;var r=Tp[e.name];if(!r)throw new Error("There is no modal window named ".concat(e.name));return a.a.createElement("div",{className:"ket-overlay"},a.a.createElement(r,n))}));function Np(){return(Np=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Mp=Object(r.createElement)("path",{d:"M666.667 812.5V708.333c0-11.718-9.115-20.833-20.834-20.833h-62.5V354.167c0-11.72-9.114-20.834-20.833-20.834H354.167c-11.72 0-20.834 9.115-20.834 20.834v104.166c0 11.72 9.115 20.834 20.834 20.834h62.5V687.5h-62.5c-11.72 0-20.834 9.115-20.834 20.833V812.5c0 11.719 9.115 20.833 20.834 20.833h291.666c11.72 0 20.834-9.114 20.834-20.833zm-83.334-583.333V125c0-11.719-9.114-20.833-20.833-20.833h-125c-11.719 0-20.833 9.114-20.833 20.833v104.167c0 11.718 9.114 20.833 20.833 20.833h125c11.719 0 20.833-9.115 20.833-20.833zM1000 500c0 276.042-223.958 500-500 500C223.958 1000 0 776.042 0 500 0 223.958 223.958 0 500 0c276.042 0 500 223.958 500 500z"});function kp(){return(kp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Bp=Object(r.createElement)("path",{d:"M585.781 276.055l-8.73 15.797H559.59s-24.945 0-31.598 34.921l-7.066 34.922h47.808l-8.73 17.461H518.43l-24.942 122.23c-10.394 52.384-47.812 52.384-47.812 52.384h-54.047l7.07-17.461h17.043s26.61 0 33.676-34.922l24.945-122.23H435.7l8.73-17.462h33.676l7.067-34.922c10.394-52.382 47.808-52.382 47.808-52.382zm0 186.668l-33.676-46.149-12.054 7.485-12.059 7.898 34.508 52.8-57.79 55.708 19.958 19.957 54.047-51.969 37 56.125 12.058-7.898 12.055-7.485-41.574-60.699 57.371-55.293-9.977-9.976-9.976-10.395zm166.297-23.282c-.367 91.606-55.082 174.254-139.273 210.364a113.081 113.081 0 01-14.137 38.25c-19.602 35.312-55.742 58.308-96.035 61.113H110.172a118.487 118.487 0 01-93.543-60.7 124.736 124.736 0 01-4.574-115.16l180.851-356.706a41.618 41.618 0 005.82-17.461V80.238c-15.167-4.71-25.246-19.058-24.53-34.922C173.78 16.215 196.23.832 225.331.832h162.14a41.57 41.57 0 0148.641 44.066c.91 17.106-11.008 32.23-27.855 35.34v118.489c0 6.234 5.406 12.054 8.316 17.46l7.899 12.473c71.336-30.547 153.21-23.472 218.25 18.856 65.039 42.332 104.66 114.328 105.613 191.925M87.723 644.816c4.988 7.899 13.304 21.204 22.863 21.204h369.18c-111.414-17.891-193.543-113.74-194.149-226.58a228.229 228.229 0 0169.012-163.386l-12.473-22.453a127.586 127.586 0 01-17.875-54.875V83.98h-41.574v114.747a133.024 133.024 0 01-14.555 56.957L86.472 614.469a34.522 34.522 0 000 29.933m430.298-16.629c103.734-1.148 187.007-85.964 186.246-189.703-.762-103.738-85.27-187.328-189.012-186.949-103.738.379-187.64 84.578-187.645 188.32.684 104.54 85.868 188.79 190.41 188.332"});function Lp(){return(Lp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ip=Object(r.createElement)("path",{d:"M461.486 555.69l-18.127 65.268h-59.567l77.694-254.138h75.436l78.773 254.138h-61.879l-19.565-65.267zm64.446-43.032l-15.867-53.919c-4.468-14.994-9.038-33.892-12.787-48.989h-.77c-3.8 14.995-7.549 34.303-11.708 48.99l-15.046 53.918zM261.5 86.968C182.017 224.667 102.5 362.344 23 500.032a1681288.366 1681288.366 0 01238.5 413h477c79.487-137.674 158.974-275.348 238.5-413C897.5 362.343 817.983 224.666 738.5 86.97h-477zm14.844 25.657h447.312L947.313 500 723.655 887.375H276.344L52.688 500l223.656-387.375zM500 242c-125.952-2.705-242.477 100.031-255.956 225.208C225.71 589.9 309.658 716.56 429.414 748.259c116.773 35.718 252.289-25.562 303.155-136.43 55.154-109.081 17.748-253.408-83.244-322.18C606.108 258.73 553.14 241.836 500 242zm0 25.656c115.575-2.723 222.028 93.37 231.177 208.593 14.12 112.839-67.364 226.9-178.639 250.184-108.48 27.437-229.859-36.275-268.812-141.166-43.073-103.399 2.26-233.034 100.548-286.842 34.99-20.191 75.338-30.85 115.726-30.769z"});function Dp(){return(Dp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var zp=Object(r.createElement)("path",{d:"M807.589 373.705l-17.417-30.746 167.411-82.28L975 291.377zM550.192 497.027l-17.417-30.746 174.483-84.455 17.417 30.746zm-252.7 118.971l-17.417-30.697 167.411-82.376 17.417 30.794zM42.417 739.321L25 708.526l174.483-84.454 17.417 30.746z"});function _p(){return(_p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Hp=Object(r.createElement)("path",{d:"M354.558 455.59l-16.99-32.66 206.568-108.165 16.937 32.66zm312.57-163.196l-16.938-32.66 206.568-108.165 16.937 32.66zM41.936 618.786L25 586.126l206.568-108.164 16.937 32.66zm100.896 229.645l-16.897-32.607 832.167-431.22L975 417.21z"});function Vp(){return(Vp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Fp=Object(r.createElement)("path",{d:"M214.927 956.465c-25.124-12.22-44.919-25.594-17.643-49.159l556.362-863.77c25.123 12.22 44.91 25.595 17.636 49.158l-556.355 863.77zM39.649 756.733c-15.73-23.086-26.341-44.555 9.056-51.484l911.646-473.856c15.73 23.086 26.341 44.555-9.056 51.484L39.649 756.733z"});function Gp(){return(Gp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Up=Object(r.createElement)("path",{d:"M41.85 615.302L25 582.793l830.184-430.195 16.85 32.515zm103.48 232.1l-16.883-32.495 829.67-431.244L975 416.151z"});function Wp(){return(Wp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Yp=Object(r.createElement)("path",{d:"M924.756 388.797H975v50.614h-50.244zm-110.042-238.82h50.244v50.667h-50.244zm-458.797 245.84h50.244v50.614h-50.244zM470.603 634.53h50.244v50.666h-50.244zm147.514-30.348l-17.259-33.302 210.425-110.095 17.311 33.25zm-468.14 245.84l-17.258-33.304 210.373-110.147 17.31 33.303zm346.487-477.587l-17.311-33.303 210.425-110.147 17.258 33.303zM42.258 613.578L25 580.275l210.425-110.147 17.258 33.303z"});function qp(){return(qp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var $p=Object(r.createElement)("path",{d:"M935.166 651.48L599.147 136.378l39.834-25.98L975 625.493zm-111.422 30.486l-297.193-455.74 39.742-26.02 297.193 455.635zm-111.42 30.387L453.887 316.035l39.782-25.947L752.11 686.406zM600.861 742.66L381.147 405.672l39.795-26.02 219.715 336.936zM489.5 773.008L308.471 495.395l39.795-26.072 180.976 277.666zM378.14 803.356l-142.29-218.344 39.742-25.966 142.237 218.29zm-111.375 30.261L163.186 674.762l39.749-25.914 103.577 158.855zM155.256 864.05l-64.864-99.486 39.795-26.02 64.864 99.434zM51.165 889.602L25 849.444l39.801-25.927 26.165 40.15z"});function Kp(){return(Kp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Xp=Object(r.createElement)("path",{d:"M43.96 760.205L25 723.728l931.033-483.933L975 276.272z"});function Zp(){return(Zp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Qp=Object(r.createElement)("path",{d:"M144.817 842.643l-16.837-32.52L958.17 380.26 975 412.772zM798.4 157.357h49.277v49.594h-49.277zM349.049 398.046h49.224v49.594H349.05zm137.649-22.898l-16.936-32.553 206.079-107.893 16.883 32.553zM41.936 611.352L25 578.747l206.026-107.893 16.935 32.605z"});function Jp(){return(Jp=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var td=Object(r.createElement)("path",{d:"M407.502 572.415l-17.154-33.093 209.117-109.468 17.154 33.041zm358.328-186.21l-17.154-33.04 209.17-109.52L975 276.737zM42.101 763.217L25 730.124l209.117-109.467 17.154 33.04zm637.644-72.098l-17.154-33.094 209.17-109.467 17.154 33.041zM326.06 877.329l-17.154-33.093 209.118-109.52 17.153 33.04zm160.56-612.098l-17.155-33.093L678.584 122.67l17.153 33.04zM128.238 456.034l-17.154-33.041 209.118-109.52 17.153 33.04z"});function ed(){return(ed=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var nd=Object(r.createElement)("path",{d:"M226.323 893.87L211.13 864.54l748.683-387.867L975 505.994zm-95.685-183.373l-15.241-29.301L863.4 292.062l15.24 29.294zm-90.443-187.17L25 494.004l748.683-387.874 15.188 29.32z"});function rd(){return(rd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ad=Object(r.createElement)("path",{d:"M25 889.025l636.975-778.05L975 595.845z"});function od(){return(od=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var id=Object(r.createElement)("path",{d:"M56.508 883.351L25 866.041l86.08-157.49 152.898 56.578-14.092-251.591 230.428 172.319-94.736-367.333 306.005 284.26L509.025 116.65 975 587.849l-25.544 25.28L601.86 261.735l177.017 471.252-327.75-304.527 89.51 347.436-250.535-187.361 12.878 229.372-175.223-64.811z"});function sd(){return(sd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var cd=Object(r.createElement)("path",{d:"M337.18 647.039L25 429.964V352.96l312.18 212.167L645.35 352.96 975 565.128v81.91L645.35 429.965z"});function ld(){return(ld=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ud=Object(r.createElement)("path",{d:"M620.546 105.63v130.925H975V105.63H620.546zm25.546 25.546h303.362v79.832H646.092v-79.832zM315.588 54.538C217.793 351.168 121.288 648.316 25 945.462h138.908c25.114-91.085 55.768-180.853 83.025-271.428h274.622c28.958 90.558 60.417 180.46 87.815 271.428h140.504C654.061 648.335 558.182 351.157 460.882 54.538H315.588zm17.563 25.546H443.32l271.429 839.832h-86.219c-29.461-90.408-57.413-181.36-87.815-271.429H229.37c-29.515 90.014-56.198 181.03-84.622 271.429H61.723L333.15 80.084zm38.32 73.445c-31.053 145.824-82.742 286.157-127.652 428.08 5.085 10.533 37.958 1.603 53.79 4.61h228.736c-42.854-144.445-99.192-285.093-130.925-432.69h-23.95zm12.773 54.286c27.149 120.238 71.648 235.466 108.571 352.857H277.27c36.636-117.314 81.094-232.463 106.975-352.857z"});function pd(){return(pd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var dd=Object(r.createElement)("path",{d:"M731.656 44.188V156.28H619.5v131.25h112.156v112.094h131.282V287.531H975v-131.25H862.937V44.187h-131.28zm25.657 25.656h79.968v112.125h112.032v79.875H837.28v112.125h-79.968V261.844H645.155v-79.875h112.157V69.844zM310.906 61.78C213.953 359.78 117.082 657.805 20.156 955.813h138.875c28.26-91.036 56.476-182.085 84.719-273.125h274.531c29.48 91.041 58.956 182.084 88.438 273.125h141.156C650.997 657.803 554.108 359.797 457.25 61.78H310.906zm18.656 25.688h109.032L712.53 930.156h-87.125C595.926 839.104 566.451 748.051 536.97 657H224.844c-28.261 91.045-56.476 182.105-84.719 273.156H55.5L329.563 87.47zM367.625 161c-28.523 141.514-79.739 276.783-122.475 414.3-8.888 16.338-5.537 23.76 13.53 19.763h264.57C473.04 438.166 426.802 305.382 391.719 161h-24.094zm12.594 60.875c29.77 117.653 71.46 231.798 107.719 347.531H274c35.996-115.647 78.14-229.583 106.219-347.531z"});function hd(){return(hd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var fd=Object(r.createElement)("path",{d:"M361.875 603.375L141.75 375h104.625l106.5 112.5 165.75-235.875L612 249zM375 0C167.895 0 0 167.895 0 375s167.895 375 375 375 375-167.895 375-375S582.105 0 375 0zm0 0"});function md(){return(md=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var gd=Object(r.createElement)("path",{d:"M0 25h69V0H0zM68 1v23H1V1z"}),bd=Object(r.createElement)("path",{d:"M21 18.14a3.85 3.85 0 002.71-.93 3.07 3.07 0 001-2.43H23.1a2.09 2.09 0 01-.53 1.54 2.09 2.09 0 01-1.55.53 1.94 1.94 0 01-1.64-.8 3.31 3.31 0 01-.6-2v-1.98a3.33 3.33 0 01.59-2 1.89 1.89 0 011.6-.8 2.18 2.18 0 011.59.53 2 2 0 01.54 1.53h1.61a3 3 0 00-1-2.45A4 4 0 0021 7.9a3.58 3.58 0 00-2.78 1.18 4.3 4.3 0 00-1.07 3V14a4.25 4.25 0 001.08 3A3.65 3.65 0 0021 18.14zM27.77 12.54a1.67 1.67 0 01.64-.52 2.09 2.09 0 01.92-.19 1.26 1.26 0 011 .39 1.91 1.91 0 01.34 1.26V18h1.66v-4.51a3.36 3.36 0 00-.66-2.29 2.33 2.33 0 00-1.84-.74 2.42 2.42 0 00-1.17.29 2.63 2.63 0 00-.9.81V7.34h-1.65V18h1.66zM34.16 7.34h1.66V8.8h-1.66zM34.16 10.6h1.66V18h-1.66zM39.32 12.86a1.35 1.35 0 01.5-.58 1.49 1.49 0 01.81-.21h.71l.2-1.55-.24-.06h-.28a1.68 1.68 0 00-1 .32 2.38 2.38 0 00-.72.89l-.11-1.07h-1.53V18h1.66zM45.49 13.65a4.08 4.08 0 00-2.39.6 1.93 1.93 0 00-.85 1.67 2.16 2.16 0 00.62 1.63 2.46 2.46 0 001.77.59 2.3 2.3 0 001.25-.35 2.85 2.85 0 00.9-.87 4 4 0 00.08.53q.06.27.15.55h1.68a4.59 4.59 0 01-.2-.82 6 6 0 01-.06-.88V13a2.31 2.31 0 00-.79-1.89 3.17 3.17 0 00-2.08-.66 3.32 3.32 0 00-2.16.68 1.83 1.83 0 00-.78 1.55h1.6a.86.86 0 01.33-.7 1.39 1.39 0 01.9-.27 1.35 1.35 0 011 .33 1.21 1.21 0 01.34.91v.65zm1.29 2.13a1.59 1.59 0 01-.67.72 2.07 2.07 0 01-1.12.31 1.15 1.15 0 01-.8-.25.86.86 0 01-.28-.67 1.09 1.09 0 01.41-.84 1.67 1.67 0 011.13-.36h1.32zM50.27 7.34h1.66V18h-1.66z"});function vd(){return(vd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var yd=Object(r.createElement)("path",{d:"M376.223 700.95L750 169.991 503.375 44.156l-128.2 650.504L246.974 44.156 0 169.992 373.777 700.95v4.895l2.098-3.145 2.094 3.145zM82.789 190.612l123.313-62.918 65.324 331.02zm0 0"});function wd(){return(wd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ed=Object(r.createElement)("path",{d:"M750 625c.598 49.754-28.371 95.125-73.758 115.52-45.383 20.394-98.543 11.925-135.347-21.555-36.81-33.485-50.25-85.61-34.227-132.715L375 447.918 243.332 586.25c16.805 51.543-1.527 108.04-45.394 139.895-43.864 31.855-103.266 31.8-147.075-.13C7.055 694.083-11.18 637.552 5.72 586.04 22.613 534.527 70.789 499.777 125 500a125.019 125.019 0 0164.582 18.75L333.332 375V242.5c-57.394-20.293-91.828-78.984-81.531-138.988C262.094 43.508 314.12-.352 375-.352s112.906 43.86 123.2 103.864c10.296 60.004-24.137 118.695-81.532 138.988V375l143.75 143.75c38.488-23.227 86.48-24 125.695-2.02C725.328 538.707 749.723 580.047 750 625zm0 0"});function Od(){return(Od=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var xd=Object(r.createElement)("path",{d:"M233.625 137.25c-15.751 0-27.469 13.865-27.469 29.063V946.03c0 15.216 11.72 28.969 27.469 28.969h591.656l3.688-3.406L959.656 850.53l4.125-3.781V166.312c0-15.295-11.722-29.062-27.468-29.062zm0 25.688h702.688c.275 0 1.78.697 1.78 3.375V835.53L815.25 949.313H233.625c-.376 0-1.813-.73-1.813-3.282V166.313c0-2.776 1.337-3.375 1.813-3.375zm124.774 606.965h472.74v21.362H358.4zm0-113.538h472.74v21.413H358.4zm0-113.59h472.74v21.414H358.4zm0-113.537h472.74v21.413H358.4zm0-113.538h472.74v21.362H358.4zM63.687 25C47.883 25 36.22 38.927 36.22 54.125v779.594c0 15.23 11.611 29.125 27.468 29.125h142.47v-25.657H63.686c-.266 0-1.78-.83-1.78-3.468V54.125c0-2.775 1.359-3.438 1.78-3.438h702.688c.22 0 1.813.76 1.813 3.438v83.125h25.656V54.125C793.844 38.83 782.176 25 766.375 25z"});function Sd(){return(Sd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ad=Object(r.createElement)("path",{d:"M188.594 20.563c-41.974 25.386-41.937 82.3-39.58 125.68 7.163 84.366 69.363 147.928 116.482 213.413 43.805 56.067 89.439 110.677 135.598 164.813l-58.563 71.906c-73.596-17.177-141.836 30.819-186.28 85.053-46.468 50.918-91.788 124.353-60.508 194.533 32.385 82.176 135.85 121.6 215.95 86.166 76.857-32.008 134.032-101.74 165.264-177.37 23.654-38.596-4.39-87.694-1.488-118.84 15.148-23.227 30.195-33.856 45.331-4.265 18.201 27.333-24.521 71.748-2.155 108.895 24.009 74.261 77.109 139.99 144.247 179.717 73.622 45.364 181.713 26.6 227.655-48.931 41.133-55.22 23.891-131.074-16.193-181.546-46.283-62.842-110.682-132.456-196.096-126.287-24.12 12.137-32.516-14.591-46.333-28.502l-33.019-40.56c81.095-97.832 167.177-193.194 231.35-303.417 25.599-55.314 31.862-124.326 3.775-179.872-13.44-28.26-30.205-18.095-41.362 2.297L499.969 403C396.174 275.523 292.402 148.028 188.594 20.562zm-2.469 37.624c104.607 128.496 209.274 256.943 313.844 385.47 104.608-128.495 209.23-256.98 313.844-385.47 28.596 66.964 6.737 145.906-37.271 201.115-64.808 92.513-137.952 178.802-211.01 264.823 27.372 33.665 54.793 67.29 82.187 100.938 60.435-21.826 122.88 12.717 162.386 57.553 42.652 46.805 95.462 108.671 73.69 176.742-25.08 73.56-115.979 110.517-186.173 78.816-71.736-30.476-125.173-96.809-152.528-168.486-12.485-32.966-6.032-72.234 20.531-96.407a6746.21 6746.21 0 01-65.594-73.812c-21.745 24.708-43.48 49.428-65.625 73.781 35.39 31.3 31.09 84.49 10.005 122.664-39.926 76.233-109.977 153.708-202.64 153.422-77.323.7-153.183-80.457-124.952-158.08 24.729-61.991 71.15-115.733 126.448-152.748 32.18-20.335 72.89-25.512 109.046-13.445 27.346-33.678 54.8-67.269 82.156-100.938-83.32-99.646-170.363-197.475-238.563-308.438-24.368-47.417-31.22-107.845-9.781-157.5zm489.563 614.344c-47.42-4.126-79.364 47.448-66.035 90.395 15.345 62.162 66.237 115.746 126.952 135.428 48.764 15.22 101.548-31.226 90.89-81.998-10.859-72.363-77.626-139.564-151.808-143.825zm-351.407.032c-76.431 5.218-143.68 73.383-152.274 148.81-8.155 54.132 53.298 95.856 101.43 73.94 59.468-25.671 111.895-81.437 118.94-147.774 4.98-40.653-26.74-77.638-68.096-74.976zm-.187 25.656c56.192-1.759 48.731 72.64 22.644 102.778-25.885 35.895-63.168 74.471-110.48 74.285-48.469-8.669-45.67-71.252-21.339-102.787 23.466-37.908 63.096-71.548 109.175-74.276zm351.781 0c65.121 6.376 123.103 66.698 126.602 132.073-.04 47.127-62.09 57.596-91.73 28.273-42.198-29.476-84.988-77.461-75.808-132.63 4.237-18.255 22.99-28.824 40.936-27.716z"});function Pd(){return(Pd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Td=Object(r.createElement)("path",{d:"M464.67 555.69l-18.127 65.268h-59.567L464.67 366.82h75.435l78.773 254.138H557l-19.565-65.267zm64.446-43.032L513.25 458.74c-4.468-14.994-9.038-33.892-12.787-48.989h-.77c-3.8 14.995-7.549 34.303-11.708 48.99l-15.046 53.918zM360.22 190.906l-.313 25.657 260.938 3.125.281-25.657-260.906-3.125zm400.687 323.875L625.688 744.25l22.125 13.031L783.03 527.813l-22.125-13.032zm-553.281 0L185.5 527.813 320.719 757.28l22.125-13.031-135.219-229.469zM261.5 86.97C182.017 224.666 102.5 362.343 23 500.03a1681288.366 1681288.366 0 01238.5 413h477c79.487-137.674 158.974-275.348 238.5-413C897.5 362.343 817.983 224.666 738.5 86.97h-477zm14.844 25.656h447.312L947.313 500 723.655 887.375H276.344L52.688 500l223.656-387.375z"});function Cd(){return(Cd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Rd=Object(r.createElement)("path",{d:"M876.337 751.055c0 70.936-57.736 128.672-128.672 128.672H201.297c-70.936 0-128.557-57.736-128.557-128.672L747.55 76.36c70.936 0 128.672 57.506 128.672 128.557v546.138z"});var jd=Object(r.createElement)("text",{y:3,fontSize:3},"ES");function Nd(){return(Nd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Md=Object(r.createElement)("path",{d:"M935.125 131.531c-16.775.337-31.692 9.735-48.156 21.563l-.094.062L326.844 548.47l-.032.031-.062.031c-16.263 11.715-30.435 23.848-42.313 44-11.877 20.153-21.594 47.63-32.156 91.438v.125l-48.125 208.531-.687 3 .719 2.938c5.282 21.522 18.66 37.784 36.5 43.875 17.797 6.076 38.371 1.747 56.625-11.344.043-.031.082-.063.125-.094L928.28 489.312l.844-.593.75-.719c34.183-33.262 47.501-69.646 44.688-116.75h.03l-2.312-201.813-.031-1.468-.344-1.438c-2.595-10.545-6.499-19.164-12.906-25.562-6.407-6.399-15.472-9.606-23.875-9.438zm.5 25.688c2.792-.056 3.519.208 5.219 1.906 1.601 1.6 3.93 5.467 5.781 12.344l2.281 200.094v.312l.032.344c2.649 42.15-6.436 67.397-36.407 96.781L282.563 910.063l-.063.062-.063.031c-13.245 9.536-24.765 10.93-33.437 7.97-8.13-2.776-15.187-9.716-19.094-23l47.344-205.157c.006-.025.025-.038.031-.063v-.062c10.274-42.587 19.537-67.716 29.282-84.25 9.734-16.517 19.828-25.155 35.093-36.157l.094-.062 560.031-395.313.032-.03.062-.032c15.08-10.838 28.167-16.67 33.75-16.781zM736.062 48.906c-2.06.023-4.117.077-6.187.188-27.589 1.48-55.785 10.782-77.969 26.75-.011.008-.02.023-.031.031L151.156 434h-.031c-16.27 11.693-30.435 23.854-42.313 44-11.803 20.02-21.483 47.313-31.968 90.594-.54 1.387-16.671 43.008-30.938 90.25-7.253 24.017-13.988 49.26-17.781 71.468-3.793 22.21-6.24 40.66 1.437 56.25 6.559 13.32 20.806 27.178 40.657 45.407 19.85 18.229 44.805 38.86 70.343 57.781 25.54 18.92 51.522 36.112 73.938 47.469 11.208 5.678 21.49 9.922 31.062 12.125 9.573 2.203 19.586 3.022 28.438-3.375l1.344-.969 1.062-1.281 2.094-2.532c-12.829 4.718-25.942 5.303-37.813 1.25-16.689-5.697-29.47-20.3-35.375-39.78-15.549-9.401-32.625-21.054-49.468-33.532-24.794-18.369-49.23-38.567-68.281-56.063-19.052-17.495-33.208-34.267-34.97-37.843-1.565-3.18-2.642-20.181.844-40.594 3.487-20.413 9.957-44.948 17.032-68.375 14.15-46.854 30.656-89.25 30.656-89.25l.313-.781.187-.844c10.287-42.62 19.557-67.797 29.313-84.344 9.747-16.532 19.864-25.164 35.156-36.156.012-.009.018-.022.031-.031L666.844 96.75l.031-.031c20.747-14.945 51.759-22.69 78.094-21.5 8.778.397 17.031 1.772 24.218 4.219 20.81 7.102 64.082 27.028 101.22 44.906a4145.242 4145.242 0 0134.562 16.844c9.884-5.69 19.65-9.446 30.156-9.657 4.077-.082 8.304.639 12.313 2.125a4232.941 4232.941 0 00-65.875-32.437c-37.402-18.005-79.918-37.81-104.094-46.063v-.031c-12.843-4.372-26.98-6.378-41.407-6.219z"});function kd(){return(kd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Bd=Object(r.createElement)("path",{d:"M73.129 209.914v403.543h403.226v73.371H62.133c-34.418 0-62.317-27.922-62.317-62.367V209.914zM304.07 343.45l103.004-103.086-48.754-49.89c-10.734-10.73-28.12-10.73-38.855 0l-63.05 64.199c-10.72 10.742-10.72 28.144 0 38.887zm132.696-73.37L334.859 373.53l311.95 313.297 103.375-103.086zm186.218 123.265V136.543c0-53.195-19.43-73.371-73.316-73.371H183.102c-56.454 0-73.317 16.875-73.317 73.371v366.855c0 54.297 16.863 73.372 73.317 73.372h293.253l-73.312-73.372H183.102V136.543h366.566v183.43zm0 0"});function Ld(){return(Ld=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Id=Object(r.createElement)("path",{d:"M583.333 812.5v-125c0-11.719-9.114-20.833-20.833-20.833h-125c-11.719 0-20.833 9.114-20.833 20.833v125c0 11.719 9.114 20.833 20.833 20.833h125c11.719 0 20.833-9.114 20.833-20.833zM750 375c0-119.14-125-208.333-236.98-208.333-106.119 0-185.546 45.573-241.536 138.672-5.859 9.114-3.255 20.833 5.209 27.343l85.937 65.104c3.255 2.605 7.813 3.907 12.37 3.907 5.86 0 12.37-2.604 16.276-7.813 30.599-39.062 43.62-50.781 55.99-59.896 11.067-7.812 32.552-15.625 55.99-15.625 41.666 0 80.077 26.693 80.077 55.339 0 33.854-17.578 50.781-57.291 69.01-46.224 20.834-109.375 74.87-109.375 138.021v23.438c0 11.718 9.114 20.833 20.833 20.833h125c11.719 0 20.833-9.115 20.833-20.833 0-14.974 18.88-46.875 49.48-64.453C682.292 511.719 750 473.958 750 375zm250 125c0 276.042-223.958 500-500 500C223.958 1000 0 776.042 0 500 0 223.958 223.958 0 500 0c276.042 0 500 223.958 500 500z"});function Dd(){return(Dd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var zd=Object(r.createElement)("path",{d:"M76.82 637.959h670.903v74.543H76.82c-41.168 0-74.543-33.375-74.543-74.543V116.146H76.82zm505.04-250.844a68.954 68.954 0 00-39.88 13.047l-94.67-101.754v-91.316c34.52-11.758 56.43-45.703 52.925-82-1.02-48.965-41.222-88.008-90.199-87.59-49.094-.445-89.68 38.16-91.687 87.219-2.946 36.496 19.343 70.308 54.043 81.996v91.691l-97.282 101.38a81.98 81.98 0 00-43.98-13.044c-38.3-.027-72.254 24.637-84.078 61.066-11.82 36.434 1.18 76.333 32.199 98.805 31.016 22.469 72.98 22.39 103.914-.195 30.934-22.59 43.785-62.535 31.828-98.922l92.063-96.91 92.062 96.91c-11.629 35.96 1.227 75.32 31.844 97.484 30.617 22.16 72.023 22.082 102.555-.195 30.53-22.281 43.234-61.691 31.468-97.61-11.765-35.913-45.328-60.167-83.125-60.062"});function _d(){return(_d=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Hd=Object(r.createElement)("path",{d:"M26.773 102.744h181.755c-.074 123.9-8.793 247.613-8.866 371.514 89.984-124.193 181.422-247.321 271.406-371.514H692.64C590.987 240.298 444.471 342.58 363.684 495.732c77.74 155.676 224.317 259.543 320.493 402.076h-215.4c-70.105-101.553-117.732-223.956-219.713-299.423-39.122-14.846-40.087 60.14-46.238 87.253-5.736 70.546-2.166 141.45-3.164 212.17H25c.007-265.023 1.766-530.041 1.773-795.064zm424.242 392.988c102.855-141.27 241.813-251.718 344.669-392.988 59.768-.743 119.55-1.267 179.316 0C872.393 239.74 719.748 333.773 632.325 482.93c-7.765 45.896 45.968 88.282 71.47 126.581 86.444 99.165 194.622 178.714 269.432 288.074-63.035-.013-126.069.437-189.104.437-100.95-142.27-232.05-260.11-333.108-402.29z"});function Vd(){return(Vd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Fd=Object(r.createElement)("path",{d:"M354.531 0l119.063 120 41.562-41.563c105.004 48.915 176.317 149.704 187.5 265h46.875C733.105 148.988 570.297-.366 375.156 0zM517.97 381.25a136.494 136.494 0 01-4.375 35.313 75.984 75.984 0 01-13.438 26.562 58.417 58.417 0 01-22.187 16.563 80.293 80.293 0 01-31.25 5.625h-28.44V285h31.25a62.498 62.498 0 0151.25 21.563 93.76 93.76 0 0117.813 62.5zm12.187-100a104.02 104.02 0 00-35.625-24.063A117.53 117.53 0 00448.906 250h-73.75v250h71.875a126.896 126.896 0 0047.188-8.438 102.808 102.808 0 0036.25-22.812 105.25 105.25 0 0023.125-37.188 142.735 142.735 0 008.125-49.062V370a142.735 142.735 0 00-8.125-49.063 109.069 109.069 0 00-23.438-39.687zM262.97 468.75c-5.516.031-11-.813-16.25-2.5a33.403 33.403 0 01-12.5-7.5 31.24 31.24 0 01-8.125-11.563 37.209 37.209 0 01-2.813-14.687h-40.625a62.504 62.504 0 006.563 29.688 69.065 69.065 0 0017.5 21.562 79.08 79.08 0 0025.625 12.813 93.693 93.693 0 0031.25 4.687 105.27 105.27 0 0031.25-4.688 76.263 76.263 0 0025.937-13.75 62.517 62.517 0 0017.188-22.5 73.146 73.146 0 006.25-31.25 65.637 65.637 0 00-2.188-17.5 52.264 52.264 0 00-7.187-15.937 56.249 56.249 0 00-12.5-13.438 64.36 64.36 0 00-19.063-9.687 65.575 65.575 0 0016.25-10.313 64.72 64.72 0 0011.563-13.125 55.026 55.026 0 006.875-14.375 49.668 49.668 0 002.187-15 75.576 75.576 0 00-5.625-31.25 55.644 55.644 0 00-15.937-21.562 64.386 64.386 0 00-24.063-13.438 113.802 113.802 0 00-31.25-4.375 93.721 93.721 0 00-31.25 5 79.392 79.392 0 00-24.687 14.063A70.333 70.333 0 00189.219 290a62.535 62.535 0 00-5.625 26.563h40.625a33.112 33.112 0 012.812-14.063 29.362 29.362 0 017.813-10.625A37.17 37.17 0 01246.719 285a45.638 45.638 0 0116.25-3.75 35.94 35.94 0 0127.812 9.688 37.8 37.8 0 019.063 26.875 47.79 47.79 0 01-2.5 15.312 27.19 27.19 0 01-7.813 11.563 39.684 39.684 0 01-12.812 7.5A52.543 52.543 0 01258.594 355H234.53v31.25h24.063a70.241 70.241 0 0118.75 2.188 37.512 37.512 0 0114.062 7.187 36.923 36.923 0 019.063 12.5 44.375 44.375 0 013.125 17.813A37.488 37.488 0 01292.656 455a40.001 40.001 0 01-29.687 13.75zM235.156 672.5C130.242 623.012 59.293 521.758 48.594 406.25H1.719C17.96 600.465 180.266 749.867 375.156 750h20.625L276.72 630zm0 0"});function Gd(){return(Gd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ud=Object(r.createElement)("path",{d:"M825.5 171.563c-47.256 0-83.464 9.788-106.719 32.437-23.341 22.733-33.468 58.865-33.468 106.219 0 52.563 18.534 125.27 54.906 220.312 10.783 28.222 17.013 44.051 21.687 52.25l.094.157.094.156C774.704 603.797 794 616.49 816 616.437h.031c24.381-.009 45.457-10.866 57.781-30.437v-.063l.032-.03c6.068-9.81 11.647-26.35 21.468-55.97v-.03c18.839-57.443 33.002-103.73 42.5-139.063 9.499-35.333 14.532-58.903 14.532-74.72 0-45.76-9.879-82.033-31.657-107.187-21.777-25.153-54.738-37.375-95.187-37.375zm0 25.687c35.501 0 59.545 9.716 75.781 28.469 16.236 18.753 25.375 48.354 25.375 90.406 0 9.45-4.359 33.447-13.656 68.031-9.293 34.57-23.323 80.544-42.063 137.688-.008.024-.023.038-.03.062-9.652 29.097-17.383 48.006-18.845 50.407-8.108 12.875-18.347 18.437-36.062 18.437h-.031c-13.02.038-22.353-5.396-31.75-20.688-.005-.008-.027-.085-.032-.093-1.623-2.874-9.318-20.72-19.968-48.594v-.031c-35.831-93.629-53.25-164.783-53.25-211.125 0-43.644 9.62-72.134 25.718-87.813 16.185-15.762 45.174-25.156 88.813-25.156zM820 636.875c-25.872 0-49.422 9.64-68.125 27.938l-.031.03c-18.637 18.29-28.625 41.783-28.625 67.75s9.909 49.487 28.687 67.75v.032c18.7 18.228 42.23 27.875 68.094 27.875 25.845 0 49.415-9.578 68.125-27.875v-.031c18.641-18.243 28.687-41.746 28.687-67.75 0-25.924-10.034-49.418-28.656-67.75v-.032h-.031c-18.692-18.228-42.234-27.937-68.125-27.937zm0 25.656c19.798 0 35.683 6.524 50.156 20.625l.032.032c14.324 14.114 20.937 29.743 20.937 49.406 0 19.794-6.62 35.402-20.937 49.406-14.461 14.148-30.336 20.594-50.188 20.594-19.832 0-35.715-6.48-50.187-20.594l-.032-.031c-14.384-13.984-20.906-29.542-20.906-49.375 0-19.722 6.628-35.35 20.938-49.407l.03-.03c14.463-14.136 30.34-20.626 50.157-20.626zM75.844 25c-16.825 0-28.188 15.321-28.188 31.281v885.813c0 15.929 11.4 31.261 28.157 31.281h.03c.032 0 180.95.544 362.407 1 90.736.228 181.588.423 250.031.531 34.222.054 62.831.099 83.032.094 10.1-.002 18.1-.01 23.656-.031 2.778-.01 4.955-.015 6.5-.032.772-.008 1.372-.02 1.875-.03.251-.007.46-.022.718-.032.25-.01.03.112 1.72-.156.023-.004.038-.028.062-.032 21.28-3.383 33.397-23.027 33.468-41.656v-.063c0-.866.172-83.603.22-106.625-6.332 1.265-12.853 1.907-19.532 1.907-2.068 0-4.12-.065-6.156-.188-.05 22.423-.219 103.549-.219 104.844v.063c-.053 7.96-4.27 14.87-11.406 16.25-.307.005-.567.026-1.032.031-1.435.015-3.563.02-6.312.031-5.497.021-13.478.03-23.563.032-20.17.005-48.786-.008-83-.063-68.427-.108-159.268-.334-250-.562-181.463-.456-362.437-.97-362.437-.97h-.031c-.275 0-2.5-1.125-2.5-5.624V56.28c0-4.375 2.378-5.593 2.5-5.593H813.03c.122 0 2.487 1.217 2.5 5.562v.031l-.25 115.438c3.351-.107 6.748-.156 10.219-.156 5.287 0 10.446.205 15.469.625.06-26.71.25-115.875.25-115.875v-.032c0-15.96-11.363-31.281-28.188-31.281zM840 612.594c-7.439 2.528-15.506 3.84-23.969 3.843H816c-.563.001-1.129-.016-1.688-.03-.02 9.4-.01 11.54-.03 20.655 1.894-.106 3.796-.187 5.718-.187 6.828 0 13.482.702 19.937 2.031.025-11.615.037-14.239.063-26.312zM207.366 808.848c0 13.044-10.578 23.571-23.57 23.571h-24.29c-12.993 0-23.571-10.578-23.571-23.57v-27.166c0-13.044 10.578-23.571 23.57-23.571h24.29c12.993 0 23.571 10.527 23.571 23.57zm0-196.064c0 12.992-10.578 23.52-23.57 23.52h-24.29c-12.993 0-23.571-10.58-23.571-23.52v-27.269c0-12.992 10.578-23.52 23.57-23.52h24.29c12.993 0 23.571 10.528 23.571 23.52zm0-196.22c0 12.993-10.578 23.52-23.57 23.52h-24.29c-12.993 0-23.571-10.578-23.571-23.52v-27.268c0-12.992 10.578-23.57 23.57-23.57h24.29c12.993 0 23.571 10.578 23.571 23.57zm0-196.167c0 12.941-10.578 23.52-23.57 23.52h-24.29c-12.993 0-23.571-10.579-23.571-23.52V193.13c0-12.992 10.578-23.52 23.57-23.52h24.29c12.993 0 23.571 10.579 23.571 23.52z"});function Wd(){return(Wd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Yd=Object(r.createElement)("path",{d:"M244.594 393.594c-6.44-.041-12.385 1.563-17.656 4.406-5.272 2.843-10.281 6.928-12.907 13.844l-182.5 483.469c-2.635 6.942-.311 16.243 4.844 21.062 5.155 4.82 11.518 6.428 17.969 6.469h.031l706.156 3.343h.094c6.45.066 12.386-1.544 17.656-4.375 5.272-2.831 10.341-6.868 12.969-13.875.012-.032.02-.061.031-.093l182.407-483.438c2.627-6.986.191-16.385-5.032-21.156-5.206-4.756-11.54-6.303-17.968-6.313h-.063l-706.031-3.343zm-.156 25.687h.03l702.47 3.281-179.72 476.313v.031l-.03.032c.024-.067.009-.005.03-.063.476-1.247.318-.429-1.062.313-1.443.775-3.736 1.363-5.312 1.343h-.094L58.281 897.22l179.75-476.281c-.52 1.37-.323.451 1.094-.313s3.64-1.354 5.313-1.344zm45.468-345.469c-9.18.037-18.405.167-27.437.344-48.173.943-90.906 3.5-90.906 3.5l-1.22.063-1.155.312c-20.523 5.163-32.505 21.47-35.75 37.375l-26.625 87.875H53.437C38.61 203.281 25 214.575 25 230.094v669.343c0 15.463 13.596 26.75 28.438 26.75h1.124l1.094-.187 17.5-3.063-18.781-.093h-.031c-6.45-.041-12.814-1.65-17.969-6.469-5.155-4.82-7.48-14.12-4.844-21.063l19.157-50.75V230.095c0 .114.426-1.125 2.75-1.125h72.374l2.782-9.125 29.406-97 .25-.781.125-.813c1.324-7.909 5.455-14.985 16.156-18.031 2.16-.129 42.142-2.5 88.438-3.406 11.889-.233 24.095-.377 36.031-.344 11.936.033 23.6.233 34.375.656 20.959.822 39.048 2.824 47.375 5.156-.793-.113 2.378 1.452 5.5 4.281 3.62 3.282 8.312 8.07 13.531 13.782 10.438 11.425 23.014 26.493 35.031 41.406 24.035 29.825 45.907 59.063 45.907 59.063l3.844 5.156h317.406c2.463 0 2.843 1.136 2.843 1.125V396.25l25.657.125V230.094c0-15.519-13.71-26.813-28.5-26.813H497.375c-4.954-6.582-21.551-28.551-42.563-54.625-12.2-15.14-24.976-30.49-36.062-42.625-5.543-6.067-10.632-11.314-15.25-15.5s-7.606-7.502-14.594-9.625h-.031c-13.399-4.053-32.13-5.56-54.5-6.437-11.185-.44-23.14-.623-35.313-.656-3.043-.009-6.095-.013-9.156 0z"});function qd(){return(qd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var $d=Object(r.createElement)("path",{d:"M361.281 25c-30.817 0-56.031 25.269-56.031 56.031 0 30.781 25.25 56.031 56.031 56.031H650.22c30.817 0 56.093-25.25 56.093-56.03C706.313 50.25 681.037 25 650.22 25zm0 25.688H650.22c16.94 0 30.406 13.47 30.406 30.343 0 16.873-13.467 30.344-30.406 30.344H361.28c-16.873 0-30.344-13.47-30.344-30.344 0-16.891 13.405-30.344 30.344-30.344zm-66.199 653.844H732.34v21.465H295.082zm0-114.256H732.34v21.516H295.082zm0-114.36H732.34v21.568H295.082zm0-114.308H732.34v21.568H295.082zm0-114.308H732.34v21.516H295.082zM179.594 67.781c-15.828 0-26.406 14.332-26.406 29.156v784.907c0 14.806 10.578 29.125 26.406 29.125H727.53l3.75-3.813 121-121.906L856 781.5V96.937c0-14.775-10.585-29.156-26.406-29.156H704.687a55.371 55.371 0 011.625 13.25c0 4.263-.52 8.409-1.437 12.406h124.5c-.258.084.938.613.938 3.5v674l-113.47 114.344h-537.25c.936 0-.718-.27-.718-3.437V96.937c0-3.25 1.654-3.5.719-3.5h127.094c-.917-3.997-1.438-8.143-1.438-12.406a55.5 55.5 0 011.625-13.25zM79.063 51.97c-16.802 0-30.376 14.117-30.376 30.812v861.407c0 16.711 13.62 30.812 30.376 30.812h841.78c16.816 0 30.47-14.073 30.47-30.813V82.782c0-16.8-13.713-30.812-30.47-30.812h-222.75c4.648 7.58 7.556 16.313 8.126 25.656h214.625c2.552 0 4.781 2.032 4.781 5.156v861.407c0 3.081-2.185 5.125-4.781 5.125H79.062c-2.552 0-4.687-1.913-4.687-5.125V82.78c0-3.126 2.18-5.156 4.688-5.156h226.28c.57-9.338 3.487-18.076 8.126-25.656z"});function Kd(){return(Kd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Xd=Object(r.createElement)("path",{d:"M939.757 670.75h-75.171v247.117c0 14.211-3.176 24.831-9.527 31.65-6.35 6.924-14.524 10.36-24.623 10.36-10.203 0-18.48-3.488-24.936-10.463-6.455-6.976-9.682-17.492-9.682-31.547V670.749h-75.172c-11.765 0-20.51-2.603-26.237-7.756-5.674-5.206-8.59-12.026-8.59-20.563 0-8.798 3.02-15.774 8.955-20.875 5.934-5.102 14.576-7.6 25.872-7.6h219.059c11.921 0 20.77 2.602 26.601 7.86 5.779 5.258 8.694 12.13 8.694 20.615 0 8.485-2.967 15.357-8.798 20.563-5.83 5.153-14.68 7.756-26.445 7.756zM533.916 821.56H470.77v96.307c0 13.795-3.28 24.259-9.735 31.39-6.507 7.132-14.732 10.672-24.623 10.672-10.36 0-18.69-3.54-25.04-10.567-6.351-7.08-9.527-17.388-9.527-31.027V656.121c0-15.149 3.488-25.977 10.464-32.484 6.924-6.455 18.012-9.735 33.16-9.735h88.447c26.132 0 46.279 1.978 60.282 5.987 13.952 3.852 25.977 10.307 36.076 19.261 10.152 9.006 17.856 19.99 23.062 32.953 5.31 13.014 7.913 27.642 7.913 43.884 0 34.67-10.672 60.908-32.016 78.815-21.291 17.804-53.099 26.758-95.317 26.758zm-16.711-155.913H470.77v103.96h46.435c16.242 0 29.83-1.718 40.71-5.154 10.931-3.384 19.208-8.954 24.935-16.71 5.674-7.705 8.59-17.856 8.59-30.402 0-14.993-4.426-27.174-13.275-36.649-9.787-10.047-30.142-15.045-60.96-15.045zm2.857-625.585v461.72h263.625V40.061H520.063zm26.032 26.032h211.562V475.75H546.094V66.094zM25 40.063v243.843h758.688V40.062H25zm26.031 26.03h706.625v191.782H51.031V66.094zM25 40.064v758.75h263.625V40.063H25zm26.031 26.03h211.563v706.688H51.03V66.094zM25 40.064V501.78h758.688V40.062H25zm26.031 26.03h706.625V475.75H51.031V66.094z"});function Zd(){return(Zd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Qd=Object(r.createElement)("path",{d:"M750 375L375 750l-66.094-66.094L570.47 421.875H0v-93.75h570.469L308.906 66.094 375 0zm0 0"});function Jd(){return(Jd=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var th=Object(r.createElement)("path",{d:"M153.324 0v306.648h-73.89V73.891H5.543V0zm443.352 443.352v70.195h73.89V750h73.891V443.352zm-99.754-110.84l-73.89 69.828-143.724-143.72-52.094 52.094 142.242 142.242-68.348 64.285h195.813zm0 0"});function eh(){return(eh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var nh=Object(r.createElement)("path",{d:"M333.296 750V116.666H166.481V0h291.926v750zM41.37 583.335h125.111V500H41.37zm542.149 0H708.63V500H583.519zm0 0"});function rh(){return(rh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ah=Object(r.createElement)("path",{d:"M450 300h300v150H450v300H300V450H0V300h300V0h150zm0 0"});function oh(){return(oh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ih=Object(r.createElement)("path",{d:"M96.84 44.171l609.284 609.16-52.963 52.915-194.754-194.998v238.748h-125.11V386.249L43.876 97.086zm361.567 291.663V.004H166.484V41.67l83.406 75h83.407v91.667zM41.374 583.332h125.11V500H41.374zm667.252 0V500H625.22zm0 0"});function sh(){return(sh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var ch=Object(r.createElement)("path",{d:"M519.29 474.242L641.601 596.56l-44.68 45.41-122.313-123.047zM706.054 596.56c0-7.325-2.442-13.43-7.325-18.313L160.398 39.918c-4.882-4.883-10.984-7.324-18.308-7.324s-13.672 2.441-19.043 7.324L40.28 122.68c-5.367 4.882-8.054 11.23-8.054 19.043 0 7.812 2.687 13.918 8.054 18.312l538.332 538.328c4.883 5.371 10.989 8.059 18.309 8.059 7.328 0 13.672-2.688 19.047-8.059l82.761-82.761c4.883-4.883 7.325-11.23 7.325-19.043zm-565.43 79.832l41.016-12.45-41.016-12.453-12.453-41.015-12.45 41.015-41.015 12.453 41.016 12.45 12.449 41.015zm146.484-68.114l82.032-24.902-82.032-24.902-24.902-82.032-24.902 82.032-82.032 24.902 82.032 24.902 24.902 82.032zm389.649-199.953l41.015-12.449-41.015-12.453-12.453-41.016-12.45 41.016-41.015 12.453 41.015 12.45 12.45 41.015zM408.69 676.391l41.016-12.45-41.016-12.453-12.449-41.015-12.453 41.015-41.016 12.453 41.016 12.45 12.453 41.015zm0 0"});function lh(){return(lh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var uh=Object(r.createElement)("path",{d:"M516.535 183.482c-42.511-3.244-84.89.665-126.774 12.838-166.696 48.452-311.99 227.933-362.668 601.774-.254 1.873-1.356 2.931-1.605 4.814l-9.629 65.794 33.7-57.77c113.495-200.68 220.912-288.903 311.317-308.108 90.406-19.205 166.973 27.93 223.058 110.726-.15 1.044-.856 3.722-3.21 8.024-4.706 8.603-13.412 21.578-25.675 36.908-24.526 30.661-61.65 71.78-97.889 121.96l-14.442 20.861h25.675c132.691 0 364.082-4.623 494.257-6.419l12.838-1.604v-12.838s-3.21-373.383-3.21-505.49v-30.49l-22.466 22.466c-29.89 29.89-68.797 64.785-101.098 96.284-88.105-100.114-208.858-170.318-332.179-179.73zm-1.605 25.676c119.433 9.385 239.23 78.63 324.156 179.73l8.023 11.233 9.629-11.233c26.536-26.495 59.982-56.526 89.865-85.05.344 144.968 3.051 448.397 3.21 465.37-125.038 1.834-325.007 5.912-455.744 6.42 29.225-38.47 59.383-75.03 80.236-101.098 12.553-15.693 22.561-28.558 28.886-40.118 3.162-5.78 5.534-11.524 6.418-17.653.797-5.515-.768-12.485-4.814-17.652-.236-.349-1.367.349-1.604 0-59.698-87.544-145.64-143.518-247.129-121.959-90.757 19.28-190.036 110.26-292.06 271.2C120.47 420.83 252 262.763 397.784 220.39c38.758-11.265 77.334-14.361 117.145-11.233z"});function ph(){return(ph=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var dh=Object(r.createElement)("path",{d:"M10.941 699.883L363.883 346.94H185.648v-70.59h299.293v298.942h-70.59v-178.94L61.412 749.293zm550.59-611.649l-97.765 14.118 70.586 67.058-17.645 98.824 88.234-45.882 88.235 45.882-17.645-98.824 70.586-67.058-98.824-14.118L604.941 0zm0 0"});function hh(){return(hh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var fh=Object(r.createElement)("path",{d:"M340.91 68h-68.183v68.223h68.183zM136.363 477.332v68.223h68.184v-68.223zm0-136.441v68.218h68.184v-68.218zm0 272.886c2.477 36.606 31.602 65.746 68.184 68.223v-68.223zM204.547 68c-36.582 2.477-65.707 31.617-68.184 68.223h68.184zm409.09 545.777h-68.184V682h68.184zm0-545.777h-68.184v68.223h68.184zm-306.82 545.777h-68.18V682h68.18zm170.456 0H409.09V682h68.183zM204.547 204.445h-68.184v68.223h68.184zM681.817 68v68.223H750C747.527 99.617 718.398 70.477 681.816 68zM750 204.445h-68.184v68.223H750zM477.273 68H409.09v68.223h68.183zM750 613.777h-68.184V682c36.582-2.477 65.711-31.617 68.184-68.223zm0-272.886h-68.184v68.218H750zm0 136.441h-68.184v68.223H750zm-102.273 68.223h-68.18V272.668h-68.184v-68.223h136.364zm-159.204 0l-70.57-124.504c35.586-15.133 57.73-51.11 55.23-89.715a123.191 123.191 0 00-34.695-89.508 123.035 123.035 0 00-88.375-37.383H238.637l3.41 341.11h64.77V433.328h43.636l58.637 112.227zM306.816 272.668h37.5c38.868 0 60 12.621 60 48.777 0 36.157-21.132 55.262-60 55.262h-37.5zm-170.453 110.52L25.91 493.706 0 467.781l84.203-84.594L0 298.59l25.91-25.922zm0 0"});function mh(){return(mh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var gh=Object(r.createElement)("path",{d:"M750 572.5h-78.95v-316h-78.945v-79H750zm-276.316 0l-68.29-130.746h-50.132V572.5h-75.79l-3.156-395h129.868a142.468 142.468 0 01101.894 42.875 142.625 142.625 0 0140.606 102.879c2.898 44.707-22.746 86.363-63.946 103.887L565.656 572.5zM355.262 375h43.422c45 0 69.472-21.723 69.472-63.988 0-42.266-24.472-54.512-69.472-54.512h-43.422zM30 256.5L0 285.73l97.5 97.961L0 481.254l30 30.023 127.895-127.586zm0 0"});function bh(){return(bh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var vh=Object(r.createElement)("path",{d:"M295.39 753.522c-12.297 0-22.913 1.56-32.094 4.814-4.59 1.626-9.05 4.854-12.838 8.023-3.789 3.17-8.024 7.579-8.024 14.443v166.892c0 6.845 4.229 12.868 8.024 16.047 3.795 3.18 8.244 4.796 12.838 6.42 9.187 3.246 19.807 4.813 32.095 4.813h470.185c12.275 0 22.92-1.56 32.095-4.814 4.587-1.627 9.05-3.25 12.838-6.419 3.787-3.169 8.023-9.183 8.023-16.047V780.802c0-6.85-4.24-11.27-8.023-14.443-3.784-3.172-8.252-6.395-12.838-8.023-9.173-3.256-19.797-4.814-32.095-4.814zm0 25.675h470.186c9.835 0 18.776 1.33 24.071 3.21 1.63.578 2.412 1.151 3.21 1.604v160.473c-.802.455-1.577 1.026-3.21 1.605-5.306 1.882-14.264 3.21-24.07 3.21H295.39c-9.845 0-18.764-1.334-24.071-3.21-1.633-.577-2.412-1.152-3.21-1.605V784.011c.802-.454 1.575-1.025 3.21-1.604 5.312-1.882 14.235-3.21 24.07-3.21zM202.317 24.974c-15.675 0-28.631 2.277-40.118 8.024-11.487 5.747-22.466 16.568-22.466 30.49v465.371c0 13.907 9.378 24.724 20.861 30.49 11.484 5.766 26.017 8.024 41.723 8.024h595.355c15.684 0 30.237-2.26 41.723-8.024 11.486-5.763 20.861-16.567 20.861-30.49V63.488c0-13.922-10.984-24.737-22.466-30.49-11.482-5.753-24.434-8.024-40.118-8.024zm0 25.676h595.355c12.2 0 22.073 3.006 28.885 6.419 6.812 3.413 8.024 6.373 8.024 6.419v465.371c0 .097-1.216 3.004-8.024 6.42-6.808 3.415-16.685 6.418-28.885 6.418H202.316c-12.229 0-22.087-3.005-28.885-6.419-6.798-3.413-8.024-6.306-8.024-6.419V63.488c0-.097 1.217-3.013 8.024-6.42 6.807-3.405 16.677-6.418 28.885-6.418zm-97.879-25.681c-44.063 0-78.656 36.186-78.656 80.25V894.75c0 44.064 34.593 80.219 78.656 80.219h190.938c-12.287 0-22.907-1.566-32.094-4.813-4.593-1.623-9.017-3.227-12.812-6.406-3.493-2.926-7.377-8.27-7.969-14.438H104.437c-30.19 0-52.968-24.372-52.968-54.562V105.219c0-30.19 22.778-54.563 52.968-54.563h38.594c4.107-7.743 11.508-13.83 19.156-17.656 11.487-5.747 24.45-8.031 40.125-8.031zm693.22 0c15.683 0 28.642 2.278 40.124 8.031 7.644 3.83 15.048 9.917 19.157 17.656h38.625c30.19 0 54.562 24.384 54.562 54.563V894.75c0 30.178-24.372 54.563-54.563 54.563h-77.125c-.593 6.18-4.452 11.52-7.937 14.437-3.787 3.169-8.256 4.78-12.844 6.406-9.174 3.254-19.819 4.813-32.093 4.813h130c44.063 0 80.218-36.143 80.218-80.219V105.219c0-44.076-36.155-80.25-80.218-80.25z"});function yh(){return(yh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var wh=Object(r.createElement)("path",{d:"M394.594 339.531l137.969 603.407 107.406-179.032L784.53 923.031l127.282-123.343-148.5-163.063 161.75-50.406zm29.031 37l453.219 209.406-149.907 41.97 146.844 167.03L780.5 887.25 633 724.906 540.812 888.47zm45.438 56.031l84.468 368.625 72.125-128.156 154.907 169.157 49.937-48.25-150.75-177.22 127.313-37.093zM328.418 171.168h353.295v31.825H328.419zM843.344 464.25l-37.813 66.375 29 13.5 36.532-64.094zM326.387 810.135L142.28 479.951l27.8-15.497L354.19 794.64zm402.238 51.334l-8.688 15.562H572.095l-18.813 31.375H737.5l12.844-23zm187.031-272.313l-42.437 13.219-53.625 96.063 21.75 23.875zM262.5 57.063L25 482.813l237.5 425.593h262.156l-7.156-31.375H279.969L60.03 482.875 279.97 88.531h440l219.937 394.344-48.843 87.531 27.843 12.938L975 482.812 737.5 57.063z"});function Eh(){return(Eh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Oh=Object(r.createElement)("path",{d:"M384.469 319.844L526.563 941.25l110.625-184.344 148.875 163.907L917.155 793.78l-152.937-168 166.625-51.906zm31.875 38.094l466.812 215.718-154.375 43.157L880 788.875l-96.063 95.063L632 716.688l-94.938 168.5zm46.812 57.687l86.969 379.688 74.313-132 159.5 174.218 51.468-49.656-155.281-182.5 131.094-38.281zm64.438-356.344l3.531 26.657s1.257.037 3.031.093V59.5c-4.01-.15-6.562-.2-6.562-.219zm-55.813.188c-4.705.225-8.312.406-15.625.75v26.468l15.625-.593zm15.594.531v25.5l6.344-.25zm62.406.375v26.469c4.804.35 10.13.872 15.594 1.531V61.844c-5.423-.648-10.707-1.11-15.594-1.469zm-109.218.938c-7.676.892-9.783 1.13-15.594 1.812v26.906l15.594-1.687zm140.406 2.156V90.03c5.85.708 11.223 1.49 15.593 2.188V65.53a436.22 436.22 0 00-15.593-2.062zm-171.594 1.468l-4.75.563 4.75 9.375zm-44.438 7.844s-2.032.43-2.375.5v27.906c1.941-.504 4.517-1.186 6.22-1.624 5.627-1.092 7.924-1.535 9.374-1.813V93.5zm285 2.969l-6.125 25.688s6.35 1.521 15.157 3.843V78c-5.204-1.317-9.032-2.25-9.032-2.25zM346.97 76.813c-4.769 1.283-10.004 2.703-15.594 4.218v28.219a199.197 199.197 0 0111.938-3.094c1.332-.34 2.332-.596 3.656-.937zm327.594 5.28v27.47c2.042.596 4.098 1.242 6.156 1.874 3.206 1.107 6.322 2.157 9.437 3.22v-27.97l-.093-.03a530.587 530.587 0 00-15.5-4.563zM315.78 85.22c-5.716 1.649-11.087 3.43-15.625 5.125v20.094l6.688 7.062s3.708-1.332 8.937-3.094zm390 6.844v27.906c6.76 2.141 11.094 4.052 11.094 4l4.5-8.594V97.406c-1.32-.466-2.73-.929-4.313-1.437-3.088-1.06-7.528-2.614-11.28-3.906zm-457.25 18.312c-1.096.136-5.153 2.001-10.75 4.813v32.406a1001.547 1001.547 0 0115.594-8.094v-25.063l-4.531-4.03c-.03-.058-.15-.052-.313-.032zm519.625 7.156v30.188c4.921 2.603 9.943 5.288 15.625 8.281v-30.063c-5.622-3.028-14.97-8.053-15.625-8.406zm-546 5.813c-5.095 2.73-10.42 5.625-15.594 8.5v33.312c2.85-1.909 8.634-5.24 15.594-9.094zm46.813 5.031v3.594c1.59-.672 2.631-1.025 2.937-.969zm530.406 5.969v31.625c6.266 4.078 14.55 9.476 15.594 10.156v-31.969c-4.06-2.664-7.566-4.975-11.907-7.812-1.849-.994-1.858-1.016-3.687-2zM752.562 137l-1.25 1.813s1.136.595 1.25.656zm-561.593 3.719c-8.26 4.823-14.037 8.454-13.719 8.969l13.719 8.593zm639.593 13.687V165.5l7.125-6.406s-3.994-2.624-7.125-4.688zM145 173.22s-.661.516-.844.656v40.656c.346-.308.682-.631 1.031-.937 4.89-5.005 10.008-9.688 14.594-13.625V181zm724.188 11.187l-7.407 5.344v25.344c3.86 3.779 8.058 7.98 12.157 12.344 1.25 1.462 2.2 2.555 3.437 4v-39.344a554.283 554.283 0 00-8.188-7.688zm-740.625 2.563c-4.459 3.984-9.3 8.51-13.938 13.375-.56.505-1.105 1.02-1.656 1.531v37.594l6.25 2.156s3.105-3.626 7.75-9.063c.503-.633 1.041-1.304 1.594-1.968zm764.406 20.656v42.25c3.246 4.296 5.031 7.219 5.031 7.219l10.563-4.563V225.47c-3.394-4.016-6.426-7.602-10.094-11.969a369.97 369.97 0 00-5.5-5.875zM97.375 218.469c-.65.804-1.288 1.61-1.875 2.375l-8.156 9.75 10.031 3.469zM64.25 263.094s-3.093 4.064-6.313 11.031c-2.003 3.977-4.81 9.558-7.374 14.656v51.188l15.593 1.75v-78.125zm17.531 4.656v32.75c3.385-6.59 6.848-13.328 9.406-18.281 3.062-6.492 6.063-10.344 6.063-10.344zm858 14.125l-15.625 4.938v15.062c2.87 6.174 6.117 13.913 8.625 22.094 3.599 8.585 5.582 17.683 7 24.687zM955.375 302v57.563l15.594-1.594v-2.094c-.29-1.33-.926-4.22-2.25-10.531-1.478-7.6-3.583-17.676-7.594-27.281-1.675-5.623-3.712-11.104-5.75-16.063zM34.969 328.906c-1.722 5.392-2.707 8.943-2.375 9.031l2.375.282zm-8.75 48.406s-2.702 20.378-.063 40.75c.37 20.531 7.345 40.114 6.5 40.22l2.313-.25v-80.376zm24.343.938v78.031l15.594-1.75v-4.406c-1.684-6.512-5.149-19.648-5.375-33.344-2.48-19.053.063-38.156.063-38.156zm904.813 19.906v79.719l5.469 1.156s1.705-4.873 4.343-12.156a14299.35 14299.35 0 005.782-26.813v-41.906zm-15.594 49.219c-1.164 5.316-2.28 10.366-3.156 14.531-2.48 6.703-4.063 11.219-4.063 11.219l7.22 1.5zM66.156 492.313l-15.594 2.875V507.5c3.434 6.861 8.122 15.961 13.22 24.875.862 1.298 1.517 2.273 2.374 3.563zm15.625 3.468v63.281c3.175 4.152 5.458 6.563 5.5 6.563l10.094-3.5v-37.5c-.24-.35-.417-.619-.656-.969-6.279-10.788-11.746-21.481-14.938-27.875zm842.375 13.625v41.063c5.458-8.383 11.312-16.443 15-23 .378-.75.276-.558.625-1.25v-11.875zm-15.593 14.156c-3.276 4.982-7.257 10.551-11.032 16.25-1.409 2.3-2.966 4.478-4.562 6.563v34.219l4.968 2.812s3.32-3.91 8.282-9.875c.731-.896 1.525-1.821 2.343-2.781zm-795.594 23.72v9.468l6.187-2.156s-2.627-2.673-6.187-7.313zm764.406 17.562a2034.665 2034.665 0 01-3.969 4.625l3.969 2.25zm-732.781 17.312l-.438.188v40.093c.041.033.084.062.125.094 5.204 4.494 10.584 8.63 15.5 12.219v-38.313c-2.442-2.099-4.66-4.132-6.531-6.062a980.41 980.41 0 00-8.656-8.219zm-16.031 6.875l-14.625 6.25s3.636 3.554 9.124 8.938c1.607 1.686 3.482 3.451 5.5 5.281zm717.593 6.844c-.554.498-3.607 3.237-8.906 7.188-1.819 1.427-4.538 3.511-6.688 5.187v33.625c3.11-2.034 3.215-2.112 6.438-4.219 3.322-2.627 5.963-4.722 9.156-7.25zm15.625 10.563v11.593c4.583-3.656 7.393-6.218 7.438-6.218zm-686.406 2.437v36.563c.766.484 1.844 1.156 1.844 1.156l13.75-8.625V620.53c-4.764-3.304-10.212-7.282-15.594-11.656zm639.594 11.313l-15.594 10.03V657l2.938 3.375s8.887-5.812 12.656-8.281zm-573.25 28.687c-1.207 1.495-2.549 2.951-3.938 4.406v34.407a224.779 224.779 0 015.188 4.718A118.45 118.45 0 00237.78 694v35.219c4.916-2.487 10.136-4.393 15.594-5.844v-65.438c-3.965-3.289-7.809-6.283-11.5-8.875-.053-.105-.104-.082-.156-.187zm-19.563 18.375c-1.699 1.393-3.389 2.792-5.094 4.188 1.65 1.158 3.49 2.611 5.094 3.812zM268.97 672v48.375c.146-.02.29-.044.437-.063a468.42 468.42 0 0115.156 18.844V686.25c-.53.028-1.06.062-1.593.094a370.663 370.663 0 00-14-14.344zm62.406 13.25V718c5.166.044 10.367.228 15.594.531V685.72c-5.2-.266-10.401-.435-15.594-.469zm-15.594.219l-9.594.187c-1.95.028-4.013.06-6.03.094v75.094a479.371 479.371 0 019.406 14.406c-.634.317-1.098.705-1.625.969a105.8 105.8 0 01-7.782 4.28v35.47a118.074 118.074 0 0015.625-6.563V726.47a542.501 542.501 0 00-6.031-8.094l6.031-.156v-32.75zm46.781 1.343v80.407c1.038-1.438 2.092-2.896 3.125-4.407 4.54-6.491 7.426-13.502 9.907-19.625a203.687 203.687 0 012.562-6.093v-48.688a535.108 535.108 0 00-15.594-1.593zm31.22 3.625v33.125c5.206.755 10.4 1.53 15.593 2.344V692.75a1073.13 1073.13 0 00-15.594-2.313zm31.187 4.813v33.156c.549.09 1.108.161 1.656.25 4.616.744 9.277 1.524 13.938 2.282V697.75c-2.878-.466-5.756-.91-8.657-1.375-2.304-.377-4.624-.749-6.937-1.125zm31.187 4.938v6.218l.188-6.187-.188-.032zm-234 .343a99.585 99.585 0 00-10.594 6.282 102.446 102.446 0 00-5 3.718v91.188c4.639 3.321 9.861 6.269 15.594 8.843V772.22c-4.825-4.324-7.786-9.163-8.281-13.938-.612-5.7 2.31-11.87 8.281-17.875zM346.97 726.5c-.614 1.455-1.223 2.895-1.781 4.281-2.059 5.067-3.936 9.818-6.47 13.407a315.472 315.472 0 01-5.5 7.593c-.612-.955-1.226-1.896-1.843-2.843v65.25c6.04 12.274 11.317 24.687 15.594 36.937zm-156 .281c-9.713 13.952-10.48 27.003-9.656 35.063.947 8.813 4.273 17.138 9.656 24.593zm46.812 54.782v34.812c5.265 1.592 10.453 2.79 15.594 3.594v-33.407c-5.04-1.13-10.218-2.8-15.594-5zm46.781 4.78c-5.175 1.31-10.352 1.985-15.593 2v32.845a95.481 95.481 0 0015.594-1.313zm78 17.313V933.22l15.594 3.25V841.5c-4.345-12.648-9.616-25.323-15.594-37.844z"});function xh(){return(xh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Sh=Object(r.createElement)("path",{d:"M370 332l146.965 643 114.506-190.844 154.028 169.688 135.72-131.531-158.372-173.844 172.43-53.719zm30.835 39.156l483.079 223.25-159.745 44.782 156.496 178-99.447 98.375-157.183-173.094-98.26 174.469zm48.489 59.813l89.948 392.969 76.952-136.625 165.057 180.343 53.27-51.468L673.835 627.25l135.72-39.531zM145.228 817H35V706h110.228zm-76.3-34H111v-43H68.929zM855 706.406v42.938L916.063 817H965V706.406zM888.663 740H931v42.719c-45.278 3.257-42.337.156-42.337-42.406zM965 135H855V25h110zm-76.352-34H931V59h-42.352zm-743.42 34H35V25h110.228zm-76.3-34H111V59H68.929zM111.3 744H188v33h-76.7zm113.605 0H336v33H224.905zM373 743.562V777h98.663l-7.592-33.438zM73.572 146H107v109H73.572zm0 436H107v109H73.572zm0-145H107v109H73.572zm0-145H107v109H73.572zm816.922-146H924v109h-33.506zm33.099 452.375L891 608.688V691h32.593zM890.494 437H924v109h-33.506zm0-145H924v109h-33.506zM111.3 65H188v33h-76.7zm557.42 0H780v33H668.72zm147.85 0H877v33h-60.43zm-591.665 0H336v33H224.905zm147.903 0H484v33H372.808zm148.008 0H632v33H520.816z"});function Ah(){return(Ah=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ph=Object(r.createElement)("path",{d:"M666.667 500c0-91.797-74.87-166.667-166.667-166.667S333.333 408.203 333.333 500 408.203 666.667 500 666.667 666.667 591.797 666.667 500zM1000 429.036v144.532c0 9.765-7.813 21.484-18.23 23.437l-120.442 18.23c-7.161 20.833-14.974 40.364-25.39 59.244 22.135 31.901 45.572 60.547 69.661 89.844 3.906 4.557 6.51 10.417 6.51 16.276 0 5.86-1.953 10.417-5.859 14.974-15.625 20.833-103.516 116.536-125.651 116.536-5.86 0-11.719-2.604-16.927-5.859l-89.844-70.312c-18.88 9.765-39.062 18.229-59.245 24.74-4.557 39.713-8.463 82.03-18.88 121.093C593.1 992.188 583.984 1000 572.266 1000H427.734c-11.718 0-22.135-8.464-23.437-19.531l-18.23-119.792c-20.182-6.51-39.713-14.323-58.593-24.088l-91.797 69.661c-4.557 3.906-10.417 5.86-16.276 5.86-5.86 0-11.719-2.605-16.276-7.162-34.505-31.25-80.078-71.615-107.422-109.375-3.255-4.557-4.557-9.766-4.557-14.974 0-5.86 1.953-10.417 5.208-14.974 22.136-29.948 46.224-58.594 68.36-89.193-11.068-20.833-20.183-42.317-26.693-64.453L18.88 594.401C7.811 592.448 0 582.031 0 570.964V426.432c0-9.765 7.813-21.484 17.578-23.437l121.094-18.23c6.51-20.833 14.974-40.364 25.39-59.895-22.135-31.25-45.572-60.547-69.661-89.844-3.906-4.557-6.51-9.766-6.51-15.625 0-5.86 2.604-10.417 5.859-14.974 15.625-21.484 103.516-116.536 125.651-116.536 5.86 0 11.719 2.604 16.927 6.51l89.844 69.661c18.88-9.765 39.062-18.229 59.245-24.74 4.557-39.713 8.463-82.03 18.88-121.093C406.9 7.813 416.016 0 427.734 0h144.532c11.718 0 22.135 8.464 23.437 19.531l18.23 119.792c20.182 6.51 39.713 14.323 58.593 24.088l92.448-69.661c3.906-3.906 9.766-5.86 15.625-5.86 5.86 0 11.719 2.605 16.276 6.511 34.505 31.901 80.078 72.266 107.422 110.677 3.255 3.906 4.557 9.115 4.557 14.323 0 5.86-1.953 10.417-5.208 14.974-22.136 29.948-46.224 58.594-68.36 89.193 11.068 20.833 20.183 42.317 26.693 63.802l119.14 18.229c11.068 1.953 18.881 12.37 18.881 23.437z"});function Th(){return(Th=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ch=Object(r.createElement)("path",{d:"M791.333 67.143v52.408h131.153v760.845H791.333v52.461H975V67.143zM225.028 880.396H75.138V119.55h149.89V67.143H25v865.714h200.028z"});function Rh(){return(Rh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var jh=Object(r.createElement)("path",{d:"M976.996 677.429q0-57.429-22.286-110.572-22.285-53.143-63.428-94.286L507.28 92l-53.143 52.286 384 380.572q63.43 61.715 63.43 152.572 0 76.286-49.715 126.857-49.714 50.572-126.857 49.715-87.43 0-154.287-64.286L148.137 370.57q-50.571-50.571-50.571-114 0-48.857 31.714-80.572 31.714-31.714 80.572-30.857 64.285 0 114.857 50.572L647.852 514.57q45.43 47.143 45.43 83.143 0 18-13.715 28.286-13.714 10.286-32.572 10.286-41.143 0-73.714-34.286L281.85 314l-52.285 52.285 290.572 288.001q56.571 56.572 126.857 56.572 49.715 0 85.715-31.715 36-31.714 36-80.571 0-66.858-67.715-136.286L377.852 143.428q-72-72-168-72-79.715 0-132.858 52.285-53.143 52.286-54 132.858 0 94.286 72 166.286l422.572 419.144q89.144 86.571 207.43 86.571 107.143 0 180-72t72-179.143z"});function Nh(){return(Nh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Mh=Object(r.createElement)("path",{d:"M758.79 684.716l.652-363.85 33.725.066-.653 363.85zM201.521 362.534l310.986-188.872 17.503 28.823-310.98 188.872zM510.839 841.63L199.345 653.597l17.43-28.877 311.494 188.041zM500 975L85.906 742.303V267.356L500 25l414.094 232.644v475zM124.908 722.458L500 936.156l380.264-222.459V277.542L500 63.95 124.908 286.408z"});function kh(){return(kh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Bh=Object(r.createElement)("path",{d:"M690.455 792.468l-31.469-11.512 122.696-335.442 31.475 11.512zm-386.683-.534L189.205 448.199l31.845-10.615 114.567 343.735zM793.55 951.778h-587.1L25 393.336 500 48.222 975 393.39zM230.833 918.21H769.22l166.356-512.103L500.053 89.653 64.478 406.108z"});function Lh(){return(Lh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Ih=Object(r.createElement)("path",{d:"M500 975L85.906 742.303V267.356L500 25l414.094 232.644v475zM124.908 722.458L500 936.156l380.264-222.459V277.542L500 63.95 124.908 286.408z"});function Dh(){return(Dh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var zh=Object(r.createElement)("path",{d:"M793.55 951.778h-587.1L25 393.336 500 48.222 975 393.39zM230.833 918.21H769.22l166.356-512.103L500.053 89.653 64.478 406.108z"});function _h(){return(_h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Hh=Object(r.createElement)("path",{d:"M975 911.35H25l475-822.7zM83.003 877.836H917.05L500 155.572z"});function Vh(){return(Vh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Fh=Object(r.createElement)("path",{d:"M975 975H25V25h950zM59.57 940.483h880.86V59.57H59.57z"});function Gh(){return(Gh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Uh=Object(r.createElement)("path",{d:"M289.35 963.31L25 633.31l93.148-412.33L498.654 36.69l381.404 182.6L975 631.252 712.234 962.308zM61.572 624.813l243.978 304.563 390.217-.897 242.553-305.566-87.659-380.19-351.955-168.51-351.111 170.146z"});function Wh(){return(Wh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Yh=Object(r.createElement)("path",{d:"M696.793 975H303.26L25 696.793V303.26L303.26 25h393.533L975 303.26v393.533zm-379.546-33.674h365.612l258.52-258.414V317.247l-258.52-258.52H317.247l-258.52 258.52v365.665z"});function qh(){return(qh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var $h=Object(r.createElement)("path",{d:"M218.75 468.75l140.625-187.5L468.75 422.187l78.125-93.75L656.25 468.75zM687.5 125h-250L375 62.5H187.5c-34.52 0-62.5 27.98-62.5 62.5v375c0 34.52 27.98 62.5 62.5 62.5h500c34.52 0 62.5-27.98 62.5-62.5V187.5c0-34.52-27.98-62.5-62.5-62.5zm-625 62.5H0V625c0 34.52 27.98 62.5 62.5 62.5H625V625H62.5zm0 0"});function Kh(){return(Kh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Xh=Object(r.createElement)("path",{d:"M975 500L797.825 368.583l42.803 115.742H159.319l42.803-115.742L25 500l177.122 131.417-41.747-112.84h679.144l-41.694 112.84z"});function Zh(){return(Zh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var Qh=Object(r.createElement)("path",{d:"M500 25L368.583 202.175l115.742-42.803v681.309l-115.742-42.803L500 975l131.417-177.122-112.84 41.747V160.481l112.84 41.694z"});function Jh(){return(Jh=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var tf=Object(r.createElement)("path",{d:"M852.49 687.559C879.934 630.757 895.7 567.292 895.7 500c0-240.073-195.277-435.35-435.35-435.35C220.278 64.65 25 259.926 25 500c0 240.073 195.278 435.35 435.35 435.35 69.601 0 135.31-16.822 193.63-45.982l-12.602-33.316c-54.36 27.774-115.78 43.74-181.027 43.74-220.414 0-399.858-179.313-399.858-399.792 0-220.48 179.379-399.858 399.858-399.858 220.545 0 399.857 179.379 399.857 399.858 0 61.156-14.646 118.618-39.451 170.406l-2.639-1.65-81.278-94.537 29.952 226.68L975 706.427z"});function ef(){return(ef=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var nf=Object(r.createElement)("path",{d:"M474.812 183.482c42.511-3.244 84.89.665 126.774 12.838 166.696 48.452 311.991 227.933 362.669 601.774.254 1.873 1.355 2.931 1.604 4.814l9.629 65.794-33.7-57.77c-113.495-200.68-220.912-288.903-311.317-308.108-90.405-19.205-166.973 27.93-223.057 110.726.15 1.044.856 3.722 3.209 8.024 4.707 8.603 13.413 21.578 25.676 36.908 24.526 30.661 61.649 71.78 97.888 121.96l14.443 20.861h-25.676c-132.691 0-364.081-4.623-494.257-6.419L15.86 793.28v-12.838s3.21-373.383 3.21-505.49v-30.49l22.466 22.466c29.89 29.89 68.798 64.785 101.098 96.284 88.106-100.114 208.859-170.318 332.18-179.73zm1.605 25.676c-119.433 9.385-239.23 78.63-324.156 179.73l-8.023 11.233-9.629-11.233c-26.536-26.495-59.981-56.526-89.864-85.05-.345 144.968-3.052 448.397-3.21 465.37 125.037 1.834 325.006 5.912 455.743 6.42-29.225-38.47-59.383-75.03-80.236-101.098-12.553-15.693-22.561-28.558-28.885-40.118-3.162-5.78-5.534-11.524-6.42-17.653-.795-5.515.77-12.485 4.815-17.652.237-.349 1.367.349 1.605 0 59.697-87.544 145.64-143.518 247.128-121.959 90.757 19.28 190.036 110.26 292.06 271.2C870.878 420.83 739.347 262.763 593.563 220.39c-38.758-11.265-77.334-14.361-117.145-11.233z"});function rf(){return(rf=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var af=Object(r.createElement)("path",{d:"M312.5 112.281c-125.718 0-227.906 102.188-227.906 227.906 0 125.719 102.188 227.907 227.906 227.907s227.906-102.188 227.906-227.907c0-125.718-102.188-227.906-227.906-227.906zm0 24.688c112.375 0 203.219 90.844 203.219 203.219 0 112.374-90.844 203.218-203.219 203.218s-203.219-90.844-203.219-203.218c0-112.375 90.844-203.22 203.219-203.22zm-.063-84.219C174.692 49.882 46.61 159.983 28.315 296.444 4.99 430.188 91.115 571.324 220.298 612.51c74.609 25.626 159.667 18.33 228.733-19.854C562.64 707.741 675.265 823.88 789.485 938.308c49.238 44.192 137.416 13.003 147.28-52.625 11.157-44.223-19.799-80.152-49.866-107.752l-313.243-318.65c58.598-120.77 15.778-277.983-94.87-353.464-48.148-34.437-107.154-53.25-166.349-53.067zm0 24.688C440.74 74.544 559.563 179.1 573.11 306.69c7.157 53.927-3.7 109.63-29.141 157.591C662.272 584.97 781.267 705.074 899.18 826.085c36.076 40.15 1.724 111.32-52.063 108.365-42.866-.758-64.88-42.353-93.898-67.544-99.947-101.689-199.904-203.367-299.845-305.062-103.604 68.778-253.74 48.687-335.487-44.925-88.773-93.62-90.672-253.023-4.183-348.748 49.053-57.228 123.333-91.223 198.733-90.733zm427.47-36.5v108.406h-108.5v126.812h108.5V384.47h126.75V276.156H975V149.344H866.656V40.938h-126.75zm24.687 24.687h77.375v108.406h108.343v77.406H841.97v108.344h-77.375V251.437h-108.5v-77.406h108.5V65.625z"});function of(){return(of=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var sf=Object(r.createElement)("path",{d:"M312.875 105.875c-125.888 0-228.188 102.3-228.188 228.188 0 125.888 102.3 228.218 228.188 228.218 125.888 0 228.219-102.33 228.219-228.218 0-125.889-102.33-228.188-228.219-228.188zm0 24.719c112.527 0 203.5 90.942 203.5 203.469 0 112.526-90.973 203.468-203.5 203.468S109.406 446.59 109.406 334.063c0-112.527 90.942-203.47 203.469-203.47zm-.031-84.375c-137.939-2.868-266.2 107.39-284.524 244.04C4.96 424.193 91.217 565.522 220.578 606.769c74.712 25.667 159.889 18.353 229.047-19.894 113.754 115.25 226.548 231.5 340.9 346.129 49.31 44.232 137.597 12.992 147.486-52.71 11.152-44.27-19.824-80.262-49.93-107.896L574.406 453.344c58.667-120.945 15.807-278.381-94.994-353.98-48.21-34.488-107.294-53.328-166.568-53.145zm0 24.718C441.32 68.04 560.274 172.766 573.827 300.52c7.134 53.985-3.634 109.795-29.17 157.793 118.503 120.826 237.63 241.135 355.717 362.31 36.097 40.2 1.709 111.429-52.121 108.51-43-.744-64.986-42.4-94.064-67.638-100.088-101.817-200.143-203.667-300.251-305.464-103.737 68.89-254.066 48.744-335.918-44.989-88.903-93.75-90.805-253.38-4.189-349.237 49.123-57.308 123.506-91.357 199.013-90.868zm345.031 23.438v118.344H975V94.375H657.875zm24.75 24.75h267.656V188H682.625v-68.875z"});function cf(){return(cf=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var lf=Object(r.createElement)("circle",{cx:500,cy:500,r:450,fill:"#fff",stroke:"#000",strokeWidth:40});function uf(){return(uf=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var pf=Object(r.createElement)("path",{fill:"#fff",stroke:"#000",strokeWidth:40,d:"M100 150h800v700H100z"});function df(){return(df=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var hf=Object(r.createElement)("path",{d:"M200 210l100 590 80-600 140 600h180l150-650",fill:"#fff",stroke:"#000",strokeWidth:40});function ff(){return(ff=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var mf=Object(r.createElement)("path",{d:"M200 210l600 590",fill:"#fff",stroke:"#000",strokeWidth:40});var gf={about:function(t){return Object(r.createElement)("svg",Np({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Mp)},analyse:function(t){return Object(r.createElement)("svg",kp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),Bp)},arom:function(t){return Object(r.createElement)("svg",Lp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ip)},"bond-any":function(t){return Object(r.createElement)("svg",Dp({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",height:1e3,width:1e3},t),zp)},"bond-aromatic":function(t){return Object(r.createElement)("svg",_p({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Hp)},"bond-crossed":function(t){return Object(r.createElement)("svg",Vp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Fp)},"bond-double":function(t){return Object(r.createElement)("svg",Gp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Up)},"bond-doublearomatic":function(t){return Object(r.createElement)("svg",Wp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Yp)},"bond-down":function(t){return Object(r.createElement)("svg",qp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),$p)},"bond-single":function(t){return Object(r.createElement)("svg",Kp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Xp)},"bond-singlearomatic":function(t){return Object(r.createElement)("svg",Zp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Qp)},"bond-singledouble":function(t){return Object(r.createElement)("svg",Jp({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),td)},"bond-triple":function(t){return Object(r.createElement)("svg",ed({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),nd)},"bond-up":function(t){return Object(r.createElement)("svg",rd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),ad)},"bond-updown":function(t){return Object(r.createElement)("svg",od({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),id)},chain:function(t){return Object(r.createElement)("svg",sd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),cd)},"charge-minus":function(t){return Object(r.createElement)("svg",ld({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),ud)},"charge-plus":function(t){return Object(r.createElement)("svg",pd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),dd)},check:function(t){return Object(r.createElement)("svg",hd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),fd)},"chiral-flag":function(t){return Object(r.createElement)("svg",md({"data-name":"Layer 1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 -5 70 35"},t),gd,bd)},cip:function(t){return Object(r.createElement)("svg",vd({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),yd)},clean:function(t){return Object(r.createElement)("svg",wd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),Ed)},copy:function(t){return Object(r.createElement)("svg",Od({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),xd)},cut:function(t){return Object(r.createElement)("svg",Sd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ad)},dearom:function(t){return Object(r.createElement)("svg",Pd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Td)},dropdown:function(t){return Object(r.createElement)("svg",Cd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Rd)},"enhanced-stereo":function(t){return Object(r.createElement)("svg",t,jd)},erase:function(t){return Object(r.createElement)("svg",Nd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Md)},"generic-groups":function(t){return Object(r.createElement)("svg",kd({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 750 750",height:1e3,width:1e3},t),Bd)},help:function(t){return Object(r.createElement)("svg",Ld({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Id)},layout:function(t){return Object(r.createElement)("svg",Dd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),zd)},logo:function(t){return Object(r.createElement)("svg",_d({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3},t),Hd)},miew:function(t){return Object(r.createElement)("svg",Vd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),Fd)},new:function(t){return Object(r.createElement)("svg",Gd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ud)},open:function(t){return Object(r.createElement)("svg",Wd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Yd)},paste:function(t){return Object(r.createElement)("svg",qd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),$d)},"period-table":function(t){return Object(r.createElement)("svg",Kd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Xd)},"reaction-arrow":function(t){return Object(r.createElement)("svg",Zd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),Qd)},"reaction-automap":function(t){return Object(r.createElement)("svg",Jd({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),th)},"reaction-map":function(t){return Object(r.createElement)("svg",eh({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),nh)},"reaction-plus":function(t){return Object(r.createElement)("svg",rh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),ah)},"reaction-unmap":function(t){return Object(r.createElement)("svg",oh({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),ih)},recognize:function(t){return Object(r.createElement)("svg",sh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),ch)},redo:function(t){return Object(r.createElement)("svg",lh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),uh)},"rgroup-attpoints":function(t){return Object(r.createElement)("svg",ph({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"-125 -125 1000 1000"},t),dh)},"rgroup-fragment":function(t){return Object(r.createElement)("svg",hh({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),fh)},"rgroup-label":function(t){return Object(r.createElement)("svg",mh({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),gh)},save:function(t){return Object(r.createElement)("svg",bh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),vh)},"select-fragment":function(t){return Object(r.createElement)("svg",yh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),wh)},"select-lasso":function(t){return Object(r.createElement)("svg",Eh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Oh)},"select-rectangle":function(t){return Object(r.createElement)("svg",xh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Sh)},settings:function(t){return Object(r.createElement)("svg",Ah({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ph)},"sgroup-data":function(t){return Object(r.createElement)("svg",Rh({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1000 1000",width:1e3,height:1e3},t),jh)},sgroup:function(t){return Object(r.createElement)("svg",Th({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ch)},"template-0":function(t){return Object(r.createElement)("svg",Nh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Mh)},"template-1":function(t){return Object(r.createElement)("svg",kh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Bh)},"template-2":function(t){return Object(r.createElement)("svg",Lh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Ih)},"template-3":function(t){return Object(r.createElement)("svg",Dh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),zh)},"template-4":function(t){return Object(r.createElement)("svg",_h({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Hh)},"template-5":function(t){return Object(r.createElement)("svg",Vh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Fh)},"template-6":function(t){return Object(r.createElement)("svg",Gh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Uh)},"template-7":function(t){return Object(r.createElement)("svg",Wh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Yh)},"template-lib":function(t){return Object(r.createElement)("svg",qh({xmlns:"http://www.w3.org/2000/svg",viewBox:"-125 -125 1000 1000",height:1e3,width:1e3},t),$h)},"transform-flip-h":function(t){return Object(r.createElement)("svg",Kh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Xh)},"transform-flip-v":function(t){return Object(r.createElement)("svg",Zh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),Qh)},"transform-rotate":function(t){return Object(r.createElement)("svg",Jh({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),tf)},undo:function(t){return Object(r.createElement)("svg",ef({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),nf)},"zoom-in":function(t){return Object(r.createElement)("svg",rf({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),af)},"zoom-out":function(t){return Object(r.createElement)("svg",of({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),sf)},"shape-circle":function(t){return Object(r.createElement)("svg",cf({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),lf)},"shape-rectangle":function(t){return Object(r.createElement)("svg",uf({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),pf)},"shape-polyline":function(t){return Object(r.createElement)("svg",df({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),hf)},"shape-line":function(t){return Object(r.createElement)("svg",ff({xmlns:"http://www.w3.org/2000/svg",width:1e3,height:1e3,viewBox:"0 0 1000 1000"},t),mf)}};function bf(){return null}function vf(t){var e=t.name,n=D()(t,["name"]),r=function(t){return t&&gf.hasOwnProperty(t)?gf[t]:bf}(e);return a.a.createElement(r,n)}var yf={Escape:"Esc",Delete:"Del",Mod:/Mac/.test(navigator.platform)?"\u2318":"Ctrl"};function wf(t){return(Array.isArray(t)?t[0]:t).replace(/(\b[a-z]\b$|Mod|Escape|Delete)/g,(function(t){return yf[t]||t.toUpperCase()}))}function Ef(t){var e=t.name,n=t.action,o=t.status,i=void 0===o?{}:o,s=t.onAction,c=n.shortcut&&wf(n.shortcut),l=Object(r.useRef)(null);return a.a.createElement("button",{ref:l,disabled:i.disabled,onClick:function(t){i.selected&&!function(t){var e=zc(t);return e&&e.classList.contains("opened")}(l.current)||(s(n.action),t.stopPropagation())},title:c?"".concat(n.title," (").concat(c,")"):n.title},a.a.createElement(vf,{name:e}),a.a.createElement("kbd",null,c))}function Of(t,e){for(var n=null,r=0;r<t.length;r++){var a,o=t[r];if(null===(a=e[o])||void 0===a?void 0:a.selected){n=o;break}}return n}function xf(t){var e=t.name,n=t.menu,r=t.className,o=t.role,i=D()(t,["name","menu","className","role"]);return a.a.createElement("menu",{className:r,role:o,style:Sf(e,n,i.visibleTools)},n.map((function(t,e){return a.a.createElement("li",{key:t.id||t,id:t.id||t,className:tt()(i.status[t])+" ".concat(t.id===i.opened?"opened":""),onClick:function(t){return function(t,e){var n=zc(t.currentTarget),r=t.currentTarget.classList.contains("selected");e(n&&n.id,r),t.stopPropagation()}(t,i.onOpen)}},function(t,e,n,r){return"object"!==B()(e)?a.a.createElement(Ef,V()({},r,{name:e,action:t[e],status:n})):e.menu?a.a.createElement(xf,V()({},r,{name:e.id,menu:e.menu})):e.component(r)}(Ur,t,i.status[t],i),t.menu&&i.opened&&function(t,e){var n=t.menu||[],r=e.opened,o=e.status,i=D()(e,["opened","status"]),s=null;if(function(t,e){return t.id===e}(t,r))if(function(t){return t.every((function(t){return"string"===typeof t}))}(n))s=Of(n,o)||n[0];else{var c=n.reduce((function(t,e){return t.push.apply(t,P()(e.menu)),t}),[]);s=Of(c,o)||c[0]}return s&&a.a.createElement(Ef,V()({},i,{name:s,action:Ur[s],status:o[s]}))}(t,i),t.menu&&a.a.createElement(vf,{name:"dropdown"}))})))}function Sf(t,e,n){if(!n[t])return{};var r=window.innerHeight<=600||window.innerWidth<=1040?32:40,a=e.indexOf(n[t]);if(-1===a){var o=[];e.forEach((function(t){o=o.concat(t.menu)})),a=o.indexOf(n[t])}return-1!==a?{marginTop:-r*a+"px"}:{}}var Af=[{id:"mainmenu",menu:[{id:"document",menu:["new","open","save"]},{id:"edit",menu:["undo","redo","cut","copy","paste"]},{id:"zoom",menu:["zoom-in","zoom-out",{id:"zoom-list",component:function(t){var e=t.status,n=t.onAction,r=e.zoom&&e.zoom.selected;return a.a.createElement("select",{value:r,onChange:function(t){return n((function(e){return e.zoom(parseFloat(t.target.value))}))}},ar.map((function(t){return a.a.createElement("option",{key:t.toString(),value:t},"".concat((100*t).toFixed(),"%"))})))}}]},{id:"process",menu:["layout","clean","arom","dearom","cip","check","analyse","recognize","miew"]},{id:"meta",menu:["settings","help","about"]}]},{id:"toolbox",menu:[{id:"select",menu:["select-lasso","select-rectangle","select-fragment"]},"erase",{id:"bond",menu:[{id:"bond-common",menu:["bond-single","bond-double","bond-triple"]},{id:"bond-stereo",menu:["bond-up","bond-down","bond-updown","bond-crossed"]},{id:"bond-query",menu:["bond-any","bond-aromatic","bond-singledouble","bond-singlearomatic","bond-doublearomatic"]}]},"chain",{id:"charge",menu:["charge-plus","charge-minus"]},{id:"transform",menu:["transform-rotate","transform-flip-h","transform-flip-v"]},"sgroup","sgroup-data",{id:"reaction",menu:["reaction-arrow","reaction-plus","reaction-automap","reaction-map","reaction-unmap"]},{id:"rgroup",menu:["rgroup-label","rgroup-fragment","rgroup-attpoints"]},{id:"shape",menu:["shape-circle","shape-rectangle","shape-line"]}]},{id:"template",menu:[{id:"template-common",component:function(t){var e=t.active,n=t.onAction,r=wf(Ur["template-0"].shortcut),o=e&&"template"===e.tool;return a.a.createElement("menu",null,Hr.map((function(t,i){return a.a.createElement("li",{id:"template-".concat(i),className:tt()({selected:o&&e.opts.struct===t})},a.a.createElement("button",{title:"".concat(t.name," (").concat(r,")"),onClick:function(){return n({tool:"template",opts:{struct:t}})}},a.a.createElement(vf,{name:"template-".concat(i)})))})))}},"template-lib"]},{id:"elements",menu:[{id:"atom",component:function(t){return Pf(er,t)}},{id:"freq-atoms",component:function(t){return Pf(t.freqAtoms,t)}},"period-table"]}];function Pf(t,e){var n=e.active,r=e.onAction,o=n&&"atom"===n.tool;return a.a.createElement("menu",null,t.map((function(t){var e=ut.map[t],i=er.indexOf(t)>-1?wf(nr[t]):null;return a.a.createElement("li",{className:tt()({selected:o&&n.opts.label===t})},a.a.createElement(xl,{el:ut[e],shortcut:i,onClick:function(){return r({tool:"atom",opts:{label:t}})}}))})))}var Tf=Object(N.b)((function(t){return{active:t.actionState&&t.actionState.activeTool,status:t.actionState||{},freqAtoms:t.toolbar.freqAtoms,opened:t.toolbar.opened,visibleTools:t.toolbar.visibleTools}}),{onOpen:function(t,e){return{type:"OPENED",data:{menuName:t,isSelected:e}}}})((function(t){return a.a.createElement(xf,V()({menu:Af,role:"toolbar"},t))}));function Cf(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=O()(t);if(e){var a=O()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w()(this,n)}}var Rf=Object(N.b)(null,{onAction:Mr,checkServer:function(){return function(t,e){e().server.then((function(e){return t(Er({indigoVersion:null===e||void 0===e?void 0:e.indigoVersion,imagoVersions:null===e||void 0===e?void 0:e.imagoVersions,server:(null===e||void 0===e?void 0:e.indigoVersion)&&(null===e||void 0===e?void 0:e.imagoVersions)}))}),(function(t){}))}}})(function(t){v()(n,t);var e=Cf(n);function n(){return d()(this,n),e.apply(this,arguments)}return f()(n,[{key:"componentDidMount",value:function(){this.props.checkServer()}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(fa,null),a.a.createElement(wc,{id:"canvas"}),a.a.createElement(Tf,this.props),a.a.createElement(ma,null),a.a.createElement(jp,null))}}]),n}(r.Component));function jf(t,e,n,r){var o=function(t,e){var n={actionState:null,editor:null,modal:null,options:Object.assign(wr,{app:t}),server:e||Promise.reject(new Error("Standalone mode!")),templates:la},r=[X.a];return Object(K.d)(Fc,n,K.a.apply(void 0,r))}(n,r);return o.dispatch(Xr(t)),o.dispatch((function(t,e){var n=Object(M.throttle)(250,(function(){var n=e();n.editor.render.update(),t({type:"CLEAR_VISIBLE",data:n.actionState.activeTool})}));addEventListener("resize",n)})),j.a.render(a.a.createElement(N.a,{store:o},a.a.createElement(cn.Provider,{value:{staticResourcesUrl:e}},a.a.createElement(Rf,null))),t),{load:function(t,e){return o.dispatch(Br(t,e))},loadStruct:kr}}var Nf={id:"/RxnPlus",type:"object",required:["type","location"],properties:{type:{enum:["plus"]},location:{type:"array",items:{type:"float",precision:1}},prop:{type:"object"}}},Mf={id:"/RxnArrow",type:"object",required:["type","location"],properties:{type:{enum:["arrow"]},location:{type:"array",items:{type:"float",precision:1}},prop:{type:"object"}}},kf={id:"/SimpleObject",type:"object",allOf:[{properties:{type:{enum:["simpleObject"]},data:{$ref:"#/definitions/simpleObject"}},required:["type","data"]}],definitions:{simpleObject:{type:"object",properties:{mode:{type:"string"},pos:{type:"array",items:[{type:"object",properties:{x:{type:"integer"},y:{type:"integer"}},required:["x","y"]}]}},required:["type","mode","pos"]}}};function Bf(t,e,n){If.apiPath=n;var r=new URLSearchParams(document.location.search);r.has("api_path")&&(If.apiPath=r.get("api_path")),If.server=function(t,e){var n=!t||/\/$/.test(t)?t:t+"/",r=a("GET","info").then((function(t){return{indigoVersion:t.indigo_version,imagoVersions:t.imago_versions}})).catch((function(){}));function a(t,e,r,a){return r&&"GET"===t&&(e=function(t,e){return t.replace(/:(\w+)/g,(function(t,n){return e[n]}))}(e,r)),fetch(n+e,{method:t,headers:Object.assign({Accept:"application/json"},a),body:"GET"!==t?r:void 0,credentials:"same-origin"}).then((function(t){return t.json().then((function(e){return t.ok?e:Promise.reject(e.error)}))})).catch((function(t){throw Error(t)}))}function o(t,n,o){return function(i,s){var c=Object.assign({},o,i);return c.options=Object.assign(c.options||{},e,s),r.then((function(){return a(t,n,JSON.stringify(c),{"Content-Type":"application/json"})}))}}function s(){return(s=c()(i.a.mark((function t(e,n){var r,o,s,c,l;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n?"?version=".concat(n):"",t.next=3,a("POST","imago/uploads".concat(r),e,{"Content-Type":e.type||"application/octet-stream"});case 3:return o=t.sent,s=o.upload_id,c=function(){return a("GET","imago/uploads/:id",{id:s})},t.next=8,lt(c,(function(t){if("FAILURE"===t.state)throw t;return"SUCCESS"===t.state}),500,300);case 8:return l=t.sent,t.abrupt("return",{struct:l.metadata.mol_str});case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return Object.assign(r,{convert:o("POST","indigo/convert"),layout:o("POST","indigo/layout"),clean:o("POST","indigo/clean"),aromatize:o("POST","indigo/aromatize"),dearomatize:o("POST","indigo/dearomatize"),calculateCip:o("POST","indigo/calculate_cip"),automap:o("POST","indigo/automap"),check:o("POST","indigo/check"),calculate:o("POST","indigo/calculate"),recognize:function(t,e){return s.apply(this,arguments)}})}(If.apiPath,{"smart-layout":!0,"ignore-stereochemistry-errors":!0,"mass-skip-error-on-pseudoatoms":!1,"gross-formula-add-rsites":!0}),If.ui=function(t,e,n,r){return jf(t,e,n,r)}(t,e,Object.assign({},r,Lf),If.server),If.server.then((function(){r.mol&&If.ui.load(r.mol)}),(function(){document.title+=" (standalone)"}))}var Lf={version:"2.1.0-beta",buildDate:"2021-01-11T13:54:16",buildNumber:null},If=Object.assign({getSmiles:function(){return ze(If.editor.struct(),{ignoreErrors:!0})},saveSmiles:function(){var t=If.editor.struct();return on(t,"smiles-ext",If.server).catch((function(){return ze(t)}))},getMolfile:function(){return Re(If.editor.struct(),{ignoreErrors:!0})},setMolecule:function(t){"string"===typeof t&&If.ui.load(t,{rescale:!0})},addFragment:function(t){"string"===typeof t&&If.ui.load(t,{rescale:!0,fragment:!0})},showMolfile:function(t,e,n){var r=new bo(t,Object.assign({scale:n.bondLength||75},n));if(e){var a=je(e);r.setMolecule(a)}return r.update(),r},toGraph:function(){var t=rn.toGraph(If.editor.render.ctab.molecule);return function(t){var e=new _.a.Validator;e.addSchema(Ve,"/Molecule"),e.addSchema(Ye,"/RGroup"),e.addSchema(Mf,"/RxnArrow"),e.addSchema(Nf,"/RxnPlus"),e.addSchema(kf,"/SimpleObject"),e.validate(t,_e)}(t),t},fromGraph:function(){return rn.fromGraph(rn.toGraph(If.editor.render.ctab.molecule))}},Lf);function Df(t){var e=t.staticResourcesUrl,n=t.apiPath,o=Object(r.useRef)(null);return Object(r.useEffect)((function(){Bf(o.current,e,n)}),[]),a.a.createElement("div",{ref:o,className:"ketcher root"})}t.ketcher=If}).call(this,n(29))},346:function(t,e,n){t.exports=n(347)},347:function(t,e,n){"use strict";n.r(e);n(348),n(358),n(543);var r=n(1),a=n.n(r),o=n(85),i=n.n(o),s=n(335);i.a.render(a.a.createElement(s.a,null),document.getElementById("root"))},543:function(t,e,n){},804:function(t,e,n){}},[[346,1,2]]]);
//# sourceMappingURL=main.872f535b.chunk.js.map